<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title></title>
      <link href="/2022/09/27/%E8%80%83%E7%A0%94/%E9%AB%98%E6%95%B0/"/>
      <url>/2022/09/27/%E8%80%83%E7%A0%94/%E9%AB%98%E6%95%B0/</url>
      
        <content type="html"><![CDATA[<hr><hr>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>(每日LeetCode)面试题 01.02. 判定是否互为字符重排</title>
      <link href="/2022/09/27/%E6%AF%8F%E6%97%A5LeetCode/2022-9/%E9%9D%A2%E8%AF%95%E9%A2%98%2001.02%20%E5%88%A4%E5%AE%9A%E6%98%AF%E5%90%A6%E4%BA%92%E4%B8%BA%E5%AD%97%E7%AC%A6%E9%87%8D%E6%8E%92/"/>
      <url>/2022/09/27/%E6%AF%8F%E6%97%A5LeetCode/2022-9/%E9%9D%A2%E8%AF%95%E9%A2%98%2001.02%20%E5%88%A4%E5%AE%9A%E6%98%AF%E5%90%A6%E4%BA%92%E4%B8%BA%E5%AD%97%E7%AC%A6%E9%87%8D%E6%8E%92/</url>
      
        <content type="html"><![CDATA[<p>题目：</p><p>给定两个字符串 <code>s1</code> 和 <code>s2</code>，请编写一个程序，确定其中一个字符串的字符重新排列后，能否变成另一个字符串。</p><p>示例：</p><blockquote><p>输入: s1 &#x3D; “abc”, s2 &#x3D; “bca”<br>输出: true </p></blockquote><p>代码(cpp)：</p><p>方式一：排序</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">CheckPermutation1</span><span class="params">(string s1, string s2)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(s1.<span class="built_in">size</span>() != s2.<span class="built_in">size</span>())&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">sort</span>(s1.<span class="built_in">begin</span>(), s1.<span class="built_in">end</span>());</span><br><span class="line">        <span class="built_in">sort</span>(s2.<span class="built_in">begin</span>(), s2.<span class="built_in">end</span>());</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; s1.<span class="built_in">size</span>(); i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(s1[i] != s2[i])&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>方式二：哈希</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">   <span class="function"><span class="type">bool</span> <span class="title">CheckPermutation</span><span class="params">(string s1, string s2)</span></span>&#123;</span><br><span class="line">       <span class="keyword">if</span>(s1.<span class="built_in">size</span>() != s2.<span class="built_in">size</span>())&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">       </span><br><span class="line">       <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">map</span><span class="params">(<span class="number">26</span>, <span class="number">0</span>)</span></span>;</span><br><span class="line">       <span class="keyword">for</span>(<span class="keyword">auto</span>&amp; s : s1)&#123;</span><br><span class="line">           map[s - <span class="string">&#x27;a&#x27;</span>]++;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">for</span>(<span class="keyword">auto</span>&amp; s : s2)&#123;</span><br><span class="line">            <span class="keyword">if</span>(map[s - <span class="string">&#x27;a&#x27;</span>] != <span class="number">0</span>)&#123;</span><br><span class="line">                map[s - <span class="string">&#x27;a&#x27;</span>]--;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">       </span><br><span class="line">       <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 每日LeetCode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
            <tag> LeetCode </tag>
            
            <tag> 数据结构 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>(每日LeetCode)面试题 17.19. 消失的两个数字</title>
      <link href="/2022/09/26/%E6%AF%8F%E6%97%A5LeetCode/2022-9/%E9%9D%A2%E8%AF%95%E9%A2%98%2017.19%20%E6%B6%88%E5%A4%B1%E7%9A%84%E4%B8%A4%E4%B8%AA%E6%95%B0%E5%AD%97/"/>
      <url>/2022/09/26/%E6%AF%8F%E6%97%A5LeetCode/2022-9/%E9%9D%A2%E8%AF%95%E9%A2%98%2017.19%20%E6%B6%88%E5%A4%B1%E7%9A%84%E4%B8%A4%E4%B8%AA%E6%95%B0%E5%AD%97/</url>
      
        <content type="html"><![CDATA[<p>题目：</p><p>给定一个数组，包含从 1 到 N 所有的整数，但其中缺了两个数字。你能在 O(N) 时间内只用 O(1) 的空间找到它们吗？</p><p>以任意顺序返回这两个数字均可。</p><p>示例：</p><blockquote><p>输入: [2,3]<br>输出: [1,4]</p></blockquote><p>代码(cpp)：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">missingTwo</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//总长度</span></span><br><span class="line">        <span class="type">int</span> all = nums.<span class="built_in">size</span>() + <span class="number">2</span>;</span><br><span class="line">        <span class="comment">//获取总长度的元素总和</span></span><br><span class="line">        <span class="type">int</span> all_sum = all*(<span class="number">1</span> + all) / <span class="number">2</span>;</span><br><span class="line">        <span class="comment">//计算剩余的总和</span></span><br><span class="line">        <span class="type">int</span> remain_sum = all_sum;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span>&amp; num : nums)&#123;</span><br><span class="line">            remain_sum -= num;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//获取结果中间的元素，说明有一个答案必定有一个小于mid的</span></span><br><span class="line">        <span class="type">int</span> mid = remain_sum / <span class="number">2</span>;</span><br><span class="line">        <span class="comment">//计算出总和</span></span><br><span class="line">        <span class="type">int</span> mid_sum = mid*(<span class="number">1</span> + mid) / <span class="number">2</span>;</span><br><span class="line">        <span class="comment">//获取那个小于mid的答案</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span>&amp; num : nums)&#123;</span><br><span class="line">            <span class="keyword">if</span>(num &lt;= mid)&#123;</span><br><span class="line">                mid_sum -= num;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">//用剩余的减去mid_sumjiu&#x27;de</span></span><br><span class="line">        <span class="keyword">return</span> &#123;mid_sum, remain_sum - mid_sum&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 每日LeetCode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
            <tag> LeetCode </tag>
            
            <tag> 数据结构 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>(每日LeetCode)1652. 拆炸弹</title>
      <link href="/2022/09/24/%E6%AF%8F%E6%97%A5LeetCode/2022-9/1652%20%E6%8B%86%E7%82%B8%E5%BC%B9/"/>
      <url>/2022/09/24/%E6%AF%8F%E6%97%A5LeetCode/2022-9/1652%20%E6%8B%86%E7%82%B8%E5%BC%B9/</url>
      
        <content type="html"><![CDATA[<div class="story post-story"><h2 id="题目："><a href="#题目：" class="headerlink" title="题目："></a>题目：</h2><p>你有一个炸弹需要拆除，时间紧迫！你的情报员会给你一个长度为 n 的 循环 数组 code 以及一个密钥 k 。</p><p>为了获得正确的密码，你需要替换掉每一个数字。所有数字会 同时 被替换。</p><ul><li>如果 k &gt; 0 ，将第 i 个数字用 接下来 k 个数字之和替换。</li><li>如果 k &lt; 0 ，将第 i 个数字用 之前 k 个数字之和替换。</li><li>如果 k &#x3D;&#x3D; 0 ，将第 i 个数字用 0 替换。</li></ul><p>由于 code 是循环的， code[n-1] 下一个元素是 code[0] ，且 code[0] 前一个元素是 code[n-1] 。</p><p>给你 循环 数组 code 和整数密钥 k ，请你返回解密后的结果来拆除炸弹！</p></div><div class="story post-story"><h2 id="示例："><a href="#示例：" class="headerlink" title="示例："></a>示例：</h2><blockquote><p>输入：code &#x3D; [5,7,1,4], k &#x3D; 3<br>输出：[12,10,16,13]<br>解释：每个数字都被接下来 3 个数字之和替换。解密后的密码为 [7+1+4, 1+4+5, 4+5+7, 5+7+1]。注意到数组是循环连接的。</p></blockquote><blockquote><p>输入：code &#x3D; [2,4,9,3], k &#x3D; -2<br>输出：[12,5,6,13]<br>解释：解密后的密码为 [3+9, 2+3, 4+2, 9+4] 。注意到数组是循环连接的。如果 k 是负数，那么和为 之前 的数字。</p></blockquote></div><div class="story post-story"><h2 id="思路："><a href="#思路：" class="headerlink" title="思路："></a>思路：</h2><p>分为3中情况，模拟出3种情况即可</p></div><div class="story post-story"><h2 id="代码-cpp-："><a href="#代码-cpp-：" class="headerlink" title="代码(cpp)："></a>代码(cpp)：</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">decrypt</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; code, <span class="type">int</span> k)</span> </span>&#123;</span><br><span class="line">        vector&lt;<span class="type">int</span>&gt; ans;</span><br><span class="line">        <span class="type">int</span> n = code.<span class="built_in">size</span>();</span><br><span class="line">        <span class="keyword">if</span>(k == <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;(n);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (k &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; code.<span class="built_in">size</span>(); i++)&#123;</span><br><span class="line">                <span class="type">int</span> sum = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>; j &lt; k; j++)&#123;</span><br><span class="line">                    sum += code[(i + j + <span class="number">1</span>) % n];</span><br><span class="line">                &#125;</span><br><span class="line">                ans.<span class="built_in">emplace_back</span>(sum);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; code.<span class="built_in">size</span>(); i++)&#123;</span><br><span class="line">                <span class="type">int</span> sum = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="built_in">abs</span>(k); j++)&#123;</span><br><span class="line">                    sum += code[(i - j - <span class="number">1</span> + n) % n];</span><br><span class="line">                &#125;</span><br><span class="line">                ans.<span class="built_in">emplace_back</span>(sum);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></div>]]></content>
      
      
      <categories>
          
          <category> 每日LeetCode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
            <tag> LeetCode </tag>
            
            <tag> 数据结构 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>(每日LeetCode)707. 设计链表</title>
      <link href="/2022/09/23/%E6%AF%8F%E6%97%A5LeetCode/2022-9/707%20%E8%AE%BE%E8%AE%A1%E9%93%BE%E8%A1%A8/"/>
      <url>/2022/09/23/%E6%AF%8F%E6%97%A5LeetCode/2022-9/707%20%E8%AE%BE%E8%AE%A1%E9%93%BE%E8%A1%A8/</url>
      
        <content type="html"><![CDATA[<div class="story post-story"><h2 id="题目："><a href="#题目：" class="headerlink" title="题目："></a>题目：</h2><p><strong>设计链表的实现</strong>。您可以选择使用单链表或双链表。单链表中的节点应该具有两个属性：val 和 next。val 是当前节点的值，next 是指向下一个节点的指针&#x2F;引用。如果要使用双向链表，则还需要一个属性 prev 以指示链表中的上一个节点。假设链表中的所有节点都是 0-index 的。</p><p>在链表类中实现这些功能：</p><ul><li><code>get(index)</code>：获取链表中第 index 个节点的值。如果索引无效，则返回-1。</li><li><code>addAtHead(val)</code>：在链表的第一个元素之前添加一个值为 val 的节点。插入后，新节点将成为链表的第一个节点。</li><li><code>addAtTail(val)</code>：将值为 val 的节点追加到链表的最后一个元素。</li><li><code>addAtIndex(index,val)</code>：在链表中的第 index 个节点之前添加值为 val  的节点。如果 index 等于链表的长度，则该节点将附加到链表的末尾。如果 index 大于链表长度，则不会插入节点。如果index小于0，则在头部插入节点。</li><li><code>deleteAtIndex(index)</code>：如果索引 index 有效，则删除链表中的第 index 个节点。</li></ul></div><div class="story post-story"><h2 id="示例："><a href="#示例：" class="headerlink" title="示例："></a>示例：</h2><blockquote><p>MyLinkedList linkedList &#x3D; new MyLinkedList();<br>linkedList.addAtHead(1);<br>linkedList.addAtTail(3);<br>linkedList.addAtIndex(1,2);      &#x2F;&#x2F;链表变为1-&gt; 2-&gt; 3<br>linkedList.get(1);                        &#x2F;&#x2F;返回2<br>linkedList.deleteAtIndex(1);     &#x2F;&#x2F;现在链表是1-&gt; 3<br>linkedList.get(1);            &#x2F;&#x2F;返回3</p></blockquote></div><div class="story post-story"><h2 id="代码-cpp-："><a href="#代码-cpp-：" class="headerlink" title="代码(cpp)："></a>代码(cpp)：</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyLinkedList</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">MyLinkedList</span>() &#123;</span><br><span class="line">        <span class="keyword">this</span>-&gt;head = <span class="keyword">new</span> <span class="built_in">ListNode</span>(<span class="number">-1</span>, <span class="literal">nullptr</span>);</span><br><span class="line">        <span class="keyword">this</span>-&gt;size = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">get</span><span class="params">(<span class="type">int</span> index)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(index &lt; <span class="number">0</span> || <span class="keyword">this</span>-&gt;size &lt;= index) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">auto</span> temp = <span class="keyword">this</span>-&gt;head;</span><br><span class="line">        <span class="keyword">while</span>(index &gt;=<span class="number">0</span>) &#123;</span><br><span class="line">            temp = temp-&gt;next;</span><br><span class="line">            index--;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> temp-&gt;val;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">addAtHead</span><span class="params">(<span class="type">int</span> val)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">addAtIndex</span>(<span class="number">0</span>, val);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">addAtTail</span><span class="params">(<span class="type">int</span> val)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>-&gt;<span class="built_in">addAtIndex</span>(<span class="keyword">this</span>-&gt;size, val);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">addAtIndex</span><span class="params">(<span class="type">int</span> index, <span class="type">int</span> val)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(index &lt; <span class="number">0</span> || <span class="keyword">this</span>-&gt;size &lt; index) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">auto</span> temp = <span class="keyword">this</span>-&gt;head;</span><br><span class="line">        <span class="keyword">while</span>(index &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            temp = temp-&gt;next;</span><br><span class="line">            index--;</span><br><span class="line">        &#125;</span><br><span class="line">        ListNode* newNode = <span class="keyword">new</span> <span class="built_in">ListNode</span>(val, temp-&gt;next);</span><br><span class="line">        temp-&gt;next = newNode;</span><br><span class="line">        <span class="keyword">this</span>-&gt;size++;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">deleteAtIndex</span><span class="params">(<span class="type">int</span> index)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(index &lt; <span class="number">0</span> || <span class="keyword">this</span>-&gt;size &lt;= index) <span class="keyword">return</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">auto</span> temp = <span class="keyword">this</span>-&gt;head;</span><br><span class="line">        <span class="keyword">while</span>(index &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            temp = temp-&gt;next;</span><br><span class="line">            index--;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">auto</span> e = temp-&gt;next;</span><br><span class="line">        temp-&gt;next = e-&gt;next;</span><br><span class="line">        <span class="keyword">delete</span> e;</span><br><span class="line">        <span class="keyword">this</span>-&gt;size--;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">ListNode</span> &#123;</span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">        <span class="type">int</span> val;</span><br><span class="line">        ListNode* next;</span><br><span class="line">        <span class="built_in">ListNode</span>(<span class="type">int</span> val, ListNode* next) &#123;</span><br><span class="line">            <span class="keyword">this</span>-&gt;val = val;</span><br><span class="line">            <span class="keyword">this</span>-&gt;next = next;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="type">int</span> size;</span><br><span class="line">    ListNode* head;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="复杂度分析："><a href="#复杂度分析：" class="headerlink" title="复杂度分析："></a>复杂度分析：</h2><ul><li><p>时间复杂度：初始化消耗 O(1)，get 消耗 O(index)，addAtHead 消耗 O(1)，addAtTail 消耗 O(n)，其中 n 为链表当前长度，即 addAtHead，addAtTail 和 addAtIndex 已调用次数之和，addAtIndex 消耗 O(index)。</p></li><li><p>空间复杂度：所有函数的单次调用空间复杂度均为 O(1)，总体空间复杂度为 O(n)，其中 n 为 addAtHead，addAtTail 和 addAtIndex 调用次数之和。</p></li></ul></div>]]></content>
      
      
      <categories>
          
          <category> 每日LeetCode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
            <tag> LeetCode </tag>
            
            <tag> 数据结构 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Git的学习笔记</title>
      <link href="/2022/09/21/Java/Git/"/>
      <url>/2022/09/21/Java/Git/</url>
      
        <content type="html"><![CDATA[<div class="story post-story"><h2 id="1-概述"><a href="#1-概述" class="headerlink" title="1.概述"></a>1.概述</h2><h3 id="1-1-开发常用场景"><a href="#1-1-开发常用场景" class="headerlink" title="1.1 开发常用场景"></a>1.1 开发常用场景</h3><ul><li><p>备份</p></li><li><p>代码还原</p></li><li><p>协同开发</p></li><li><p>追溯问题代码的编写人员和编写时间</p></li></ul><h3 id="1-2-SVN"><a href="#1-2-SVN" class="headerlink" title="1.2 SVN"></a>1.2 SVN</h3><p>SVN(subversion)，是一个开放源代码的版本控制系统，通过采用分支管理系统的高效管理，简而言之就是用于多个人共同开发同一个项目，实现共享资源，实现最终集中式的管理。</p><p>工作流程：</p><p>SVN是集中式版本控制系统，版本库是集中放在中央服务器的<br>工作流程如下:</p><ol><li>从中央服务器远程仓库下载代码</li><li>修改后将代码提交到中央服务器远程仓库</li></ol><p>优缺点:</p><ul><li>优点：简单,易操作</li><li>缺点：所有代码必须放在中央服务器  <ol><li>服务器一旦宕机无法提交代码,即容错性较差</li><li>离线无法提交代码,无法及时记录我们的提交行为</li></ol></li></ul><h3 id="1-3-Git"><a href="#1-3-Git" class="headerlink" title="1.3 Git"></a>1.3 Git</h3><p>工作流程：</p><p>Git是分布式版本控制系统(Distributed Version Control System，简称 DVCS)，分为两种类型的仓库：</p><ul><li><p>本地仓库</p></li><li><p>远程仓库</p></li></ul><p>工作流程如下：</p><ol><li>从远程仓库中克隆或拉取代码到本地仓库(clone&#x2F;pull)</li><li>从本地进行代码修改</li><li>在提交前先将代码提交到暂存区</li><li>提交到本地仓库。本地仓库中保存修改的各个历史版本</li><li>修改完成后，需要和团队成员共享代码时，将代码push到远程仓库</li></ol><p>Git和SVN的区别：</p><ol><li>SVN 是集中式版本控制工具，Git是分布式版本控制工具</li><li>SVN不支持离线提交，Git支持离线提交代码</li></ol><h3 id="1-4-Git-工作流程"><a href="#1-4-Git-工作流程" class="headerlink" title="1.4 Git 工作流程"></a>1.4 Git 工作流程</h3><pre class="mermaid">flowchart LR    A[(Remote<br>远程仓库)]    B[(Repository<br>本地仓库)]    C[(index<br>暂存区)]    D[workspace<br>工作区]    A--1.抓取/克隆<br>fetch/clone-->BA--5.拉取<br>pull<br>fetch+merge-->DB--2.检出<br>checked-->DB--6.推送<br>push-->AC--4.提交<br>commit-->BD--3.添加<br>add-->C</pre><p>命令如下：</p><ol><li>clone(克隆)：从玩程仓庄中克隆代码到本地仓库</li><li>checkout(检出)：从本地仓库中检出一个仓库分支然后进行修订</li><li>add(添加)：在提交的先格代码堤交到智存区</li><li>commit(提交)：提交到本地仓库，本地仓南中保存修放的各个历史版本</li><li>fetch(抓取)：从污程车，抓取到本地仓库，不进行任何的合井动作，一般操作比较少。</li><li>pull(拉取)：从运程库拉到本地库，白动进行合井(merge)，然后放到到工作区，相当于fetch+merge</li><li>push(推送)：修改完成后，需要和团队成员共享代码，将代码推送到远程仓库</li></ol></div><div class="story post-story"><h2 id="2-Git的使用及常用命令"><a href="#2-Git的使用及常用命令" class="headerlink" title="2.Git的使用及常用命令"></a>2.Git的使用及常用命令</h2><p>再windows桌面或者文件夹中右键，会出现：</p><ul><li><code>Git GUI</code>：Git提供的图像化界面工具</li><li><code>Git Bash</code>：Git提供的命令行工具</li></ul><h3 id="2-1-基本配置"><a href="#2-1-基本配置" class="headerlink" title="2.1 基本配置"></a>2.1 基本配置</h3><h4 id="配置用户信息"><a href="#配置用户信息" class="headerlink" title="配置用户信息"></a>配置用户信息</h4><ol><li><p>打开<code>Git Bash</code></p></li><li><p>设置用户信息</p><ul><li><p><code>git config --global user.name&quot;XXX&quot;</code></p></li><li><p><code>git config --global user.email&quot;666@qq.com&quot;</code></p></li></ul></li><li><p>查看用户信息</p><ul><li><p><code>git config --global user.name</code></p></li><li><p><code>git config --global user.email</code></p></li></ul></li></ol><h4 id="为常用指令配置别名"><a href="#为常用指令配置别名" class="headerlink" title="为常用指令配置别名"></a>为常用指令配置别名</h4><p>有些常用的指令参数非常多，每次都要出入好多参数，我们可以起别名：</p><ol><li><p>打开<code>Users</code>目录，创建<code>.bashrc</code>文件</p><p>再<code>Users</code>目录中右键，打开<code>Git Bash</code>，输入下面来创建<code>.bashrc</code>文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">touch</span> ~/.bashrc</span><br></pre></td></tr></table></figure></li><li><p>再<code>.bashrc</code>文件输入以下内容</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#用于输出git提交日志</span></span><br><span class="line"><span class="built_in">alias</span> git-log=<span class="string">&#x27;git log --pretty=oneline --all --graph --abbrev-commit&#x27;</span></span><br><span class="line"><span class="comment">#用于输出当前目录所有文件及其文件信息</span></span><br><span class="line"><span class="built_in">alias</span> ll=<span class="string">&#x27;ls -al&#x27;</span></span><br></pre></td></tr></table></figure></li><li><p>接着执行：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> ~/.bash</span><br></pre></td></tr></table></figure></li></ol><h4 id="解决Git-Bash乱码问题"><a href="#解决Git-Bash乱码问题" class="headerlink" title="解决Git Bash乱码问题"></a>解决Git Bash乱码问题</h4><ol><li><p>打开Git Bash执行下面命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git config --global core.quotepath <span class="literal">false</span></span><br></pre></td></tr></table></figure></li><li><p><code>$&#123;git_home&#125;/etc/bash.bashrc</code>文件最后加入下面内容：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export LANG=&quot;zh_CN.UTF-8&quot;</span><br><span class="line">export LC_ALL=&quot;zh_CN.UTF-8&quot;</span><br></pre></td></tr></table></figure></li></ol><h3 id="2-2-获取本地仓库"><a href="#2-2-获取本地仓库" class="headerlink" title="2.2 获取本地仓库"></a>2.2 获取本地仓库</h3><p>要使用Git对代码进行版本控制，首先需要获得本地仓库</p><ol><li><p>在电脑的任意位置创建一个空目录(例如test)作为我们的本地Git仓库</p></li><li><p>进入这个目录中，点击右键打开Git bash窗口</p></li><li><p>执行命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git init</span><br></pre></td></tr></table></figure></li><li><p>如果创建成功后可在文件夹下看到隐藏的<code>.git</code>目录。</p></li></ol><h3 id="2-3-基础操作命令"><a href="#2-3-基础操作命令" class="headerlink" title="2.3 基础操作命令"></a>2.3 基础操作命令</h3><p>Git工作目录对于文件的修改(增加、删除、更新)会存在几个状态，这些<strong>修改</strong>状态会随着执行Git命令而发生变化</p><img src="https://s2.loli.net/2022/09/22/2R67LeqzPWbku5o.png" class="lazyload" data-srcset="https://s2.loli.net/2022/09/22/2R67LeqzPWbku5o.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220922142123000.png" style="zoom:67%;" /><p>使用命令来控制这些状态之间的转换：</p><ul><li><code>git add</code>：工作区–&gt;暂存区</li><li><code>git commit</code>：暂存区–&gt;本地仓库</li></ul><h4 id="查看修改的状态"><a href="#查看修改的状态" class="headerlink" title="查看修改的状态"></a>查看修改的状态</h4><p>查看修改的状态(暂存区、工作区)：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git status</span><br></pre></td></tr></table></figure><h4 id="添加工作区到暂存区"><a href="#添加工作区到暂存区" class="headerlink" title="添加工作区到暂存区"></a>添加工作区到暂存区</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git add 文件名</span><br></pre></td></tr></table></figure><p>或者使用通配符，如：将所有文件添加到暂存区</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git add .</span><br></pre></td></tr></table></figure><h4 id="提交暂存区到本地仓库"><a href="#提交暂存区到本地仓库" class="headerlink" title="提交暂存区到本地仓库"></a>提交暂存区到本地仓库</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git commit -m <span class="string">&#x27;注释内容&#x27;</span></span><br></pre></td></tr></table></figure><h4 id="查看日志"><a href="#查看日志" class="headerlink" title="查看日志"></a>查看日志</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">log</span> [option]</span><br></pre></td></tr></table></figure><p>option多个参数：</p><ul><li><code>--all</code>：显示所有分支</li><li><code>--pretty=oneline</code>：将提交的信息显示为一行</li><li><code>--abbrev-commit</code>：使得输出的commitId更简短</li><li><code>--graph</code>：以图的形式显示</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">log</span> --pretty=oneline --all --graph --abbrev-commit</span><br></pre></td></tr></table></figure><p>或者在之前的常用指令设置的别名：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git-log</span><br></pre></td></tr></table></figure><h4 id="版本回退"><a href="#版本回退" class="headerlink" title="版本回退"></a>版本回退</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git reset --hard commitID</span><br></pre></td></tr></table></figure><ul><li><code>commitID</code>可以使用<code>git-log</code>或<code>git log</code>查看</li></ul><p>查看已经删除的记录：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git reflog</span><br></pre></td></tr></table></figure><h4 id="添加文件至忽略列表"><a href="#添加文件至忽略列表" class="headerlink" title="添加文件至忽略列表"></a>添加文件至忽略列表</h4><p>在工作目录创建一个名为<code>.gitignore</code>的文件(文件名固定)</p><p>可以列出要忽略的文件名，如：</p><p>忽略后缀为a的文件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">*.a</span><br></pre></td></tr></table></figure><h3 id="2-4-分支"><a href="#2-4-分支" class="headerlink" title="2.4 分支"></a>2.4 分支</h3><p>几乎所有的版本控制系统都以某种形式支持分支。使用分支意味着你可以把你的工作从开发主线上分离来进行重大的BUG修改，开发新功能，以免影响开发主线</p><h4 id="查看本地分支"><a href="#查看本地分支" class="headerlink" title="查看本地分支"></a>查看本地分支</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git branch</span><br></pre></td></tr></table></figure><h4 id="创建本地分支"><a href="#创建本地分支" class="headerlink" title="创建本地分支"></a>创建本地分支</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git branch 分支名</span><br></pre></td></tr></table></figure><h4 id="切换分支"><a href="#切换分支" class="headerlink" title="切换分支"></a>切换分支</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git checkout 分支名</span><br></pre></td></tr></table></figure><p>还可以切换到另一个不存在的分支(创建并切换)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git checkout -b 分支名</span><br></pre></td></tr></table></figure><h4 id="合并分支"><a href="#合并分支" class="headerlink" title="合并分支"></a>合并分支</h4><p>一个分支上的提交可以合并到另一个分支</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git merge 分支名称</span><br></pre></td></tr></table></figure><h4 id="删除分支"><a href="#删除分支" class="headerlink" title="删除分支"></a>删除分支</h4><p>不能删除当前分支，只能删除其他分支</p><p>删除分支时，需要删除其他分支：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git branch -d b1</span><br></pre></td></tr></table></figure><p>不做任何检查，强制删除：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git branch -D b1</span><br></pre></td></tr></table></figure><h4 id="解决冲突"><a href="#解决冲突" class="headerlink" title="解决冲突"></a>解决冲突</h4><p>当两个分支上对文件的修改可能会存在冲突，如同时修改同一个文件的同一行，这时需要手动解决冲突，解决步骤如下：</p><ol><li>处理文件中冲突的地方</li><li>将解决完的冲突的文件加入暂存区(add)</li><li>提交到仓库(commit)</li></ol><h4 id="开发中分支使用原则"><a href="#开发中分支使用原则" class="headerlink" title="开发中分支使用原则"></a>开发中分支使用原则</h4><p>在开发中，一般有如下分支使用原则与流程：</p><ul><li>master(生产分支)<ul><li>线上分支、主分支、中小规模项目作为线上运行的应用对应的分支</li></ul></li><li>develop(开发分支)<ul><li>是从master创建的分支，一般作为开发部门的主要开发分支，如果没有其他并行开发不同期上线要求，都可以在此版本进行开发，阶段开发完成后，需要合并到master分支，准备上线</li></ul></li><li>feature&#x2F;XXX分支<ul><li>从develop创建的分支，一般是同期并行开发，但不同期上线时创建的分支，分支上的研发任务完成后合并到develop分支。</li></ul></li><li>hotfix&#x2F;XXX分支<ul><li>从master派生的分支，一般作为线上bug修复使用，修复完成后需要合并到master、test、 develop分支。</li></ul></li><li>还有其他一些分支如，test分支(用于代码测试)、pre分支(预上线分支)等</li></ul></div><div class="story post-story"><h2 id="3-Git远程仓库"><a href="#3-Git远程仓库" class="headerlink" title="3.Git远程仓库"></a>3.Git远程仓库</h2><h3 id="3-1-常用的托管仓库"><a href="#3-1-常用的托管仓库" class="headerlink" title="3.1 常用的托管仓库"></a>3.1 常用的托管仓库</h3><p>那么我们如何搭建Git远程仓库呢？</p><p>我们可以借助互联网上提供的一些代码托管服务水实现，其中比较常用的有GitHub、码云等。</p><ul><li><a href="https://github.com/">gitHub</a>是一个面向开源及私有软件项目的托管平台，因为只支持Git作为唯一的版本库格式进行托管，故名gitHub</li><li><a href="https://gitee.com/">码云</a>(gitee)是国内的一个代码托管平台，由手服务器在国内，所以相比于GitHub，码云速度会更快</li></ul><h3 id="3-2-操作远程仓库"><a href="#3-2-操作远程仓库" class="headerlink" title="3.2 操作远程仓库"></a>3.2 操作远程仓库</h3><h4 id="远程仓库的添加"><a href="#远程仓库的添加" class="headerlink" title="远程仓库的添加"></a>远程仓库的添加</h4><p>命令：<code>git remote add &lt;远端名称&gt; &lt;仓库路径&gt;</code></p><ul><li>远端名称：默认为origin(可以自己取)，取决于远端服务器设置</li><li>仓库名称：从远程仓库服务器获取的URL</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git remote add origin 仓库地址</span><br></pre></td></tr></table></figure><h4 id="查看远程仓库"><a href="#查看远程仓库" class="headerlink" title="查看远程仓库"></a>查看远程仓库</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git remote</span><br></pre></td></tr></table></figure><h4 id="推送到远程仓库"><a href="#推送到远程仓库" class="headerlink" title="推送到远程仓库"></a>推送到远程仓库</h4><p>命令：<code>git push [-f] [--set-upstream] [远端名称] [本地分支名]:[远端分支名]</code></p><ul><li><p><code>-f</code>：强制覆盖</p></li><li><p>注意：如果本地分支名和远端分支名相同，则只需写本地分支名即可</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push origin master</span><br></pre></td></tr></table></figure></li><li><p><code>--set-upstream</code>：推送到远端的同时并建立起与远端分支的关联</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push --set-upstream origin master</span><br></pre></td></tr></table></figure><p>如果当前分支已经和远端分支关联，则可以省略分支名和远端名</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push</span><br></pre></td></tr></table></figure></li></ul><h4 id="本地分支与远端分支"><a href="#本地分支与远端分支" class="headerlink" title="本地分支与远端分支"></a>本地分支与远端分支</h4><p>查看关联关系：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git branch -vv</span><br></pre></td></tr></table></figure><h4 id="从远程仓库克隆"><a href="#从远程仓库克隆" class="headerlink" title="从远程仓库克隆"></a>从远程仓库克隆</h4><p>将远程仓库克隆到本地：</p><p>命令：<code>git clone &lt;仓库路径&gt; &lt;本地目录&gt;</code></p><ul><li>注意：本地目录可以省略，会在当前文件夹自动生成一个目录</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> 仓库路径</span><br></pre></td></tr></table></figure><h4 id="从远程仓库抓取和拉取"><a href="#从远程仓库抓取和拉取" class="headerlink" title="从远程仓库抓取和拉取"></a>从远程仓库抓取和拉取</h4><p>抓取：将仓库里的更新都抓取到本地，不会进行合并</p><ul><li><p>抓取命令：<code>git fetch [remote name] [branch name]</code></p></li><li><p>如果不指定远端名称和分支名，则会抓取所有分支</p></li></ul><p>拉取：将远端仓库的修改拉到本地并自动进行合并，等同于<code>fetch+merge</code></p><ul><li><p>拉取命令：<code>git pull [remote name] [branch name]</code></p></li><li><p>如果不指定远端名称和分支名，则会抓取所有分支并更新当前分支</p></li></ul><h4 id="解决合并冲突"><a href="#解决合并冲突" class="headerlink" title="解决合并冲突"></a>解决合并冲突</h4><p>在一段时间，A、B用户修改了同一个文件，且修改了同一行位置的代码，此时会发生合并冲突。</p><p>A用户在本地修改代码后优先推送到远程仓库，此时B用户在本地修订代码，提交到本地仓库后，也需要推送到远程仓库，此时B用户晚于A用户，故需要先拉取远程仓库的提交，经过合井后才能推送到远端分支,如下图所示。</p><p>在B用户拉取代码时，因为A、B用户同一段时同修改了同一个文件的相同位置代码，故会发生合并冲突。</p><p>远程分支也是分支，所以合井时冲突的解决方式也和解決本地分支冲突相同相同</p></div>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>(每日LeetCode)698. 划分为k个相等的子集</title>
      <link href="/2022/09/20/%E6%AF%8F%E6%97%A5LeetCode/2022-9/698%20%E5%88%92%E5%88%86%E4%B8%BAk%E4%B8%AA%E7%9B%B8%E7%AD%89%E7%9A%84%E5%AD%90%E9%9B%86/"/>
      <url>/2022/09/20/%E6%AF%8F%E6%97%A5LeetCode/2022-9/698%20%E5%88%92%E5%88%86%E4%B8%BAk%E4%B8%AA%E7%9B%B8%E7%AD%89%E7%9A%84%E5%AD%90%E9%9B%86/</url>
      
        <content type="html"><![CDATA[<div class="story post-story"><h2 id="题目："><a href="#题目：" class="headerlink" title="题目："></a>题目：</h2><p>给定一个整数数组 <code>nums</code> 和一个正整数 <code>k</code>，找出是否有可能把这个数组分成 <code>k</code> 个非空子集，其总和都相等。</p></div><div class="story post-story"><h2 id="示例："><a href="#示例：" class="headerlink" title="示例："></a>示例：</h2><blockquote><p>输入： nums &#x3D; [4, 3, 2, 3, 5, 2, 1], k &#x3D; 4<br>输出： True<br>说明： 有可能将其分成 4 个子集（5），（1,4），（2,3），（2,3）等于总和。</p></blockquote></div><div class="story post-story"><h2 id="思路："><a href="#思路：" class="headerlink" title="思路："></a>思路：</h2><p>计算出nums的元素总和。</p><p>除以k，不能除尽，则说明不存在解</p><p>总和除以k，可以求出平均值，得出每个桶(arr数组)需要装的元素大小</p><p>利用回溯进行装球(nums中的元素)，得出解</p></div><div class="story post-story"><h2 id="代码-cpp-；"><a href="#代码-cpp-；" class="headerlink" title="代码(cpp)；"></a>代码(cpp)；</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">dfs</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums, <span class="type">int</span> target, vector&lt;<span class="type">int</span>&gt; arr, <span class="type">int</span> k, <span class="type">int</span> index)</span></span>&#123;</span><br><span class="line">        <span class="comment">//如果index到了nums的末尾的后一位</span></span><br><span class="line">        <span class="keyword">if</span>(index == nums.<span class="built_in">size</span>())&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">auto</span>&amp; a : arr)&#123;</span><br><span class="line">                <span class="comment">//如果有一个桶里的数不等于平均数，则返回false</span></span><br><span class="line">                <span class="keyword">if</span>(a != target) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//遍历完成，返回true</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">//遍历每个桶</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; k; i++)&#123;</span><br><span class="line">            <span class="comment">//如果第i桶加上nums中的index位置的元素，大于平均数</span></span><br><span class="line">            <span class="keyword">if</span>(arr[i] + nums[index] &gt; target)</span><br><span class="line">                <span class="comment">//进入到下一个桶(i+1)</span></span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            <span class="comment">//第i桶加上index位置元素</span></span><br><span class="line">            arr[i] += nums[index];</span><br><span class="line"><span class="comment">//调用递归，插入index+1位置的元素</span></span><br><span class="line">            <span class="keyword">if</span>(<span class="built_in">dfs</span>(nums, target, arr, k, index + <span class="number">1</span>))</span><br><span class="line">                <span class="comment">//如果递归完成后每个桶里的数都等于平均数，则返回为真</span></span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line"><span class="comment">//运行到这里说明，这个index位置的元素，放到i桶里不合适</span></span><br><span class="line">            <span class="comment">//将i桶中的这个位置的元素剔除，放到i+1桶里试试</span></span><br><span class="line">            arr[i] -= nums[index];</span><br><span class="line">            </span><br><span class="line"><span class="comment">//剔除这个位置的元素后，如果这个桶为0，则说明放到别的桶里也一样</span></span><br><span class="line">            <span class="comment">//每个桶要放的大小都一样</span></span><br><span class="line">            <span class="keyword">if</span>(arr[i] == <span class="number">0</span>) <span class="keyword">break</span>; <span class="comment">//剪枝</span></span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">//遍历完全后，还没有找到解，则返回false</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">canPartitionKSubsets</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums, <span class="type">int</span> k)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//如果nums的元素个数小于k，则返回flase</span></span><br><span class="line">        <span class="keyword">if</span>(nums.<span class="built_in">size</span>() &lt; k) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"><span class="comment">//获取nums的元素总和</span></span><br><span class="line">        <span class="type">int</span> sum = <span class="built_in">accumulate</span>(nums.<span class="built_in">begin</span>(),nums.<span class="built_in">end</span>(),<span class="number">0</span>);</span><br><span class="line">        <span class="comment">//如果不能被k除尽，则返回false</span></span><br><span class="line">        <span class="keyword">if</span>(sum%k != <span class="number">0</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"><span class="comment">//降序排列</span></span><br><span class="line">        <span class="built_in">sort</span>(nums.<span class="built_in">begin</span>(), nums.<span class="built_in">end</span>(), <span class="built_in">greater</span>&lt;<span class="type">int</span>&gt;());</span><br><span class="line"><span class="comment">//获取sum的平均数</span></span><br><span class="line">        <span class="type">int</span> target = sum / k;</span><br><span class="line"><span class="comment">//用来记录每个桶的大小</span></span><br><span class="line">        <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">arr</span><span class="params">(k)</span></span>;</span><br><span class="line"><span class="comment">//调用回溯,得出解</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">dfs</span>(nums, target, arr, k, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></div>]]></content>
      
      
      <categories>
          
          <category> 每日LeetCode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
            <tag> LeetCode </tag>
            
            <tag> 数据结构 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>(每日LeetCode)1636. 按照频率将数组升序排序</title>
      <link href="/2022/09/19/%E6%AF%8F%E6%97%A5LeetCode/2022-9/1636%20%E6%8C%89%E7%85%A7%E9%A2%91%E7%8E%87%E5%B0%86%E6%95%B0%E7%BB%84%E5%8D%87%E5%BA%8F%E6%8E%92%E5%BA%8F/"/>
      <url>/2022/09/19/%E6%AF%8F%E6%97%A5LeetCode/2022-9/1636%20%E6%8C%89%E7%85%A7%E9%A2%91%E7%8E%87%E5%B0%86%E6%95%B0%E7%BB%84%E5%8D%87%E5%BA%8F%E6%8E%92%E5%BA%8F/</url>
      
        <content type="html"><![CDATA[<div class="story post-story"><h2 id="题目："><a href="#题目：" class="headerlink" title="题目："></a>题目：</h2><p>给你一个整数数组 <code>nums</code> ，请你将数组按照每个值的频率 <strong>升序</strong> 排序。如果有多个值的频率相同，请你按照数值本身将它们 <strong>降序</strong> 排序。 </p><p>请你返回排序后的数组。</p></div><div class="story post-story"><h2 id="示例："><a href="#示例：" class="headerlink" title="示例："></a>示例：</h2><blockquote><p>输入：nums &#x3D; [1,1,2,2,2,3]<br>输出：[3,1,1,2,2,2]<br>解释：’3’ 频率为 1，’1’ 频率为 2，’2’ 频率为 3 。</p></blockquote></div><div class="story post-story"><h2 id="思路："><a href="#思路：" class="headerlink" title="思路："></a>思路：</h2><p>获取nums数组中的每个元素的频率，通过频率比较：</p><ul><li>如果频率相等的情况，按照元素的大小进行降序排列</li><li>如果频率不相等的情况，按照元素的排列大小进行升序排列</li></ul></div><div class="story post-story"><h2 id="代码-cpp-："><a href="#代码-cpp-：" class="headerlink" title="代码(cpp)："></a>代码(cpp)：</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">frequencySort</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums)</span> </span>&#123;</span><br><span class="line">        unordered_map&lt;<span class="type">int</span>, <span class="type">int</span>&gt; map;</span><br><span class="line">        <span class="comment">//获取nums中各个元素的频率</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span>&amp; num : nums)&#123;</span><br><span class="line">            map[num]++;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">//给nums自定义排序</span></span><br><span class="line">        <span class="built_in">sort</span>(nums.<span class="built_in">begin</span>(), nums.<span class="built_in">end</span>(), [&amp;](<span class="type">int</span> a, <span class="type">int</span> b)&#123;</span><br><span class="line">            <span class="comment">//频率不相等的情况，按照升序排列</span></span><br><span class="line">            <span class="keyword">if</span>(map[a] != map[b])&#123;</span><br><span class="line">                <span class="keyword">return</span> map[a] &lt; map[b];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//排列相等的情况，按照降序排序</span></span><br><span class="line">            <span class="keyword">return</span> a &gt; b;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> nums;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="复杂度分析："><a href="#复杂度分析：" class="headerlink" title="复杂度分析："></a>复杂度分析：</h2><ul><li><p>时间复杂度：O(nlogn)，其中 n 是数组 nums 的长度。排序消耗 O(nlogn) 时间。</p></li><li><p>空间复杂度：O(n)，存储数组元素频率的哈希表消耗 O(n) 空间。</p></li></ul></div>]]></content>
      
      
      <categories>
          
          <category> 每日LeetCode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
            <tag> LeetCode </tag>
            
            <tag> 数据结构 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>(每日LeetCode)1640. 能否连接形成数组</title>
      <link href="/2022/09/19/%E6%AF%8F%E6%97%A5LeetCode/2022-9/1640%20%E8%83%BD%E5%90%A6%E8%BF%9E%E6%8E%A5%E5%BD%A2%E6%88%90%E6%95%B0%E7%BB%84/"/>
      <url>/2022/09/19/%E6%AF%8F%E6%97%A5LeetCode/2022-9/1640%20%E8%83%BD%E5%90%A6%E8%BF%9E%E6%8E%A5%E5%BD%A2%E6%88%90%E6%95%B0%E7%BB%84/</url>
      
        <content type="html"><![CDATA[<div class="story post-story"><h2 id="题目："><a href="#题目：" class="headerlink" title="题目："></a>题目：</h2><p>给你一个整数数组 arr ，数组中的每个整数 互不相同 。另有一个由整数数组构成的数组 pieces，其中的整数也 互不相同 。请你以 任意顺序 连接 pieces 中的数组以形成 arr 。但是，不允许 对每个数组 pieces[i] 中的整数重新排序。</p><p>如果可以连接 pieces 中的数组形成 arr ，返回 true ；否则，返回 false 。</p></div><div class="story post-story"><h2 id="示例："><a href="#示例：" class="headerlink" title="示例："></a>示例：</h2><blockquote><p>输入：arr &#x3D; [91,4,64,78], pieces &#x3D; [[78],[4,64],[91]]<br>输出：true<br>解释：依次连接 [91]、[4,64] 和 [78]</p></blockquote></div><div class="story post-story"><h2 id="思路："><a href="#思路：" class="headerlink" title="思路："></a>思路：</h2><p>使用哈希表存储pieces中每个数组的首元素及其该数组的位置</p><p>再与arr数组比较：</p><ul><li>如果未找到(arr与pieces中的元素都相同)，则说明该元素不是pieces的数组中的首元素，返回false</li><li>如果找到，再依次比较后面的元素，如果有不同的元素，返回false</li></ul><p>直到遍历完全，没有上述问题，返回true</p></div><div class="story post-story"><h2 id="代码-cpp-："><a href="#代码-cpp-：" class="headerlink" title="代码(cpp)："></a>代码(cpp)：</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">canFormArray</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; arr, vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&amp; pieces)</span> </span>&#123;</span><br><span class="line">        unordered_map&lt;<span class="type">int</span>, <span class="type">int</span>&gt; map;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; pieces.<span class="built_in">size</span>(); i++)&#123;</span><br><span class="line">            map.<span class="built_in">emplace</span>(pieces[i][<span class="number">0</span>], i);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> i = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(i &lt; arr.<span class="built_in">size</span>())&#123;</span><br><span class="line">            <span class="keyword">auto</span> temp = map.<span class="built_in">find</span>(arr[i]);</span><br><span class="line">            <span class="keyword">if</span>(temp != map.<span class="built_in">end</span>())&#123;</span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>; j &lt; pieces[temp-&gt;second].<span class="built_in">size</span>(); j++)&#123;</span><br><span class="line">                    <span class="keyword">if</span>(arr[i++] != pieces[temp-&gt;second][j])&#123;</span><br><span class="line">                        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="复杂度分析："><a href="#复杂度分析：" class="headerlink" title="复杂度分析："></a>复杂度分析：</h2><ul><li><p>时间复杂度：O(n)，其中 n 是数组 arr 的长度。</p></li><li><p>空间复杂度：O(n)。保存哈希表需要 O(n) 的空间。</p></li></ul></div>]]></content>
      
      
      <categories>
          
          <category> 每日LeetCode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
            <tag> LeetCode </tag>
            
            <tag> 数据结构 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/09/17/Java/%E6%89%8B%E5%86%99Spring/"/>
      <url>/2022/09/17/Java/%E6%89%8B%E5%86%99Spring/</url>
      
        <content type="html"><![CDATA[<hr><hr><h3 id="手写Spring启动和扫描"><a href="#手写Spring启动和扫描" class="headerlink" title="手写Spring启动和扫描"></a>手写Spring启动和扫描</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(ElementType.TYPE)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> ComponentScan &#123;</span><br><span class="line"></span><br><span class="line">    String <span class="title function_">value</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(ElementType.TYPE)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Component &#123;</span><br><span class="line"></span><br><span class="line">    String <span class="title function_">value</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(ElementType.TYPE)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Scope &#123;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">value</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BeanDefinition</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Class cls;</span><br><span class="line">    <span class="keyword">private</span> String scope;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">BeanDefinition</span><span class="params">()</span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">BeanDefinition</span><span class="params">(Class cls, String scope)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.cls = cls;</span><br><span class="line">        <span class="built_in">this</span>.scope = scope;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Class <span class="title function_">getCls</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> cls;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCls</span><span class="params">(Class cls)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.cls = cls;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getScope</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> scope;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setScope</span><span class="params">(String scope)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.scope = scope;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyApplicationContext</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Class ApplicationConfig;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ConcurrentHashMap&lt;String, Object&gt; beanDefinitionMap = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MyApplicationContext</span><span class="params">(Class ApplicationConfig)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.ApplicationConfig = ApplicationConfig;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//解析配置类</span></span><br><span class="line">        scan(ApplicationConfig);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//扫描路径中的bean</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">scan</span><span class="params">(Class ApplicationConfig)</span> &#123;</span><br><span class="line">        <span class="comment">//判断是否存在ComponentScan注解</span></span><br><span class="line">        <span class="keyword">if</span> (!ApplicationConfig.isAnnotationPresent(ComponentScan.class))&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;not found interface ComponentScan&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//获取ComponentScan注解</span></span><br><span class="line">        <span class="type">ComponentScan</span> <span class="variable">componentScan</span> <span class="operator">=</span> (ComponentScan) ApplicationConfig.getDeclaredAnnotation(ComponentScan.class);</span><br><span class="line">        <span class="comment">//获取扫描的路径</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">path</span> <span class="operator">=</span> componentScan.value();</span><br><span class="line">        path = path.replace(<span class="string">&quot;.&quot;</span>,<span class="string">&quot;/&quot;</span>);</span><br><span class="line">        <span class="comment">//扫描路径</span></span><br><span class="line">        <span class="type">ClassLoader</span> <span class="variable">classLoader</span> <span class="operator">=</span> MyApplicationContext.class.getClassLoader(); <span class="comment">//app</span></span><br><span class="line">        <span class="type">URL</span> <span class="variable">resource</span> <span class="operator">=</span> classLoader.getResource(path);</span><br><span class="line">        <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(resource.getFile()); <span class="comment">//获取目录</span></span><br><span class="line">        <span class="keyword">if</span> (file.isDirectory())&#123; <span class="comment">//目录是否为空</span></span><br><span class="line">            File[] files = file.listFiles(); <span class="comment">//获取目录中的类路径</span></span><br><span class="line">            <span class="keyword">for</span> (File f : files) &#123;</span><br><span class="line">                <span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> f.getAbsolutePath(); <span class="comment">//获取类路径字符串</span></span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (fileName.endsWith(<span class="string">&quot;.class&quot;</span>))&#123; <span class="comment">//判断是否是类文件</span></span><br><span class="line">                    <span class="comment">//分割获取指定的路径</span></span><br><span class="line">                    <span class="type">String</span> <span class="variable">className</span> <span class="operator">=</span> fileName.substring(fileName.indexOf(<span class="string">&quot;com&quot;</span>),fileName.indexOf(<span class="string">&quot;.class&quot;</span>));</span><br><span class="line">                    className = className.replace(<span class="string">&quot;\\&quot;</span>, <span class="string">&quot;.&quot;</span>);</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        Class&lt;?&gt; cls = classLoader.loadClass(className); <span class="comment">//获取到类</span></span><br><span class="line">                        <span class="comment">//判断是否类中是否有Component注解</span></span><br><span class="line">                        <span class="keyword">if</span> (cls.isAnnotationPresent(Component.class))&#123;</span><br><span class="line">                            <span class="comment">//获取Component中的bean名</span></span><br><span class="line">                            <span class="type">Component</span> <span class="variable">component</span> <span class="operator">=</span> cls.getDeclaredAnnotation(Component.class);</span><br><span class="line">                            <span class="type">String</span> <span class="variable">beanName</span> <span class="operator">=</span> component.value();</span><br><span class="line"></span><br><span class="line">                            <span class="type">BeanDefinition</span> <span class="variable">definition</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BeanDefinition</span>();</span><br><span class="line">                            definition.setCls(cls);</span><br><span class="line"><span class="comment">//判断是否类中是否有Scope注解</span></span><br><span class="line">                            <span class="keyword">if</span> (cls.isAnnotationPresent(Scope.class))&#123;</span><br><span class="line">                                <span class="type">Scope</span> <span class="variable">scope</span> <span class="operator">=</span> cls.getDeclaredAnnotation(Scope.class);</span><br><span class="line">                                definition.setScope(scope.value());</span><br><span class="line">                            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                                definition.setScope(<span class="string">&quot;singleton&quot;</span>);</span><br><span class="line">                            &#125;</span><br><span class="line"></span><br><span class="line">                            beanDefinitionMap.put(beanName, definition);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//TODO</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">getBean</span><span class="params">(String beanName)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="手写getBean"><a href="#手写getBean" class="headerlink" title="手写getBean()"></a>手写getBean()</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyApplicationContext</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Class ApplicationConfig;</span><br><span class="line">    <span class="comment">//单例对象池</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ConcurrentHashMap&lt;String, Object&gt; singletonObjects = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ConcurrentHashMap&lt;String, Object&gt; beanDefinitionMap = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MyApplicationContext</span><span class="params">(Class ApplicationConfig)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.ApplicationConfig = ApplicationConfig;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//解析配置类</span></span><br><span class="line">        scan(ApplicationConfig);</span><br><span class="line">        <span class="comment">//创建出单例bean，多例bean无需创建随用随创</span></span><br><span class="line">        <span class="keyword">for</span> (String beanName : beanDefinitionMap.keySet()) &#123;</span><br><span class="line">            <span class="type">BeanDefinition</span> <span class="variable">beanDefinition</span> <span class="operator">=</span> (BeanDefinition) beanDefinitionMap.get(beanName);</span><br><span class="line">            <span class="keyword">if</span> (beanDefinition.getScope().equals(<span class="string">&quot;singleton&quot;</span>)) &#123;</span><br><span class="line">                <span class="type">Object</span> <span class="variable">bean</span> <span class="operator">=</span> createBean(beanDefinition);</span><br><span class="line">                singletonObjects.put(beanName, bean);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//通过beanDefinition中的cls创建bean</span></span><br><span class="line">    <span class="keyword">private</span> Object <span class="title function_">createBean</span><span class="params">(BeanDefinition beanDefinition)</span>&#123;</span><br><span class="line">        <span class="type">Class</span> <span class="variable">cls</span> <span class="operator">=</span> beanDefinition.getCls();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">Object</span> <span class="variable">instance</span> <span class="operator">=</span> cls.getDeclaredConstructor().newInstance();</span><br><span class="line">            <span class="keyword">return</span> instance;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InstantiationException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InvocationTargetException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchMethodException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//扫描路径中的bean</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">scan</span><span class="params">(Class ApplicationConfig)</span> &#123;</span><br><span class="line">        <span class="comment">//判断是否存在ComponentScan注解</span></span><br><span class="line">        <span class="keyword">if</span> (!ApplicationConfig.isAnnotationPresent(ComponentScan.class))&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;not found interface ComponentScan&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//获取ComponentScan注解</span></span><br><span class="line">        <span class="type">ComponentScan</span> <span class="variable">componentScan</span> <span class="operator">=</span> (ComponentScan) ApplicationConfig.getDeclaredAnnotation(ComponentScan.class);</span><br><span class="line">        <span class="comment">//获取扫描的路径</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">path</span> <span class="operator">=</span> componentScan.value();</span><br><span class="line">        path = path.replace(<span class="string">&quot;.&quot;</span>,<span class="string">&quot;/&quot;</span>);</span><br><span class="line">        <span class="comment">//扫描路径</span></span><br><span class="line">        <span class="type">ClassLoader</span> <span class="variable">classLoader</span> <span class="operator">=</span> MyApplicationContext.class.getClassLoader(); <span class="comment">//app</span></span><br><span class="line">        <span class="type">URL</span> <span class="variable">resource</span> <span class="operator">=</span> classLoader.getResource(path);</span><br><span class="line">        <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(resource.getFile()); <span class="comment">//获取目录</span></span><br><span class="line">        <span class="keyword">if</span> (file.isDirectory())&#123; <span class="comment">//目录是否为空</span></span><br><span class="line">            File[] files = file.listFiles(); <span class="comment">//获取目录中的类路径</span></span><br><span class="line">            <span class="keyword">for</span> (File f : files) &#123;</span><br><span class="line">                <span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> f.getAbsolutePath(); <span class="comment">//获取类路径字符串</span></span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (fileName.endsWith(<span class="string">&quot;.class&quot;</span>))&#123; <span class="comment">//判断是否是类文件</span></span><br><span class="line">                    <span class="comment">//分割获取指定的路径</span></span><br><span class="line">                    <span class="type">String</span> <span class="variable">className</span> <span class="operator">=</span> fileName.substring(fileName.indexOf(<span class="string">&quot;com&quot;</span>),fileName.indexOf(<span class="string">&quot;.class&quot;</span>));</span><br><span class="line">                    className = className.replace(<span class="string">&quot;\\&quot;</span>, <span class="string">&quot;.&quot;</span>);</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        Class&lt;?&gt; cls = classLoader.loadClass(className); <span class="comment">//获取到类</span></span><br><span class="line">                        <span class="comment">//判断是否类中是否有Component注解</span></span><br><span class="line">                        <span class="keyword">if</span> (cls.isAnnotationPresent(Component.class))&#123; </span><br><span class="line">                            <span class="comment">//获取Component中的bean名</span></span><br><span class="line">                            <span class="type">Component</span> <span class="variable">component</span> <span class="operator">=</span> cls.getDeclaredAnnotation(Component.class);</span><br><span class="line">                            <span class="type">String</span> <span class="variable">beanName</span> <span class="operator">=</span> component.value();</span><br><span class="line"></span><br><span class="line">                            <span class="type">BeanDefinition</span> <span class="variable">definition</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BeanDefinition</span>();</span><br><span class="line">                            definition.setCls(cls);</span><br><span class="line"><span class="comment">//判断是否类中是否有Scope注解</span></span><br><span class="line">                            <span class="keyword">if</span> (cls.isAnnotationPresent(Scope.class))&#123;</span><br><span class="line">                                <span class="type">Scope</span> <span class="variable">scope</span> <span class="operator">=</span> cls.getDeclaredAnnotation(Scope.class);</span><br><span class="line">                                definition.setScope(scope.value());</span><br><span class="line">                            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                                definition.setScope(<span class="string">&quot;singleton&quot;</span>);</span><br><span class="line">                            &#125;</span><br><span class="line"></span><br><span class="line">                            beanDefinitionMap.put(beanName, definition);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//getBean方法</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">getBean</span><span class="params">(String beanName)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (beanDefinitionMap.containsKey(beanName))&#123;</span><br><span class="line">            <span class="type">BeanDefinition</span> <span class="variable">beanDefinition</span> <span class="operator">=</span> (BeanDefinition) beanDefinitionMap.get(beanName);</span><br><span class="line">            <span class="keyword">if</span> (beanDefinition.getScope().equals(<span class="string">&quot;singleton&quot;</span>))&#123;</span><br><span class="line">                <span class="comment">//如果是单例bean，直接在单例池中取</span></span><br><span class="line">                <span class="type">Object</span> <span class="variable">bean</span> <span class="operator">=</span> singletonObjects.get(beanName);</span><br><span class="line">                <span class="keyword">return</span> bean;</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">//多例bean就创建新的bean对象</span></span><br><span class="line">                <span class="type">Object</span> <span class="variable">bean</span> <span class="operator">=</span> createBean(beanDefinition);</span><br><span class="line">                <span class="keyword">return</span> bean;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;not found bean&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="测试："><a href="#测试：" class="headerlink" title="测试："></a>测试：</h4><p>配置类：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ComponentScan(&quot;com.mine.service&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>主函数：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Application</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">MyApplicationContext</span> <span class="variable">app</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyApplicationContext</span>(AppConfig.class);</span><br><span class="line">        <span class="type">UserService</span> <span class="variable">userService</span> <span class="operator">=</span> (UserService) app.getBean(<span class="string">&quot;userService&quot;</span>);</span><br><span class="line">        <span class="type">UserService</span> <span class="variable">userService1</span> <span class="operator">=</span> (UserService) app.getBean(<span class="string">&quot;userService&quot;</span>);</span><br><span class="line">        <span class="type">UserService</span> <span class="variable">userService2</span> <span class="operator">=</span> (UserService) app.getBean(<span class="string">&quot;userService&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;userService = &quot;</span> + userService);</span><br><span class="line">        System.out.println(<span class="string">&quot;userService1 = &quot;</span> + userService1);</span><br><span class="line">        System.out.println(<span class="string">&quot;userService2 = &quot;</span> + userService2);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>将UserService设置为单例(默认就为单例)：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component(&quot;userService&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>运行结果：</p><blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">userService2 = com.mine.service.UserService@2<span class="type">e817b38</span></span><br><span class="line"><span class="variable">userService1</span> <span class="operator">=</span> com.mine.service.UserService@2<span class="type">e817b38</span></span><br><span class="line"><span class="variable">userService3</span> <span class="operator">=</span> com.mine.service.UserService@2e817b38</span><br></pre></td></tr></table></figure></blockquote><p>将UserService设为多例：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component(&quot;userService&quot;)</span></span><br><span class="line"><span class="meta">@Scope(&quot;prototype&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>运行结果：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">userService2 = com.mine.service.UserService@433<span class="type">c675d</span></span><br><span class="line"><span class="variable">userService1</span> <span class="operator">=</span> com.mine.service.UserService@3<span class="type">f91beef</span></span><br><span class="line"><span class="variable">userService3</span> <span class="operator">=</span> com.mine.service.UserService@1a6c5a9e</span><br></pre></td></tr></table></figure><h3 id="手写依赖注入"><a href="#手写依赖注入" class="headerlink" title="手写依赖注入"></a>手写依赖注入</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(&#123;ElementType.METHOD, ElementType.FIELD&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Autowired &#123;</span><br><span class="line"></span><br><span class="line">    String <span class="title function_">value</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component(&quot;orderService&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderService</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component(&quot;userService&quot;)</span></span><br><span class="line"><span class="meta">@Scope(&quot;prototype&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> OrderService orderService;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;orderService = &quot;</span> + orderService);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在createBean方法中添加：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> Object <span class="title function_">createBean</span><span class="params">(BeanDefinition beanDefinition)</span>&#123;</span><br><span class="line">        <span class="type">Class</span> <span class="variable">cls</span> <span class="operator">=</span> beanDefinition.getCls();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">Object</span> <span class="variable">instance</span> <span class="operator">=</span> cls.getDeclaredConstructor().newInstance();</span><br><span class="line">            </span><br><span class="line">            <span class="comment">//获取每个字段</span></span><br><span class="line">            <span class="keyword">for</span> (Field field : cls.getDeclaredFields()) &#123;</span><br><span class="line">                <span class="comment">//判断该字段是否有Autowired注解</span></span><br><span class="line">                <span class="keyword">if</span> (field.isAnnotationPresent(Autowired.class)) &#123;</span><br><span class="line">                    field.setAccessible(<span class="literal">true</span>); <span class="comment">//设置可以访问private变量的变量值</span></span><br><span class="line">                    <span class="type">Object</span> <span class="variable">bean</span> <span class="operator">=</span> getBean(field.getName());</span><br><span class="line">                    <span class="comment">//将该字段注入</span></span><br><span class="line">                    field.set(instance, bean);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> instance;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InstantiationException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InvocationTargetException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchMethodException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h4 id="测试：-1"><a href="#测试：-1" class="headerlink" title="测试："></a>测试：</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Application</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">MyApplicationContext</span> <span class="variable">app</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyApplicationContext</span>(AppConfig.class);</span><br><span class="line">        <span class="type">UserService</span> <span class="variable">userService</span> <span class="operator">=</span> (UserService) app.getBean(<span class="string">&quot;userService&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;userService = &quot;</span> + userService);</span><br><span class="line">        userService.test();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>运行结果：</p><blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">userService = com.mine.service.UserService@179d3b25</span><br><span class="line">orderService = com.mine.service.OrderService@254989ff</span><br></pre></td></tr></table></figure></blockquote><h3 id="Aware回调"><a href="#Aware回调" class="headerlink" title="Aware回调"></a>Aware回调</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BeanNameAware</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">setBeanName</span><span class="params">(String name)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>实现BeanNameAware的接口</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component(&quot;userService&quot;)</span></span><br><span class="line"><span class="meta">@Scope(&quot;prototype&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> <span class="keyword">implements</span> <span class="title class_">BeanNameAware</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> OrderService orderService;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String beanName;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setBeanName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        beanName = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;orderService = &quot;</span> + orderService);</span><br><span class="line">        System.out.println(<span class="string">&quot;beanName = &quot;</span> + beanName);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>需要在createBean添加内容，并添加一个参数(记得把调用的createBean方法也进行修改)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> Object <span class="title function_">createBean</span><span class="params">(String beanName, BeanDefinition beanDefinition)</span>&#123;</span><br><span class="line">        <span class="type">Class</span> <span class="variable">cls</span> <span class="operator">=</span> beanDefinition.getCls();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">Object</span> <span class="variable">instance</span> <span class="operator">=</span> cls.getDeclaredConstructor().newInstance();</span><br><span class="line">            <span class="comment">//获取每个字段</span></span><br><span class="line">            <span class="keyword">for</span> (Field field : cls.getDeclaredFields()) &#123;</span><br><span class="line">                <span class="comment">//判断该字段是否有Autowired注解</span></span><br><span class="line">                <span class="keyword">if</span> (field.isAnnotationPresent(Autowired.class)) &#123;</span><br><span class="line">                    field.setAccessible(<span class="literal">true</span>); <span class="comment">//设置可以访问private变量的变量值</span></span><br><span class="line">                    <span class="type">Object</span> <span class="variable">bean</span> <span class="operator">=</span> getBean(field.getName());</span><br><span class="line"></span><br><span class="line">                    <span class="comment">//将该字段注入</span></span><br><span class="line">                    field.set(instance, bean);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//Aware回调</span></span><br><span class="line">            <span class="keyword">if</span> (instance <span class="keyword">instanceof</span> BeanNameAware) &#123; <span class="comment">//判断instance是否实现了BeanNameAware的方法</span></span><br><span class="line">                ((BeanNameAware) instance).setBeanName(beanName);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> instance;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InstantiationException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InvocationTargetException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchMethodException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h4 id="测试：-2"><a href="#测试：-2" class="headerlink" title="测试："></a>测试：</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Application</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">MyApplicationContext</span> <span class="variable">app</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyApplicationContext</span>(AppConfig.class);</span><br><span class="line">        <span class="type">UserService</span> <span class="variable">userService</span> <span class="operator">=</span> (UserService) app.getBean(<span class="string">&quot;userService&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;userService = &quot;</span> + userService);</span><br><span class="line">        userService.test();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>运行结果·：</p><blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">userService = com.mine.service.UserService@254989<span class="type">ff</span></span><br><span class="line"><span class="variable">orderService</span> <span class="operator">=</span> com.mine.service.OrderService@5<span class="type">d099f62</span></span><br><span class="line"><span class="variable">beanName</span> <span class="operator">=</span> userService</span><br></pre></td></tr></table></figure></blockquote><h3 id="初始化机制"><a href="#初始化机制" class="headerlink" title="初始化机制"></a>初始化机制</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">InitializingBean</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">afterPropertiesSet</span><span class="params">()</span> <span class="keyword">throws</span> Exception;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component(&quot;userService&quot;)</span></span><br><span class="line"><span class="meta">@Scope(&quot;prototype&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> <span class="keyword">implements</span> <span class="title class_">InitializingBean</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> OrderService orderService;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;orderService = &quot;</span> + orderService);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterPropertiesSet</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;初始化&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> Object <span class="title function_">createBean</span><span class="params">(String beanName, BeanDefinition beanDefinition)</span>&#123;</span><br><span class="line">    <span class="type">Class</span> <span class="variable">cls</span> <span class="operator">=</span> beanDefinition.getCls();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="type">Object</span> <span class="variable">instance</span> <span class="operator">=</span> cls.getDeclaredConstructor().newInstance();</span><br><span class="line">        <span class="comment">//获取每个字段</span></span><br><span class="line">        <span class="keyword">for</span> (Field field : cls.getDeclaredFields()) &#123;</span><br><span class="line">            <span class="comment">//判断该字段是否有Autowired注解</span></span><br><span class="line">            <span class="keyword">if</span> (field.isAnnotationPresent(Autowired.class)) &#123;</span><br><span class="line">                field.setAccessible(<span class="literal">true</span>); <span class="comment">//设置可以访问private变量的变量值</span></span><br><span class="line">                <span class="type">Object</span> <span class="variable">bean</span> <span class="operator">=</span> getBean(field.getName());</span><br><span class="line"></span><br><span class="line">                <span class="comment">//将该字段注入</span></span><br><span class="line">                field.set(instance, bean);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//Aware回调</span></span><br><span class="line">        <span class="keyword">if</span> (instance <span class="keyword">instanceof</span> BeanNameAware) &#123; <span class="comment">//instance是否实现了BeanNameAware的方法</span></span><br><span class="line">            ((BeanNameAware) instance).setBeanName(beanName);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//初始化</span></span><br><span class="line">        <span class="keyword">if</span> (instance <span class="keyword">instanceof</span> InitializingBean) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                ((InitializingBean) instance).afterPropertiesSet();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InstantiationException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InvocationTargetException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (NoSuchMethodException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="测试：-3"><a href="#测试：-3" class="headerlink" title="测试："></a>测试：</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Application</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">MyApplicationContext</span> <span class="variable">app</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyApplicationContext</span>(AppConfig.class);</span><br><span class="line">        <span class="type">UserService</span> <span class="variable">userService</span> <span class="operator">=</span> (UserService) app.getBean(<span class="string">&quot;userService&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;userService = &quot;</span> + userService);</span><br><span class="line">        userService.test();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>运行结果：</p><blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">初始化</span><br><span class="line">userService = com.mine.service.UserService@254989ff</span><br><span class="line">orderService = com.mine.service.OrderService@5d099f62</span><br></pre></td></tr></table></figure></blockquote><h3 id="手写BeanPostProcessor机制"><a href="#手写BeanPostProcessor机制" class="headerlink" title="手写BeanPostProcessor机制"></a>手写BeanPostProcessor机制</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BeanPostProcessor</span> &#123;</span><br><span class="line">    Object <span class="title function_">postProcessBeforeInitialization</span><span class="params">(Object bean, String beanName)</span>;</span><br><span class="line"></span><br><span class="line">    Object <span class="title function_">postProcessAfterInitialization</span><span class="params">(Object bean, String beanName)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBeanPostProcessor</span> <span class="keyword">implements</span> <span class="title class_">BeanPostProcessor</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">postProcessBeforeInitialization</span><span class="params">(Object bean, String beanName)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;初始化前&quot;</span>+beanName);</span><br><span class="line">        <span class="keyword">return</span> bean;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">postProcessAfterInitialization</span><span class="params">(Object bean, String beanName)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;初始化后&quot;</span>+beanName);</span><br><span class="line">        <span class="keyword">return</span> bean;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>scan方法中的部分代码，添加判断BeanPostProcessor接口：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">                        Class&lt;?&gt; cls = classLoader.loadClass(className); <span class="comment">//获取到类</span></span><br><span class="line">                        <span class="keyword">if</span> (cls.isAnnotationPresent(Component.class))&#123; <span class="comment">//判断是否类中是否有Component注解</span></span><br><span class="line">                            <span class="comment">//判断是否实现了BeanPostProcessor接口</span></span><br><span class="line">                            <span class="keyword">if</span>(BeanPostProcessor.class.isAssignableFrom(cls)) &#123;</span><br><span class="line">                                <span class="type">BeanPostProcessor</span> <span class="variable">beanPostProcessor</span> <span class="operator">=</span> (BeanPostProcessor) cls.getDeclaredConstructor().newInstance();</span><br><span class="line">                                beanPostProcessorList.add(beanPostProcessor);</span><br><span class="line">                            &#125;</span><br><span class="line"></span><br><span class="line">                            <span class="type">Component</span> <span class="variable">component</span> <span class="operator">=</span> cls.getDeclaredAnnotation(Component.class);</span><br><span class="line">                            <span class="type">String</span> <span class="variable">beanName</span> <span class="operator">=</span> component.value();</span><br><span class="line"></span><br><span class="line">                            <span class="type">BeanDefinition</span> <span class="variable">definition</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BeanDefinition</span>();</span><br><span class="line">                            definition.setCls(cls);</span><br><span class="line"></span><br><span class="line">                            <span class="keyword">if</span> (cls.isAnnotationPresent(Scope.class))&#123;</span><br><span class="line">                                <span class="type">Scope</span> <span class="variable">scope</span> <span class="operator">=</span> cls.getDeclaredAnnotation(Scope.class);</span><br><span class="line">                                definition.setScope(scope.value());</span><br><span class="line">                            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                                definition.setScope(<span class="string">&quot;singleton&quot;</span>);</span><br><span class="line">                            &#125;</span><br><span class="line"></span><br><span class="line">                            beanDefinitionMap.put(beanName, definition);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> Object <span class="title function_">createBean</span><span class="params">(String beanName, BeanDefinition beanDefinition)</span>&#123;</span><br><span class="line">        <span class="type">Class</span> <span class="variable">cls</span> <span class="operator">=</span> beanDefinition.getCls();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">Object</span> <span class="variable">instance</span> <span class="operator">=</span> cls.getDeclaredConstructor().newInstance();</span><br><span class="line">            <span class="comment">//获取每个字段</span></span><br><span class="line">            <span class="keyword">for</span> (Field field : cls.getDeclaredFields()) &#123;</span><br><span class="line">                <span class="comment">//判断该字段是否有Autowired注解</span></span><br><span class="line">                <span class="keyword">if</span> (field.isAnnotationPresent(Autowired.class)) &#123;</span><br><span class="line">                    field.setAccessible(<span class="literal">true</span>); <span class="comment">//设置可以访问private变量的变量值</span></span><br><span class="line">                    <span class="type">Object</span> <span class="variable">bean</span> <span class="operator">=</span> getBean(field.getName());</span><br><span class="line"></span><br><span class="line">                    <span class="comment">//将该字段注入</span></span><br><span class="line">                    field.set(instance, bean);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//Aware回调</span></span><br><span class="line">            <span class="keyword">if</span> (instance <span class="keyword">instanceof</span> BeanNameAware) &#123; <span class="comment">//o是否实现了BeanNameAware的方法</span></span><br><span class="line">                ((BeanNameAware) instance).setBeanName(beanName);</span><br><span class="line">            &#125;</span><br><span class="line"><span class="comment">//调用初始化前定义的方法</span></span><br><span class="line">            <span class="keyword">for</span> (BeanPostProcessor beanPostProcessor : beanPostProcessorList) &#123;</span><br><span class="line">                instance = beanPostProcessor.postProcessBeforeInitialization(instance, beanName);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//初始化</span></span><br><span class="line">            <span class="keyword">if</span> (instance <span class="keyword">instanceof</span> InitializingBean) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    ((InitializingBean) instance).afterPropertiesSet();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"><span class="comment">//调用初始化后定义的方法</span></span><br><span class="line">            <span class="keyword">for</span> (BeanPostProcessor beanPostProcessor : beanPostProcessorList) &#123;</span><br><span class="line">                instance = beanPostProcessor.postProcessAfterInitialization(instance, beanName);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> instance;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InstantiationException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InvocationTargetException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchMethodException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Application</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">MyApplicationContext</span> <span class="variable">app</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyApplicationContext</span>(AppConfig.class);</span><br><span class="line">        <span class="type">UserService</span> <span class="variable">userService</span> <span class="operator">=</span> (UserService) app.getBean(<span class="string">&quot;userService&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>运行结果：</p><blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">初始化前</span><br><span class="line">初始化后</span><br><span class="line">初始化前orderService</span><br><span class="line">初始化后orderService</span><br><span class="line">初始化前userService</span><br><span class="line">初始化后userService</span><br></pre></td></tr></table></figure></blockquote><p>手写Bean生命周期</p><p>手写Aop机制</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/09/17/Java/%E5%9F%BA%E7%A1%80/"/>
      <url>/2022/09/17/Java/%E5%9F%BA%E7%A1%80/</url>
      
        <content type="html"><![CDATA[<hr><hr><p>注解</p><p>java中注解分为两种：<strong>元注解</strong>与<strong>自定义注解</strong></p><ul><li>元注解：描述注解的注解</li><li>自定义注解：开发者自己定义的注解，如Spring框架中<code>@Value</code>、<code>@Autowired</code>等</li></ul><p>JDK提供了4个标准的注解：</p><table><thead><tr><th>元注解</th><th>作用</th></tr></thead><tbody><tr><td>@Target</td><td>指定注解使用的作用范围(类、方法、字段等)</td></tr><tr><td>@Retention</td><td>指定注解的生命周期(源码、class文件、运行等)</td></tr><tr><td>@Documented</td><td>表示该注解会被javadoc文档记录</td></tr><tr><td>@Inherited</td><td>表示该注解的子类可以继承父类的注解，只能作用于类上的注解</td></tr></tbody></table><p>除了以上4个注解其余都是自定义注解</p><p>元注解参数说明：</p><ul><li>@Target参数<ul><li><strong>ElementType.METHOD：用于描述方法</strong></li><li><strong>ElementType.TYPE：用于描述类、接口(包括注解类型)或enum声明</strong></li><li>ElementType.CONSTRUCTOR：用于描述构造器</li><li>ElementType.FIELD：成员变量、对象、属性(包括enum实例)</li><li>ElementType.LOCAL_VARIABLE：用于描述局部变量</li><li>ElementType.PACKAGE：用于描述包</li><li>ElementType.PARAMETER：用于描述参数</li><li>ElementType.ANNOTATION_TYPE:用于描述参数</li></ul></li><li>@Retention参数<ul><li><strong>RetentionPolicy.RUNTIME：始终不会丢弃</strong>，运行期也保留该注解，因此可以使用反射机制读取该注解的信息</li><li>RetentionPolicy.SOURCE：在编译阶段丢弃，这些注解在编译结束后就不再有任何意义，所以它们不会写入字节码。如：<code>@Override</code>就属于这类注解</li><li>RetentionPolicy.CLASS：在类加载的时候丢弃，在字节码文件的处理中有用，注解默认使用这种方式</li></ul></li></ul><p>自定义注解实现：</p><blockquote><p>需求：需要记录方法的入口参数以及方法的返回参数，以及方法执行的时间</p></blockquote><p>自定义一个<code>@MyLog</code>注解：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(ElementType.METHOD)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> MyLog &#123;</span><br><span class="line">    <span class="comment">//描述方法</span></span><br><span class="line">    String <span class="title function_">value</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>(每日LeetCode)1624. 两个相同字符之间的最长子字符串</title>
      <link href="/2022/09/17/%E6%AF%8F%E6%97%A5LeetCode/2022-9/1624%20%E4%B8%A4%E4%B8%AA%E7%9B%B8%E5%90%8C%E5%AD%97%E7%AC%A6%E4%B9%8B%E9%97%B4%E7%9A%84%E6%9C%80%E9%95%BF%E5%AD%90%E5%AD%97%E7%AC%A6%E4%B8%B2/"/>
      <url>/2022/09/17/%E6%AF%8F%E6%97%A5LeetCode/2022-9/1624%20%E4%B8%A4%E4%B8%AA%E7%9B%B8%E5%90%8C%E5%AD%97%E7%AC%A6%E4%B9%8B%E9%97%B4%E7%9A%84%E6%9C%80%E9%95%BF%E5%AD%90%E5%AD%97%E7%AC%A6%E4%B8%B2/</url>
      
        <content type="html"><![CDATA[<div class="story post-story"><h2 id="题目："><a href="#题目：" class="headerlink" title="题目："></a>题目：</h2><p>给你一个字符串 s，请你返回 两个相同字符之间的最长子字符串的长度 ，计算长度时不含这两个字符。如果不存在这样的子字符串，返回 -1 。</p><p>子字符串 是字符串中的一个连续字符序列。</p></div><div class="story post-story"><h2 id="示例："><a href="#示例：" class="headerlink" title="示例："></a>示例：</h2><blockquote><p>输入：s &#x3D; “abca”<br>输出：2<br>解释：最优的子字符串是 “bc” 。</p></blockquote></div><div class="story post-story"><h2 id="思路："><a href="#思路：" class="headerlink" title="思路："></a>思路：</h2><p>使用哈希表存放某个字母第一次出现的位置，之后与后面再次出现的字母得到字串长度，最后得到最长的字串长度</p></div><div class="story post-story"><h2 id="代码-cpp-："><a href="#代码-cpp-：" class="headerlink" title="代码(cpp)："></a>代码(cpp)：</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    unordered_map&lt;<span class="type">char</span>, <span class="type">int</span>&gt; map;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">maxLengthBetweenEqualCharacters</span><span class="params">(string s)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> ans = <span class="number">-1</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; s.<span class="built_in">size</span>(); i++)&#123;</span><br><span class="line">            <span class="keyword">auto</span> it = map.<span class="built_in">find</span>(s[i]);</span><br><span class="line">            <span class="keyword">if</span>(it == map.<span class="built_in">end</span>())&#123;</span><br><span class="line">                map.<span class="built_in">emplace</span>(s[i], i);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="type">int</span> temp = i - <span class="number">1</span> - it-&gt;second;</span><br><span class="line">                ans = <span class="built_in">max</span>(temp, ans);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="复杂度分析："><a href="#复杂度分析：" class="headerlink" title="复杂度分析："></a>复杂度分析：</h2><ul><li><p>时间复杂度：O(n)，其中 n 表示字符串的长度。我们只需遍历一遍字符串即可。</p></li><li><p>空间复杂度：O(∣Σ∣)，其中 Σ 是字符集，在本题中字符集为所有小写字母，∣Σ∣&#x3D;26。</p></li></ul></div>]]></content>
      
      
      <categories>
          
          <category> 每日LeetCode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
            <tag> LeetCode </tag>
            
            <tag> 数据结构 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>(每日LeetCode)670. 最大交换</title>
      <link href="/2022/09/13/%E6%AF%8F%E6%97%A5LeetCode/2022-9/670%20%E6%9C%80%E5%A4%A7%E4%BA%A4%E6%8D%A2/"/>
      <url>/2022/09/13/%E6%AF%8F%E6%97%A5LeetCode/2022-9/670%20%E6%9C%80%E5%A4%A7%E4%BA%A4%E6%8D%A2/</url>
      
        <content type="html"><![CDATA[<div class="story post-story"><h2 id="题目："><a href="#题目：" class="headerlink" title="题目："></a>题目：</h2><p>给定一个非负整数，你<strong>至多</strong>可以交换一次数字中的任意两位。返回你能得到的最大值。</p></div><div class="story post-story"><h2 id="示例："><a href="#示例：" class="headerlink" title="示例："></a>示例：</h2><blockquote><p>输入: 2736<br>输出: 7236<br>解释: 交换数字2和数字7。</p></blockquote></div><div class="story post-story"><h2 id="思路：遍历"><a href="#思路：遍历" class="headerlink" title="思路：遍历"></a>思路：遍历</h2><p>先用第一个数字与后面的数字比较，找出最大的并且大于第一个数字，未找到，则用第二个数字与后面的数字比较</p><p>依次遍历，直到找到有比所比较的数字大的数字后交换位置，返回交换后的数字</p><p>如果遍历完全后，未找到，则说明，此数字已经为最大数，直接返回</p></div><div class="story post-story"><h2 id="代码-cpp-："><a href="#代码-cpp-：" class="headerlink" title="代码(cpp)："></a>代码(cpp)：</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">maximumSwap</span><span class="params">(<span class="type">int</span> num)</span> </span>&#123;</span><br><span class="line">        string str = <span class="built_in">to_string</span>(num);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; str.<span class="built_in">size</span>(); i++)&#123;</span><br><span class="line">            <span class="type">int</span> temp = i;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j = str.<span class="built_in">size</span>() - <span class="number">1</span>; j &gt;=  i + <span class="number">1</span>; j--)&#123;</span><br><span class="line">                <span class="keyword">if</span>(str[temp] &lt; str[j])&#123;</span><br><span class="line">                    temp = j;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(temp != i)&#123;</span><br><span class="line">                <span class="built_in">swap</span>(str[i], str[temp]);</span><br><span class="line">                <span class="type">int</span> ans = <span class="built_in">stoi</span>(str);</span><br><span class="line">                <span class="keyword">return</span> ans;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> num;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="复杂度分析："><a href="#复杂度分析：" class="headerlink" title="复杂度分析："></a>复杂度分析：</h2><ul><li><p>时间复杂度：O(n^2)</p></li><li><p>空间复杂度：O(n)</p></li></ul></div>]]></content>
      
      
      <categories>
          
          <category> 每日LeetCode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
            <tag> LeetCode </tag>
            
            <tag> 数据结构 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>(每日LeetCode)1608. 特殊数组的特征值</title>
      <link href="/2022/09/12/%E6%AF%8F%E6%97%A5LeetCode/2022-9/1608%20%E7%89%B9%E6%AE%8A%E6%95%B0%E7%BB%84%E7%9A%84%E7%89%B9%E5%BE%81%E5%80%BC/"/>
      <url>/2022/09/12/%E6%AF%8F%E6%97%A5LeetCode/2022-9/1608%20%E7%89%B9%E6%AE%8A%E6%95%B0%E7%BB%84%E7%9A%84%E7%89%B9%E5%BE%81%E5%80%BC/</url>
      
        <content type="html"><![CDATA[<div class="story post-story"><h2 id="题目："><a href="#题目：" class="headerlink" title="题目："></a>题目：</h2><p>给你一个非负整数数组 nums 。如果存在一个数 x ，使得 nums 中恰好有 x 个元素 大于或者等于 x ，那么就称 nums 是一个 特殊数组 ，而 x 是该数组的 特征值 。</p><p>注意： x 不必 是 nums 的中的元素。</p><p>如果数组 nums 是一个 特殊数组 ，请返回它的特征值 x 。否则，返回 -1 。可以证明的是，如果 nums 是特殊数组，那么其特征值 x 是 唯一的 。</p></div><div class="story post-story"><h2 id="示例："><a href="#示例：" class="headerlink" title="示例："></a>示例：</h2><blockquote><p>输入：nums &#x3D; [3,5]<br>输出：2<br>解释：有 2 个元素（3 和 5）大于或等于 2 。</p></blockquote></div><div class="story post-story"><h2 id="代码-cpp-：暴力枚举"><a href="#代码-cpp-：暴力枚举" class="headerlink" title="代码(cpp)：暴力枚举"></a>代码(cpp)：暴力枚举</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">specialArray</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> size = nums.<span class="built_in">size</span>();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt;= size; i++)&#123;</span><br><span class="line">            <span class="type">int</span> count = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>; j &lt; size; j++)&#123;</span><br><span class="line">                <span class="keyword">if</span>(nums[j] &gt;= i)&#123;</span><br><span class="line">                    count++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(count == i)&#123;</span><br><span class="line">                <span class="keyword">return</span> i;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="思路：降序排序-一次遍历"><a href="#思路：降序排序-一次遍历" class="headerlink" title="思路：降序排序+一次遍历"></a>思路：降序排序+一次遍历</h2><p>先将nums数组降序排序，</p><p>先以<code>x = 0</code>为例：这就说明nums数组中第一个元素以及之后的都要小于x</p><p><code>x = 1</code>时：nums数组第一个元素要大于等于x，之后的要小于x</p><p><code>x = 2</code>时：nums数组第二个元素要大于等于x(因为是降序所以第一个元素肯定大于x)，之后的要小于x</p><p>结论：<code>nums[x-1] &gt;= x</code>并且<code>num[x] &lt; x</code></p></div><div class="story post-story"><h2 id="代码-cpp-："><a href="#代码-cpp-：" class="headerlink" title="代码(cpp)："></a>代码(cpp)：</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="type">int</span> <span class="title function_">specialArray</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">size</span> <span class="operator">=</span> nums.size();</span><br><span class="line"><span class="comment">//降序排列</span></span><br><span class="line">        sort(nums.begin(), nums.end(), greater&lt;<span class="type">int</span>&gt;());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">x</span> <span class="operator">=</span> <span class="number">0</span>; x &lt;= size; x++)&#123;</span><br><span class="line">        <span class="comment">//如果存在nums[x-1] &lt; x的情况，跳出此次遍历，进入下一个</span></span><br><span class="line">            <span class="keyword">if</span>(x-<span class="number">1</span> &gt;=<span class="number">0</span> &amp;&amp; nums[x-<span class="number">1</span>] &lt; x)&#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line"><span class="comment">//如果num[x] &lt; x，返回x</span></span><br><span class="line">            <span class="keyword">if</span>(x == size || nums[x] &lt; i)&#123;</span><br><span class="line">                <span class="keyword">return</span> x;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="复杂度分析："><a href="#复杂度分析：" class="headerlink" title="复杂度分析："></a>复杂度分析：</h2><ul><li><p>时间复杂度：O(nlogn)，其中 n 是数组 nums 的长度。</p></li><li><p>空间复杂度：O(logn)，即为排序需要的栈空间。</p></li></ul></div>]]></content>
      
      
      <categories>
          
          <category> 每日LeetCode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
            <tag> LeetCode </tag>
            
            <tag> 数据结构 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>(每日LeetCode)1619. 删除某些元素后的数组均值</title>
      <link href="/2022/09/12/%E6%AF%8F%E6%97%A5LeetCode/2022-9/1619%20%E5%88%A0%E9%99%A4%E6%9F%90%E4%BA%9B%E5%85%83%E7%B4%A0%E5%90%8E%E7%9A%84%E6%95%B0%E7%BB%84%E5%9D%87%E5%80%BC/"/>
      <url>/2022/09/12/%E6%AF%8F%E6%97%A5LeetCode/2022-9/1619%20%E5%88%A0%E9%99%A4%E6%9F%90%E4%BA%9B%E5%85%83%E7%B4%A0%E5%90%8E%E7%9A%84%E6%95%B0%E7%BB%84%E5%9D%87%E5%80%BC/</url>
      
        <content type="html"><![CDATA[<div class="story post-story"><h2 id="题目："><a href="#题目：" class="headerlink" title="题目："></a>题目：</h2><p>给你一个整数数组 <code>arr</code> ，请你删除最小 <code>5%</code> 的数字和最大 <code>5%</code> 的数字后，剩余数字的平均值。</p><p>与 <strong>标准答案</strong> 误差在 <code>10^(-5)</code> 的结果都被视为正确结果。</p></div><div class="story post-story"><h2 id="示例："><a href="#示例：" class="headerlink" title="示例："></a>示例：</h2><blockquote><p>输入：arr &#x3D; [1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,3]<br>输出：2.00000<br>解释：删除数组中最大和最小的元素后，所有元素都等于 2，所以平均值为 2 。</p></blockquote></div><div class="story post-story"><h2 id="思路："><a href="#思路：" class="headerlink" title="思路："></a>思路：</h2><p>将size设为数组的元素个数</p><p>将数组排序后，将左边<code>size*0.05</code>个元素删除，并且将右边<code>size*0.05</code>个元素删除</p><p>再计算出总和除以<code>size*0.9</code>个元素(删除左右两边各<code>size*0.05</code>个元素，还剩<code>size*0.9</code>个元素)</p><p>返回平均数</p></div><div class="story post-story"><h2 id="代码-cpp-："><a href="#代码-cpp-：" class="headerlink" title="代码(cpp)："></a>代码(cpp)：</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">double</span> <span class="title">trimMean</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; arr)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">sort</span>(arr.<span class="built_in">begin</span>(), arr.<span class="built_in">end</span>());</span><br><span class="line">        <span class="type">int</span> size = arr.<span class="built_in">size</span>();</span><br><span class="line">        <span class="type">int</span> temp = <span class="built_in">int</span>(size * <span class="number">0.05</span>);</span><br><span class="line">        <span class="type">int</span> sum = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = temp; i &lt; size - temp; i++)&#123;</span><br><span class="line">            sum += arr[i];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">double</span> ans = sum / (size*<span class="number">0.9</span>);</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="复杂度分析："><a href="#复杂度分析：" class="headerlink" title="复杂度分析："></a>复杂度分析：</h2><ul><li><p>时间复杂度：O(nlogn)，其中 n 是数组 arr 的长度。</p></li><li><p>空间复杂度：O(logn)。排序需要 O(logn) 的栈空间。</p></li></ul></div>]]></content>
      
      
      <categories>
          
          <category> 每日LeetCode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
            <tag> LeetCode </tag>
            
            <tag> 数据结构 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>(每日LeetCode)669. 修剪二叉搜索树</title>
      <link href="/2022/09/10/%E6%AF%8F%E6%97%A5LeetCode/2022-9/669%20%E4%BF%AE%E5%89%AA%E4%BA%8C%E5%8F%89%E6%90%9C%E7%B4%A2%E6%A0%91/"/>
      <url>/2022/09/10/%E6%AF%8F%E6%97%A5LeetCode/2022-9/669%20%E4%BF%AE%E5%89%AA%E4%BA%8C%E5%8F%89%E6%90%9C%E7%B4%A2%E6%A0%91/</url>
      
        <content type="html"><![CDATA[<div class="story post-story"><h2 id="题目："><a href="#题目：" class="headerlink" title="题目："></a>题目：</h2><p>给你二叉搜索树的根节点 root ，同时给定最小边界low 和最大边界 high。通过修剪二叉搜索树，使得所有节点的值在[low, high]中。修剪树 不应该 改变保留在树中的元素的相对结构 (即，如果没有被移除，原有的父代子代关系都应当保留)。 可以证明，存在 唯一的答案 。</p><p>所以结果应当返回修剪好的二叉搜索树的新的根节点。注意，根节点可能会根据给定的边界发生改变。</p></div><div class="story post-story"><h2 id="示例："><a href="#示例：" class="headerlink" title="示例："></a>示例：</h2><img src="https://assets.leetcode.com/uploads/2020/09/09/trim2.jpg" class="lazyload" data-srcset="https://assets.leetcode.com/uploads/2020/09/09/trim2.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img" style="zoom:50%;" /><blockquote><p>输入：root &#x3D; [3,0,4,null,2,null,null,1], low &#x3D; 1, high &#x3D; 3<br>输出：[3,2,null,1]</p></blockquote></div><div class="story post-story"><h2 id="思路：DFS"><a href="#思路：DFS" class="headerlink" title="思路：DFS"></a>思路：DFS</h2><p>通过深度优先搜索，找出不符合<code>[low, high]</code>区间的结点，并剔除</p><p>二叉平衡树的性质：父节点大于左子树，小于右子树</p><p>如果有节点存在，<code>val</code>值小于<code>low</code>值，则说明该节点的左子树，也均小于<code>low</code>值</p><p>同理，如果有节点存在，<code>val</code>值大于<code>high</code>值，则说明该节点的右子树，也均大于<code>high</code>值</p></div><div class="story post-story"><h2 id="代码-cpp-："><a href="#代码-cpp-：" class="headerlink" title="代码(cpp)："></a>代码(cpp)：</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution1</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">TreeNode* <span class="title">trimBST</span><span class="params">(TreeNode* root, <span class="type">int</span> low, <span class="type">int</span> high)</span> </span>&#123;</span><br><span class="line"><span class="comment">//找到符合区间的结点</span></span><br><span class="line">        <span class="keyword">while</span>(root != <span class="literal">nullptr</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(root-&gt;val &lt; low)</span><br><span class="line">                root = root-&gt;right; </span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(root-&gt;val &gt; high)</span><br><span class="line">                root = root-&gt;left;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">//遍历左右子树</span></span><br><span class="line">        <span class="keyword">if</span>(root != <span class="literal">nullptr</span>)&#123;</span><br><span class="line">            root-&gt;left = <span class="built_in">trimBST</span>(root-&gt;left, low, high);</span><br><span class="line">            root-&gt;right = <span class="built_in">trimBST</span>(root-&gt;right, low, high);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> root;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="官方代码-cpp-："><a href="#官方代码-cpp-：" class="headerlink" title="官方代码(cpp)："></a>官方代码(cpp)：</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">TreeNode* <span class="title">trimBST</span><span class="params">(TreeNode* root, <span class="type">int</span> low, <span class="type">int</span> high)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (root == <span class="literal">nullptr</span>) <span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">        <span class="comment">//小于low的情况</span></span><br><span class="line">        <span class="keyword">if</span> (root-&gt;val &lt; low)</span><br><span class="line">            <span class="comment">//返回该节点的右子树</span></span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">trimBST</span>(root-&gt;right, low, high);</span><br><span class="line">        <span class="comment">//大于high的情况</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (root-&gt;val &gt; high)</span><br><span class="line">            <span class="comment">//返回该节点的左子树</span></span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">trimBST</span>(root-&gt;left, low, high);</span><br><span class="line">        <span class="comment">//遍历左右子树</span></span><br><span class="line">root-&gt;left = <span class="built_in">trimBST</span>(root-&gt;left, low, high);</span><br><span class="line">root-&gt;right = <span class="built_in">trimBST</span>(root-&gt;right, low, high);</span><br><span class="line">        </span><br><span class="line"><span class="keyword">return</span> root;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="复杂度分析："><a href="#复杂度分析：" class="headerlink" title="复杂度分析："></a>复杂度分析：</h2><ul><li>时间复杂度：O(n)，其中 n 为二叉树的结点数目。</li><li>空间复杂度：O(n)。递归栈最坏情况下需要 O(n) 的空间。</li></ul></div>]]></content>
      
      
      <categories>
          
          <category> 每日LeetCode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
            <tag> LeetCode </tag>
            
            <tag> 数据结构 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/09/09/%E8%BD%AF%E4%BB%B6%E5%AE%89%E8%A3%85/Docker%E5%AE%89%E8%A3%85Nacos/"/>
      <url>/2022/09/09/%E8%BD%AF%E4%BB%B6%E5%AE%89%E8%A3%85/Docker%E5%AE%89%E8%A3%85Nacos/</url>
      
        <content type="html"><![CDATA[<hr><hr><div class="story post-story"><h2 id="1-安装Nacos"><a href="#1-安装Nacos" class="headerlink" title="1.安装Nacos"></a>1.安装Nacos</h2><h3 id="1-1-搜索Nacos镜像"><a href="#1-1-搜索Nacos镜像" class="headerlink" title="1.1 搜索Nacos镜像"></a>1.1 搜索Nacos镜像</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker search nacos</span><br></pre></td></tr></table></figure><h3 id="1-2-拉取Nacos镜像"><a href="#1-2-拉取Nacos镜像" class="headerlink" title="1.2 拉取Nacos镜像"></a>1.2 拉取Nacos镜像</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull nacos/nacos-server</span><br></pre></td></tr></table></figure><h3 id="1-3-启动Nacos容器"><a href="#1-3-启动Nacos容器" class="headerlink" title="1.3 启动Nacos容器"></a>1.3 启动Nacos容器</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker run -id \</span><br><span class="line">--name c_nacos \</span><br><span class="line">-p 8848:8848 \</span><br><span class="line">--privileged=true \</span><br><span class="line">-e MODE=standalone \</span><br><span class="line">-e PREFER_HOST_MODE=hostname \</span><br><span class="line">nacos/nacos-server:latest</span><br></pre></td></tr></table></figure><p>参数：</p><ul><li><code>--privileged=true</code>：使容器内的root拥有真正的root权限</li></ul><h3 id="1-4-测试"><a href="#1-4-测试" class="headerlink" title="1.4 测试"></a>1.4 测试</h3><p>访问：<code>http://主机地址:8848/nacos/index.html</code></p></div><div class="story post-story"><h2 id="2-搭建Nacos集群"><a href="#2-搭建Nacos集群" class="headerlink" title="2.搭建Nacos集群"></a>2.搭建Nacos集群</h2><p>2.1 拉取mysql镜像</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull mysql</span><br></pre></td></tr></table></figure><p>2.2 拉取</p></div>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>(每日LeetCode)1598. 文件夹操作日志搜集器</title>
      <link href="/2022/09/09/%E6%AF%8F%E6%97%A5LeetCode/2022-9/1598%20%E6%96%87%E4%BB%B6%E5%A4%B9%E6%93%8D%E4%BD%9C%E6%97%A5%E5%BF%97%E6%90%9C%E9%9B%86%E5%99%A8/"/>
      <url>/2022/09/09/%E6%AF%8F%E6%97%A5LeetCode/2022-9/1598%20%E6%96%87%E4%BB%B6%E5%A4%B9%E6%93%8D%E4%BD%9C%E6%97%A5%E5%BF%97%E6%90%9C%E9%9B%86%E5%99%A8/</url>
      
        <content type="html"><![CDATA[<div class="story post-story"><h2 id="题目："><a href="#题目：" class="headerlink" title="题目："></a>题目：</h2><p>每当用户执行变更文件夹操作时，LeetCode 文件系统都会保存一条日志记录。</p><p>下面给出对变更操作的说明：</p><ul><li><code>&quot;../&quot;</code> ：移动到当前文件夹的父文件夹。如果已经在主文件夹下，则 <strong>继续停留在当前文件夹</strong> 。</li><li><code>&quot;./&quot;</code> ：继续停留在当前文件夹。</li><li><code>&quot;x/&quot;</code> ：移动到名为 x 的子文件夹中。题目数据 保证总是存在文件夹 x 。<br>给你一个字符串列表 logs ，其中 logs[i] 是用户在 i^th 步执行的操作。</li></ul><p>文件系统启动时位于主文件夹，然后执行 logs 中的操作。</p><p>执行完所有变更文件夹操作后，请你找出 <strong>返回主文件夹所需的最小步数</strong> 。</p></div><div class="story post-story"><h2 id="示例："><a href="#示例：" class="headerlink" title="示例："></a>示例：</h2><img src="https://assets.leetcode-cn.com/aliyun-lc-upload/uploads/2020/09/26/sample_11_1957.png" class="lazyload" data-srcset="https://assets.leetcode-cn.com/aliyun-lc-upload/uploads/2020/09/26/sample_11_1957.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img" style="zoom:67%;" /><blockquote><p>输入：logs &#x3D; [“d1&#x2F;“,”d2&#x2F;“,”..&#x2F;“,”d21&#x2F;“,”.&#x2F;“]<br>输出：2<br>解释：执行 “..&#x2F;“ 操作变更文件夹 2 次，即可回到主文件夹</p></blockquote></div><div class="story post-story"><h2 id="思路：栈模拟"><a href="#思路：栈模拟" class="headerlink" title="思路：栈模拟"></a>思路：栈模拟</h2><h2 id="代码-cpp-："><a href="#代码-cpp-：" class="headerlink" title="代码(cpp)："></a>代码(cpp)：</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">minOperations</span><span class="params">(vector&lt;string&gt;&amp; logs)</span> </span>&#123;</span><br><span class="line">        stack&lt;string&gt; s;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span>&amp; log : logs)&#123;</span><br><span class="line">            <span class="keyword">if</span>(log == <span class="string">&quot;../&quot;</span>)&#123;</span><br><span class="line">                <span class="keyword">if</span>(!s.<span class="built_in">empty</span>())&#123;</span><br><span class="line">                    s.<span class="built_in">pop</span>();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(log == <span class="string">&quot;./&quot;</span>)&#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                s.<span class="built_in">emplace</span>(log);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> s.<span class="built_in">size</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="复杂度分析："><a href="#复杂度分析：" class="headerlink" title="复杂度分析："></a>复杂度分析：</h2><ul><li>时间复杂度：O(n)，其中 n 字符串数组的长度。只需遍历一遍字符串数组即可。</li><li>空间复杂度：O(1)。</li></ul></div>]]></content>
      
      
      <categories>
          
          <category> 每日LeetCode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
            <tag> LeetCode </tag>
            
            <tag> 数据结构 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>(每日LeetCode)1592. 重新排列单词间的空格</title>
      <link href="/2022/09/07/%E6%AF%8F%E6%97%A5LeetCode/2022-9/1592%20%E9%87%8D%E6%96%B0%E6%8E%92%E5%88%97%E5%8D%95%E8%AF%8D%E9%97%B4%E7%9A%84%E7%A9%BA%E6%A0%BC/"/>
      <url>/2022/09/07/%E6%AF%8F%E6%97%A5LeetCode/2022-9/1592%20%E9%87%8D%E6%96%B0%E6%8E%92%E5%88%97%E5%8D%95%E8%AF%8D%E9%97%B4%E7%9A%84%E7%A9%BA%E6%A0%BC/</url>
      
        <content type="html"><![CDATA[<div class="story post-story"><h2 id="题目："><a href="#题目：" class="headerlink" title="题目："></a>题目：</h2><p>给你一个字符串 <code>text</code> ，该字符串由若干被空格包围的单词组成。每个单词由一个或者多个小写英文字母组成，并且两个单词之间至少存在一个空格。题目测试用例保证 <code>text</code> <strong>至少包含一个单词</strong> 。</p><p>请你重新排列空格，使每对相邻单词之间的空格数目都 相等 ，并尽可能 最大化 该数目。如果不能重新平均分配所有空格，请 <strong>将多余的空格放置在字符串末尾</strong> ，这也意味着返回的字符串应当与原 <code>text</code> 字符串的长度相等。</p><p>返回 <strong>重新排列空格后的字符串</strong> 。</p></div><div class="story post-story"><h2 id="示例："><a href="#示例：" class="headerlink" title="示例："></a>示例：</h2><blockquote><p>输入：text &#x3D; “  this   is  a sentence “<br>输出：”this   is   a   sentence”<br>解释：总共有 9 个空格和 4 个单词。可以将 9 个空格平均分配到相邻单词之间，相邻单词间空格数为：9 &#x2F; (4-1) &#x3D; 3 个。</p></blockquote></div><div class="story post-story"><h2 id="代码-cpp-："><a href="#代码-cpp-：" class="headerlink" title="代码(cpp)："></a>代码(cpp)：</h2><p>感觉像屎山，不确定我在看看~</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">string <span class="title">reorderSpaces</span><span class="params">(string text)</span> </span>&#123;</span><br><span class="line">        vector&lt;string&gt; str;</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> count = <span class="number">0</span>; <span class="comment">//空格数初始化为0</span></span><br><span class="line">        string temp = <span class="string">&quot;&quot;</span>; <span class="comment">//初始化单词为空</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; text.<span class="built_in">size</span>(); i++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(text[i] == <span class="string">&#x27; &#x27;</span>) &#123; <span class="comment">//如果是空格</span></span><br><span class="line">                <span class="comment">//temp不为空，插入str，并将temp置空，获取下一个单词</span></span><br><span class="line">                <span class="keyword">if</span>(temp != <span class="string">&quot;&quot;</span>)&#123; </span><br><span class="line">                    str.<span class="built_in">emplace_back</span>(temp);</span><br><span class="line">                    temp = <span class="string">&quot;&quot;</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                count++; <span class="comment">//空格数加1</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123; <span class="comment">//如果不为空格</span></span><br><span class="line">                temp += text[i]; <span class="comment">//添加字符</span></span><br><span class="line">                <span class="comment">//如果处在text字符串的末尾，直接将temp插入str中</span></span><br><span class="line">                <span class="keyword">if</span>(i == text.<span class="built_in">size</span>() - <span class="number">1</span>)&#123;</span><br><span class="line">                    str.<span class="built_in">emplace_back</span>(temp);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> num = <span class="number">0</span>; <span class="comment">//初始化两个单词之间的空格数为0</span></span><br><span class="line">        <span class="keyword">if</span>(str.<span class="built_in">size</span>() &gt; <span class="number">1</span>)&#123;</span><br><span class="line">            <span class="comment">//获取两个单词之间的空格数</span></span><br><span class="line">            num = count / (str.<span class="built_in">size</span>()<span class="number">-1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//拼接字符串</span></span><br><span class="line">        string ans = str[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt; str.<span class="built_in">size</span>(); i++)&#123;</span><br><span class="line">            <span class="comment">//拼接</span></span><br><span class="line">            ans += <span class="built_in">string</span>(num, <span class="string">&#x27; &#x27;</span>) + str[i];</span><br><span class="line">            count -= num; <span class="comment">//剩余的空格数</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//将剩余的空格加到ans的末尾</span></span><br><span class="line">        ans += <span class="built_in">string</span>(count, <span class="string">&#x27; &#x27;</span>);</span><br><span class="line">            </span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></div>]]></content>
      
      
      <categories>
          
          <category> 每日LeetCode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
            <tag> LeetCode </tag>
            
            <tag> 数据结构 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>(每日LeetCode)652. 寻找重复的子树</title>
      <link href="/2022/09/05/%E6%AF%8F%E6%97%A5LeetCode/2022-9/652%20%E5%AF%BB%E6%89%BE%E9%87%8D%E5%A4%8D%E7%9A%84%E5%AD%90%E6%A0%91/"/>
      <url>/2022/09/05/%E6%AF%8F%E6%97%A5LeetCode/2022-9/652%20%E5%AF%BB%E6%89%BE%E9%87%8D%E5%A4%8D%E7%9A%84%E5%AD%90%E6%A0%91/</url>
      
        <content type="html"><![CDATA[<div class="story post-story"><h2 id="题目："><a href="#题目：" class="headerlink" title="题目："></a>题目：</h2><p>给定一棵二叉树 root，返回所有重复的子树。</p><p>对于同一类的重复子树，你只需要返回其中任意一棵的根结点即可。</p><p>如果两棵树具有相同的结构和相同的结点值，则它们是重复的。</p></div><div class="story post-story"><h2 id="示例："><a href="#示例：" class="headerlink" title="示例："></a>示例：</h2><img src="https://assets.leetcode.com/uploads/2020/08/16/e33.jpg" class="lazyload" data-srcset="https://assets.leetcode.com/uploads/2020/08/16/e33.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img" style="zoom:50%;" /><blockquote><p>输入：root &#x3D; [2,2,2,3,null,3,null]<br>输出：[[2,3],[3]]</p></blockquote></div><div class="story post-story"><h2 id="思路：递归"><a href="#思路：递归" class="headerlink" title="思路：递归"></a>思路：递归</h2><p>通过递归获取每一段的子树的字符串</p><p>如果哈希表中不存在此字符串，则插入，存在此字符串，说明此字符串存在重复的子树</p></div><div class="story post-story"><h2 id="代码-cpp-："><a href="#代码-cpp-：" class="headerlink" title="代码(cpp)："></a>代码(cpp)：</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    unordered_set&lt;TreeNode*&gt; set;</span><br><span class="line">    unordered_map&lt;string, TreeNode*&gt; map;</span><br><span class="line"></span><br><span class="line">    <span class="function">string <span class="title">dfs</span><span class="params">(TreeNode* node)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(node == <span class="literal">nullptr</span>) <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="comment">//获取node结点的子树字符串</span></span><br><span class="line">        string str = <span class="built_in">to_string</span>(node-&gt;val) + <span class="string">&quot;(&quot;</span> + <span class="built_in">dfs</span>(node-&gt;left) + <span class="string">&quot;)(&quot;</span> + <span class="built_in">dfs</span>(node-&gt;right) + <span class="string">&quot;)&quot;</span>;</span><br><span class="line">        <span class="comment">//在哈希表中查询</span></span><br><span class="line">        <span class="keyword">auto</span> temp = map.<span class="built_in">find</span>(str);</span><br><span class="line">        <span class="keyword">if</span>(temp != map.<span class="built_in">end</span>()) <span class="comment">//存在，则插入到set中</span></span><br><span class="line">            set.<span class="built_in">emplace</span>(temp-&gt;second);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            map[str] = node; <span class="comment">//不存在，插入到哈希表中</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> str;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">vector&lt;TreeNode*&gt; <span class="title">findDuplicateSubtrees</span><span class="params">(TreeNode* root)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">dfs</span>(root);</span><br><span class="line">        <span class="comment">//将set中的元素拷贝到vector中</span></span><br><span class="line">        <span class="keyword">return</span> &#123;set.<span class="built_in">begin</span>(), set.<span class="built_in">end</span>()&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="复杂度分析："><a href="#复杂度分析：" class="headerlink" title="复杂度分析："></a>复杂度分析：</h2><ul><li><p>时间复杂度：O(n^2)，其中 n 是树中节点的数目。在最坏情况下，树呈现链状的结构，而每一个节点都会在其左右子树序列的基础上再增加最多 99 个字符（两组括号以及节点本身的值），那么所有子树的序列长度之和为 $\sum_{i&#x3D;1}^n$ 9n &#x3D; O(n^2)。构造出这些序列就需要 O(n^2) 的时间。</p></li><li><p>空间复杂度：O(n^2)，即为哈希表需要使用的空间。</p></li></ul></div>]]></content>
      
      
      <categories>
          
          <category> 每日LeetCode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
            <tag> LeetCode </tag>
            
            <tag> 数据结构 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>(每日LeetCode)1582. 二进制矩阵中的特殊位置</title>
      <link href="/2022/09/04/%E6%AF%8F%E6%97%A5LeetCode/2022-9/1582%20%E4%BA%8C%E8%BF%9B%E5%88%B6%E7%9F%A9%E9%98%B5%E4%B8%AD%E7%9A%84%E7%89%B9%E6%AE%8A%E4%BD%8D%E7%BD%AE/"/>
      <url>/2022/09/04/%E6%AF%8F%E6%97%A5LeetCode/2022-9/1582%20%E4%BA%8C%E8%BF%9B%E5%88%B6%E7%9F%A9%E9%98%B5%E4%B8%AD%E7%9A%84%E7%89%B9%E6%AE%8A%E4%BD%8D%E7%BD%AE/</url>
      
        <content type="html"><![CDATA[<div class="story post-story"><h2 id="题目："><a href="#题目：" class="headerlink" title="题目："></a>题目：</h2><p>给你一个大小为 rows x cols 的矩阵 mat，其中 mat[i][j] 是 0 或 1，请返回 矩阵 mat 中特殊位置的数目 。</p><p>特殊位置 定义：如果 mat[i][j] &#x3D;&#x3D; 1 并且第 i 行和第 j 列中的所有其他元素均为 0（行和列的下标均 从 0 开始 ），则位置 (i, j) 被称为特殊位置。</p></div><div class="story post-story"><h2 id="示例："><a href="#示例：" class="headerlink" title="示例："></a>示例：</h2><blockquote><p>输入：mat &#x3D; [[1,0,0],<br>                           [0,0,1],<br>                           [1,0,0]]<br>输出：1<br>解释：(1,2) 是一个特殊位置，因为 mat[1][2] &#x3D;&#x3D; 1 且所处的行和列上所有其他元素都是 0</p></blockquote></div><div class="story post-story"><h2 id="思路：模拟"><a href="#思路：模拟" class="headerlink" title="思路：模拟"></a>思路：模拟</h2><p>获取<code>mat</code>数组中的每行<code>i</code>及每列<code>j</code>的1元素的总个数<code>row</code>、<code>column</code></p><p>如果某<code>i</code>行只有一个1元素，某<code>j</code>列也只有一个1元素，并且该行列在<code>mat</code>数组中存在为1</p><p>说明<code>mat[i][j]</code>所处的行和列上所有其他元素都是 0</p></div><div class="story post-story"><h2 id="代码-cpp-："><a href="#代码-cpp-：" class="headerlink" title="代码(cpp)："></a>代码(cpp)：</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">numSpecial</span><span class="params">(vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&amp; mat)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> n = mat.<span class="built_in">size</span>(); <span class="comment">//获取行数</span></span><br><span class="line">        <span class="type">int</span> m = mat[<span class="number">0</span>].<span class="built_in">size</span>();  <span class="comment">//获取列数</span></span><br><span class="line">        <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">row</span><span class="params">(n)</span></span>;</span><br><span class="line">        <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">column</span><span class="params">(m)</span></span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>; j &lt; m; j++)&#123;</span><br><span class="line">                row[i] += mat[i][j]; <span class="comment">//获取每行的1元素的总个数</span></span><br><span class="line">                column[j] += mat[i][j]; <span class="comment">//获取每列的1元素的总个数</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> ans = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>; j &lt; m; j++)&#123;</span><br><span class="line">            <span class="comment">//如果i行只有一个1，j列只有一个1，并且mat数组i行j列为1</span></span><br><span class="line">                <span class="keyword">if</span>(mat[i][j] == <span class="number">1</span> &amp;&amp; row[i] == <span class="number">1</span> &amp;&amp; column[j] == <span class="number">1</span>)&#123;</span><br><span class="line">                    ans++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="复杂度分析："><a href="#复杂度分析：" class="headerlink" title="复杂度分析："></a>复杂度分析：</h2><ul><li>时间复杂度：O(m×n)，其中 m 为矩阵 mat 的行数，n 为矩阵 mat 的列数。</li><li>空间复杂度：O(m+n)，主要为预处理每一行和列的空间开销。</li></ul></div>]]></content>
      
      
      <categories>
          
          <category> 每日LeetCode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
            <tag> LeetCode </tag>
            
            <tag> 数据结构 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>C++11的学习笔记</title>
      <link href="/2022/09/03/C++/C++11%E7%89%B9%E6%80%A7/"/>
      <url>/2022/09/03/C++/C++11%E7%89%B9%E6%80%A7/</url>
      
        <content type="html"><![CDATA[<h1 id="C-11-简介"><a href="#C-11-简介" class="headerlink" title="C++11 简介"></a>C++11 简介</h1><p>C++11是对目前C++语言的扩展与修正，C++11不仅包含核心语言的新机能，而且拓展了C++的标准库(STL)，并入了大部分的C++Trehnical Report 1(TR1)程序库。</p><p>C++11包括的新特性，包括：lambda表达式、类型推导关键字auto、decltype以及模板的大量改进</p><div class="story post-story"><h2 id="1-类型推导"><a href="#1-类型推导" class="headerlink" title="1.类型推导"></a>1.类型推导</h2><h3 id="1-1-auto"><a href="#1-1-auto" class="headerlink" title="1.1 auto"></a>1.1 auto</h3><p>在C中，auto修饰局部变量，局部变量也叫auto变量，自动变量</p><p>而在C++11中，auto根据用户初始化数据类型自动推导</p><p>举例前，需要引入<code>typeinfo</code>：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;typeinfo&gt;</span></span></span><br></pre></td></tr></table></figure><p>其中下面的函数可返回a的<strong>数据类型的字符串形式</strong>：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">typeid</span>(a).<span class="built_in">name</span>();</span><br></pre></td></tr></table></figure><p>1. </p>   <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;typeinfo&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">int</span> a = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">auto</span> b = <span class="number">2</span>;</span><br><span class="line">    <span class="comment">//b的数据类型自动推导为int</span></span><br><span class="line">cout &lt;&lt; <span class="built_in">typeid</span>(b).<span class="built_in">name</span>() &lt;&lt; endl;</span><br><span class="line"><span class="keyword">auto</span> c = <span class="number">2.5</span>;</span><br><span class="line">    <span class="comment">//c的数据类型自动推导为double</span></span><br><span class="line">cout &lt;&lt; <span class="built_in">typeid</span>(c).<span class="built_in">name</span>() &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>   运行结果：</p><blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span></span><br><span class="line"><span class="type">double</span></span><br></pre></td></tr></table></figure></blockquote><p>2. </p>   <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;typeinfo&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">double</span> <span class="title">fun</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">1.5</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">auto</span> a = <span class="built_in">fun</span>();   </span><br><span class="line">    <span class="comment">//c的数据类型根据返回值自动推导为double</span></span><br><span class="line">    cout &lt;&lt; <span class="built_in">typeid</span>(a).<span class="built_in">name</span>() &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>   运行结果：</p><blockquote><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">double</span></span><br></pre></td></tr></table></figure></blockquote><p>3. </p>   <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;typeinfo&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Test</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">int</span> a;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">Test t = &#123; <span class="number">1</span> &#125;;     <span class="comment">//初始化Test结构体 a = 1</span></span><br><span class="line"><span class="keyword">auto</span> a = t;</span><br><span class="line">    <span class="comment">// d的数据类型自动推导为Test</span></span><br><span class="line">cout &lt;&lt; <span class="built_in">typeid</span>(a).<span class="built_in">name</span>() &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>   运行结果：</p><blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="keyword">struct</span> <span class="title class_">Test</span></span><br></pre></td></tr></table></figure></blockquote><ol start="4"><li><p>两种遍历方式：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">fun1</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; v)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">auto</span> it = v.<span class="built_in">begin</span>(); it != v.<span class="built_in">end</span>(); it++)</span><br><span class="line">&#123;</span><br><span class="line">cout &lt;&lt; *it &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">fun2</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; v)</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">auto</span>&amp; i : v)</span><br><span class="line">&#123;</span><br><span class="line">cout &lt;&lt; i &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>注意</strong>：</p><p>使用auto时，数据必须要<span style="color:red">初始化</span>：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">auto</span> a; <span class="comment">//报错</span></span><br><span class="line">a = <span class="number">10</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>vs不支持函数形参是auto变量(部分编译器会支持)：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">fun3</span><span class="params">(<span class="keyword">auto</span> a)</span> <span class="comment">//报错</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>不能作为自定义类型的成员变量：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Test</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">int</span> a;</span><br><span class="line"><span class="keyword">auto</span> b;     <span class="comment">//报错</span></span><br><span class="line"><span class="keyword">auto</span> c = <span class="number">0</span>; <span class="comment">//报错</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>auto不能作为初始化数组，但是可以赋值：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;typeinfo&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">//auto a[3] = &#123; 1, 2, 3 &#125;; //报错</span></span><br><span class="line"><span class="type">int</span> b[<span class="number">3</span>] = &#123; <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span> &#125;;</span><br><span class="line"><span class="keyword">auto</span> c = b;</span><br><span class="line">cout &lt;&lt; <span class="built_in">typeid</span>(c).<span class="built_in">name</span>() &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>运行结果：</p><blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> * __ptr64</span><br></pre></td></tr></table></figure></blockquote><p>模板实例化不能是auto类型：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">//vector&lt;auto&gt; v1;         //报错</span></span><br><span class="line"> <span class="comment">//vector&lt;auto&gt; v2 = &#123; 1 &#125;; //报错</span></span><br><span class="line">vector&lt;<span class="type">int</span>&gt; v3 = &#123; <span class="number">1</span> &#125;;</span><br><span class="line"><span class="keyword">auto</span> v4 = v3;              <span class="comment">//正常</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h3 id="1-2-decltype"><a href="#1-2-decltype" class="headerlink" title="1.2 decltype"></a>1.2 decltype</h3><p><code>decltype()</code>与<code>auto</code>相反，可以获取a的数据类型，并用做b的数据类型</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">decltype</span>(a) b;</span><br></pre></td></tr></table></figure><p>1. </p>   <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">int</span> i;</span><br><span class="line">    <span class="comment">//decltype(i)等价于int</span></span><br><span class="line"><span class="keyword">decltype</span>(i) j = <span class="number">0</span>;</span><br><span class="line">    cout &lt;&lt; <span class="built_in">typeid</span>(j).<span class="built_in">name</span>() &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>   运行结果：</p><blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span></span><br></pre></td></tr></table></figure></blockquote><p>2. </p>   <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;typeinfo&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">float</span> a;</span><br><span class="line"><span class="type">double</span> b;</span><br><span class="line"><span class="keyword">decltype</span>(a + b) c;</span><br><span class="line">cout &lt;&lt; <span class="built_in">typeid</span>(c).<span class="built_in">name</span>() &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>   运行结果：</p><blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="type">double</span></span><br></pre></td></tr></table></figure></blockquote><p>3. </p>   <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;typeinfo&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">vector&lt;<span class="type">int</span>&gt; v;</span><br><span class="line"><span class="keyword">decltype</span>(v.<span class="built_in">begin</span>()) it;</span><br><span class="line"><span class="comment">//打印迭代器数据类型</span></span><br><span class="line">cout &lt;&lt; <span class="built_in">typeid</span>(it).<span class="built_in">name</span>() &lt;&lt; endl;</span><br><span class="line"><span class="keyword">for</span> (it = v.<span class="built_in">begin</span>(); it != v.<span class="built_in">end</span>(); it++)</span><br><span class="line">&#123;</span><br><span class="line">        <span class="comment">//数组为空，无打印</span></span><br><span class="line">cout &lt;&lt; *it &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>   运行结果：</p><blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="keyword">class</span> <span class="title class_">std</span>::_Vector_iterator&lt;<span class="keyword">class</span> <span class="title class_">std</span>::_Vector_val&lt;<span class="keyword">struct</span> <span class="title class_">std</span>::_Simple_types&lt;<span class="type">int</span>&gt; &gt; &gt;</span><br></pre></td></tr></table></figure></blockquote><ol start="4"><li><p>匿名数据类型：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;typeinfo&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//匿名类型的枚举变量</span></span><br><span class="line"><span class="keyword">enum</span> &#123;OK, Error&#125; flag;</span><br><span class="line"><span class="keyword">decltype</span>(flag) flag2;</span><br><span class="line">cout &lt;&lt; <span class="built_in">typeid</span>(flag2).<span class="built_in">name</span>() &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>运行结果：</p><blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">enum `void __cdecl main(void)&#x27;::`2&#x27;::&lt;unnamed-type-flag&gt;</span><br></pre></td></tr></table></figure></blockquote></li></ol><h3 id="1-3-跟踪返回类型"><a href="#1-3-跟踪返回类型" class="headerlink" title="1.3 跟踪返回类型"></a>1.3 跟踪返回类型</h3><ol><li><p>正常写函数以及返回值</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">double</span> <span class="title">fun</span><span class="params">(<span class="type">int</span> a, <span class="type">double</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>引入<code>auto</code>作为返回值，并指定返回值为<code>double</code>与上面的函数效果等价</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">auto</span> <span class="title">fun1</span><span class="params">(<span class="type">int</span> a, <span class="type">double</span> b)</span> -&gt; <span class="type">double</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>自定义返回值</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">auto</span> <span class="title">fun2</span><span class="params">(<span class="type">int</span> a, <span class="type">double</span> b)</span> -&gt; <span class="title">decltype</span><span class="params">(a + b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>引入模板</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T1, <span class="keyword">class</span> T2&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">auto</span> <span class="title">fun3</span><span class="params">(T1 a, T2 b)</span> -&gt; <span class="title">decltype</span><span class="params">(a + b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol></div><div class="story post-story"><h2 id="2-易用性改进"><a href="#2-易用性改进" class="headerlink" title="2.易用性改进"></a>2.易用性改进</h2><h3 id="2-1-类内成员初始化"><a href="#2-1-类内成员初始化" class="headerlink" title="2.1 类内成员初始化"></a>2.1 类内成员初始化</h3><ol><li><p>类中的数据成员在申明时可以直接赋予一个默认值</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">A</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="built_in">A</span>(<span class="type">int</span> a, <span class="type">int</span> b) : <span class="built_in">a</span>(a),<span class="built_in">b</span>(b)  <span class="comment">//参数列表初始化 </span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> a = <span class="number">10</span>;                  <span class="comment">//`=`等号初始化默认值</span></span><br><span class="line">    <span class="type">int</span> b&#123; <span class="number">20</span> &#125;;                 <span class="comment">//`&#123;&#125;`大括号初始化默认值</span></span><br><span class="line">    </span><br><span class="line">    string str1 = <span class="string">&quot;str1&quot;</span>;        <span class="comment">//`=`等号初始化默认值</span></span><br><span class="line"><span class="comment">//string str2(&quot;str2&quot;);       //报错</span></span><br><span class="line">string str3&#123; <span class="string">&quot;str3&quot;</span> &#125;;       <span class="comment">//`&#123;&#125;`大括号初始化默认值</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">A a&#123;<span class="number">1</span>&#125;;                      <span class="comment">//通过大括号初始化</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h3 id="2-2-列表初始化"><a href="#2-2-列表初始化" class="headerlink" title="2.2 列表初始化"></a>2.2 列表初始化</h3><ol><li><p>列表初始化(<code>&#123;&#125;</code>初始化方式)</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Test</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">int</span> age;</span><br><span class="line"><span class="type">double</span> money;</span><br><span class="line"><span class="type">char</span> name[<span class="number">20</span>];</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">Test t = &#123; <span class="number">18</span>, <span class="number">64.8</span>, <span class="string">&quot;Tom&quot;</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> a = <span class="number">1</span>;</span><br><span class="line"><span class="type">int</span> b = &#123; <span class="number">1</span> &#125;;</span><br><span class="line"><span class="type">int</span> c&#123; <span class="number">1</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> arr1[] = &#123; <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span> &#125;;</span><br><span class="line"><span class="type">int</span> arr2[]&#123; <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span> &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>使用列表初始化的方式可以<strong>防止类型收窄</strong>(隐式转换导致数据丢失)</p><p><code>=</code>赋值的情况：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">int</span> a = <span class="number">128</span>;</span><br><span class="line"><span class="type">char</span> b = a;</span><br><span class="line">cout &lt;&lt; a &lt;&lt; endl;</span><br><span class="line">cout &lt;&lt; b &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>运行结果：</p><blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="number">128</span></span><br><span class="line">   <span class="comment">//为空，数据丢失。c语言中ascii码最多能表示0~127，共128个字符</span></span><br></pre></td></tr></table></figure></blockquote><p><code>&#123;&#125;</code>赋值的情况：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">int</span> a = <span class="number">128</span>;</span><br><span class="line"><span class="type">char</span> b&#123; a &#125;;</span><br><span class="line">cout &lt;&lt; a &lt;&lt; endl;</span><br><span class="line">cout &lt;&lt; b &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>vs运行报错：<strong>从“int”转换到“char”需要收缩转换</strong></p></li></ol><h3 id="2-3-for循环"><a href="#2-3-for循环" class="headerlink" title="2.3 for循环"></a>2.3 for循环</h3><ol><li><p>for循环遍历数组</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">int</span> a[] = &#123; <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span> &#125;;</span><br><span class="line"><span class="type">int</span> size = <span class="built_in">sizeof</span>(a) / <span class="built_in">sizeof</span>(*a); <span class="comment">//获取元素个数</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; size; i++)</span><br><span class="line">&#123;</span><br><span class="line">cout &lt;&lt; a[i] &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>基于范围的for循环</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">int</span> a[] = &#123; <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">auto</span>&amp; temp : a)</span><br><span class="line">&#123;</span><br><span class="line">cout &lt;&lt; temp &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>运行结果：</p><blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="number">5</span></span><br></pre></td></tr></table></figure></blockquote></li><li><p>容器范围的for遍历</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">vector&lt;<span class="type">int</span>&gt; v = &#123; <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">auto</span>&amp; temp : v)</span><br><span class="line">&#123;</span><br><span class="line">cout &lt;&lt; temp &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>注意：</p><p>容器的范围的for遍历，需要容器含有<code>begin()</code>和<code>end()</code>才可以使用</p><p>例如：<code>queue</code>、<code>stack</code>等容器无法使用范围的for遍历</p></li></ol><h3 id="2-4-静态断言"><a href="#2-4-静态断言" class="headerlink" title="2.4 静态断言"></a>2.4 静态断言</h3><p>C++提供了调试工具<code>assert</code>，这是个宏，用于在运行阶段对断言进行检查，如果条件为<code>true</code>，执行程序，否则调用<code>abort()</code></p><p>使用<code>assert()</code>需要导入：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cassert&gt;</span></span></span><br></pre></td></tr></table></figure><p><code>assert()</code>断言：</p><ul><li>运行时检查条件</li><li>条件应为常量、变量均可</li></ul><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cassert&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">bool</span> flag = <span class="literal">false</span>;</span><br><span class="line"><span class="comment">//运行时检查条件，如果为真，继续执行；否则中断程序，报错</span></span><br><span class="line"><span class="built_in">assert</span>(flag == <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">cout &lt;&lt; <span class="string">&quot;hello assert&quot;</span> &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>运行报错：</p><blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Assertion failed: flag == true, file E:\08_静态断言.cpp, line 9</span><br></pre></td></tr></table></figure></blockquote><p><code>static_assert()</code>静态断言：</p><ul><li>编译时检查条件</li><li>条件应为常量，编译阶段不会有变量</li></ul><p>下面为，检查是否<strong>不为</strong>64位系统：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cassert&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="built_in">static_assert</span>(<span class="built_in">sizeof</span>(<span class="type">void</span>*) == <span class="number">8</span>, <span class="string">&quot;不支持64位系统&quot;</span>);</span><br><span class="line"></span><br><span class="line">cout &lt;&lt; <span class="string">&quot;hello static_assert&quot;</span> &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-5-noexcept修饰符"><a href="#2-5-noexcept修饰符" class="headerlink" title="2.5 noexcept修饰符"></a>2.5 noexcept修饰符</h3><p>抛出异常：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">fun1</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">throw</span> <span class="number">1</span>; <span class="comment">//抛出异常</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>不让函数抛出异常：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//fun2函数不能抛出任何异常，老式写法，在C++11中被废弃</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">fun2</span><span class="params">()</span> <span class="title">throw</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>注意：此写法，在C++11中被废弃</p><p>新写法使用<code>noexcept</code>修饰符 来替代<code>throw()</code></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//fun3函数不能抛出任何异常</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">fun3</span><span class="params">()</span> <span class="keyword">noexcept</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-6-nullptr"><a href="#2-6-nullptr" class="headerlink" title="2.6 nullptr"></a>2.6 nullptr</h3><p><code>nullptr</code>是为了解决C++中<code>NULL</code>的二义性问题从而引进的一种新的类型，<code>NULL</code>实际上代表的是0</p><p>重载fun函数：</p><p>​当调用<code>fun(NULL)</code>时，我们希望它打印的是：<code>fun2</code></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">fun</span><span class="params">(<span class="type">int</span> a)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;fun1&quot;</span> &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">fun</span><span class="params">(<span class="type">int</span>* p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;fun2&quot;</span> &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="built_in">fun</span>(<span class="literal">NULL</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>运行结果：</p><blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fun1</span><br></pre></td></tr></table></figure></blockquote><p>但是，打印的是：<code>fun1</code>；</p><p>如果要解决这个二义性，所以就需要使用<code>nullptr</code>：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">fun</span><span class="params">(<span class="type">int</span> a)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;fun1&quot;</span> &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">fun</span><span class="params">(<span class="type">int</span>* p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;fun2&quot;</span> &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="built_in">fun</span>(<span class="literal">nullptr</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>运行结果：</p><blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;fun2</span><br></pre></td></tr></table></figure></blockquote><p>比较<code>NULL</code>和<code>nullptr</code>：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">int</span>* p1 = <span class="literal">NULL</span>;</span><br><span class="line"><span class="type">int</span>* p2 = <span class="literal">nullptr</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (p1 == p2)</span><br><span class="line">&#123;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;p1 = p2&quot;</span> &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>运行结果：</p><blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;p1 = p2</span><br></pre></td></tr></table></figure></blockquote><p>证明：<code>NULL</code>和<code>nullptr</code>相等</p><p><code>nullptr</code>不能赋值给普通类型：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">int</span> a = <span class="literal">NULL</span>;             <span class="comment">//正常</span></span><br><span class="line"><span class="comment">//int b = nullptr;        //报错</span></span><br><span class="line"><span class="comment">//double c = nullptr;     //报错</span></span><br><span class="line">    <span class="type">int</span>* p = <span class="literal">nullptr</span>;         <span class="comment">//正常</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-7-强类型枚举"><a href="#2-7-强类型枚举" class="headerlink" title="2.7 强类型枚举"></a>2.7 强类型枚举</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">Status1</span> &#123; Ok, Error &#125;;</span><br><span class="line"><span class="keyword">enum</span> <span class="title class_">Status2</span> &#123; Ok, Error &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>运行报错：</p><blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">“main::Ok”: 重定义；以前的定义是“枚举数”</span><br><span class="line">“main::Error”: 重定义；以前的定义是“枚举数”</span><br></pre></td></tr></table></figure></blockquote><p>强类型枚举：<code>enum</code>后面加上<code>class</code>或<code>struct</code>修饰，即可：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">enum class</span> <span class="title class_">Status1</span> &#123; Ok, Error &#125;;</span><br><span class="line"><span class="keyword">enum class</span> <span class="title class_">Status2</span> &#123; Ok, Error &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>运行成功！</p><p>调用时，需要指定枚举类型的作用域：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">enum class</span> <span class="title class_">Status1</span> &#123; Ok, Error &#125;;</span><br><span class="line"><span class="keyword">enum class</span> <span class="title class_">Status2</span> &#123; Ok, Error &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Status1 flag = OK;            //报错，必须要指定枚举的作用域</span></span><br><span class="line">Status1 flag = Status1::Ok;     <span class="comment">//正常</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>强枚举类型，并且可以指定成员变量的类型：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">enum class</span> <span class="title class_">Status1</span> &#123; Ok, Error &#125;;</span><br><span class="line"><span class="keyword">enum class</span> <span class="title class_">Status2</span> : <span class="type">char</span> &#123; Ok, Error &#125;;</span><br><span class="line"></span><br><span class="line">cout &lt;&lt; <span class="built_in">sizeof</span>(Status1::Ok) &lt;&lt; endl; <span class="comment">//4字节</span></span><br><span class="line">cout &lt;&lt; <span class="built_in">sizeof</span>(Status2::Ok) &lt;&lt; endl; <span class="comment">//1字节</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>运行结果：</p><blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="number">4</span></span><br><span class="line">&gt;<span class="number">1</span></span><br></pre></td></tr></table></figure></blockquote><h3 id="2-8-常量表达式"><a href="#2-8-常量表达式" class="headerlink" title="2.8 常量表达式"></a>2.8 常量表达式</h3><p>常量表达式要在程序编译时执行，普通变量要在程序运行时执行</p><p><code>constexpr</code>：可以将<strong>变量</strong>或<strong>函数</strong>在<strong>编译阶段</strong>初始化</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="comment">//运行时初始化，非常量</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">getNum1</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//const修饰的常量属于右值</span></span><br><span class="line"><span class="comment">//const修饰的形参不是常量</span></span><br><span class="line"><span class="function"><span class="type">const</span> <span class="type">int</span> <span class="title">getNum2</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//常量表达式，发生在编译阶段</span></span><br><span class="line"><span class="function"><span class="keyword">constexpr</span> <span class="type">int</span> <span class="title">getNum3</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">// 枚举类型成员初始化，必须是整型常量</span></span><br><span class="line"><span class="comment">//enum &#123;e1 = getNum1(), e2 &#125;;    //报错</span></span><br><span class="line"><span class="comment">//enum &#123; e1 = getNum2(), e2 &#125;;   //const，报错</span></span><br><span class="line"><span class="keyword">enum</span> &#123; e1 = <span class="built_in">getNum3</span>(), e2 &#125;;     <span class="comment">//正常</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">constexpr</span> <span class="type">int</span> temp = <span class="built_in">getNum3</span>();  <span class="comment">//正常，发生在编译阶段</span></span><br><span class="line"><span class="keyword">enum</span> &#123; e3 = temp, e4 &#125;;          <span class="comment">//正常</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>constexpr</code>的限制：</p><ul><li>函数中允许包含typedef、using指令、静态断言</li><li>函数必须有返回值</li><li>在使用前必须已有定义</li><li>return返回语句表达式不能使用非常量表达式的函数、全局函数，且必须是一个常量表达式</li></ul><p><strong>总结</strong>：运行阶段产生的变量或函数，不要瞎掺和到常量表达式中</p><h3 id="2-9-自定义字面量"><a href="#2-9-自定义字面量" class="headerlink" title="2.9 自定义字面量"></a>2.9 自定义字面量</h3><p>根据C++11标准，只有以下参数才是合法的：</p><blockquote><p>char const *</p><p>unsigned long long</p><p>long double</p><p>char const *, size_t</p><p>wchar const *, size_t</p><p>char16_t const *, size_t</p><p>char32_t const *, size_t</p></blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="comment">//自定义字面量，起名要求 operator&quot;&quot;XXX</span></span><br><span class="line"><span class="comment">//只需要传递第一个参数，第二个参数自动推导出第一个参数的长度并赋值</span></span><br><span class="line"><span class="type">size_t</span> <span class="keyword">operator</span><span class="string">&quot;&quot;</span>_len(<span class="type">char</span> <span class="type">const</span>* str, <span class="type">size_t</span> size)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> size;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">char</span> <span class="type">const</span>* <span class="keyword">operator</span><span class="string">&quot;&quot;</span>_str(<span class="type">char</span> <span class="type">const</span>* str, <span class="type">size_t</span> size)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> str;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">char</span> <span class="type">const</span>* <span class="keyword">operator</span><span class="string">&quot;&quot;</span>_test(<span class="type">char</span> <span class="type">const</span>* str)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> str;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;abc&quot;</span>_len &lt;&lt; endl;      <span class="comment">//正常</span></span><br><span class="line">cout &lt;&lt; <span class="string">&quot;abc&quot;</span>_str &lt;&lt; endl;      <span class="comment">//正常</span></span><br><span class="line"><span class="comment">//cout &lt;&lt; &quot;abc&quot;_test &lt;&lt; endl;   //报错</span></span><br><span class="line">cout &lt;&lt; <span class="number">123</span>_test &lt;&lt; endl;       <span class="comment">//正常</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>运行结果：</p><blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="number">3</span></span><br><span class="line">&gt;abc</span><br><span class="line">&gt;<span class="number">123</span></span><br></pre></td></tr></table></figure></blockquote><h3 id="2-10-原生字符串字面值"><a href="#2-10-原生字符串字面值" class="headerlink" title="2.10 原生字符串字面值"></a>2.10 原生字符串字面值</h3><p>原生字符串字面值：使用户书写的字符串”所见即所得”</p><p>C++11中使用原生字符串字面值只需要在<code>R&quot;()&quot;</code>括号中写入字符串，即可</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">cout &lt;&lt; <span class="string">R&quot;(Hello ,\n \r</span></span><br><span class="line"><span class="string">world</span></span><br><span class="line"><span class="string">  !!!)&quot;</span> &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">cout &lt;&lt; <span class="string">&quot;-------------------&quot;</span> &lt;&lt; endl;</span><br><span class="line"><span class="comment">//也可以赋值给string数据类型</span></span><br><span class="line">string str = <span class="string">R&quot;(Hello ,\n \r)&quot;</span>;</span><br><span class="line">cout &lt;&lt; str &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>运行结果：</p><blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt;Hello ,\n \r</span><br><span class="line">&gt;world</span><br><span class="line"> !!!</span><br><span class="line">&gt;-------------------</span><br><span class="line">&gt;Hello ,\n \r</span><br></pre></td></tr></table></figure></blockquote></div><div class="story post-story"><h2 id="3-类的改进"><a href="#3-类的改进" class="headerlink" title="3.类的改进"></a>3.类的改进</h2><p>…..</p></div><div class="story post-story"><h2 id="4-模板的改进"><a href="#4-模板的改进" class="headerlink" title="4.模板的改进"></a>4.模板的改进</h2><h3 id="4-1-右尖括号-gt"><a href="#4-1-右尖括号-gt" class="headerlink" title="4.1 右尖括号&gt;"></a>4.1 右尖括号<code>&gt;</code></h3><p>在C++98&#x2F;03中，模板实例化时，连续的右尖括号<code>&gt;&gt;</code>会被编译成右移动操作符</p><p>需要在两个右尖括号之间添加空格<code>&gt; &gt;</code></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">//vector&lt;vector&lt;int&gt;&gt; v1;   //报错</span></span><br><span class="line">vector&lt;vector&lt;<span class="type">int</span>&gt; &gt; v2;    <span class="comment">//正常</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在C++11中解决了此问题：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; v <span class="comment">//正常</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-2-类型的别名"><a href="#4-2-类型的别名" class="headerlink" title="4.2 类型的别名"></a>4.2 类型的别名</h3><p>需要导入一个库来判断数据类型是否相同</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;type_traits&gt;</span></span></span><br></pre></td></tr></table></figure><p><code>is_same</code>判断两个数据类型是否相同，返回值为bool类型：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">is_same&lt;T1, T2&gt;::value</span><br></pre></td></tr></table></figure><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;type_traits&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="comment">//通过typedef给一个类型起别名，不能新建类型</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">int</span> int32;</span><br><span class="line"><span class="comment">//C++11起别名方式</span></span><br><span class="line"><span class="keyword">using</span> my_int = <span class="type">int</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">cout &lt;&lt; is_same&lt;int32, my_int&gt;::value &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-3-函数模板的默认模板参数"><a href="#4-3-函数模板的默认模板参数" class="headerlink" title="4.3 函数模板的默认模板参数"></a>4.3 函数模板的默认模板参数</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="comment">//类模板支持默认模板参数</span></span><br><span class="line"><span class="comment">//注意：如果有多个类模板参数，默认模板参数要写在**最右边**</span></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span> = <span class="type">int</span>&gt;</span><br><span class="line"><span class="keyword">class</span> A</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="built_in">A</span>(T a) : <span class="built_in">a</span>(a) &#123;&#125;</span><br><span class="line">T a;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//C++11支持函数模板的默认模板参数</span></span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T </span>= <span class="type">int</span>&gt;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">fun</span><span class="params">(T t)</span></span></span><br><span class="line"><span class="function"></span>&#123; &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">A&lt;&gt; <span class="built_in">a</span>(<span class="number">10</span>);             <span class="comment">//默认为int</span></span><br><span class="line">cout &lt;&lt; a.a &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line"><span class="function">A&lt;string&gt; <span class="title">b</span><span class="params">(<span class="string">&quot;abc&quot;</span>)</span></span>;    <span class="comment">//指定为string</span></span><br><span class="line">cout &lt;&lt; b.a &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line"><span class="built_in">fun</span>(<span class="number">10</span>);               <span class="comment">//传入int</span></span><br><span class="line"><span class="built_in">fun</span>&lt;string&gt;(<span class="string">&quot;abc&quot;</span>);    <span class="comment">//传入string</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-4-可变参数模板函数"><a href="#4-4-可变参数模板函数" class="headerlink" title="4.4 可变参数模板函数"></a>4.4 可变参数模板函数</h3><p>可变模板函数的声明：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="comment">//下面为可变参数模板函数</span></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> ... T&gt;     <span class="comment">//T为模板参数包</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">fun</span><span class="params">(T ... args)</span>        <span class="comment">//args为函数参数包</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">//获取可变参数个数</span></span><br><span class="line">cout &lt;&lt; <span class="keyword">sizeof</span> ... (args) &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="built_in">fun</span>&lt;<span class="type">int</span>&gt;(<span class="number">10</span>);</span><br><span class="line"><span class="built_in">fun</span>&lt;<span class="type">int</span>, string&gt;(<span class="number">10</span>, <span class="string">&quot;abc&quot;</span>);</span><br><span class="line"><span class="built_in">fun</span>&lt;<span class="type">int</span>, string, <span class="type">char</span>&gt;(<span class="number">10</span>, <span class="string">&quot;abc&quot;</span>, <span class="string">&#x27;a&#x27;</span>);</span><br><span class="line">    <span class="built_in">fun</span>(<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>);  <span class="comment">//不指定数据类型也可以</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>运行结果：</p><blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="number">1</span></span><br><span class="line">&gt;<span class="number">2</span></span><br><span class="line">&gt;<span class="number">3</span></span><br><span class="line">&gt;<span class="number">4</span></span><br></pre></td></tr></table></figure></blockquote><p><strong>参数包的展开</strong></p><ul><li><p>递归的方式展开：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="comment">//递归终止函数，当参数列表遍历完后，调用此重载函数结束递归</span></span><br><span class="line"><span class="comment">//本质就是重载函数</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">fun</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;参数已为空&quot;</span> &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T1, <span class="keyword">class</span> ... T2&gt;</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">fun</span><span class="params">(T1 first, T2 ... last)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">cout &lt;&lt; first &lt;&lt; endl;</span><br><span class="line"><span class="built_in">fun</span>(last ...);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="built_in">fun</span>(<span class="number">1</span>, <span class="number">2.5</span>, <span class="number">3</span>, <span class="string">&quot;abc&quot;</span>, <span class="string">&#x27;a&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>运行结果：</p><blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="number">1</span></span><br><span class="line">&gt;<span class="number">2.5</span></span><br><span class="line">&gt;<span class="number">3</span></span><br><span class="line">&gt;abc</span><br><span class="line">&gt;a</span><br><span class="line">&gt;参数已为空</span><br></pre></td></tr></table></figure></blockquote></li><li><p>非递归的方式展开：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">print</span><span class="params">(T t)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">cout &lt;&lt; t &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> ... T&gt;</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">fun</span><span class="params">(T ... args)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">//逗号运算符</span></span><br><span class="line"><span class="comment">//初始化列表</span></span><br><span class="line"><span class="type">int</span> a[] = &#123; (<span class="built_in">print</span>(args), <span class="number">0</span>) ... &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="built_in">fun</span>(<span class="number">1</span>, <span class="number">2.5</span>, <span class="string">&quot;abc&quot;</span>, <span class="string">&#x27;a&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>运行结果：</p><blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="number">1</span></span><br><span class="line">&gt;<span class="number">2.5</span></span><br><span class="line">&gt;abc</span><br><span class="line">&gt;a</span><br></pre></td></tr></table></figure></blockquote></li></ul><h3 id="4-5-可变参数模板类"><a href="#4-5-可变参数模板类" class="headerlink" title="4.5 可变参数模板类"></a>4.5 可变参数模板类</h3><p>继承的方式展开参数模板类</p><ul><li><p>类模板继承方式展开参数包：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;typeinfo&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="comment">//可变参数模板的声明，必须要声明</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> ... T&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Car</span>; <span class="comment">//主模板的声明中不允许使用模板参数列表&lt; &gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//递归继承模板类</span></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">Head</span>, <span class="keyword">class</span> ... Tail&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Car</span>&lt;Head, Tail ...&gt; : <span class="keyword">public</span> Car&lt;Tail ...&gt;</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="built_in">Car</span>()</span><br><span class="line">&#123;</span><br><span class="line">cout &lt;&lt; <span class="built_in">typeid</span>(Head).<span class="built_in">name</span>() &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//递归终止类</span></span><br><span class="line"><span class="keyword">template</span>&lt;&gt; </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Car</span>&lt;&gt;&#123; &#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">//初始化Car</span></span><br><span class="line">Car&lt;<span class="type">int</span>, <span class="type">double</span>, string, <span class="type">char</span>&gt; c;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>运行结果：</p><blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="type">char</span></span><br><span class="line">&gt;<span class="keyword">class</span> <span class="title class_">std</span>::basic_string&lt;<span class="type">char</span>,<span class="keyword">struct</span> <span class="title class_">std</span>::char_traits&lt;<span class="type">char</span>&gt;,<span class="keyword">class</span> <span class="title class_">std</span>::allocator&lt;<span class="type">char</span>&gt; &gt;</span><br><span class="line">&gt;<span class="type">double</span></span><br><span class="line">&gt;<span class="type">int</span></span><br></pre></td></tr></table></figure></blockquote></li><li><p>类模板递归和特化方式展开参数包</p><p>下面的是获得相加的数据类型的字节总数：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//可变参数模板的声明</span></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> ... T&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Add</span>;</span><br><span class="line"><span class="comment">//可变参数模板的定义</span></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">first</span>, <span class="keyword">class</span> ... last&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Add</span>&lt;first, last ...&gt;</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">int</span> val = Add&lt;first&gt;::val + Add&lt;last ...&gt;::val;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//边界条件，递归终止条件</span></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">first</span>&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Add</span>&lt;first&gt;</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">int</span> val = <span class="built_in">sizeof</span>(first);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">cout &lt;&lt; Add&lt;<span class="type">int</span>&gt;::val &lt;&lt; endl;              <span class="comment">//int类型字节为4</span></span><br><span class="line">cout &lt;&lt; Add&lt;<span class="type">double</span>&gt;::val &lt;&lt; endl;           <span class="comment">//double类型字节为8</span></span><br><span class="line">cout &lt;&lt; Add&lt;<span class="type">int</span>, <span class="type">int</span>, <span class="type">double</span>&gt;::val &lt;&lt; endl; <span class="comment">//int+int+double字节数为16 </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>运行结果：</p><blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="number">4</span></span><br><span class="line">&gt;<span class="number">8</span></span><br><span class="line">&gt;<span class="number">16</span></span><br></pre></td></tr></table></figure></blockquote><p>也可以指定数据类型：</p><p>指定数据类型为<code>int</code>，并获得他们的之间相乘的总和：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;typeinfo&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="comment">//可变参数模板的声明</span></span><br><span class="line"><span class="comment">//并指定为int类型</span></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="type">int</span> ... T&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Mul</span>;</span><br><span class="line"><span class="comment">//可变参数模板的定义</span></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="type">int</span> first, <span class="type">int</span> ... last&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Mul</span>&lt;first, last ...&gt;</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">int</span> val = first * Mul&lt;last ...&gt;::val;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//边界条件，递归终止条件</span></span><br><span class="line"><span class="keyword">template</span>&lt;&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Mul</span>&lt;&gt;</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">int</span> val = <span class="number">1</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">cout &lt;&lt; Mul&lt;<span class="number">2</span>&gt;::val &lt;&lt; endl;        <span class="comment">//2*1</span></span><br><span class="line">cout &lt;&lt; Mul&lt;<span class="number">2</span>, <span class="number">2</span>&gt;::val &lt;&lt; endl;     <span class="comment">//2*2</span></span><br><span class="line">cout &lt;&lt; Mul&lt;<span class="number">3</span>, <span class="number">3</span>, <span class="number">3</span>&gt;::val &lt;&lt; endl;  <span class="comment">//3*3*3</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>运行结果：</p><blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="number">2</span></span><br><span class="line">&gt;<span class="number">4</span></span><br><span class="line">&gt;<span class="number">27</span></span><br></pre></td></tr></table></figure></blockquote></li></ul></div><div class="story post-story"><h2 id="5-左值、右值"><a href="#5-左值、右值" class="headerlink" title="5.左值、右值"></a>5.左值、右值</h2><h3 id="5-1-左值、右值引用"><a href="#5-1-左值、右值引用" class="headerlink" title="5.1 左值、右值引用"></a>5.1 左值、右值引用</h3><p>左值引用：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">main1</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">//引用&amp;：给一个内存起别名，定义时必须初始化</span></span><br><span class="line"><span class="type">int</span> a;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> temp = <span class="number">1</span>;</span><br><span class="line"><span class="type">int</span> t1 = <span class="number">1</span>;</span><br><span class="line"><span class="type">int</span> t2 = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span>&amp; b = a;               <span class="comment">//正常</span></span><br><span class="line"><span class="comment">//int&amp; c = 1;             //报错，非常量引用的初始值必须为左值</span></span><br><span class="line"><span class="comment">//int&amp; d = t1 + t2;       //报错，非常量引用的初始值必须为左值</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//const int&amp; 万能引用</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span>&amp; e = a;         <span class="comment">//正常</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span>&amp; f = <span class="number">1</span>;         <span class="comment">//正常</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span>&amp; t = temp;      <span class="comment">//正常</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>右值引用：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">//右值引用</span></span><br><span class="line"><span class="type">int</span>&amp;&amp; a = <span class="number">10</span>;           <span class="comment">//正常</span></span><br><span class="line"><span class="type">int</span>&amp;&amp; b = <span class="built_in">fun</span>();        <span class="comment">//正常</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> t1 = <span class="number">1</span>;</span><br><span class="line"><span class="type">int</span> t2 = <span class="number">1</span>;</span><br><span class="line"><span class="comment">//int&amp;&amp; c = t1;         //报错，无法将右值引用绑定到左值</span></span><br><span class="line"><span class="type">int</span>&amp;&amp; d = t1 + t2;      <span class="comment">//正常</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>左值、右值判断：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="comment">//通过重载函数的特点，来进行判断</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">test</span><span class="params">(<span class="type">int</span>&amp; left)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;左值&quot;</span> &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">test</span><span class="params">(<span class="type">int</span>&amp;&amp; right)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;右值&quot;</span> &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">int</span> a = <span class="number">1</span>;</span><br><span class="line"><span class="type">int</span> b = <span class="number">1</span>;</span><br><span class="line"><span class="type">int</span>&amp;&amp; c = <span class="number">1</span>;</span><br><span class="line"><span class="built_in">test</span>(a);        <span class="comment">//左值</span></span><br><span class="line"><span class="built_in">test</span>(<span class="number">1</span>);        <span class="comment">//右值</span></span><br><span class="line"><span class="built_in">test</span>(a + b);    <span class="comment">//右值</span></span><br><span class="line"><span class="built_in">test</span>(c);        <span class="comment">//左值</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>运行结果：</p><blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;左值</span><br><span class="line">&gt;右值</span><br><span class="line">&gt;右值</span><br><span class="line">&gt;左值</span><br></pre></td></tr></table></figure></blockquote><h3 id="5-2-返回值优化"><a href="#5-2-返回值优化" class="headerlink" title="5.2 返回值优化"></a>5.2 返回值优化</h3><p>……</p></div><div class="story post-story"><h2 id="6-移动语义"><a href="#6-移动语义" class="headerlink" title="6.移动语义"></a>6.移动语义</h2><p>……</p><h3 id="6-3-std-move"><a href="#6-3-std-move" class="headerlink" title="6.3 std::move"></a>6.3 std::move</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">int</span> a = <span class="number">10</span>;</span><br><span class="line"><span class="comment">//int&amp;&amp; b = a;     //报错，左值不能绑定到右值引用</span></span><br><span class="line"><span class="type">int</span>&amp;&amp; c = <span class="built_in">move</span>(a); <span class="comment">//正常，move将左值转化为右值</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="6-4-std-forward"><a href="#6-4-std-forward" class="headerlink" title="6.4 std::forward"></a>6.4 std::forward</h3><p>当我们需要将一组参数原封不动的传递给里一个函数时：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">fun</span><span class="params">(<span class="type">const</span> T&amp; t)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;fun(const T&amp; t) &quot;</span> &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">fun</span><span class="params">(T&amp; t)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;fun(T&amp; t) &quot;</span> &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">forwardVal</span><span class="params">(<span class="type">const</span> T&amp; t)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="built_in">fun</span>(t);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">forwardVal</span><span class="params">(T&amp; t)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="built_in">fun</span>(t);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">int</span> a = <span class="number">0</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> b = <span class="number">1</span>;</span><br><span class="line">forwardVal(a);</span><br><span class="line">forwardVal(b);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>运行结果：</p><blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="built_in">fun</span>(T&amp; t)</span><br><span class="line">&gt;<span class="built_in">fun</span>(<span class="type">const</span> T&amp; t)</span><br></pre></td></tr></table></figure></blockquote><p>使用<code>std::forward</code>函数，实现完美转发：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">fun</span><span class="params">(<span class="type">const</span> T&amp; t)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;fun(const T&amp; t) &quot;</span> &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">fun</span><span class="params">(T&amp; t)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;fun(T&amp; t) &quot;</span> &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">fun</span><span class="params">(<span class="type">const</span> T&amp;&amp; t)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;fun(const T&amp;&amp; t) &quot;</span> &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//只需定义一个函数，无需重载函数</span></span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt;</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">forwardVal</span><span class="params">(T&amp;&amp; t)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">//forward保存参数的左值、右值属性</span></span><br><span class="line"><span class="built_in">fun</span>(forward&lt;T&gt;(t));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">int</span> a = <span class="number">1</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> b = <span class="number">2</span>;</span><br><span class="line">forwardVal(a);</span><br><span class="line">forwardVal(b);</span><br><span class="line">forwardVal(<span class="number">10</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>运行结果：</p><blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="built_in">fun</span>(T&amp; t)</span><br><span class="line">&gt;<span class="built_in">fun</span>(<span class="type">const</span> T&amp; t)</span><br><span class="line">&gt;<span class="built_in">fun</span>(<span class="type">const</span> T&amp;&amp; t)</span><br></pre></td></tr></table></figure></blockquote></div><div class="story post-story"><h2 id="7-智能指针"><a href="#7-智能指针" class="headerlink" title="7.智能指针"></a>7.智能指针</h2><h3 id="7-1-unique-ptr"><a href="#7-1-unique-ptr" class="headerlink" title="7.1 unique_ptr"></a>7.1 unique_ptr</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;memory&gt;</span>           <span class="comment">//智能指针头文件</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">//智能指针无需释放，自动释放</span></span><br><span class="line"><span class="function">unique_ptr&lt;<span class="type">int</span>&gt; <span class="title">ptr</span><span class="params">(<span class="keyword">new</span> <span class="type">int</span>(<span class="number">10</span>))</span></span>;</span><br><span class="line">cout &lt;&lt; *ptr &lt;&lt; endl;  <span class="comment">//重载了operator*()</span></span><br><span class="line">cout &lt;&lt; ptr &lt;&lt; endl;   </span><br><span class="line"></span><br><span class="line"><span class="comment">//可以人为指定释放堆区空间</span></span><br><span class="line"><span class="comment">//ptr = nullptr;       //正常</span></span><br><span class="line"><span class="comment">//ptr = NULL;          //正常</span></span><br><span class="line">ptr.<span class="built_in">reset</span>();           <span class="comment">//正常</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;memory&gt;</span>               <span class="comment">//智能指针头文件</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="function">unique_ptr&lt;<span class="type">int</span>&gt; <span class="title">ptr1</span><span class="params">(<span class="keyword">new</span> <span class="type">int</span>(<span class="number">10</span>))</span></span>;</span><br><span class="line"><span class="comment">//报错，禁用拷贝构造</span></span><br><span class="line"><span class="comment">//unique_ptr&lt;int&gt; ptr2 = ptr;  </span></span><br><span class="line">    <span class="comment">//int* p = ptr             //报错</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//将ptr1使用权(指向的内存)交给ptr3，ptr1不能再操作堆区内存了</span></span><br><span class="line">unique_ptr&lt;<span class="type">int</span>&gt; ptr3 = <span class="built_in">move</span>(ptr1); </span><br><span class="line">    </span><br><span class="line">    <span class="comment">//cout &lt;&lt; *ptr1 &lt;&lt; endl;   //报错  </span></span><br><span class="line">    cout &lt;&lt; *ptr3 &lt;&lt; endl;     <span class="comment">//正常</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;memory&gt;</span> <span class="comment">//智能指针头文件</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="function">unique_ptr&lt;<span class="type">int</span>&gt; <span class="title">ptr</span><span class="params">(<span class="keyword">new</span> <span class="type">int</span>(<span class="number">10</span>))</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//无参，作用为显式释放堆区内存</span></span><br><span class="line"><span class="comment">//ptr.reset();  </span></span><br><span class="line"></span><br><span class="line"><span class="comment">//有参，先释放堆区内存，再重新绑定一个新堆区内存</span></span><br><span class="line">ptr.<span class="built_in">reset</span>(<span class="keyword">new</span> <span class="built_in">int</span>(<span class="number">20</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;memory&gt;</span> <span class="comment">//智能指针头文件</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="function">unique_ptr&lt;<span class="type">int</span>&gt; <span class="title">ptr</span><span class="params">(<span class="keyword">new</span> <span class="type">int</span>(<span class="number">10</span>))</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//释放ptr对堆区内存的控制权但是不释放堆区的内存，并将控制权交给指针p</span></span><br><span class="line"><span class="type">int</span>* p = ptr.<span class="built_in">release</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">//cout &lt;&lt; *ptr &lt;&lt; endl;   //报错</span></span><br><span class="line">cout &lt;&lt; *p &lt;&lt; endl;       <span class="comment">//正常</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//需要人为将p指针的堆区释放</span></span><br><span class="line"><span class="keyword">delete</span> p;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="7-2-shared-ptr"><a href="#7-2-shared-ptr" class="headerlink" title="7.2 shared_ptr"></a>7.2 shared_ptr</h3><p><code>shared_ptr</code>允许多个智能指针共享并拥有同一个堆区分配对象的内存。通过引用计数实现，会记录有多少个<code>shared_ptr</code>共同指向同一个对象，如果最后一个共享指针被销毁，也就是对某个引用对象的计数变为0时，自动释放此内存。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;memory&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//shared_ptr也会自动释放堆区空间</span></span><br><span class="line"><span class="function">shared_ptr&lt;<span class="type">int</span>&gt; <span class="title">ptr1</span><span class="params">(<span class="keyword">new</span> <span class="type">int</span>(<span class="number">10</span>))</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//拷贝构造，此时有2个对象和堆区内存绑定</span></span><br><span class="line">shared_ptr&lt;<span class="type">int</span>&gt; ptr2 = ptr1;       <span class="comment">//正常</span></span><br><span class="line"><span class="comment">//打印ptr1与ptr2的地址</span></span><br><span class="line">cout &lt;&lt; ptr1 &lt;&lt; endl;</span><br><span class="line">cout &lt;&lt; ptr2 &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line"><span class="comment">//计数器，获取与堆区绑定的对象的个数</span></span><br><span class="line">cout &lt;&lt; ptr1.<span class="built_in">use_count</span>() &lt;&lt; endl;  <span class="comment">//2</span></span><br><span class="line"><span class="comment">//释放ptr1对象，计数器减1，不会释放堆区内存</span></span><br><span class="line">    ptr1.<span class="built_in">reset</span>();</span><br><span class="line">cout &lt;&lt; ptr2.<span class="built_in">use_count</span>() &lt;&lt; endl;  <span class="comment">//1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//当计数器为0时，才会释放堆区空间</span></span><br><span class="line">ptr2.<span class="built_in">reset</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>运行结果：</p><blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="number">0000026</span>C3E3E6CA0</span><br><span class="line">&gt;<span class="number">0000026</span>C3E3E6CA0</span><br><span class="line">&gt;<span class="number">2</span></span><br><span class="line">&gt;<span class="number">1</span></span><br></pre></td></tr></table></figure></blockquote><h3 id="7-3-weak-ptr"><a href="#7-3-weak-ptr" class="headerlink" title="7.3 weak_ptr"></a>7.3 weak_ptr</h3><p><code>weak_ptr</code>是为配合 <code>shared_ptr</code> 而引入的一种智能指针来协助 <code>shared_ptr</code> 工作，它可以从一个<code>shared_ptr</code> 或另一个 <code>weak_ptr</code> 对象构造，它的构造和析构不会引起引用计数的增加或减少。没有重载 <code>*</code> 和<code>-&gt;</code>但可以使用 <code>lock</code> 获得一个可用的 <code>shared_ptr</code> 对象。</p><p><code>weak_ptr</code> 的使用更为复杂一点，它可以指向 <code>shared_ptr</code> 指针指向的对象内存，却并不拥有该内存，而使用 <code>weak_ptr</code> 成员<code>lock</code>，则可返回其指向内存的一个 <code>share_ptr</code> 对象，且在所指对象内存己经无效时，返回指针空值 nullptr。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;memory&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="function">shared_ptr&lt;<span class="type">int</span>&gt; <span class="title">ptr1</span><span class="params">(<span class="keyword">new</span> <span class="type">int</span>(<span class="number">10</span>))</span></span>;</span><br><span class="line">shared_ptr&lt;<span class="type">int</span>&gt; ptr2 = ptr1;             <span class="comment">//2个对象绑定堆区空间</span></span><br><span class="line"><span class="comment">//weak_ptr不和堆区空间绑定，可以通过lock函数获取shared_ptr的对象</span></span><br><span class="line">weak_ptr&lt;<span class="type">int</span>&gt; ptr3 = ptr1;</span><br><span class="line">cout &lt;&lt; ptr1.<span class="built_in">use_count</span>() &lt;&lt; endl;        <span class="comment">//打印计数器</span></span><br><span class="line">cout &lt;&lt; ptr3.<span class="built_in">use_count</span>() &lt;&lt; endl;        <span class="comment">//打印计数器</span></span><br><span class="line">    </span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;----------------&quot;</span> &lt;&lt; endl;</span><br><span class="line">    </span><br><span class="line"><span class="comment">//通过lock函数获取shared_ptr的对象</span></span><br><span class="line">shared_ptr&lt;<span class="type">int</span>&gt; ptr4 = ptr3.<span class="built_in">lock</span>();      <span class="comment">//3个对象绑定堆区空间</span></span><br><span class="line">cout &lt;&lt; ptr1.<span class="built_in">use_count</span>() &lt;&lt; endl;        <span class="comment">//打印计数器</span></span><br><span class="line">cout &lt;&lt; ptr3.<span class="built_in">use_count</span>() &lt;&lt; endl;        <span class="comment">//打印计数器</span></span><br><span class="line"></span><br><span class="line">cout &lt;&lt; *ptr1 &lt;&lt; <span class="string">&quot;,&quot;</span> &lt;&lt; *ptr2 &lt;&lt; <span class="string">&quot;,&quot;</span> &lt;&lt; *ptr4 &lt;&lt; endl;  <span class="comment">//正常</span></span><br><span class="line"><span class="comment">//cout &lt;&lt; *ptr3 &lt;&lt; endll;                               //报错，没有重载*和-&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//释放所有shared_ptr对象</span></span><br><span class="line">    ptr1.<span class="built_in">reset</span>();</span><br><span class="line">ptr2.<span class="built_in">reset</span>();</span><br><span class="line">ptr4.<span class="built_in">reset</span>();</span><br><span class="line"></span><br><span class="line">shared_ptr&lt;<span class="type">int</span>&gt; temp = ptr3.<span class="built_in">lock</span>();</span><br><span class="line"><span class="keyword">if</span> (temp == <span class="literal">nullptr</span>)</span><br><span class="line">&#123;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;temp为空，已经释放了堆区空间！&quot;</span> &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>运行结果：</p><blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="number">2</span></span><br><span class="line">&gt;<span class="number">2</span></span><br><span class="line">&gt;----------------</span><br><span class="line">&gt;<span class="number">3</span></span><br><span class="line">&gt;<span class="number">3</span></span><br><span class="line">&gt;<span class="number">10</span>,<span class="number">10</span>,<span class="number">10</span></span><br><span class="line">&gt;temp为空，已经释放了堆区空间！</span><br></pre></td></tr></table></figure></blockquote></div><div class="story post-story"><h2 id="8-闭包的实现"><a href="#8-闭包的实现" class="headerlink" title="8.闭包的实现"></a>8.闭包的实现</h2><h3 id="8-1-闭包是什么"><a href="#8-1-闭包是什么" class="headerlink" title="8.1 闭包是什么"></a>8.1 闭包是什么</h3><p>闭包有很多种定义，一种说法是，闭包是带有上下文的函数。说白了，就是有状态的函数，更直接一些，不就是个类吗？换了个名字化 。</p><p>一个函数，带上了一个状态，就变成了闭包了。那什么叫“带上状态，呢？意思是这个闭包有属于自己的变量，这些个变量的值是创建闭包的时候设置的，并在调用闭包的时候，可以访问这些变量。</p><p>函数是代码，状态是一组变量，将代码和一组变量捆绑(bind)，就形成了闭包。</p><p>闭包的状态㧢绑，必须发生在运行时。</p><h3 id="8-2-仿函数：重载operator"><a href="#8-2-仿函数：重载operator" class="headerlink" title="8.2 仿函数：重载operator()"></a>8.2 仿函数：重载operator()</h3><p>C++11之前就已经支持</p><p>比较大小：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="comment">//仿函数：重载operator()</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Compare</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">//如果val1小于val2,则返回真，否则返回假</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">operator</span><span class="params">()</span><span class="params">(<span class="type">int</span> val1, <span class="type">int</span> val2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">return</span> val1 &lt; val2;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">cout &lt;&lt; <span class="built_in">Compare</span>()(<span class="number">11</span>, <span class="number">12</span>) &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>运行结果：</p><blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="number">1</span></span><br></pre></td></tr></table></figure></blockquote><h3 id="8-3-std-function"><a href="#8-3-std-function" class="headerlink" title="8.3 std::function"></a>8.3 std::function</h3><p>在C++中，可调用实体主要包括：函数、函数指针、函数引用、可以隐式转换为函数指定的对系，或者实现了 opetator()的对象。</p><p>C++11中，新增加了一个 std::function 类模板，它是对 C++中现有的可调用实体的一种类型安全的包装。通过指定它的模板参数，它可以用统一的方式处理函数、函数对象、函数指针，并允许保存和延迟执行它们。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;functional&gt;</span>  <span class="comment">//std::function</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="comment">//普通函数</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">fun</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">//__func__：返回函数名</span></span><br><span class="line">cout &lt;&lt; __func__ &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//类中静态函数</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Test</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">int</span> <span class="title">testFun</span><span class="params">(<span class="type">int</span> a)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">cout &lt;&lt; __func__ &lt;&lt; endl;</span><br><span class="line"><span class="keyword">return</span> a;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//类中仿函数</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyFun</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">operator</span><span class="params">()</span><span class="params">(<span class="type">int</span> a)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">cout &lt;&lt; __func__ &lt;&lt; endl;</span><br><span class="line"><span class="keyword">return</span> a;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//绑定普通函数</span></span><br><span class="line">function&lt;<span class="type">void</span>()&gt; f1 = fun;</span><br><span class="line"><span class="built_in">f1</span>();</span><br><span class="line"><span class="comment">//绑定类中的静态函数</span></span><br><span class="line">function&lt;<span class="type">int</span>(<span class="type">int</span>)&gt; f2 = Test::testFun;</span><br><span class="line">cout &lt;&lt; <span class="built_in">f2</span>(<span class="number">100</span>) &lt;&lt; endl;</span><br><span class="line"><span class="comment">//绑定类中的仿函数，绑定对象</span></span><br><span class="line">function&lt;<span class="type">int</span>(<span class="type">int</span>)&gt; f3 = <span class="built_in">MyFun</span>();</span><br><span class="line">cout &lt;&lt; <span class="built_in">f3</span>(<span class="number">30</span>) &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>运行结果：</p><blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt;fun</span><br><span class="line">&gt;testFun</span><br><span class="line">&gt;<span class="number">100</span></span><br><span class="line">&gt;<span class="built_in">operator</span> ()</span><br><span class="line">&gt;<span class="number">30</span></span><br></pre></td></tr></table></figure></blockquote><p>std:function对象最大的用处就是在实现函数回调，使用者需要注忘，它不能被用来检查相等或者不相等，但是可以与 NULL 或者nullptr 进行比较。</p><h3 id="8-4-std-bind"><a href="#8-4-std-bind" class="headerlink" title="8.4 std::bind"></a>8.4 std::bind</h3><p>std:bind 是这样一种机制，它可以预先把指定可调用实体的某些参数鄉定到己有的变量，产生一个新的可调用实体，这种机制在 回调函数 的使用过程中也频为有用。</p><p>C++98中，有两个两数bindlst 和bind2nd，它们分别可以用来绑定 functor 的第一个和第二个参数，它们都是只可以绑定一个参数，各种限制，使得 bind1st 和 bind2nd 的可用性大大降低。</p><p>在C++11中，提供了std:bind， 它鄉定的参数的个数不受限制，绑定的具体哪些参数也不受限制，由用户指定，这个bind 才是真正意义上的绑定。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;functional&gt;</span>   <span class="comment">//std::bind</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">fun</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">cout &lt;&lt; x &lt;&lt; <span class="string">&quot;   &quot;</span> &lt;&lt; y &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="built_in">bind</span>(fun, <span class="number">1</span>, <span class="number">2</span>)();             <span class="comment">//输出1  2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//std::placeholders::_1 表示函数调用，第1个参数替换</span></span><br><span class="line"><span class="comment">//std::placeholders::_2 表示函数调用，第2个参数替换</span></span><br><span class="line"><span class="comment">//std::placeholders::_3 表示函数调用，第3个参数替换</span></span><br><span class="line"><span class="built_in">bind</span>(fun, placeholders::_1, placeholders::_2)(<span class="number">5</span>, <span class="number">10</span>);  <span class="comment">//输出5  10</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//简化写法</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std::placeholders;</span><br><span class="line"></span><br><span class="line"><span class="comment">//将第1个参数与_1替换</span></span><br><span class="line"><span class="built_in">bind</span>(fun, <span class="number">5</span>, _1)(<span class="number">2</span>, <span class="number">4</span>, <span class="number">10</span>);    <span class="comment">//输出5  2</span></span><br><span class="line"><span class="comment">//将第2个参数与_2替换</span></span><br><span class="line"><span class="built_in">bind</span>(fun, <span class="number">5</span>, _2)(<span class="number">2</span>, <span class="number">4</span>, <span class="number">10</span>);    <span class="comment">//输出5  4</span></span><br><span class="line"><span class="comment">//第1个参数与第一个参数互换</span></span><br><span class="line"><span class="built_in">bind</span>(fun, _2, _1)(<span class="number">2</span>, <span class="number">4</span>, <span class="number">10</span>);   <span class="comment">//输出4  2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//bind(fun, _2, 10)(20);       //报错，不存咋第2个参数</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>运行结果：</p><blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="number">1</span>   <span class="number">2</span></span><br><span class="line">&gt;<span class="number">5</span>   <span class="number">10</span></span><br><span class="line">&gt;<span class="number">5</span>   <span class="number">2</span></span><br><span class="line">&gt;<span class="number">5</span>   <span class="number">4</span></span><br><span class="line">&gt;<span class="number">4</span>   <span class="number">2</span></span><br></pre></td></tr></table></figure></blockquote><h3 id="8-5-function结合bind"><a href="#8-5-function结合bind" class="headerlink" title="8.5 function结合bind"></a>8.5 function结合bind</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;functional&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std::placeholders;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Test</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="type">int</span> a;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">fun</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">cout &lt;&lt; x &lt;&lt; <span class="string">&quot;  &quot;</span> &lt;&lt; y &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">Test test;    <span class="comment">//创建对象</span></span><br><span class="line"><span class="comment">//绑定成员函数</span></span><br><span class="line">function&lt;<span class="type">void</span>(<span class="type">int</span>, <span class="type">int</span>)&gt; f1 = <span class="built_in">bind</span>(&amp;Test::fun, &amp;test, _1, _2);</span><br><span class="line"><span class="built_in">f1</span>(<span class="number">1</span>, <span class="number">2</span>);     <span class="comment">//test.fun(1, 2)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//绑定成员变量</span></span><br><span class="line">function&lt;<span class="type">int</span>&amp; ()&gt; f2 = <span class="built_in">bind</span>(&amp;Test::a, &amp;test);</span><br><span class="line"><span class="built_in">f2</span>() = <span class="number">12</span>;    <span class="comment">//test.a = 12;</span></span><br><span class="line">cout &lt;&lt; test.a &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>运行结果：</p><blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="number">1</span>  <span class="number">2</span></span><br><span class="line">&gt;<span class="number">12</span></span><br></pre></td></tr></table></figure></blockquote><h3 id="8-6-lambda表达式"><a href="#8-6-lambda表达式" class="headerlink" title="8.6 lambda表达式"></a>8.6 lambda表达式</h3><p>lambda表达式的基本格式：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[]()</span><br><span class="line">&#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>基础语法：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="comment">//[]中只能捕获全局变量与同一作用域的变量</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">auto</span> f1 = []() &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> a = <span class="number">1</span>;</span><br><span class="line"><span class="type">int</span> b = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">cout &lt;&lt; <span class="string">&quot;f2-------------&quot;</span> &lt;&lt; endl;</span><br><span class="line"><span class="comment">//a、b以值传递方式</span></span><br><span class="line"><span class="keyword">auto</span> f2 = [a, b]()</span><br><span class="line">&#123;</span><br><span class="line">cout &lt;&lt; a &lt;&lt; <span class="string">&quot;  &quot;</span> &lt;&lt; b &lt;&lt; endl;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">f2</span>();</span><br><span class="line"></span><br><span class="line">cout &lt;&lt; <span class="string">&quot;f3-------------&quot;</span> &lt;&lt; endl;</span><br><span class="line"><span class="comment">//添加x、y参数</span></span><br><span class="line"><span class="keyword">auto</span> f3 = [a, b](<span class="type">int</span> x, <span class="type">int</span> y)</span><br><span class="line">&#123;</span><br><span class="line">cout &lt;&lt; a &lt;&lt; <span class="string">&quot;  &quot;</span> &lt;&lt; b &lt;&lt; endl;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;x=&quot;</span> &lt;&lt; x &lt;&lt; <span class="string">&quot;,y=&quot;</span> &lt;&lt; y &lt;&lt; endl;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">f3</span>(<span class="number">3</span>, <span class="number">6</span>);</span><br><span class="line"></span><br><span class="line">cout &lt;&lt; <span class="string">&quot;f4-------------&quot;</span> &lt;&lt; endl;</span><br><span class="line"><span class="comment">//=：以值传递的方式捕获外面的变量</span></span><br><span class="line"><span class="keyword">auto</span> f4 = [=]()</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">f3</span>(<span class="number">4</span>, <span class="number">8</span>);</span><br><span class="line">cout &lt;&lt; a &lt;&lt; <span class="string">&quot;  &quot;</span> &lt;&lt; b &lt;&lt; endl;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">f4</span>();</span><br><span class="line"></span><br><span class="line">cout &lt;&lt; <span class="string">&quot;f5-------------&quot;</span> &lt;&lt; endl;</span><br><span class="line"><span class="comment">//&amp;：以引用的方式捕获外面的变量</span></span><br><span class="line"><span class="keyword">auto</span> f5 = [&amp;]()</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">f3</span>(<span class="number">5</span>, <span class="number">10</span>);</span><br><span class="line">cout &lt;&lt; a &lt;&lt; <span class="string">&quot;  &quot;</span> &lt;&lt; b &lt;&lt; endl;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">f5</span>();</span><br><span class="line"></span><br><span class="line">cout &lt;&lt; <span class="string">&quot;f6-------------&quot;</span> &lt;&lt; endl;</span><br><span class="line"><span class="comment">//a为值传递，其余为引用</span></span><br><span class="line"><span class="keyword">auto</span> f6 = [&amp;, a]()</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">f3</span>(<span class="number">6</span>, <span class="number">12</span>);</span><br><span class="line">cout &lt;&lt; a &lt;&lt; <span class="string">&quot;  &quot;</span> &lt;&lt; b &lt;&lt; endl;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">f6</span>();</span><br><span class="line"></span><br><span class="line">cout &lt;&lt; <span class="string">&quot;f7-------------&quot;</span> &lt;&lt; endl;</span><br><span class="line"><span class="comment">//a为引用，其余为值传递</span></span><br><span class="line"><span class="keyword">auto</span> f7 = [=, &amp;a]()</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">f3</span>(<span class="number">7</span>, <span class="number">14</span>);</span><br><span class="line">cout &lt;&lt; a &lt;&lt; <span class="string">&quot;  &quot;</span> &lt;&lt; b &lt;&lt; endl;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">f7</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">//默认情况下，lambda表达式以const修饰函数体</span></span><br><span class="line"><span class="comment">//添加mutable，就可以修改了</span></span><br><span class="line"><span class="keyword">auto</span> f8 = [=]() <span class="keyword">mutable</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//不加mutable会报错，无法修改</span></span><br><span class="line">a++;   <span class="comment">//正常</span></span><br><span class="line">&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>运行结果：</p><blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="number">1</span>  <span class="number">2</span></span><br><span class="line">&gt;f3-------------</span><br><span class="line">&gt;<span class="number">1</span>  <span class="number">2</span></span><br><span class="line">&gt;x=<span class="number">3</span>,y=<span class="number">6</span></span><br><span class="line">&gt;f4-------------</span><br><span class="line">&gt;<span class="number">1</span>  <span class="number">2</span></span><br><span class="line">&gt;x=<span class="number">4</span>,y=<span class="number">8</span></span><br><span class="line">&gt;<span class="number">1</span>  <span class="number">2</span></span><br><span class="line">&gt;f5-------------</span><br><span class="line">&gt;<span class="number">1</span>  <span class="number">2</span></span><br><span class="line">&gt;x=<span class="number">5</span>,y=<span class="number">10</span></span><br><span class="line">&gt;<span class="number">1</span>  <span class="number">2</span></span><br><span class="line">&gt;f6-------------</span><br><span class="line">&gt;<span class="number">1</span>  <span class="number">2</span></span><br><span class="line">&gt;x=<span class="number">6</span>,y=<span class="number">12</span></span><br><span class="line">&gt;<span class="number">1</span>  <span class="number">2</span></span><br><span class="line">&gt;f7-------------</span><br><span class="line">&gt;<span class="number">1</span>  <span class="number">2</span></span><br><span class="line">&gt;x=<span class="number">7</span>,y=<span class="number">14</span></span><br><span class="line">&gt;<span class="number">1</span>  <span class="number">2</span></span><br></pre></td></tr></table></figure></blockquote><p>类和全局变量：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> globality = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Test</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="type">int</span> i = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">testFun</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">int</span> a = <span class="number">5</span>;</span><br><span class="line">cout &lt;&lt; __func__ &lt;&lt; endl;</span><br><span class="line"><span class="keyword">auto</span> f1 = [=]()</span><br><span class="line">&#123;</span><br><span class="line">cout &lt;&lt; i &lt;&lt; endl;              <span class="comment">//正常</span></span><br><span class="line">cout &lt;&lt; globality &lt;&lt; endl;   <span class="comment">//正常</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">auto</span> f2 = [&amp;]()</span><br><span class="line">&#123;</span><br><span class="line">cout &lt;&lt; i &lt;&lt; endl;             <span class="comment">//正常</span></span><br><span class="line">cout &lt;&lt; globality &lt;&lt; endl;   <span class="comment">//正常</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//只能捕获类成员变量和全局变量，不能捕获局部变量</span></span><br><span class="line"><span class="keyword">auto</span> f3 = [<span class="keyword">this</span>]()</span><br><span class="line">&#123;</span><br><span class="line">cout &lt;&lt; i &lt;&lt; endl;             <span class="comment">//正常</span></span><br><span class="line">cout &lt;&lt; globality &lt;&lt; endl;   <span class="comment">//正常</span></span><br><span class="line"><span class="comment">//cout &lt;&lt; a &lt;&lt; endl;          //报错</span></span><br><span class="line">&#125;;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//[]中只能捕获全局变量与同一作用域的变量</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">auto</span> f1 = [=]()</span><br><span class="line">&#123;</span><br><span class="line">cout &lt;&lt; globality &lt;&lt; endl;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">f1</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="8-7-值传递与引用捕获参数的区别"><a href="#8-7-值传递与引用捕获参数的区别" class="headerlink" title="8.7 值传递与引用捕获参数的区别"></a>8.7 值传递与引用捕获参数的区别</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">int</span> a = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">auto</span> f1 = [=]() <span class="keyword">mutable</span></span><br><span class="line">&#123;</span><br><span class="line">a++;</span><br><span class="line">cout &lt;&lt; a &lt;&lt; endl;    <span class="comment">//a = 2;</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">f1</span>();</span><br><span class="line">cout &lt;&lt; a &lt;&lt; endl;        <span class="comment">//a = 1;</span></span><br><span class="line">    </span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;-----------&quot;</span> &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> b = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">auto</span> f2 = [&amp;]() <span class="keyword">mutable</span></span><br><span class="line">&#123;</span><br><span class="line">b++;</span><br><span class="line">cout &lt;&lt; b &lt;&lt; endl;    <span class="comment">//b = 2;</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">f2</span>();</span><br><span class="line">cout &lt;&lt; b &lt;&lt; endl;        <span class="comment">//b = 2;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>运行结果：</p><blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="number">2</span></span><br><span class="line">&gt;<span class="number">1</span></span><br><span class="line">&gt;-----------</span><br><span class="line">&gt;<span class="number">2</span></span><br><span class="line">&gt;<span class="number">2</span></span><br></pre></td></tr></table></figure></blockquote><h3 id="8-8-lambda表达式与仿函数"><a href="#8-8-lambda表达式与仿函数" class="headerlink" title="8.8 lambda表达式与仿函数"></a>8.8 lambda表达式与仿函数</h3><p>事实上，仿函数是编译器实现lambda 的一种方式，通过编译器都是把lambda表达式转化为一个仿函数对象。</p><p>因此，在C++11中，lambda 可以视为仿函数的一种等价形式。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyFun</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line"><span class="type">int</span> a;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="built_in">MyFun</span>(<span class="type">int</span> a)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">this</span>-&gt;a = a;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">operator</span><span class="params">()</span><span class="params">(<span class="type">int</span> val)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">this</span>-&gt;a + val;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">int</span> a = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//仿函数</span></span><br><span class="line">cout &lt;&lt; <span class="built_in">MyFun</span>(a)(<span class="number">20</span>) &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line"><span class="comment">//lambda表达式</span></span><br><span class="line"><span class="keyword">auto</span> f = [=](<span class="type">int</span> val)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> a + val;</span><br><span class="line">&#125;;</span><br><span class="line">cout &lt;&lt; <span class="built_in">f</span>(<span class="number">20</span>) &lt;&lt; endl;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="8-9-lambda表达式类型"><a href="#8-9-lambda表达式类型" class="headerlink" title="8.9 lambda表达式类型"></a>8.9 lambda表达式类型</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;functional&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std::placeholders;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">function&lt;<span class="type">int</span>(<span class="type">int</span>)&gt; f1 = [](<span class="type">int</span> x) &#123;<span class="keyword">return</span> x + <span class="number">1</span>; &#125;;</span><br><span class="line">cout &lt;&lt; <span class="built_in">f1</span>(<span class="number">1</span>) &lt;&lt; endl;    <span class="comment">//2</span></span><br><span class="line"></span><br><span class="line">function&lt;<span class="type">int</span>(<span class="type">int</span>)&gt; f2 = <span class="built_in">bind</span>([](<span class="type">int</span> x) &#123;<span class="keyword">return</span> x + <span class="number">1</span>; &#125;, _1);</span><br><span class="line">cout &lt;&lt; <span class="built_in">f2</span>(<span class="number">2</span>) &lt;&lt; endl;    <span class="comment">//3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">auto</span> f3 = [](<span class="type">int</span> x, <span class="type">int</span> y) -&gt;<span class="type">int</span> &#123;<span class="keyword">return</span> x + y; &#125;;</span><br><span class="line"><span class="keyword">auto</span> f4 = [=](<span class="type">int</span> x, <span class="type">int</span> y) -&gt;<span class="type">int</span> &#123;<span class="keyword">return</span> x + y; &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//定义一个FUN_PTR函数指针，参数列表为两个int，返回值为int</span></span><br><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">int</span> <span class="params">(*FUN_PTR)</span><span class="params">(<span class="type">int</span>, <span class="type">int</span>)</span></span>;</span><br><span class="line">FUN_PTR p1 = f3;          <span class="comment">//正常，lambda表达式可以转化为函数指针</span></span><br><span class="line"><span class="comment">//FUN_PTR p2 = f4;        //报错，lambda表达式转化为函数指针不允许捕获变量</span></span><br><span class="line"></span><br><span class="line">cout&lt;&lt; <span class="built_in">p1</span>(<span class="number">1</span>, <span class="number">2</span>) &lt;&lt; endl;  <span class="comment">//3</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>运行结果：</p><blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="number">3</span></span><br></pre></td></tr></table></figure></blockquote><h3 id="8-10-lambda的优势"><a href="#8-10-lambda的优势" class="headerlink" title="8.10 lambda的优势"></a>8.10 lambda的优势</h3><p>传统筛选出大于5的数：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line">vector&lt;<span class="type">int</span>&gt; arr;</span><br><span class="line">vector&lt;<span class="type">int</span>&gt; largeNums; <span class="comment">//筛选出大于5的数</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">print</span><span class="params">(<span class="type">const</span> vector&lt;<span class="type">int</span>&gt;&amp; v)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">auto</span>&amp; i : v)</span><br><span class="line">&#123;</span><br><span class="line">cout &lt;&lt; i &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">cout &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++)</span><br><span class="line">&#123;</span><br><span class="line">arr.<span class="built_in">emplace_back</span>(i);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> temp = <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//传统操作</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">auto</span>&amp; a : arr)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (a &gt; temp)</span><br><span class="line">&#123;</span><br><span class="line">largeNums.<span class="built_in">emplace_back</span>(a);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">print</span>(largeNums);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>回调函数：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span>  <span class="comment">//std::for_each</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line">vector&lt;<span class="type">int</span>&gt; arr;</span><br><span class="line">vector&lt;<span class="type">int</span>&gt; largeNums; <span class="comment">//筛选出大于5的数</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> temp = <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">fun</span><span class="params">(<span class="type">int</span>&amp; n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span> (n &gt; temp)</span><br><span class="line">&#123;</span><br><span class="line">largeNums.<span class="built_in">emplace_back</span>(n);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">print</span><span class="params">(<span class="type">int</span>&amp; n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">cout &lt;&lt; n &lt;&lt; <span class="string">&quot;  &quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++)</span><br><span class="line">&#123;</span><br><span class="line">arr.<span class="built_in">emplace_back</span>(i);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//筛选</span></span><br><span class="line">for_each(arr.<span class="built_in">begin</span>(), arr.<span class="built_in">end</span>(), fun);</span><br><span class="line"><span class="comment">//遍历</span></span><br><span class="line">for_each(largeNums.<span class="built_in">begin</span>(), largeNums.<span class="built_in">end</span>(), print);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>lambda表达式：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span>  <span class="comment">//std::for_each</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line">vector&lt;<span class="type">int</span>&gt; arr;</span><br><span class="line">vector&lt;<span class="type">int</span>&gt; largeNums; <span class="comment">//筛选出大于5的数</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++)</span><br><span class="line">&#123;</span><br><span class="line">arr.<span class="built_in">emplace_back</span>(i);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> temp = <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//筛选</span></span><br><span class="line">for_each(arr.<span class="built_in">begin</span>(), arr.<span class="built_in">end</span>(),</span><br><span class="line">[&amp;temp](<span class="type">int</span>&amp; n) &#123;</span><br><span class="line"><span class="keyword">if</span> (n &gt; temp) largeNums.<span class="built_in">emplace_back</span>(n);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//遍历</span></span><br><span class="line">for_each(largeNums.<span class="built_in">begin</span>(), largeNums.<span class="built_in">end</span>(),</span><br><span class="line">[](<span class="type">int</span>&amp; n) &#123;</span><br><span class="line">cout &lt;&lt; n &lt;&lt; <span class="string">&quot;  &quot;</span>;</span><br><span class="line">&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>]]></content>
      
      
      <categories>
          
          <category> C++ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C++ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>(每日LeetCode)646. 最长数对链</title>
      <link href="/2022/09/03/%E6%AF%8F%E6%97%A5LeetCode/2022-9/646%20%E6%9C%80%E9%95%BF%E6%95%B0%E5%AF%B9%E9%93%BE/"/>
      <url>/2022/09/03/%E6%AF%8F%E6%97%A5LeetCode/2022-9/646%20%E6%9C%80%E9%95%BF%E6%95%B0%E5%AF%B9%E9%93%BE/</url>
      
        <content type="html"><![CDATA[<p>题目：</p><p>给出 n 个数对。 在每一个数对中，第一个数字总是比第二个数字小。</p><p>现在，我们定义一种跟随关系，当且仅当 b &lt; c 时，数对(c, d) 才可以跟在 (a, b) 后面。我们用这种形式来构造一个数对链。</p><p>给定一个数对集合，找出能够形成的最长数对链的长度。你不需要用到所有的数对，你可以以任何顺序选择其中的一些数对来构造。</p><div class="story post-story"><h2 id="示例："><a href="#示例：" class="headerlink" title="示例："></a>示例：</h2><blockquote><p>输入：[[1,2], [2,3], [3,4]]<br>输出：2<br>解释：最长的数对链是 [1,2] -&gt; [3,4]</p></blockquote></div><div class="story post-story"><h2 id="思路：动态规划"><a href="#思路：动态规划" class="headerlink" title="思路：动态规划"></a>思路：动态规划</h2><p>遍历数组<code>pairs</code> 用<code> i</code>表示</p><p>如果存在<code>pairs[j][1] &lt; pairs[i][0]</code></p><p>重新遍历之前已经遍历过的元素(<code>i</code>位置之前的元素)<code>pairs</code>用<code>j</code>表示并且<code>j &lt; i</code>，找到最大的<code>dp[j] + 1</code>，记录到<code>dp[i]</code>中</p><p>返回<code>dp</code>数组的最后一个元素就为最长数对链</p></div><div class="story post-story"><h2 id="代码-cpp-："><a href="#代码-cpp-：" class="headerlink" title="代码(cpp)："></a>代码(cpp)：</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">findLongestChain</span><span class="params">(vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&amp; pairs)</span> </span>&#123;</span><br><span class="line">        <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">dp</span><span class="params">(pairs.size(), <span class="number">1</span>)</span></span>;</span><br><span class="line">        <span class="built_in">sort</span>(pairs.<span class="built_in">begin</span>(), pairs.<span class="built_in">end</span>());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; pairs.<span class="built_in">size</span>(); i++)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>; j &lt; i; j++)&#123;</span><br><span class="line">                <span class="keyword">if</span> (pairs[j][<span class="number">1</span>] &lt; pairs[i][<span class="number">0</span>]) &#123;</span><br><span class="line">                    dp[i] = <span class="built_in">max</span>(dp[i], dp[j] + <span class="number">1</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dp.<span class="built_in">back</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="复杂度分析："><a href="#复杂度分析：" class="headerlink" title="复杂度分析："></a>复杂度分析：</h2><ul><li><p>时间复杂度：O(n^2)，其中 n 为 pairs 的长度。排序的时间复杂度为 O(nlogn)，两层 for 循环的时间复杂度为 O(n^2)。</p></li><li><p>空间复杂度：O(n)，数组 dp 的空间复杂度为 O(n)。</p></li></ul></div>]]></content>
      
      
      <categories>
          
          <category> 每日LeetCode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
            <tag> LeetCode </tag>
            
            <tag> 数据结构 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>(每日LeetCode)687. 最长同值路径</title>
      <link href="/2022/09/02/%E6%AF%8F%E6%97%A5LeetCode/2022-9/687%20%E6%9C%80%E9%95%BF%E5%90%8C%E5%80%BC%E8%B7%AF%E5%BE%84/"/>
      <url>/2022/09/02/%E6%AF%8F%E6%97%A5LeetCode/2022-9/687%20%E6%9C%80%E9%95%BF%E5%90%8C%E5%80%BC%E8%B7%AF%E5%BE%84/</url>
      
        <content type="html"><![CDATA[<div class="story post-story"><h2 id="题目："><a href="#题目：" class="headerlink" title="题目："></a>题目：</h2><p>给定一个二叉树的 root ，返回 最长的路径的长度 ，这个路径中的 每个节点具有相同值 。 这条路径可以经过也可以不经过根节点。</p><p>两个节点之间的路径长度 由它们之间的边数表示。</p></div><div class="story post-story"><h2 id="示例："><a href="#示例：" class="headerlink" title="示例："></a>示例：</h2><img src="https://assets.leetcode.com/uploads/2020/10/13/ex1.jpg" class="lazyload" data-srcset="https://assets.leetcode.com/uploads/2020/10/13/ex1.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img" style="zoom:67%;" /><blockquote><p>输入：root &#x3D; [5,4,5,1,1,5]<br>输出：2</p></blockquote></div><div class="story post-story"><h2 id="思路：深度优先搜索-DFS"><a href="#思路：深度优先搜索-DFS" class="headerlink" title="思路：深度优先搜索(DFS)"></a>思路：深度优先搜索(DFS)</h2><p>递归到树的最底部后，得到左右子树的路径长度</p><p>其中<code>ans</code>记录了左右子树由它们的父节点相连，所得到的左右子树相加的路径长度</p><p>返回值为左右子树中最长路径的长度</p><p>举例：</p><blockquote><p>​     1</p><p>  &#x2F;  \</p><p> <span style="color:red">1</span>     1</p><p>&#x2F; \</p><p>1    1</p></blockquote><ol><li><p>此时，红色标记的就是父节点</p><blockquote><p>  <span style="color:red">1</span></p><p> &#x2F; \</p><p>1    1</p></blockquote></li><li><p>ans的值就为：2(左右子树的路径长度的相加之和)，也就是局部的最优解</p></li><li><p>但是返回值应为左右子树的中的最长路径的长度</p><ul><li><p>因为如果返回左右子树相加之和的路径长度就会导致：</p><blockquote><p>​     1</p><p>  &#x2F;  </p><p> <span style="color:red">1</span>     </p><p>&#x2F; \</p><p>1    1</p></blockquote><p>出现”三岔口”。</p></li><li><p>返回左右子树的中的最长路径的长度</p><blockquote><p>​     1</p><p>  &#x2F;  </p><p> <span style="color:red">1</span>     </p><p>  \</p><p>​     1</p></blockquote><p>不会出现”三岔口”。</p></li></ul></li><li><p>一直向上返回值，直至到达root根节点，最后得到<code>ans</code>的最大值(全局最优解)</p><blockquote><p>​    1</p><p>  &#x2F;  \</p><p> <span style="color:red">1</span>     1</p><p>  \</p><p>​     1</p></blockquote></li></ol></div><div class="story post-story"><h2 id="代码-cpp-："><a href="#代码-cpp-：" class="headerlink" title="代码(cpp)："></a>代码(cpp)：</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="type">int</span> ans = <span class="number">0</span>; <span class="comment">//记录最长的路径</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">dfs</span><span class="params">(TreeNode* root)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(root == <span class="literal">nullptr</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"><span class="comment">//进入最底层的节点，从下往上计算</span></span><br><span class="line">        <span class="type">int</span> L = <span class="built_in">dfs</span>(root-&gt;left); <span class="comment">//获取左子树中最长的一段路径</span></span><br><span class="line">        <span class="type">int</span> R = <span class="built_in">dfs</span>(root-&gt;right); <span class="comment">//获取右子树中最长的一段路径</span></span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> temp_L = <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> temp_R = <span class="number">0</span>;</span><br><span class="line"><span class="comment">//如果左子树的值与父节点的值相同，则加一，否则置为0</span></span><br><span class="line">        <span class="keyword">if</span>(root-&gt;left != <span class="literal">nullptr</span> &amp;&amp; root-&gt;left-&gt;val == root-&gt;val)</span><br><span class="line">            temp_L = L + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(root-&gt;right != <span class="literal">nullptr</span> &amp;&amp; root-&gt;right-&gt;val == root-&gt;val)</span><br><span class="line">            temp_R = R + <span class="number">1</span>;</span><br><span class="line">        <span class="comment">//将左右子树相加变为一条路径，与之前的最长路径比较</span></span><br><span class="line">        ans = <span class="built_in">max</span>(ans, temp_L + temp_R); </span><br><span class="line"><span class="comment">//返回左子树或右子树中的最长的一段路径</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">max</span>(temp_L, temp_R);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">longestUnivaluePath</span><span class="params">(TreeNode* root)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">dfs</span>(root);</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="复杂度分析："><a href="#复杂度分析：" class="headerlink" title="复杂度分析："></a>复杂度分析：</h2><ul><li>时间复杂度：O(n)，其中 n 为树的结点数目。</li><li>空间复杂度：O(n)。递归栈最坏情况下需要 O(n) 的空间。</li></ul></div>]]></content>
      
      
      <categories>
          
          <category> 每日LeetCode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
            <tag> LeetCode </tag>
            
            <tag> 数据结构 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>(每日LeetCode)1475. 商品折扣后的最终价格</title>
      <link href="/2022/09/01/%E6%AF%8F%E6%97%A5LeetCode/2022-9/1475%20%E5%95%86%E5%93%81%E6%8A%98%E6%89%A3%E5%90%8E%E7%9A%84%E6%9C%80%E7%BB%88%E4%BB%B7%E6%A0%BC/"/>
      <url>/2022/09/01/%E6%AF%8F%E6%97%A5LeetCode/2022-9/1475%20%E5%95%86%E5%93%81%E6%8A%98%E6%89%A3%E5%90%8E%E7%9A%84%E6%9C%80%E7%BB%88%E4%BB%B7%E6%A0%BC/</url>
      
        <content type="html"><![CDATA[<div class="story post-story"><h2 id="题目："><a href="#题目：" class="headerlink" title="题目："></a>题目：</h2><p>给你一个数组 prices ，其中 <code>prices[i]</code> 是商店里第 <code>i</code> 件商品的价格。</p><p>商店里正在进行促销活动，如果你要买第 i 件商品，那么你可以得到与 <code>prices[j]</code> 相等的折扣，其中 j 是满足 <code>j &gt; i</code> 且 <code>prices[j] &lt;= prices[i]</code> 的 最小下标 ，如果没有满足条件的 <code>j</code> ，你将没有任何折扣。</p><p>请你返回一个数组，数组中第 <code>i</code> 个元素是折扣后你购买商品 <code>i</code> 最终需要支付的价格。</p></div><div class="story post-story"><h2 id="示例："><a href="#示例：" class="headerlink" title="示例："></a>示例：</h2><blockquote><p>输入：prices &#x3D; [8,4,6,2,3]<br>输出：[4,2,4,2,3]<br>解释：<br>商品 0 的价格为 price[0]&#x3D;8 ，你将得到 prices[1]&#x3D;4 的折扣，所以最终价格为 8 - 4 &#x3D; 4 。<br>商品 1 的价格为 price[1]&#x3D;4 ，你将得到 prices[3]&#x3D;2 的折扣，所以最终价格为 4 - 2 &#x3D; 2 。<br>商品 2 的价格为 price[2]&#x3D;6 ，你将得到 prices[3]&#x3D;2 的折扣，所以最终价格为 6 - 2 &#x3D; 4 。<br>商品 3 和 4 都没有折扣。</p></blockquote></div><div class="story post-story"><h2 id="思路：遍历"><a href="#思路：遍历" class="headerlink" title="思路：遍历"></a>思路：遍历</h2><p>遍历找到满足 <code>j &gt; i</code> 且 <code>prices[j] &lt;= prices[i]</code> 的 最小下标</p></div><div class="story post-story"><h2 id="代码-cpp-："><a href="#代码-cpp-：" class="headerlink" title="代码(cpp)："></a>代码(cpp)：</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">finalPrices</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; prices)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> n = prices.<span class="built_in">size</span>();</span><br><span class="line">        <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">ans</span><span class="params">(n)</span></span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++)&#123;</span><br><span class="line">            ans[i] = prices[i];</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j = i + <span class="number">1</span>; j &lt; n; j++)&#123;</span><br><span class="line">                <span class="keyword">if</span>(prices[j] &lt;= prices[i])&#123;</span><br><span class="line">                    ans[i] -= prices[j];</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="复杂度分析："><a href="#复杂度分析：" class="headerlink" title="复杂度分析："></a>复杂度分析：</h2><ul><li><p>时间复杂度：O(n^2)，其中 n 为数组的长度。对于每个商品，我们需要遍历一遍数组查找符合题目要求的折扣。</p></li><li><p>空间复杂度：O(1)。返回值不计入空间复杂度。</p></li></ul></div>]]></content>
      
      
      <categories>
          
          <category> 每日LeetCode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
            <tag> LeetCode </tag>
            
            <tag> 数据结构 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>(每日LeetCode)946. 验证栈序列</title>
      <link href="/2022/08/31/%E6%AF%8F%E6%97%A5LeetCode/2022-8/946%20%E9%AA%8C%E8%AF%81%E6%A0%88%E5%BA%8F%E5%88%97/"/>
      <url>/2022/08/31/%E6%AF%8F%E6%97%A5LeetCode/2022-8/946%20%E9%AA%8C%E8%AF%81%E6%A0%88%E5%BA%8F%E5%88%97/</url>
      
        <content type="html"><![CDATA[<div class="story post-story"><h2 id="题目："><a href="#题目：" class="headerlink" title="题目："></a>题目：</h2><p>给定 pushed 和 popped 两个序列，每个序列中的 值都不重复，只有当它们可能是在最初空栈上进行的推入 push 和弹出 pop 操作序列的结果时，返回 true；否则，返回 false 。</p></div><div class="story post-story"><h2 id="示例："><a href="#示例：" class="headerlink" title="示例："></a>示例：</h2><blockquote><p>输入：pushed &#x3D; [1,2,3,4,5], popped &#x3D; [4,5,3,2,1]<br>输出：true<br>解释：我们可以按以下顺序执行：<br>push(1), push(2), push(3), push(4), pop() -&gt; 4,<br>push(5), pop() -&gt; 5, pop() -&gt; 3, pop() -&gt; 2, pop() -&gt; 1</p></blockquote></div><div class="story post-story"><h2 id="思路：模拟"><a href="#思路：模拟" class="headerlink" title="思路：模拟"></a>思路：模拟</h2><p>依次将<code>pushed</code>数组中的元素入栈，如果栈<code>s</code>的栈顶等于<code>popped</code>的第一个元素，将栈顶元素出栈，并判断<code>popped</code>数组的下一个元素</p><p>最后只需要判断栈<code>s</code>是否为空即可</p></div><div class="story post-story"><h2 id="代码-cpp-："><a href="#代码-cpp-：" class="headerlink" title="代码(cpp)："></a>代码(cpp)：</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">validateStackSequences</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; pushed, vector&lt;<span class="type">int</span>&gt;&amp; popped)</span> </span>&#123;</span><br><span class="line">        stack&lt;<span class="type">int</span>&gt; s;</span><br><span class="line">        <span class="type">int</span> pos = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; pushed.<span class="built_in">size</span>(); i++) &#123;</span><br><span class="line">            s.<span class="built_in">emplace</span>(pushed[i]);</span><br><span class="line">            <span class="keyword">while</span> (!s.<span class="built_in">empty</span>() &amp;&amp; s.<span class="built_in">top</span>() == popped[pos]) &#123;</span><br><span class="line">                s.<span class="built_in">pop</span>();</span><br><span class="line">                pos++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> s.<span class="built_in">empty</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="复杂度分析："><a href="#复杂度分析：" class="headerlink" title="复杂度分析："></a>复杂度分析：</h2><ul><li><p>时间复杂度：O(n)，其中 nn 是数组 pushed 和 popped 的长度。需要遍历数组 pushed 和 popped 各一次，判断两个数组是否为有效的栈操作序列。</p></li><li><p>空间复杂度：O(n)，其中 n 是数组 pushed 和 popped 的长度。空间复杂度主要取决于栈空间，栈内元素个数不超过 n。</p></li></ul></div>]]></content>
      
      
      <categories>
          
          <category> 每日LeetCode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
            <tag> LeetCode </tag>
            
            <tag> 数据结构 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>(每日LeetCode)998. 最大二叉树 II</title>
      <link href="/2022/08/30/%E6%AF%8F%E6%97%A5LeetCode/2022-8/998%20%E6%9C%80%E5%A4%A7%E4%BA%8C%E5%8F%89%E6%A0%91%20II/"/>
      <url>/2022/08/30/%E6%AF%8F%E6%97%A5LeetCode/2022-8/998%20%E6%9C%80%E5%A4%A7%E4%BA%8C%E5%8F%89%E6%A0%91%20II/</url>
      
        <content type="html"><![CDATA[<p>题目：</p><p>最大树 定义：一棵树，并满足：<strong>其中每个节点的值都大于其子树中的任何其他值</strong>。</p><p>给你最大树的根节点 root 和一个整数 val 。</p><p>就像 之前的问题 那样，给定的树是利用 Construct(a) 例程从列表 a（root &#x3D; Construct(a)）递归地构建的：</p><p>如果 a 为空，返回 null 。<br>否则，令 a[i] 作为 a 的最大元素。创建一个值为 a[i] 的根节点 root 。<br>root 的左子树将被构建为 Construct([a[0], a[1], …, a[i - 1]]) 。<br>root 的右子树将被构建为 Construct([a[i + 1], a[i + 2], …, a[a.length - 1]]) 。<br>返回 root 。<br>请注意，题目没有直接给出 a ，只是给出一个根节点 root &#x3D; Construct(a) 。</p><p>假设 b 是 a 的副本，并在末尾附加值 val。题目数据保证 b 中的值互不相同。</p><p>返回 Construct(b) 。</p><p>示例：</p><p><img src="https://assets.leetcode-cn.com/aliyun-lc-upload/uploads/2019/02/23/maximum-binary-tree-1-2.png" class="lazyload" data-srcset="https://assets.leetcode-cn.com/aliyun-lc-upload/uploads/2019/02/23/maximum-binary-tree-1-2.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img"></p><blockquote><p>输入：root &#x3D; [4,1,3,null,null,2], val &#x3D; 5<br>输出：[5,4,null,1,3,null,null,2]<br>解释：a &#x3D; [1,4,2,3], b &#x3D; [1,4,2,3,5]</p></blockquote><p>没看懂题目…</p><p>看题解大概是：val足够大，整个树都是左子树。val足够小，变成一个右叶子。</p><p>代码(cpp)：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">TreeNode* <span class="title">insertIntoMaxTree</span><span class="params">(TreeNode* root, <span class="type">int</span> val)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(root == <span class="literal">nullptr</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">TreeNode</span>(val);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(root-&gt;val &lt; val)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">TreeNode</span>(val, root, <span class="literal">nullptr</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        root-&gt;right = <span class="built_in">insertIntoMaxTree</span>(root-&gt;right, val);</span><br><span class="line">        <span class="keyword">return</span> root;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 每日LeetCode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
            <tag> LeetCode </tag>
            
            <tag> 数据结构 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>(每日LeetCode)1470. 重新排列数组</title>
      <link href="/2022/08/29/%E6%AF%8F%E6%97%A5LeetCode/2022-8/1470%20%E9%87%8D%E6%96%B0%E6%8E%92%E5%88%97%E6%95%B0%E7%BB%84/"/>
      <url>/2022/08/29/%E6%AF%8F%E6%97%A5LeetCode/2022-8/1470%20%E9%87%8D%E6%96%B0%E6%8E%92%E5%88%97%E6%95%B0%E7%BB%84/</url>
      
        <content type="html"><![CDATA[<div class="story post-story"><h2 id="题目："><a href="#题目：" class="headerlink" title="题目："></a>题目：</h2><p>给你一个数组 <code>nums</code> ，数组中有 2n 个元素，按 <code>[x1,x2,...,xn,y1,y2,...,yn]</code> 的格式排列。</p><p>请你将数组按 <code>[x1,y1,x2,y2,...,xn,yn]</code> 格式重新排列，返回重排后的数组。</p></div><div class="story post-story"><h2 id="示例："><a href="#示例：" class="headerlink" title="示例："></a>示例：</h2><blockquote><p>输入：nums &#x3D; [2,5,1,3,4,7], n &#x3D; 3<br>输出：[2,3,5,4,1,7]<br>解释：由于 x1&#x3D;2, x2&#x3D;5, x3&#x3D;1, y1&#x3D;3, y2&#x3D;4, y3&#x3D;7 ，所以答案为 [2,3,5,4,1,7]</p></blockquote></div><div class="story post-story"><h2 id="思路：双指针"><a href="#思路：双指针" class="headerlink" title="思路：双指针"></a>思路：双指针</h2><p>在数组<code>nums</code>的起始位置和中间位置依次遍历添加到<code>ans</code>新数组中</p></div><div class="story post-story"><h2 id="代码-cpp-："><a href="#代码-cpp-：" class="headerlink" title="代码(cpp)："></a>代码(cpp)：</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">shuffle</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums, <span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">ans</span><span class="params">(<span class="number">2</span>*n)</span></span>;</span><br><span class="line">        <span class="type">int</span> left = <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> right = n;</span><br><span class="line">        <span class="keyword">while</span>(left &lt; n)&#123;</span><br><span class="line">            ans.<span class="built_in">emplace_back</span>(nums[left]);</span><br><span class="line">            ans.<span class="built_in">emplace_back</span>(nums[right]);</span><br><span class="line">            left++;</span><br><span class="line">            right++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="复杂度分析："><a href="#复杂度分析：" class="headerlink" title="复杂度分析："></a>复杂度分析：</h2><ul><li><p>时间复杂度：O(n)，其中 n 是给定的参数。需要遍历长度为 2n 的数组 nums 一次将数组重新排列，每个元素重新排列的时间是 O(1)O(1)。</p></li><li><p>空间复杂度：O(1)。注意返回值不计入空间复杂度。</p></li></ul></div>]]></content>
      
      
      <categories>
          
          <category> 每日LeetCode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
            <tag> LeetCode </tag>
            
            <tag> 数据结构 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>(每日LeetCode)662. 二叉树最大宽度</title>
      <link href="/2022/08/27/%E6%AF%8F%E6%97%A5LeetCode/2022-8/662%20%E4%BA%8C%E5%8F%89%E6%A0%91%E6%9C%80%E5%A4%A7%E5%AE%BD%E5%BA%A6/"/>
      <url>/2022/08/27/%E6%AF%8F%E6%97%A5LeetCode/2022-8/662%20%E4%BA%8C%E5%8F%89%E6%A0%91%E6%9C%80%E5%A4%A7%E5%AE%BD%E5%BA%A6/</url>
      
        <content type="html"><![CDATA[<div class="story post-story"><h2 id="题目："><a href="#题目：" class="headerlink" title="题目："></a>题目：</h2><p>给你一棵二叉树的根节点 <code>root</code> ，返回树的 <strong>最大宽度</strong> 。</p><p>树的 最大宽度 是所有层中最大的 宽度 。</p><p>每一层的 宽度 被定义为该层最左和最右的非空节点（即，两个端点）之间的长度。将这个二叉树视作与满二叉树结构相同，两端点间会出现一些延伸到这一层的 <code>null</code> 节点，这些 <code>null</code> 节点也计入长度。</p><p>题目数据保证答案将会在  32 位 带符号整数范围内。</p></div><div class="story post-story"><h2 id="示例："><a href="#示例：" class="headerlink" title="示例："></a>示例：</h2><img src="https://assets.leetcode.com/uploads/2021/05/03/width1-tree.jpg" class="lazyload" data-srcset="https://assets.leetcode.com/uploads/2021/05/03/width1-tree.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img" style="zoom:67%;" /><blockquote><p>输入：root &#x3D; [1,3,2,5,3,null,9]<br>输出：4<br>解释：最大宽度出现在树的第 3 层，宽度为 4 (5,3,null,9) 。</p></blockquote></div><div class="story post-story"><h2 id="思路：广度优先搜索-BFS"><a href="#思路：广度优先搜索-BFS" class="headerlink" title="思路：广度优先搜索(BFS)"></a>思路：广度优先搜索(BFS)</h2><p>就是一个二叉树的层序遍历</p><p>只是遍历的时候增加了一个 标记每个<strong>结点</strong>的<strong>序号</strong> 的过程</p><p>如果某节点<code>node</code>的序号为<code>n</code>，那么它的左节点为<code>2n</code>，右节点为<code>2n+1</code></p><p>每层的<strong>尾序号与首序号之间的差</strong>就是该层的宽度</p><p>返回最大宽度</p></div><div class="story post-story"><h2 id="代码-cpp-："><a href="#代码-cpp-：" class="headerlink" title="代码(cpp)："></a>代码(cpp)：</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">widthOfBinaryTree</span><span class="params">(TreeNode* root)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 初始化数组储存结点以及对应的序号</span></span><br><span class="line">        vector&lt;pair&lt;TreeNode*, <span class="type">unsigned</span> <span class="type">long</span> <span class="type">long</span>&gt;&gt; array;</span><br><span class="line">        array.<span class="built_in">emplace_back</span>(root, <span class="number">1L</span>);</span><br><span class="line">        <span class="type">unsigned</span> <span class="type">long</span> <span class="type">long</span> ans = <span class="number">0</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">while</span>(!array.<span class="built_in">empty</span>())&#123; <span class="comment">//层序遍历</span></span><br><span class="line">            vector&lt;pair&lt;TreeNode*, <span class="type">unsigned</span> <span class="type">long</span> <span class="type">long</span>&gt;&gt; temp;</span><br><span class="line">            <span class="comment">// 获取每个结点以及对应的序号</span></span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">auto</span>&amp; [node, index] : array)&#123; <span class="comment">//遍历该层的每个结点</span></span><br><span class="line">                </span><br><span class="line">                <span class="keyword">if</span>(node-&gt;left) temp.<span class="built_in">emplace_back</span>(node-&gt;left, index*<span class="number">2</span>);</span><br><span class="line">                <span class="keyword">if</span>(node-&gt;right) temp.<span class="built_in">emplace_back</span>(node-&gt;right, index*<span class="number">2</span> + <span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            ans = <span class="built_in">max</span>(ans, array.<span class="built_in">back</span>().second - array[<span class="number">0</span>].second + <span class="number">1</span>);</span><br><span class="line">            array = <span class="built_in">move</span>(temp); <span class="comment">//将temp(就是下一层的结点)引用给array</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="复杂度分析："><a href="#复杂度分析：" class="headerlink" title="复杂度分析："></a>复杂度分析：</h2><ul><li><p>时间复杂度：O(n)，其中 n 是二叉树的节点个数。需要遍历所有节点。</p></li><li><p>空间复杂度：O(n)。广度优先搜索的空间复杂度最多为 O(n)。</p></li></ul></div>]]></content>
      
      
      <categories>
          
          <category> 每日LeetCode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
            <tag> LeetCode </tag>
            
            <tag> 数据结构 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>(每日LeetCode)1464. 数组中两元素的最大乘积</title>
      <link href="/2022/08/26/%E6%AF%8F%E6%97%A5LeetCode/2022-8/1464%20%E6%95%B0%E7%BB%84%E4%B8%AD%E4%B8%A4%E5%85%83%E7%B4%A0%E7%9A%84%E6%9C%80%E5%A4%A7%E4%B9%98%E7%A7%AF/"/>
      <url>/2022/08/26/%E6%AF%8F%E6%97%A5LeetCode/2022-8/1464%20%E6%95%B0%E7%BB%84%E4%B8%AD%E4%B8%A4%E5%85%83%E7%B4%A0%E7%9A%84%E6%9C%80%E5%A4%A7%E4%B9%98%E7%A7%AF/</url>
      
        <content type="html"><![CDATA[<div class="story post-story"><h2 id="题目："><a href="#题目：" class="headerlink" title="题目："></a>题目：</h2><p>给你一个整数数组 <code>nums</code>，请你选择数组的两个不同下标 <code>i</code> 和 <code>j</code>，使 <code>(nums[i]-1)*(nums[j]-1)</code> 取得最大值。</p><p>请你计算并返回该式的最大值。</p></div><div class="story post-story"><h2 id="示例："><a href="#示例：" class="headerlink" title="示例："></a>示例：</h2><blockquote><p>输入：nums &#x3D; [3,4,5,2]<br>输出：12<br>解释：如果选择下标 i&#x3D;1 和 j&#x3D;2（下标从 0 开始），则可以获得最大值，(nums[1]-1)<em>(nums[2]-1) &#x3D; (4-1)</em>(5-1) &#x3D; 3*4 &#x3D; 12 。 </p></blockquote></div><div class="story post-story"><h2 id="代码-cpp-："><a href="#代码-cpp-：" class="headerlink" title="代码(cpp)："></a>代码(cpp)：</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">maxProduct</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">sort</span>(nums.<span class="built_in">begin</span>(), nums.<span class="built_in">end</span>());</span><br><span class="line">        <span class="keyword">return</span> (nums[nums.<span class="built_in">size</span>()<span class="number">-2</span>] - <span class="number">1</span>)*(nums[nums.<span class="built_in">size</span>()<span class="number">-1</span>] - <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="复杂度分析："><a href="#复杂度分析：" class="headerlink" title="复杂度分析："></a>复杂度分析：</h2><ul><li>时间复杂度：O(nlogn)，其中 n 为数组 nums 的长度，主要为数组排序的时间复杂度。</li><li>空间复杂度：O(1)，仅使用常量空间。</li></ul></div>]]></content>
      
      
      <categories>
          
          <category> 每日LeetCode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
            <tag> LeetCode </tag>
            
            <tag> 数据结构 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>(每日LeetCode)658. 找到 K 个最接近的元素</title>
      <link href="/2022/08/25/%E6%AF%8F%E6%97%A5LeetCode/2022-8/658%20%E6%89%BE%E5%88%B0%20K%20%E4%B8%AA%E6%9C%80%E6%8E%A5%E8%BF%91%E7%9A%84%E5%85%83%E7%B4%A0/"/>
      <url>/2022/08/25/%E6%AF%8F%E6%97%A5LeetCode/2022-8/658%20%E6%89%BE%E5%88%B0%20K%20%E4%B8%AA%E6%9C%80%E6%8E%A5%E8%BF%91%E7%9A%84%E5%85%83%E7%B4%A0/</url>
      
        <content type="html"><![CDATA[<div class="story post-story"><h2 id="题目："><a href="#题目：" class="headerlink" title="题目："></a>题目：</h2><p>给定一个 排序好 的数组 arr ，两个整数 k 和 x ，从数组中找到最靠近 x（两数之差最小）的 k 个数。返回的结果必须要是按升序排好的。</p><p>整数 a 比整数 b 更接近 x 需要满足：</p><p><code>|a - x| &lt; |b - x|</code> 或者<code>|a - x| == |b - x|</code> 且 <code>a &lt; b</code></p></div><div class="story post-story"><h2 id="示例："><a href="#示例：" class="headerlink" title="示例："></a>示例：</h2><blockquote><p>输入：arr &#x3D; [1,2,3,4,5], k &#x3D; 4, x &#x3D; 3<br>输出：[1,2,3,4]</p></blockquote></div><div class="story post-story"><h2 id="思路：二分查找-双指针"><a href="#思路：二分查找-双指针" class="headerlink" title="思路：二分查找+双指针"></a>思路：二分查找+双指针</h2><p>利用 <strong>二分查找</strong> 找到第一个不小于x的元素</p><p>利用 <strong>双指针</strong> 循环找到最接近x值的元素区间</p><p>返回此区间的元素即可</p></div><div class="story post-story"><h2 id="代码-cpp-："><a href="#代码-cpp-：" class="headerlink" title="代码(cpp)："></a>代码(cpp)：</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">findClosestElements</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; arr, <span class="type">int</span> k, <span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">auto</span> right = <span class="built_in">lower_bound</span>(arr.<span class="built_in">begin</span>(), arr.<span class="built_in">end</span>(), x);</span><br><span class="line">        <span class="keyword">auto</span> left = right - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (k &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (left &lt; arr.<span class="built_in">begin</span>()) &#123;</span><br><span class="line">                right++;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (right &gt;= arr.<span class="built_in">end</span>()) &#123;</span><br><span class="line">                left--;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (x - *left &lt;= *right - x) &#123;</span><br><span class="line">                left--;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                right++;</span><br><span class="line">            &#125;</span><br><span class="line">            k--;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;(left + <span class="number">1</span>, right);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="复杂度分析："><a href="#复杂度分析：" class="headerlink" title="复杂度分析："></a>复杂度分析：</h2><ul><li><p>时间复杂度：O(logn+k)，其中 n 是数组 arr 的长度。二分查找需要 O(logn)，双指针查找需要 O(k)。</p></li><li><p>空间复杂度：O(1)。返回值不计入空间复杂度。</p></li></ul></div>]]></content>
      
      
      <categories>
          
          <category> 每日LeetCode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
            <tag> LeetCode </tag>
            
            <tag> 数据结构 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>(每日LeetCode)1460. 通过翻转子数组使两个数组相等</title>
      <link href="/2022/08/24/%E6%AF%8F%E6%97%A5LeetCode/2022-8/1460%20%E9%80%9A%E8%BF%87%E7%BF%BB%E8%BD%AC%E5%AD%90%E6%95%B0%E7%BB%84%E4%BD%BF%E4%B8%A4%E4%B8%AA%E6%95%B0%E7%BB%84%E7%9B%B8%E7%AD%89/"/>
      <url>/2022/08/24/%E6%AF%8F%E6%97%A5LeetCode/2022-8/1460%20%E9%80%9A%E8%BF%87%E7%BF%BB%E8%BD%AC%E5%AD%90%E6%95%B0%E7%BB%84%E4%BD%BF%E4%B8%A4%E4%B8%AA%E6%95%B0%E7%BB%84%E7%9B%B8%E7%AD%89/</url>
      
        <content type="html"><![CDATA[<div class="story post-story"><h2 id="题目："><a href="#题目：" class="headerlink" title="题目："></a>题目：</h2><p>给你两个长度相同的整数数组 <code>target</code> 和 <code>arr</code> 。每一步中，你可以选择 <code>arr</code> 的任意 非空子数组 并将它翻转。你可以执行此过程任意次。</p><p>如果你能让 <code>arr</code> 变得与 <code>target</code> 相同，返回 <code>True</code>；否则，返回 <code>False</code> 。</p></div><div class="story post-story"><h2 id="示例："><a href="#示例：" class="headerlink" title="示例："></a>示例：</h2><blockquote><p>输入：target &#x3D; [1,2,3,4], arr &#x3D; [2,4,1,3]<br>输出：true<br>解释：你可以按照如下步骤使 arr 变成 target：<br>1- 翻转子数组 [2,4,1] ，arr 变成 [1,4,2,3]<br>2- 翻转子数组 [4,2] ，arr 变成 [1,2,4,3]<br>3- 翻转子数组 [4,3] ，arr 变成 [1,2,3,4]<br>上述方法并不是唯一的，还存在多种将 arr 变成 target 的方法。</p></blockquote></div><div class="story post-story"><h2 id="思路："><a href="#思路：" class="headerlink" title="思路："></a>思路：</h2><p>这道题很简单！</p><p>不需要关注<strong>过程</strong>，只需要看到<strong>结果</strong>即可</p><p>将<code>target</code>与<code>arr</code>排序后比较是否相同即可</p></div><div class="story post-story"><h2 id="代码-cpp-："><a href="#代码-cpp-：" class="headerlink" title="代码(cpp)："></a>代码(cpp)：</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">canBeEqual</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; target, vector&lt;<span class="type">int</span>&gt;&amp; arr)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">sort</span>(target.<span class="built_in">begin</span>(), target.<span class="built_in">end</span>());</span><br><span class="line">        <span class="built_in">sort</span>(arr.<span class="built_in">begin</span>(), arr.<span class="built_in">end</span>());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> target == arr;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="复杂度分析："><a href="#复杂度分析：" class="headerlink" title="复杂度分析："></a>复杂度分析：</h2><ul><li><p>时间复杂度：O(n×logn)，其中 n 是输入数组的长度。排序消耗 O(n×logn) 复杂度，判断是否相同消耗 O(n) 复杂度。</p></li><li><p>空间复杂度：O(logn)，快速排序递归深度平均为 O(logn)。</p></li></ul></div>]]></content>
      
      
      <categories>
          
          <category> 每日LeetCode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
            <tag> LeetCode </tag>
            
            <tag> 数据结构 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>(每日LeetCode)655. 输出二叉树</title>
      <link href="/2022/08/22/%E6%AF%8F%E6%97%A5LeetCode/2022-8/655%20%E8%BE%93%E5%87%BA%E4%BA%8C%E5%8F%89%E6%A0%91/"/>
      <url>/2022/08/22/%E6%AF%8F%E6%97%A5LeetCode/2022-8/655%20%E8%BE%93%E5%87%BA%E4%BA%8C%E5%8F%89%E6%A0%91/</url>
      
        <content type="html"><![CDATA[<div class="story post-story"><h2 id="题目："><a href="#题目：" class="headerlink" title="题目："></a>题目：</h2><p>给你一棵二叉树的根节点 root ，请你构造一个下标从 0 开始、大小为 <code>m x n</code> 的字符串矩阵 <code>res</code> ，用以表示树的 格式化布局 。构造此格式化布局矩阵需要遵循以下规则：</p><p>树的 高度 为 <code>height</code> ，矩阵的行数 m 应该等于 <code>height + 1</code> 。<br>矩阵的列数 <code>n</code> 应该等于 <code>2^(height+1 - 1)</code> 。<br>根节点 需要放置在 顶行 的 正中间 ，对应位置为 <code>res[0][(n-1)/2]</code> 。<br>对于放置在矩阵中的每个节点，设对应位置为 <code>res[r][c]</code> ，将其左子节点放置在 <code>res[r+1][c-2height-r-1]</code> ，右子节点放置在 <code>res[r+1][c+2height-r-1]</code>。<br>继续这一过程，直到树中的所有节点都妥善放置。<br>任意空单元格都应该包含空字符串 <code>&quot;&quot;</code> 。<br>返回构造得到的矩阵 <code>res</code> 。</p></div><div class="story post-story"><h2 id="示例："><a href="#示例：" class="headerlink" title="示例："></a>示例：</h2><img src="https://assets.leetcode.com/uploads/2021/05/03/print2-tree.jpg" class="lazyload" data-srcset="https://assets.leetcode.com/uploads/2021/05/03/print2-tree.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img" style="zoom: 67%;" /><blockquote><p>输入：root &#x3D; [1,2,3,null,4]<br>输出：<br>[[“”,””,””,”1”,””,””,””],<br>[“”,”2”,””,””,””,”3”,””],<br>[“”,””,”4”,””,””,””,””]]</p></blockquote></div><div class="story post-story"><h2 id="思路：DFS-深度优先搜索"><a href="#思路：DFS-深度优先搜索" class="headerlink" title="思路：DFS(深度优先搜索)"></a>思路：DFS(深度优先搜索)</h2><ol><li>利用DFS获取深度</li><li>利用DFS遍历二叉树获取对应的val值</li></ol></div><div class="story post-story"><h2 id="代码-cpp-："><a href="#代码-cpp-：" class="headerlink" title="代码(cpp)："></a>代码(cpp)：</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">getHeight</span><span class="params">(TreeNode* root)</span></span>&#123;</span><br><span class="line">        <span class="type">int</span> height = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span>(root-&gt;left)&#123;</span><br><span class="line">            height = <span class="built_in">max</span>(height, <span class="built_in">getHeight</span>(root-&gt;left) + <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(root-&gt;right)&#123;</span><br><span class="line">            height = <span class="built_in">max</span>(height, <span class="built_in">getHeight</span>(root-&gt;right) + <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> height;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> r, <span class="type">int</span> c, TreeNode* root, vector&lt;vector&lt;string&gt;&gt;&amp; res, <span class="type">int</span>&amp; height)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(root == <span class="literal">nullptr</span>) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">        res[r][c] = <span class="built_in">to_string</span>(root-&gt;val);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">dfs</span>(r+<span class="number">1</span>, c-<span class="built_in">pow</span>(<span class="number">2</span>, height-r<span class="number">-1</span>), root-&gt;left, res, height);</span><br><span class="line">        <span class="built_in">dfs</span>(r+<span class="number">1</span>, c+<span class="built_in">pow</span>(<span class="number">2</span>, height-r<span class="number">-1</span>), root-&gt;right, res, height);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    vector&lt;vector&lt;string&gt;&gt; <span class="built_in">printTree</span>(TreeNode* root) &#123;</span><br><span class="line">        <span class="type">int</span> height = <span class="built_in">getHeight</span>(root); <span class="comment">//获取深度</span></span><br><span class="line">        <span class="type">int</span> m = height + <span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> n = <span class="built_in">pow</span>(<span class="number">2</span>, m) - <span class="number">1</span>;</span><br><span class="line">        <span class="comment">//初始化res</span></span><br><span class="line">        vector&lt;vector&lt;string&gt;&gt; <span class="built_in">res</span>(m, <span class="built_in">vector</span>&lt;string&gt;(n));</span><br><span class="line"><span class="comment">//dfs遍历二叉树</span></span><br><span class="line">        <span class="built_in">dfs</span>(<span class="number">0</span>, (n<span class="number">-1</span>)/<span class="number">2</span>, root, res, height);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="复杂度分析："><a href="#复杂度分析：" class="headerlink" title="复杂度分析："></a>复杂度分析：</h2><ul><li><p>时间复杂度：O(height×2^height)，其中height 是二叉树的高度。需要填充 (height + 1)×(2^(height+1) − 1) 的数组。</p></li><li><p>空间复杂度：O(height)，其中 height 是二叉树的高度。空间复杂度主要是递归调用的栈空间，取决于二叉树的高度。注意返回值不计入空间复杂度。</p></li></ul></div>]]></content>
      
      
      <categories>
          
          <category> 每日LeetCode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
            <tag> LeetCode </tag>
            
            <tag> 数据结构 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/22/%E5%B0%8F%E6%8A%80%E5%B7%A7/C++%E4%B8%AD1%E3%80%8A%E3%80%8A%20n%E7%9A%84%E6%84%8F%E6%80%9D/"/>
      <url>/2022/08/22/%E5%B0%8F%E6%8A%80%E5%B7%A7/C++%E4%B8%AD1%E3%80%8A%E3%80%8A%20n%E7%9A%84%E6%84%8F%E6%80%9D/</url>
      
        <content type="html"><![CDATA[<hr><hr><div class="story post-story"><h2 id="1-lt-lt-n是什么意思？"><a href="#1-lt-lt-n是什么意思？" class="headerlink" title="1 &lt;&lt; n是什么意思？"></a><code>1 &lt;&lt; n</code>是什么意思？</h2><p>1的二进制是<code>0000 0001</code><br><code>&lt;&lt;</code>：将二进制编码向左移动n位并将空位补0</p><p>例如：</p><p><code>1 &lt;&lt; 2</code></p><p>就是将<code>0000 0001</code>左移2位为变成<code>0000 0100</code></p><p>转换成十进制最终变成4</p><p>同理：</p><p><code>1 &gt;&gt; n</code>：将二进制编码向右移动n位</p></div>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>(每日LeetCode)1455. 检查单词是否为句中其他单词的前缀</title>
      <link href="/2022/08/21/%E6%AF%8F%E6%97%A5LeetCode/2022-8/1455%20%E6%A3%80%E6%9F%A5%E5%8D%95%E8%AF%8D%E6%98%AF%E5%90%A6%E4%B8%BA%E5%8F%A5%E4%B8%AD%E5%85%B6%E4%BB%96%E5%8D%95%E8%AF%8D%E7%9A%84%E5%89%8D%E7%BC%80/"/>
      <url>/2022/08/21/%E6%AF%8F%E6%97%A5LeetCode/2022-8/1455%20%E6%A3%80%E6%9F%A5%E5%8D%95%E8%AF%8D%E6%98%AF%E5%90%A6%E4%B8%BA%E5%8F%A5%E4%B8%AD%E5%85%B6%E4%BB%96%E5%8D%95%E8%AF%8D%E7%9A%84%E5%89%8D%E7%BC%80/</url>
      
        <content type="html"><![CDATA[<div class="story post-story"><h2 id="题目："><a href="#题目：" class="headerlink" title="题目："></a>题目：</h2><p>给你一个字符串 sentence 作为句子并指定检索词为 searchWord ，其中句子由若干用 单个空格 分隔的单词组成。请你检查检索词 searchWord 是否为句子 sentence 中任意单词的前缀。</p><p>如果 searchWord 是某一个单词的前缀，则返回句子 sentence 中该单词所对应的下标（下标从 1 开始）。如果 searchWord 是多个单词的前缀，则返回匹配的第一个单词的下标（最小下标）。如果 searchWord 不是任何单词的前缀，则返回 -1 。</p><p>字符串 s 的 前缀 是 s 的任何前导连续子字符串。</p></div><div class="story post-story"><h2 id="示例："><a href="#示例：" class="headerlink" title="示例："></a>示例：</h2><blockquote><p>输入：sentence &#x3D; “i love eating burger”, searchWord &#x3D; “burg”<br>输出：4<br>解释：”burg” 是 “burger” 的前缀，而 “burger” 是句子中第 4 个单词。</p></blockquote></div><div class="story post-story"><h2 id="代码-cpp-："><a href="#代码-cpp-：" class="headerlink" title="代码(cpp)："></a>代码(cpp)：</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">isPrefixOfWord</span><span class="params">(string sentence, string searchWord)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> ans = <span class="number">1</span>; <span class="comment">//初始化第一个单词的wei</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; sentence.<span class="built_in">size</span>(); i++) &#123;</span><br><span class="line">            <span class="type">int</span> temp = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">while</span> (sentence[i] == searchWord[temp]) &#123; <span class="comment">// 与searchWord进行比较</span></span><br><span class="line">                <span class="keyword">if</span> (temp == searchWord.<span class="built_in">size</span>() - <span class="number">1</span>) &#123; <span class="comment">//比较完，返回单词位置</span></span><br><span class="line">                    <span class="keyword">return</span> ans;</span><br><span class="line">                &#125;</span><br><span class="line">                temp++;</span><br><span class="line">                i++;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">while</span> (i &lt; sentence.<span class="built_in">size</span>() &amp;&amp; sentence[i] != <span class="string">&#x27; &#x27;</span>)&#123;<span class="comment">//遍历到下一个单词</span></span><br><span class="line">                i++;</span><br><span class="line">            &#125;</span><br><span class="line">            ans++; <span class="comment">// 进入下一个单词的位置</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>; <span class="comment">//不存在，返回-1</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></div>]]></content>
      
      
      <categories>
          
          <category> 每日LeetCode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
            <tag> LeetCode </tag>
            
            <tag> 数据结构 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>(每日LeetCode)654. 最大二叉树</title>
      <link href="/2022/08/20/%E6%AF%8F%E6%97%A5LeetCode/2022-8/654%20%E6%9C%80%E5%A4%A7%E4%BA%8C%E5%8F%89%E6%A0%91/"/>
      <url>/2022/08/20/%E6%AF%8F%E6%97%A5LeetCode/2022-8/654%20%E6%9C%80%E5%A4%A7%E4%BA%8C%E5%8F%89%E6%A0%91/</url>
      
        <content type="html"><![CDATA[<div class="story post-story"><h2 id="题目："><a href="#题目：" class="headerlink" title="题目："></a>题目：</h2><p>给定一个不重复的整数数组 nums 。 最大二叉树 可以用下面的算法从 nums 递归地构建:</p><p>创建一个根节点，其值为 nums 中的最大值。<br>递归地在最大值 左边 的 子数组前缀上 构建左子树。<br>递归地在最大值 右边 的 子数组后缀上 构建右子树。<br>返回 nums 构建的 最大二叉树 。</p></div><div class="story post-story"><h2 id="示例："><a href="#示例：" class="headerlink" title="示例："></a>示例：</h2><img src="https://assets.leetcode.com/uploads/2020/12/24/tree1.jpg" class="lazyload" data-srcset="https://assets.leetcode.com/uploads/2020/12/24/tree1.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img" style="zoom: 50%;" /><blockquote><p>输入：nums &#x3D; [3,2,1,6,0,5]<br>输出：[6,3,5,null,2,0,null,null,1]<br>解释：递归调用如下所示：</p><p>[3,2,1,6,0,5] 中的最大值是 6 ，左边部分是 [3,2,1] ，右边部分是 [0,5] 。</p><ul><li>[3,2,1] 中的最大值是 3 ，左边部分是 [] ，右边部分是 [2,1] 。<ul><li>空数组，无子节点。</li><li>[2,1] 中的最大值是 2 ，左边部分是 [] ，右边部分是 [1] 。<ul><li>空数组，无子节点。</li><li>只有一个元素，所以子节点是一个值为 1 的节点。</li></ul></li></ul></li><li>[0,5] 中的最大值是 5 ，左边部分是 [0] ，右边部分是 [] 。<ul><li>只有一个元素，所以子节点是一个值为 0 的节点。</li><li>空数组，无子节点。</li></ul></li></ul></blockquote></div><div class="story post-story"><h2 id="思路：递归"><a href="#思路：递归" class="headerlink" title="思路：递归"></a>思路：递归</h2><p>每次递归遍历中找到<code>left</code>和<code>right</code>区间的最大值作为该节点的<code>val</code>值，以及该最大值的位置<code>max_pos</code></p><p>划分该节点的左子树的区间为<code>left</code>和<code>max_pos</code></p><p>划分该节点的右子树的区间为<code>max_pos+1</code>和<code>right</code></p><p>如果左右区间<code>left &gt;= right</code>说明已经遍历完全，退出递归</p></div><div class="story post-story"><h2 id="代码-cpp-："><a href="#代码-cpp-：" class="headerlink" title="代码(cpp)："></a>代码(cpp)：</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">TreeNode* <span class="title">def</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums, <span class="type">int</span> left, <span class="type">int</span> right)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(left &gt;= right) <span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> temp = <span class="number">-1</span>;</span><br><span class="line">        <span class="type">int</span> max_pos = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = left; i &lt; right; i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(nums[i] &gt; temp)&#123;</span><br><span class="line">                temp = nums[i];</span><br><span class="line">                max_pos = i;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        TreeNode* node = <span class="keyword">new</span> <span class="built_in">TreeNode</span>(temp);</span><br><span class="line">        node-&gt;left = <span class="built_in">def</span>(nums, left, max_pos);</span><br><span class="line">        node-&gt;right = <span class="built_in">def</span>(nums, max_pos + <span class="number">1</span>, right);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> node;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">TreeNode* <span class="title">constructMaximumBinaryTree</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">def</span>(nums, <span class="number">0</span>, nums.<span class="built_in">size</span>());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="复杂度分析："><a href="#复杂度分析：" class="headerlink" title="复杂度分析："></a>复杂度分析：</h2><ul><li><p>时间复杂度：O(n^2)，其中 n 是数组 nums 的长度。在最坏的情况下，数组严格递增或递减，需要递归 n 层，第 (0 ≤ i &lt; n) 层需要遍历 n-i 个元素以找出最大值，总时间复杂度为 O(n^2)。</p></li><li><p>空间复杂度：O(n)，即为最坏情况下需要使用的栈空间。</p></li></ul></div>]]></content>
      
      
      <categories>
          
          <category> 每日LeetCode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
            <tag> LeetCode </tag>
            
            <tag> 数据结构 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Docker中安装es以及kibana</title>
      <link href="/2022/08/19/%E8%BD%AF%E4%BB%B6%E5%AE%89%E8%A3%85/Docker%E4%B8%AD%E5%AE%89%E8%A3%85es%E4%BB%A5%E5%8F%8Akibana/"/>
      <url>/2022/08/19/%E8%BD%AF%E4%BB%B6%E5%AE%89%E8%A3%85/Docker%E4%B8%AD%E5%AE%89%E8%A3%85es%E4%BB%A5%E5%8F%8Akibana/</url>
      
        <content type="html"><![CDATA[<div class="story post-story"><h2 id="1-es"><a href="#1-es" class="headerlink" title="1.es"></a>1.es</h2><h3 id="1-1-安装es镜像"><a href="#1-1-安装es镜像" class="headerlink" title="1.1 安装es镜像"></a>1.1 安装es镜像</h3><p>我的容器中jdk版本为8</p><p>这里我选择的是es的7.17.5版本镜像镜像安装，因为<strong>es8以上的版本不支持jdk8</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull elasticsearch:7.17.5</span><br></pre></td></tr></table></figure><h3 id="1-2-启动es容器"><a href="#1-2-启动es容器" class="headerlink" title="1.2 启动es容器"></a>1.2 启动es容器</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker run -id \</span><br><span class="line">--name c_es \</span><br><span class="line">-p 9200:9200 \</span><br><span class="line">-e &quot;discovery.type=single-node&quot; \</span><br><span class="line">elasticsearch:7.17.5</span><br></pre></td></tr></table></figure><h3 id="1-3-测试"><a href="#1-3-测试" class="headerlink" title="1.3 测试"></a>1.3 测试</h3><p>在浏览器中访问：<code>http://主机地址ip:9200</code></p><p>如果出现：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;3c9efa3c75db&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;cluster_name&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;docker-cluster&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;cluster_uuid&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;1hr4ILNNQfufDSJYgcuIHQ&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;version&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;number&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;7.17.5&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;build_flavor&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;default&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;build_type&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;docker&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;build_hash&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;8d61b4f7ddf931f219e3745f295ed2bbc50c8e84&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;build_date&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;2022-06-23T21:57:28.736740635Z&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;build_snapshot&quot;</span> <span class="punctuation">:</span> <span class="keyword">false</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;lucene_version&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;8.11.1&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;minimum_wire_compatibility_version&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;6.8.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;minimum_index_compatibility_version&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;6.0.0-beta1&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;tagline&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;You Know, for Search&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>则说明安装成功！</p><h3 id="1-4-跨域访问问题"><a href="#1-4-跨域访问问题" class="headerlink" title="1.4 跨域访问问题"></a>1.4 跨域访问问题</h3><p>进入容器：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker exec -it c_es /bin/bash</span><br></pre></td></tr></table></figure><p>修改<code>elasticsearch.yml</code>：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/share/elasticsearch/config/</span><br><span class="line">vi elasticsearch.yml</span><br></pre></td></tr></table></figure><p>文件末尾添加以下内容：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http.cors.enabled: true</span><br><span class="line">http.cors.allow-origin: &quot;*&quot;</span><br></pre></td></tr></table></figure><p>重启容器：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker restart c_es</span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="2-kibana"><a href="#2-kibana" class="headerlink" title="2.kibana"></a>2.kibana</h2><h3 id="2-1-安装kibana镜像"><a href="#2-1-安装kibana镜像" class="headerlink" title="2.1 安装kibana镜像"></a>2.1 安装kibana镜像</h3><p>前提：已经成功部署es</p><p><strong>注意</strong>：kibana版本要与es的版本一致</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull kibana:7.17.5</span><br></pre></td></tr></table></figure><h3 id="2-2-获取es容器内部ip"><a href="#2-2-获取es容器内部ip" class="headerlink" title="2.2 获取es容器内部ip"></a>2.2 获取es容器内部ip</h3><p>查看c_es容器信息：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker inspect c_es</span><br></pre></td></tr></table></figure><p>找到<code>IPAddress: &quot;ip&quot;</code>，此ip就是<strong>es容器内部ip</strong></p><h3 id="2-3-启动kibana容器"><a href="#2-3-启动kibana容器" class="headerlink" title="2.3 启动kibana容器"></a>2.3 启动kibana容器</h3><p>将<code>ELASTICSEARCH_HOSTS</code>修改为<strong>自己es容器内部ip</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker run -id \</span><br><span class="line">--name c_kibana \</span><br><span class="line">-e ELASTICSEARCH_HOSTS=http://es容器内部ip:9200 \</span><br><span class="line">-p 5601:5601 \</span><br><span class="line">kibana:7.17.5</span><br></pre></td></tr></table></figure><h3 id="2-4-修改中文"><a href="#2-4-修改中文" class="headerlink" title="2.4 修改中文"></a>2.4 修改中文</h3><p>进入容器：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker exec -u 0 -it c_kibana /bin/bash</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd config</span><br><span class="line">vi kibana.yml</span><br></pre></td></tr></table></figure><p>在末尾加上一下内容： </p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">i18n.locale:</span> <span class="string">&quot;zh-CN&quot;</span></span><br></pre></td></tr></table></figure><h3 id="2-5-测试"><a href="#2-5-测试" class="headerlink" title="2.5 测试"></a>2.5 测试</h3><p>在浏览器中访问：<code>http://主机地址ip:5601</code></p><p>就可以看到kibana的界面了！</p></div>]]></content>
      
      
      <categories>
          
          <category> 软件安装 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 容器 </tag>
            
            <tag> es </tag>
            
            <tag> kibana </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>(每日LeetCode)1450. 在既定时间做作业的学生人数</title>
      <link href="/2022/08/19/%E6%AF%8F%E6%97%A5LeetCode/2022-8/1450%20%E5%9C%A8%E6%97%A2%E5%AE%9A%E6%97%B6%E9%97%B4%E5%81%9A%E4%BD%9C%E4%B8%9A%E7%9A%84%E5%AD%A6%E7%94%9F%E4%BA%BA%E6%95%B0/"/>
      <url>/2022/08/19/%E6%AF%8F%E6%97%A5LeetCode/2022-8/1450%20%E5%9C%A8%E6%97%A2%E5%AE%9A%E6%97%B6%E9%97%B4%E5%81%9A%E4%BD%9C%E4%B8%9A%E7%9A%84%E5%AD%A6%E7%94%9F%E4%BA%BA%E6%95%B0/</url>
      
        <content type="html"><![CDATA[<div class="story post-story"><h2 id="题目："><a href="#题目：" class="headerlink" title="题目："></a>题目：</h2><p>给你两个整数数组 <code>startTime</code>（开始时间）和 <code>endTime</code>（结束时间），并指定一个整数 <code>queryTime</code> 作为查询时间。</p><p>已知，第 <code>i</code> 名学生在 <code>startTime[i]</code> 时开始写作业并于 <code>endTime[i]</code> 时完成作业。</p><p>请返回在查询时间 <code>queryTime</code> 时正在做作业的学生人数。形式上，返回能够使 <code>queryTime</code> 处于区间 <code>[startTime[i], endTime[i]]</code>（含）的学生人数。</p></div><div class="story post-story"><h2 id="示例："><a href="#示例：" class="headerlink" title="示例："></a>示例：</h2><blockquote><p>输入：startTime &#x3D; [1,2,3], endTime &#x3D; [3,2,7], queryTime &#x3D; 4<br>输出：1<br>解释：一共有 3 名学生。<br>第一名学生在时间 1 开始写作业，并于时间 3 完成作业，在时间 4 没有处于做作业的状态。<br>第二名学生在时间 2 开始写作业，并于时间 2 完成作业，在时间 4 没有处于做作业的状态。<br>第三名学生在时间 3 开始写作业，预计于时间 7 完成作业，这是是唯一一名在时间 4 时正在做作业的学生。</p></blockquote></div><div class="story post-story"><h2 id="思路：枚举"><a href="#思路：枚举" class="headerlink" title="思路：枚举"></a>思路：枚举</h2><h2 id="代码-cpp-："><a href="#代码-cpp-：" class="headerlink" title="代码(cpp)："></a>代码(cpp)：</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">busyStudent</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; startTime, vector&lt;<span class="type">int</span>&gt;&amp; endTime, <span class="type">int</span> queryTime)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> sum = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; startTime.<span class="built_in">size</span>(); i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(startTime[i] &lt;= queryTime &amp;&amp; queryTime &lt;= endTime[i]) &#123;</span><br><span class="line">                sum++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sum;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="复杂度分析："><a href="#复杂度分析：" class="headerlink" title="复杂度分析："></a>复杂度分析：</h2><ul><li>时间复杂度：O(n)，其中 n 为 数组的长度。只需遍历一遍数组即可。</li><li>空间复杂度：O(1)。</li></ul></div>]]></content>
      
      
      <categories>
          
          <category> 每日LeetCode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
            <tag> LeetCode </tag>
            
            <tag> 数据结构 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>(每日LeetCode)1302. 层数最深叶子节点的和</title>
      <link href="/2022/08/17/%E6%AF%8F%E6%97%A5LeetCode/2022-8/1302%20%E5%B1%82%E6%95%B0%E6%9C%80%E6%B7%B1%E5%8F%B6%E5%AD%90%E8%8A%82%E7%82%B9%E7%9A%84%E5%92%8C/"/>
      <url>/2022/08/17/%E6%AF%8F%E6%97%A5LeetCode/2022-8/1302%20%E5%B1%82%E6%95%B0%E6%9C%80%E6%B7%B1%E5%8F%B6%E5%AD%90%E8%8A%82%E7%82%B9%E7%9A%84%E5%92%8C/</url>
      
        <content type="html"><![CDATA[<div class="story post-story"><h2 id="题目："><a href="#题目：" class="headerlink" title="题目："></a>题目：</h2><p>给你一棵二叉树的根节点 <code>root</code> ，请你返回 <strong>层数最深的叶子节点的和</strong> 。</p></div><div class="story post-story"><h2 id="示例："><a href="#示例：" class="headerlink" title="示例："></a>示例：</h2><img src="https://assets.leetcode-cn.com/aliyun-lc-upload/uploads/2019/12/28/1483_ex1.png" class="lazyload" data-srcset="https://assets.leetcode-cn.com/aliyun-lc-upload/uploads/2019/12/28/1483_ex1.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img" style="zoom: 67%;" /><blockquote><p>输入：root &#x3D; [1,2,3,4,5,null,6,7,null,null,null,null,8]<br>输出：15</p></blockquote></div><div class="story post-story"><h2 id="思路一：深度优先搜索-DFS"><a href="#思路一：深度优先搜索-DFS" class="headerlink" title="思路一：深度优先搜索(DFS)"></a>思路一：深度优先搜索(DFS)</h2><h3 id="代码-cpp-："><a href="#代码-cpp-：" class="headerlink" title="代码(cpp)："></a>代码(cpp)：</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="type">int</span> max_level = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> sum = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">(TreeNode* root, <span class="type">int</span> level)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!root) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(max_level &lt; level)&#123; <span class="comment">//max_sum如果不是最大深度，重新开始</span></span><br><span class="line">            sum = root-&gt;val;</span><br><span class="line">            max_level = level;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(max_level == level) &#123; <span class="comment">//为最大深度，le</span></span><br><span class="line">            sum += root-&gt;val;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">dfs</span>(root-&gt;left, level + <span class="number">1</span>);</span><br><span class="line">        <span class="built_in">dfs</span>(root-&gt;right, level + <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">deepestLeavesSum</span><span class="params">(TreeNode* root)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">dfs</span>(root, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> sum;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="复杂度分析："><a href="#复杂度分析：" class="headerlink" title="复杂度分析："></a>复杂度分析：</h3><ul><li><p>时间复杂度：O(n)，其中 n 是二叉树的节点数。深度优先搜索需要遍历每个节点一次。</p></li><li><p>空间复杂度：O(n)，其中 n 是二叉树的节点数。空间复杂度主要取决于递归调用栈的深度，为二叉树的深度，最坏情况下二叉树的深度是 O(n)。</p></li></ul></div><div class="story post-story"><h2 id="思路二：广度优先搜索-BFS"><a href="#思路二：广度优先搜索-BFS" class="headerlink" title="思路二：广度优先搜索(BFS)"></a>思路二：广度优先搜索(BFS)</h2><h3 id="代码-cpp-：-1"><a href="#代码-cpp-：-1" class="headerlink" title="代码(cpp)："></a>代码(cpp)：</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">deepestLeavesSum</span><span class="params">(TreeNode* root)</span> </span>&#123;</span><br><span class="line">        queue&lt;TreeNode*&gt; q;</span><br><span class="line">        q.<span class="built_in">emplace</span>(root);</span><br><span class="line">        <span class="type">int</span> sum = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(!q.<span class="built_in">empty</span>())&#123; <span class="comment">//层遍历</span></span><br><span class="line">            sum = <span class="number">0</span>;</span><br><span class="line">            <span class="type">int</span> size = q.<span class="built_in">size</span>(); <span class="comment">//获取该层的元素个数</span></span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; size; i++)&#123; <span class="comment">//该层的元素遍历</span></span><br><span class="line">                TreeNode* node = q.<span class="built_in">front</span>();</span><br><span class="line">                q.<span class="built_in">pop</span>();</span><br><span class="line">                <span class="keyword">if</span>(node-&gt;left)  q.<span class="built_in">emplace</span>(node-&gt;left);</span><br><span class="line">                <span class="keyword">if</span>(node-&gt;right)  q.<span class="built_in">emplace</span>(node-&gt;right);</span><br><span class="line">                sum += node-&gt;val;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sum;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="复杂度分析：-1"><a href="#复杂度分析：-1" class="headerlink" title="复杂度分析："></a>复杂度分析：</h3><ul><li><p>时间复杂度：O(n)，其中 n 是二叉树的节点数。广度优先搜索需要遍历每个节点一次。</p></li><li><p>空间复杂度：O(n)，其中 n 是二叉树的节点数。空间复杂度主要取决于队列空间，队列中的节点个数不超过 n 个。</p></li></ul></div>]]></content>
      
      
      <categories>
          
          <category> 每日LeetCode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
            <tag> LeetCode </tag>
            
            <tag> 数据结构 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>(每日LeetCode)1656. 设计有序流</title>
      <link href="/2022/08/16/%E6%AF%8F%E6%97%A5LeetCode/2022-8/1656%20%E8%AE%BE%E8%AE%A1%E6%9C%89%E5%BA%8F%E6%B5%81/"/>
      <url>/2022/08/16/%E6%AF%8F%E6%97%A5LeetCode/2022-8/1656%20%E8%AE%BE%E8%AE%A1%E6%9C%89%E5%BA%8F%E6%B5%81/</url>
      
        <content type="html"><![CDATA[<div class="story post-story"><h2 id="题目："><a href="#题目：" class="headerlink" title="题目："></a>题目：</h2><p>有 <code>n</code> 个 <code>(id, value)</code> 对，其中 <code>id</code> 是 <code>1</code> 到 <code>n</code> 之间的一个整数，<code>value</code> 是一个字符串。不存在 <code>id</code> 相同的两个 <code>(id, value)</code> 对。</p><p>设计一个流，以 任意 顺序获取 <code>n</code> 个 <code>(id, value)</code> 对，并在多次调用时 <strong>按 <code>id</code> 递增的顺序</strong> 返回一些值。</p><p>实现 <code>OrderedStream</code> 类：</p><ul><li><code>OrderedStream(int n)</code> 构造一个能接收 <code>n</code> 个值的流，并将当前指针 <code>ptr</code> 设为 <code>1</code> 。</li><li><code>String[] insert(int id, String value)</code> 向流中存储新的 <code>(id, value)</code> 对。存储后：<ul><li>如果流存储有 <code>id = ptr</code> 的 <code>(id, value)</code> 对，则找出从 <code>id = ptr</code> 开始的 最长 <strong><code>id</code> 连续递增序列</strong> ，并 <strong>按顺序</strong> 返回与这些 <code>id</code> 关联的值的列表。然后，将 <code>ptr</code> 更新为最后那个  <code>id + 1</code> 。</li><li>否则，返回一个空列表。</li></ul></li></ul></div><div class="story post-story"><h2 id="示例："><a href="#示例：" class="headerlink" title="示例："></a>示例：</h2><p><img src="https://assets.leetcode-cn.com/aliyun-lc-upload/uploads/2020/11/15/q1.gif" class="lazyload" data-srcset="https://assets.leetcode-cn.com/aliyun-lc-upload/uploads/2020/11/15/q1.gif" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img"></p><blockquote><p>输入<br>[“OrderedStream”, “insert”, “insert”, “insert”, “insert”, “insert”]<br>[[5], [3, “ccccc”], [1, “aaaaa”], [2, “bbbbb”], [5, “eeeee”], [4, “ddddd”]]<br>输出<br>[null, [], [“aaaaa”], [“bbbbb”, “ccccc”], [], [“ddddd”, “eeeee”]]</p><p>解释<br>OrderedStream os&#x3D; new OrderedStream(5);<br>os.insert(3, “ccccc”); &#x2F;&#x2F; 插入 (3, “ccccc”)，返回 []<br>os.insert(1, “aaaaa”); &#x2F;&#x2F; 插入 (1, “aaaaa”)，返回 [“aaaaa”]<br>os.insert(2, “bbbbb”); &#x2F;&#x2F; 插入 (2, “bbbbb”)，返回 [“bbbbb”, “ccccc”]<br>os.insert(5, “eeeee”); &#x2F;&#x2F; 插入 (5, “eeeee”)，返回 []<br>os.insert(4, “ddddd”); &#x2F;&#x2F; 插入 (4, “ddddd”)，返回 [“ddddd”, “eeeee”]</p></blockquote></div><div class="story post-story"><h2 id="代码-cpp-："><a href="#代码-cpp-：" class="headerlink" title="代码(cpp)："></a>代码(cpp)：</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">OrderedStream</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="type">int</span> ptr;</span><br><span class="line">    vector&lt;string&gt; array;</span><br><span class="line">    <span class="built_in">OrderedStream</span>(<span class="type">int</span> n) &#123;</span><br><span class="line">        ptr = <span class="number">1</span>;</span><br><span class="line">        array = <span class="built_in">vector</span>&lt;string&gt;(n + <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function">vector&lt;string&gt; <span class="title">insert</span><span class="params">(<span class="type">int</span> idKey, string value)</span> </span>&#123;</span><br><span class="line">        vector&lt;string&gt; ans;</span><br><span class="line">        array[idKey] = value;</span><br><span class="line">        <span class="keyword">while</span>(ptr &lt; array.<span class="built_in">size</span>() &amp;&amp; array[ptr] != <span class="string">&quot;&quot;</span>)&#123;</span><br><span class="line">            ans.<span class="built_in">emplace_back</span>(array[ptr]);</span><br><span class="line">            ptr++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="复杂度分析："><a href="#复杂度分析：" class="headerlink" title="复杂度分析："></a>复杂度分析：</h2><ul><li><p>时间复杂度：OrderedStream(int n) 的时间复杂度为 O(n)；String[] insert(int id, String value) 的时间复杂度为均摊 O(1)，这是因为我们会恰好调用该函数 n 次，那么每一个字符串最多会被包含在返回数组中一次。</p></li><li><p>空间复杂度：O(n)，即为存储 n 个字符串需要的空间。</p></li></ul></div>]]></content>
      
      
      <categories>
          
          <category> 每日LeetCode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
            <tag> LeetCode </tag>
            
            <tag> 数据结构 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>(每日LeetCode)641. 设计循环双端队列</title>
      <link href="/2022/08/15/%E6%AF%8F%E6%97%A5LeetCode/2022-8/641%20%E8%AE%BE%E8%AE%A1%E5%BE%AA%E7%8E%AF%E5%8F%8C%E7%AB%AF%E9%98%9F%E5%88%97/"/>
      <url>/2022/08/15/%E6%AF%8F%E6%97%A5LeetCode/2022-8/641%20%E8%AE%BE%E8%AE%A1%E5%BE%AA%E7%8E%AF%E5%8F%8C%E7%AB%AF%E9%98%9F%E5%88%97/</url>
      
        <content type="html"><![CDATA[<div class="story post-story"><h2 id="题目："><a href="#题目：" class="headerlink" title="题目："></a>题目：</h2><p>设计实现双端队列。</p><p>实现 MyCircularDeque 类:</p><ul><li><p><code>MyCircularDeque(int k)</code> ：构造函数,双端队列最大为 k 。</p></li><li><p><code>boolean insertFront()</code>：将一个元素添加到双端队列头部。 如果操作成功返回 true ，否则返回 false。</p></li><li><p><code>boolean insertLast()</code> ：将一个元素添加到双端队列尾部。如果操作成功返回 true ，否则返回 false 。</p></li><li><p><code>boolean deleteFront()</code> ：从双端队列头部删除一个元素。 如果操作成功返回 true ，否则返回 false 。</p></li><li><p><code>boolean deleteLast()</code> ：从双端队列尾部删除一个元素。如果操作成功返回 true ，否则返回 false 。</p></li><li><p><code>int getFront()</code>：从双端队列头部获得一个元素。如果双端队列为空，返回 -1 。</p></li><li><p><code>int getRear()</code> ：获得双端队列的最后一个元素。 如果双端队列为空，返回 -1 。</p></li><li><p><code>boolean isEmpty()</code> ：若双端队列为空，则返回 true ，否则返回 false  。</p></li><li><p><code>boolean isFull()</code> ：若双端队列满了，则返回 true ，否则返回 false 。</p></li></ul></div><div class="story post-story"><h2 id="示例："><a href="#示例：" class="headerlink" title="示例："></a>示例：</h2><blockquote><p>输入<br>[“MyCircularDeque”, “insertLast”, “insertLast”, “insertFront”, “insertFront”, “getRear”, “isFull”, “deleteLast”, “insertFront”, “getFront”]<br>[[3], [1], [2], [3], [4], [], [], [], [4], []]<br>输出<br>[null, true, true, true, false, 2, true, true, true, 4]</p><p>解释<br>MyCircularDeque circularDeque &#x3D; new MycircularDeque(3); &#x2F;&#x2F; 设置容量大小为3<br>circularDeque.insertLast(1);       &#x2F;&#x2F; 返回 true<br>circularDeque.insertLast(2);       &#x2F;&#x2F; 返回 true<br>circularDeque.insertFront(3);     &#x2F;&#x2F; 返回 true<br>circularDeque.insertFront(4);     &#x2F;&#x2F; 已经满了，返回 false<br>circularDeque.getRear();        &#x2F;&#x2F; 返回 2<br>circularDeque.isFull();             &#x2F;&#x2F; 返回 true<br>circularDeque.deleteLast();        &#x2F;&#x2F; 返回 true<br>circularDeque.insertFront(4);     &#x2F;&#x2F; 返回 true<br>circularDeque.getFront();       &#x2F;&#x2F; 返回 4</p></blockquote></div><div class="story post-story"><h2 id="思路：数组"><a href="#思路：数组" class="headerlink" title="思路：数组"></a>思路：数组</h2><p>可参考<a href="/2022/08/02/%E6%AF%8F%E6%97%A5LeetCode/2022-8/622%20%E8%AE%BE%E8%AE%A1%E5%BE%AA%E7%8E%AF%E9%98%9F%E5%88%97">力扣 622 设计循环队列</a></p></div><div class="story post-story"><h2 id="代码-cpp-："><a href="#代码-cpp-：" class="headerlink" title="代码(cpp)："></a>代码(cpp)：</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyCircularDeque</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; deque;</span><br><span class="line">    <span class="type">int</span> front;</span><br><span class="line">    <span class="type">int</span> rear;</span><br><span class="line">    <span class="type">int</span> capacity;</span><br><span class="line">    <span class="built_in">MyCircularDeque</span>(<span class="type">int</span> k) &#123;</span><br><span class="line">        capacity = k;</span><br><span class="line">        deque = <span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;(k + <span class="number">1</span>);</span><br><span class="line">        front = <span class="number">0</span>;</span><br><span class="line">        rear = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">insertFront</span><span class="params">(<span class="type">int</span> value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">isFull</span>()) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        front = (front - <span class="number">1</span> + capacity + <span class="number">1</span>) % (capacity + <span class="number">1</span>);</span><br><span class="line">        deque[front] = value;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">insertLast</span><span class="params">(<span class="type">int</span> value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">isFull</span>()) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        deque[rear] = value;</span><br><span class="line">        rear = (rear + <span class="number">1</span>) % (capacity + <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">deleteFront</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">isEmpty</span>()) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        front = (front + <span class="number">1</span>) % (capacity + <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">deleteLast</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">isEmpty</span>()) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        rear = (rear - <span class="number">1</span> + capacity + <span class="number">1</span>) % (capacity + <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">getFront</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">isEmpty</span>()) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">return</span> deque[front];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">getRear</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">isEmpty</span>()) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">return</span> deque[(rear - <span class="number">1</span> + capacity + <span class="number">1</span>) % (capacity + <span class="number">1</span>)];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">isEmpty</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> front == rear;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">isFull</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (rear + <span class="number">1</span>) % (capacity + <span class="number">1</span>) == front;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="复杂度分析："><a href="#复杂度分析：" class="headerlink" title="复杂度分析："></a>复杂度分析：</h2><ul><li>时间复杂度：初始化和每项操作的时间复杂度均为 O(1)。</li><li>空间复杂度：O(k)，其中 k 为给定的队列元素数目。</li></ul></div>]]></content>
      
      
      <categories>
          
          <category> 每日LeetCode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
            <tag> LeetCode </tag>
            
            <tag> 数据结构 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>(每日LeetCode)1422. 分割字符串的最大得分</title>
      <link href="/2022/08/14/%E6%AF%8F%E6%97%A5LeetCode/2022-8/1422%20%E5%88%86%E5%89%B2%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9A%84%E6%9C%80%E5%A4%A7%E5%BE%97%E5%88%86/"/>
      <url>/2022/08/14/%E6%AF%8F%E6%97%A5LeetCode/2022-8/1422%20%E5%88%86%E5%89%B2%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9A%84%E6%9C%80%E5%A4%A7%E5%BE%97%E5%88%86/</url>
      
        <content type="html"><![CDATA[<div class="story post-story"><h2 id="题目："><a href="#题目：" class="headerlink" title="题目："></a>题目：</h2><p>给你一个由若干 0 和 1 组成的字符串 s ，请你计算并返回将该字符串分割成两个 非空 子字符串（即 左 子字符串和 右 子字符串）所能获得的最大得分。</p><p>「分割字符串的得分」为 左 子字符串中 0 的数量加上 右 子字符串中 1 的数量。</p></div><div class="story post-story"><h2 id="示例："><a href="#示例：" class="headerlink" title="示例："></a>示例：</h2><blockquote><p>输入：s &#x3D; “011101”<br>输出：5<br>解释：<br>将字符串 s 划分为两个非空子字符串的可行方案有：<br>左子字符串 &#x3D; “0” 且 右子字符串 &#x3D; “11101”，得分 &#x3D; 1 + 4 &#x3D; 5<br>左子字符串 &#x3D; “01” 且 右子字符串 &#x3D; “1101”，得分 &#x3D; 1 + 3 &#x3D; 4<br>左子字符串 &#x3D; “011” 且 右子字符串 &#x3D; “101”，得分 &#x3D; 1 + 2 &#x3D; 3<br>左子字符串 &#x3D; “0111” 且 右子字符串 &#x3D; “01”，得分 &#x3D; 1 + 1 &#x3D; 2<br>左子字符串 &#x3D; “01110” 且 右子字符串 &#x3D; “1”，得分 &#x3D; 2 + 1 &#x3D; 3</p></blockquote></div><div class="story post-story"><h2 id="思路：枚举"><a href="#思路：枚举" class="headerlink" title="思路：枚举"></a>思路：枚举</h2><p>获得每一种可能的分数，比较出最高得分</p></div><div class="story post-story"><h2 id="代码-cpp-："><a href="#代码-cpp-：" class="headerlink" title="代码(cpp)："></a>代码(cpp)：</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">maxScore</span><span class="params">(string s)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> score = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; s.<span class="built_in">size</span>() - <span class="number">1</span>; i++)&#123;</span><br><span class="line">            <span class="type">int</span> temp_score = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>; j &lt;= i; j++)&#123;</span><br><span class="line">                <span class="keyword">if</span>(s[j] == <span class="string">&#x27;0&#x27;</span>)&#123;</span><br><span class="line">                    temp_score++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> k = i + <span class="number">1</span>; k &lt; s.<span class="built_in">size</span>(); k++)&#123;</span><br><span class="line">                <span class="keyword">if</span>(s[k] == <span class="string">&#x27;1&#x27;</span>)&#123;</span><br><span class="line">                    temp_score++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            score = <span class="built_in">max</span>(score, temp_score);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> score;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="复杂度分析："><a href="#复杂度分析：" class="headerlink" title="复杂度分析："></a>复杂度分析：</h2><ul><li><p>时间复杂度：O(n^2)，其中 n 是字符串 s 的长度。需要遍历 n−1 个分割点，对于每个分割点需要 O(n) 的时间遍历整个字符串计算分割字符串的得分，因此时间复杂度是 O(n^2)</p></li><li><p>空间复杂度：O(1)</p></li></ul></div>]]></content>
      
      
      <categories>
          
          <category> 每日LeetCode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
            <tag> LeetCode </tag>
            
            <tag> 数据结构 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>(每日LeetCode)1282. 用户分组</title>
      <link href="/2022/08/12/%E6%AF%8F%E6%97%A5LeetCode/2022-8/1282%20%E7%94%A8%E6%88%B7%E5%88%86%E7%BB%84/"/>
      <url>/2022/08/12/%E6%AF%8F%E6%97%A5LeetCode/2022-8/1282%20%E7%94%A8%E6%88%B7%E5%88%86%E7%BB%84/</url>
      
        <content type="html"><![CDATA[<div class="story post-story"><h2 id="题目："><a href="#题目：" class="headerlink" title="题目："></a>题目：</h2><p>有 n 个人被分成数量未知的组。每个人都被标记为一个从 0 到 n - 1 的唯一ID 。</p><p>给定一个整数数组 groupSizes ，其中 groupSizes[i] 是第 i 个人所在的组的大小。例如，如果 groupSizes[1] &#x3D; 3 ，则第 1 个人必须位于大小为 3 的组中。</p><p>返回一个组列表，使每个人 i 都在一个大小为 groupSizes[i] 的组中。</p><p>每个人应该 恰好只 出现在 一个组 中，并且每个人必须在一个组中。如果有多个答案，返回其中 任何 一个。可以 保证 给定输入 至少有一个 有效的解。</p></div><div class="story post-story"><h2 id="示例："><a href="#示例：" class="headerlink" title="示例："></a>示例：</h2><blockquote><p>输入：groupSizes &#x3D; [3,3,3,3,3,1,3]<br>输出：[[5],[0,1,2],[3,4,6]]<br>解释：<br>第一组是 [5]，大小为 1，groupSizes[5] &#x3D; 1。<br>第二组是 [0,1,2]，大小为 3，groupSizes[0] &#x3D; groupSizes[1] &#x3D; groupSizes[2] &#x3D; 3。<br>第三组是 [3,4,6]，大小为 3，groupSizes[3] &#x3D; groupSizes[4] &#x3D; groupSizes[6] &#x3D; 3。<br>其他可能的解决方案有 [[2,1,6],[5],[0,4,3]] 和 [[5],[0,6,2],[4,3,1]]。</p></blockquote></div><div class="story post-story"><h2 id="思路：哈希表"><a href="#思路：哈希表" class="headerlink" title="思路：哈希表"></a>思路：哈希表</h2><p>使用哈希表获取用户人数相同的元素的所在位置</p><p>遍历哈希表，依次截取用户人数为大小的片段</p></div><div class="story post-story"><h2 id="代码-cpp-："><a href="#代码-cpp-：" class="headerlink" title="代码(cpp)："></a>代码(cpp)：</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; <span class="built_in">groupThePeople</span>(vector&lt;<span class="type">int</span>&gt;&amp; groupSizes) &#123;</span><br><span class="line">        unordered_map&lt;<span class="type">int</span>, vector&lt;<span class="type">int</span>&gt;&gt; groups;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; groupSizes.<span class="built_in">size</span>(); i++)&#123;</span><br><span class="line">            groups[groupSizes[i]].<span class="built_in">emplace_back</span>(i);</span><br><span class="line">        &#125;</span><br><span class="line">        vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; ans;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span>&amp; group : groups)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">auto</span> it = group.second.<span class="built_in">begin</span>(); it != group.second.<span class="built_in">end</span>();)&#123;</span><br><span class="line">                ans.<span class="built_in">emplace_back</span>(<span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;(it, it + group.first)); <span class="comment">//截取数组片段</span></span><br><span class="line">                it += group.first;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="复杂度分析："><a href="#复杂度分析：" class="headerlink" title="复杂度分析："></a>复杂度分析：</h2><ul><li><p>时间复杂度：O(n)，其中 n 是数组 groupSize 的长度。需要遍历数组一次得到每个组的大小对应的所有人的编号，然后需要遍历所有元素完成分组。</p></li><li><p>空间复杂度：O(n)，其中 n 是数组 groupSize 的长度。空间复杂度主要取决于哈希表，哈希表需要 O(n) 的空间记录每个组的大小对应的所有人的编号。</p></li></ul></div>]]></content>
      
      
      <categories>
          
          <category> 每日LeetCode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
            <tag> LeetCode </tag>
            
            <tag> 数据结构 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>(每日LeetCode)1417. 重新格式化字符串</title>
      <link href="/2022/08/11/%E6%AF%8F%E6%97%A5LeetCode/2022-8/1417%20%E9%87%8D%E6%96%B0%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2/"/>
      <url>/2022/08/11/%E6%AF%8F%E6%97%A5LeetCode/2022-8/1417%20%E9%87%8D%E6%96%B0%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2/</url>
      
        <content type="html"><![CDATA[<div class="story post-story"><h2 id="题目："><a href="#题目：" class="headerlink" title="题目："></a>题目：</h2><p>给你一个混合了数字和字母的字符串 s，其中的字母均为小写英文字母。</p><p>请你将该字符串重新格式化，使得任意两个相邻字符的类型都不同。也就是说，字母后面应该跟着数字，而数字后面应该跟着字母。</p><p>请你返回 重新格式化后 的字符串；如果无法按要求重新格式化，则返回一个 空字符串 。</p></div><div class="story post-story"><h2 id="示例："><a href="#示例：" class="headerlink" title="示例："></a>示例：</h2><p>输入：s &#x3D; “a0b1c2”<br>输出：”0a1b2c”<br>解释：”0a1b2c” 中任意两个相邻字符的类型都不同。 “a0b1c2”, “0a1b2c”, “0c2a1b” 也是满足题目要求的答案。</p></div><div class="story post-story"><h2 id="思路："><a href="#思路：" class="headerlink" title="思路："></a>思路：</h2><p>分别获取数字<code>num</code>和字母<code>letter</code></p><p>求得数字长度与字母长度之间的差：</p><ul><li><p>差的绝对值大于1，则无解；</p></li><li><p>差等于0，依次添加数字、字母；</p></li><li><p>差等于1，先添加数字再添加字母；</p></li><li><p>差等于-1，先添加字母再添加数字；</p></li></ul></div><div class="story post-story"><h2 id="代码-cpp-："><a href="#代码-cpp-：" class="headerlink" title="代码(cpp)："></a>代码(cpp)：</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">string <span class="title">reformat</span><span class="params">(string s)</span> </span>&#123;</span><br><span class="line">        string num = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        string letter = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> i : s)&#123;</span><br><span class="line">            <span class="keyword">if</span>(i &gt;= <span class="number">48</span> &amp;&amp; i &lt;= <span class="number">57</span>)&#123;</span><br><span class="line">                num += i;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                letter += i;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> temp = num.<span class="built_in">size</span>() - letter.<span class="built_in">size</span>();</span><br><span class="line">        <span class="keyword">if</span>(temp &gt; <span class="number">1</span> || temp &lt; <span class="number">-1</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        string ans;</span><br><span class="line">        <span class="keyword">if</span>(temp == <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; num.<span class="built_in">size</span>(); i++)&#123;</span><br><span class="line">                ans += num[i];</span><br><span class="line">                ans += letter[i];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(temp == <span class="number">1</span>)&#123;</span><br><span class="line">            ans += num[<span class="number">0</span>];</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; letter.<span class="built_in">size</span>(); i++)&#123;</span><br><span class="line">                ans += letter[i]; </span><br><span class="line">                ans += num[i + <span class="number">1</span>];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            ans += letter[<span class="number">0</span>];</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; num.<span class="built_in">size</span>(); i++)&#123;</span><br><span class="line">                ans += num[i]; </span><br><span class="line">                ans += letter[i + <span class="number">1</span>];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></div>]]></content>
      
      
      <categories>
          
          <category> 每日LeetCode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
            <tag> LeetCode </tag>
            
            <tag> 数据结构 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/11/C++/%E5%81%9A%E9%A2%98%E5%B8%B8%E7%94%A8%E5%87%BD%E6%95%B0/"/>
      <url>/2022/08/11/C++/%E5%81%9A%E9%A2%98%E5%B8%B8%E7%94%A8%E5%87%BD%E6%95%B0/</url>
      
        <content type="html"><![CDATA[<table><thead><tr><th align="center">函数</th><th align="center"></th><th></th></tr></thead><tbody><tr><td align="center">bool isdigit(char c)</td><td align="center">判断字符是否为数字</td><td></td></tr><tr><td align="center">int abs(int num)</td><td align="center">获取num的绝对值</td><td></td></tr><tr><td align="center">string to_string (int val)</td><td align="center">数字转字符串</td><td></td></tr><tr><td align="center">iterator lower_bound(<br>iterator first, iterator last, T&amp; val)</td><td align="center">指定区域内查找不小于目标值的第一个元素</td><td>二分查找</td></tr><tr><td align="center">T move(T t)</td><td align="center">将左值强制转化为右值引用</td><td>效率更高,<br>增强型等号</td></tr><tr><td align="center">int atoi(const char *nptr)</td><td align="center">将char*类型的字符串转为int整型</td><td></td></tr><tr><td align="center">int stoi(string str)</td><td align="center">将string类型的字符串转为int整型</td><td></td></tr><tr><td align="center">accumulate(起始迭代器, 结束迭代器, 初始值, 自定义操作函数)</td><td align="center">累加</td><td></td></tr></tbody></table>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>(每日LeetCode)1413. 逐步求和得到正数的最小值</title>
      <link href="/2022/08/09/%E6%AF%8F%E6%97%A5LeetCode/2022-8/1413%20%E9%80%90%E6%AD%A5%E6%B1%82%E5%92%8C%E5%BE%97%E5%88%B0%E6%AD%A3%E6%95%B0%E7%9A%84%E6%9C%80%E5%B0%8F%E5%80%BC/"/>
      <url>/2022/08/09/%E6%AF%8F%E6%97%A5LeetCode/2022-8/1413%20%E9%80%90%E6%AD%A5%E6%B1%82%E5%92%8C%E5%BE%97%E5%88%B0%E6%AD%A3%E6%95%B0%E7%9A%84%E6%9C%80%E5%B0%8F%E5%80%BC/</url>
      
        <content type="html"><![CDATA[<div class="story post-story"><h2 id="题目："><a href="#题目：" class="headerlink" title="题目："></a>题目：</h2><p>给你一个整数数组 <code>nums</code> 。你可以选定任意的 正数 <code>startValue</code> 作为初始值。</p><p>你需要从左到右遍历 <code>nums</code> 数组，并将 <code>startValue</code> 依次累加上 <code>nums</code> 数组中的值。</p><p>请你在确保累加和始终大于等于 1 的前提下，选出一个最小的 正数 作为 <code>startValue</code> 。</p></div><div class="story post-story"><h2 id="示例："><a href="#示例：" class="headerlink" title="示例："></a>示例：</h2><blockquote><p>输入：nums &#x3D; [-3,2,-3,4,2]<br>输出：5<br>解释：如果你选择 startValue &#x3D; 4，在第三次累加时，和小于 1 。<br>         累加求和<br>         startValue &#x3D; 4 | startValue &#x3D; 5 | nums<br>           (4 -3 ) &#x3D; 1  | (5 -3 ) &#x3D; 2    |  -3<br>           (1 +2 ) &#x3D; 3  | (2 +2 ) &#x3D; 4    |   2<br>           (3 -3 ) &#x3D; 0  | (4 -3 ) &#x3D; 1    |  -3<br>           (0 +4 ) &#x3D; 4  | (1 +4 ) &#x3D; 5    |   4<br>           (4 +2 ) &#x3D; 6  | (5 +2 ) &#x3D; 7    |   2</p></blockquote></div><div class="story post-story"><h2 id="思路："><a href="#思路：" class="headerlink" title="思路："></a>思路：</h2><p>遍历数组，如果累加中小于1时，增加<code>startValue</code>的值直到累加为1</p></div><div class="story post-story"><h2 id="代码-cpp-："><a href="#代码-cpp-：" class="headerlink" title="代码(cpp)："></a>代码(cpp)：</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">minStartValue</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> startValue = <span class="number">1</span>; <span class="comment">//初始化为1，因为startValue为最小的正数</span></span><br><span class="line">        <span class="type">int</span> sum = <span class="number">1</span>; <span class="comment">//初始化为1，因为一开始初始化为0要加上startValue就变成了1</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span>&amp; num : nums)&#123;</span><br><span class="line">            sum += num; <span class="comment">//累加</span></span><br><span class="line">            <span class="keyword">if</span>(sum &lt; <span class="number">1</span>)&#123; <span class="comment">//小于1的情况</span></span><br><span class="line">                startValue += <span class="number">1</span> - sum; <span class="comment">//加上相差的数</span></span><br><span class="line">                sum = <span class="number">1</span>; <span class="comment">//总和就变成了1</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> startValue;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></div>]]></content>
      
      
      <categories>
          
          <category> 每日LeetCode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
            <tag> LeetCode </tag>
            
            <tag> 数据结构 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>(每日LeetCode)636. 函数的独占时间</title>
      <link href="/2022/08/07/%E6%AF%8F%E6%97%A5LeetCode/2022-8/636%20%E5%87%BD%E6%95%B0%E7%9A%84%E7%8B%AC%E5%8D%A0%E6%97%B6%E9%97%B4/"/>
      <url>/2022/08/07/%E6%AF%8F%E6%97%A5LeetCode/2022-8/636%20%E5%87%BD%E6%95%B0%E7%9A%84%E7%8B%AC%E5%8D%A0%E6%97%B6%E9%97%B4/</url>
      
        <content type="html"><![CDATA[<div class="story post-story"><h2 id="题目："><a href="#题目：" class="headerlink" title="题目："></a>题目：</h2><p>有一个 单线程 CPU 正在运行一个含有 <code>n</code> 道函数的程序。每道函数都有一个位于  <code>0</code> 和 <code>n-1</code> 之间的唯一标识符。</p><p>函数调用 存储在一个 调用栈 上 ：当一个函数调用开始时，它的标识符将会推入栈中。而当一个函数调用结束时，它的标识符将会从栈中弹出。标识符位于栈顶的函数是 <strong>当前正在执行的函数</strong> 。每当一个函数开始或者结束时，将会记录一条日志，包括函数标识符、是开始还是结束、以及相应的时间戳。</p><p>给你一个由日志组成的列表 <code>logs</code> ，其中 <code>logs[i]</code> 表示第 <code>i</code> 条日志消息，该消息是一个按<code>&quot;&#123;function_id&#125;:&#123;&quot;start&quot; | &quot;end&quot;&#125;:&#123;timestamp&#125;&quot;</code> 进行格式化的字符串。例如，<code>&quot;0:start:3&quot;</code> 意味着标识符为 0 的函数调用在时间戳 3 的 起始开始执行 ；而 <code>&quot;1:end:2&quot;</code> 意味着标识符为 <code>1</code> 的函数调用在时间戳 <code>2</code> 的 <strong>末尾结束执行</strong>。注意，函数可以 <strong>调用多次，可能存在递归调用</strong> 。</p><p>函数的 独占时间 定义是在这个函数在程序所有函数调用中执行时间的总和，调用其他函数花费的时间不算该函数的独占时间。例如，如果一个函数被调用两次，一次调用执行 <code>2</code> 单位时间，另一次调用执行 <code>1</code> 单位时间，那么该函数的 独占时间 为 <code>2 + 1 = 3</code> 。</p><p>以数组形式返回每个函数的 <strong>独占时间</strong> ，其中第 <code>i</code> 个下标对应的值表示标识符 <code>i</code> 的函数的独占时间。</p></div><div class="story post-story"><h2 id="示例："><a href="#示例：" class="headerlink" title="示例："></a>示例：</h2><img src="https://assets.leetcode.com/uploads/2019/04/05/diag1b.png" class="lazyload" data-srcset="https://assets.leetcode.com/uploads/2019/04/05/diag1b.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img" style="zoom: 33%;" /><blockquote><p>输入：<code>n = 2, logs = [&quot;0:start:0&quot;,&quot;1:start:2&quot;,&quot;1:end:5&quot;,&quot;0:end:6&quot;]</code><br>输出：[3,4]<br>解释：<br>函数 0 在时间戳 0 的起始开始执行，执行 2 个单位时间，于时间戳 1 的末尾结束执行。<br>函数 1 在时间戳 2 的起始开始执行，执行 4 个单位时间，于时间戳 5 的末尾结束执行。<br>函数 0 在时间戳 6 的开始恢复执行，执行 1 个单位时间。<br>所以函数 0 总共执行 2 + 1 &#x3D; 3 个单位时间，函数 1 总共执行 4 个单位时间。 </p></blockquote></div><div class="story post-story"><h2 id="思路：栈"><a href="#思路：栈" class="headerlink" title="思路：栈"></a>思路：栈</h2><p>遍历logs数组</p><p>遍历到<code>status</code>为<code>start</code>时：</p><ol><li><p>将栈顶函数的运行<strong>部分时长</strong>更新，因为要运行新的函数，先暂时停止运行栈顶函数</p></li><li><p>将栈顶函数的时刻更新为现在的时刻，再入栈</p></li></ol><p><code>status</code>为<code>end</code>时：</p><ol><li>获取栈顶函数，更新运行<strong>总时长</strong>，将此函数弹出，因为已经运行完毕了</li><li>此时栈顶函数就是之前的那个函数了，要继续运行此函数，</li><li>将此函数从时刻更新为现在的时刻，因为是现在的时刻开始继续运行的</li></ol></div><div class="story post-story"><h2 id="代码-cpp-："><a href="#代码-cpp-：" class="headerlink" title="代码(cpp)："></a>代码(cpp)：</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">exclusiveTime</span><span class="params">(<span class="type">int</span> n, vector&lt;string&gt;&amp; logs)</span> </span>&#123;</span><br><span class="line">        stack&lt;pair&lt;<span class="type">int</span>, <span class="type">int</span>&gt;&gt; s;</span><br><span class="line">        <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">ans</span><span class="params">(n)</span></span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span>&amp; log : logs)&#123;</span><br><span class="line">            <span class="type">int</span> id;</span><br><span class="line">            <span class="type">char</span> status[<span class="number">10</span>];</span><br><span class="line">            <span class="type">int</span> cur_time;</span><br><span class="line">            <span class="built_in">sscanf</span>(log.<span class="built_in">c_str</span>(), <span class="string">&quot;%d:%[^:]:%d&quot;</span>, &amp;id, status, &amp;cur_time);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(status[<span class="number">0</span>] == <span class="string">&#x27;s&#x27;</span>)&#123;</span><br><span class="line">                <span class="keyword">if</span>(!s.<span class="built_in">empty</span>())&#123;</span><br><span class="line">                    ans[s.<span class="built_in">top</span>().first] += cur_time - s.<span class="built_in">top</span>().second;</span><br><span class="line">                    s.<span class="built_in">top</span>().second = cur_time;</span><br><span class="line">                &#125;</span><br><span class="line">                s.<span class="built_in">emplace</span>(id, cur_time);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">auto</span> temp = s.<span class="built_in">top</span>();</span><br><span class="line">                s.<span class="built_in">pop</span>();</span><br><span class="line">                ans[temp.first] += cur_time + <span class="number">1</span> - temp.second;</span><br><span class="line">                <span class="keyword">if</span>(!s.<span class="built_in">empty</span>())&#123;</span><br><span class="line">                    s.<span class="built_in">top</span>().second = cur_time + <span class="number">1</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;          </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="复杂度分析："><a href="#复杂度分析：" class="headerlink" title="复杂度分析："></a>复杂度分析：</h2><ul><li>时间复杂度：O(n)，其中 n 为全部日志 logs 的数量，n 条日志信息对应总共 n 次入栈和出栈操作。</li><li>空间复杂度：O(n)，其中 n 为全部日志 logs 的数量，n 条日志信息对应 n&#x2F;2 次入栈操作，最坏的情况下全部 n&#x2F;2 条日志入栈后才会依次弹栈。</li></ul></div>]]></content>
      
      
      <categories>
          
          <category> 每日LeetCode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
            <tag> LeetCode </tag>
            
            <tag> 数据结构 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Docker容器的学习笔记</title>
      <link href="/2022/08/06/Java/Docker%E5%AE%B9%E5%99%A8/"/>
      <url>/2022/08/06/Java/Docker%E5%AE%B9%E5%99%A8/</url>
      
        <content type="html"><![CDATA[<div class="story post-story"><h2 id="1-初识Docker"><a href="#1-初识Docker" class="headerlink" title="1.初识Docker"></a>1.初识Docker</h2><p>我们写好的代码会接触到好几个环境：开发环境、测试环境和生产环境</p><p><img src="https://s2.loli.net/2022/08/08/yRKLvzcD9kjVJig.png" class="lazyload" data-srcset="https://s2.loli.net/2022/08/08/yRKLvzcD9kjVJig.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="AADB6B41E3BB00CBEC2A7517863F8989"></p><p>可能导致在<strong>不同的环境下</strong>代码运行产生问题(“水土”不服)</p><p>所以就需要将<strong>代码以及运行环境</strong>装到一个<strong>容器</strong></p><p>测试只需要在容器中进行测试即可，使用的是容器中的运行环境，解决了<strong>软件跨环境迁移</strong>的问题</p><h3 id="1-1-Docker概念"><a href="#1-1-Docker概念" class="headerlink" title="1.1 Docker概念"></a>1.1 Docker概念</h3><ul><li><p>Docker是一个开源的应用容器引擎</p></li><li><p>诞生于2013年初，基于Go语言实现</p></li><li><p>Docker可以让开发者打包他们的应用以及依赖包到一个轻量级、可移值的容器中，然后发布到任何流行的Linux机器上</p></li><li><p>容器是完全使用沙箱机制，相互隔离(一台Linux机器可以启动多个容器，容器之间互不影响)</p></li><li><p>容器性能开销极低</p></li></ul><p><strong>小结：docker是一种容器技术，解决软件跨环境迁移的问题</strong></p><h3 id="1-2-Docker架构"><a href="#1-2-Docker架构" class="headerlink" title="1.2 Docker架构"></a>1.2 Docker架构</h3><img src="https://s2.loli.net/2022/08/08/eyKaI6RDYMcEnWG.png" class="lazyload" data-srcset="https://s2.loli.net/2022/08/08/eyKaI6RDYMcEnWG.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220808111802683" style="zoom: 67%;" /><ul><li>镜像(Image)：Docker镜像(image)，就相当于是一个root文件系统。比如官方镜像ubuntu:16.04包含了一个完整的一套Ubuntu 16.04最小系统的root文件系统。</li><li>容器(Container)：镜像(image)和容器(Container)的关系就像是面向对象程序设计中的类和对象一样，镜像是静态的定义，容器是镜像运行时的实体类。容器可以被创建、启动、停止、删除、暂停等操作。</li><li>仓库(Repository)：仓库看成一个代码控制中心，用来保存镜像。</li></ul><h3 id="1-3-Docker与虚拟机"><a href="#1-3-Docker与虚拟机" class="headerlink" title="1.3 Docker与虚拟机"></a>1.3 Docker与虚拟机</h3><p>容器就是将软件打包成标准化单元，以用于开发、交付和部署。</p><ul><li>容器镜像是轻量的、可执行的独立软件包，包含软件运行新需的所有内容：代码、运行时环境、系结工具、<br>系统库和设置。</li><li>容器化软件在任何环境中都能够始终如一地运行。</li><li>容器赋于了软件独立性，使其免受外在环境差异的影响，从而有助于减少团队间在相同基础设施上运行不同<br>软件时的冲突。</li></ul><p><strong>docker容器虚拟化与传统虚拟机比较</strong></p><p>相同：</p><ul><li>容器和虚拟机具有相似的资源隔离和分配优势</li></ul><p>不同：</p><ul><li>容器虛拟化的是操作系統，虛拟机虚拟化的是硬件。</li><li>传统虚拟机可以运行不同的操作系统，容器只能运行同一类型操作系统</li></ul><table><thead><tr><th align="center">特性</th><th align="center">容器</th><th align="center">虚拟机</th></tr></thead><tbody><tr><td align="center">启动</td><td align="center">秒级</td><td align="center">分钟级</td></tr><tr><td align="center">硬盘使用</td><td align="center">一般为MB</td><td align="center">一般为GB</td></tr><tr><td align="center">性能</td><td align="center">接近原生</td><td align="center">较弱</td></tr><tr><td align="center">系统支持量</td><td align="center">单机支持上千个容器</td><td align="center">一般为几十个</td></tr></tbody></table></div><div class="story post-story"><h2 id="2-Docker命令"><a href="#2-Docker命令" class="headerlink" title="2.Docker命令"></a>2.Docker命令</h2><h3 id="2-1-服务相关命令"><a href="#2-1-服务相关命令" class="headerlink" title="2.1 服务相关命令"></a>2.1 服务相关命令</h3><ul><li><p>启动docker服务：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl start docker</span><br></pre></td></tr></table></figure></li><li><p>停止docker服务：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl stop docker</span><br></pre></td></tr></table></figure></li><li><p>重启docker服务：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart docker</span><br></pre></td></tr></table></figure></li><li><p>查看docker服务状态：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl status docker</span><br></pre></td></tr></table></figure></li><li><p>设置开机启动docker服务：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable docker</span><br></pre></td></tr></table></figure></li></ul><h3 id="2-2-镜像相关命令"><a href="#2-2-镜像相关命令" class="headerlink" title="2.2 镜像相关命令"></a>2.2 镜像相关命令</h3><ul><li><p><strong>查看镜像</strong>：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker images</span><br></pre></td></tr></table></figure><p>查看镜像所有的image id：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker images -q</span><br></pre></td></tr></table></figure></li><li><p><strong>搜索镜像</strong>：</p><p>搜索redis镜像</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker search redis</span><br></pre></td></tr></table></figure></li><li><p><strong>拉取(下载)镜像</strong>：</p><p>默认下载最新版本的redis镜像</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker search redis</span><br></pre></td></tr></table></figure><p>也可以指定版本号：</p><p>下载7.0版本的redis镜像 </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker search redis:7.0</span><br></pre></td></tr></table></figure><p>查看版本：打开<a href="hub.docker.com">docker官网</a>，搜索redis，找到并打开官方镜像查看描述信息</p></li><li><p><strong>删除镜像</strong>：</p><p>通过image id删除镜像</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker rmi &lt;IMAGE ID&gt;</span><br></pre></td></tr></table></figure><p>也可以通过名称指定版本：删除7.0版本的redis镜像</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker rmi redis:7.0</span><br></pre></td></tr></table></figure><p>删除所有镜像：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker rmi &#x27;docker images -q&#x27;</span><br></pre></td></tr></table></figure><p> 删除无用镜像：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker rmi $(docker images -f &quot;dangling=true&quot; -q)</span><br></pre></td></tr></table></figure></li></ul><h3 id="2-3-容器相关命令"><a href="#2-3-容器相关命令" class="headerlink" title="2.3 容器相关命令"></a>2.3 容器相关命令</h3><ul><li><p><strong>查看容器</strong>：</p><p>查看正在运行的容器：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker ps</span><br></pre></td></tr></table></figure><p>查看所有容器：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker ps -a</span><br></pre></td></tr></table></figure></li><li><p><strong>创建容器</strong>：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run [参数]</span><br></pre></td></tr></table></figure><p>例子：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it --name=c1 centos:latest /bin/bash</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -id --name=c2 centos:latest</span><br></pre></td></tr></table></figure><p><code>-i</code>：保持容器运行</p><p><code>-t</code>：为容器重新分配一个伪终端(可与-i合并为-it)</p><p><code>-it</code>创建的容器称为交互式容器</p><p><code>-d</code>：守护(后台)模式运行容器</p><p><code>-id</code>：创建的容器称为守护式容器，需要使用<code>docker exec</code>进入容器</p><p><code>--name=c1</code>：给容器起名为c1</p><p>退出容器：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">exit</span><br></pre></td></tr></table></figure></li><li><p><strong>进入容器</strong>：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker exec [参数]</span><br></pre></td></tr></table></figure><p>进入c2容器：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker exec -it c2 /bin/bash</span><br></pre></td></tr></table></figure><p>以root权限进入容器：</p><p>参数 0 表示root</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker exec -u 0 -it 容器名 /bin/bash</span><br></pre></td></tr></table></figure></li><li><p><strong>启动容器</strong>：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker start 容器名称</span><br></pre></td></tr></table></figure></li><li><p><strong>停止容器</strong>：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker stop 容器名称</span><br></pre></td></tr></table></figure></li><li><p><strong>删除容器</strong>：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker rm 容器名称</span><br></pre></td></tr></table></figure></li><li><p><strong>查看容器信息</strong>：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker inspect 容器名称</span><br></pre></td></tr></table></figure></li></ul></div><div class="story post-story"><h2 id="3-Docker容器数据卷"><a href="#3-Docker容器数据卷" class="headerlink" title="3.Docker容器数据卷"></a>3.Docker容器数据卷</h2><h3 id="3-1-数据卷概念"><a href="#3-1-数据卷概念" class="headerlink" title="3.1 数据卷概念"></a>3.1 数据卷概念</h3><ul><li><p>数据卷是宿主机中的一个目录或文件</p></li><li><p>当容器目录和数据卷目录被绑定后，双方的修改会立即同步</p></li><li><p>一个数据卷可以被多个容器同时挂载</p></li><li><p>一个容器可以被挂载多个数据卷</p></li><li><p>数据卷的作用：</p><ul><li><p>容器的持久化</p></li><li><p>外部机器和容器间接通信</p></li><li><p>容器之间数据交换</p></li></ul></li></ul><h3 id="3-2-配置数据卷"><a href="#3-2-配置数据卷" class="headerlink" title="3.2 配置数据卷"></a>3.2 配置数据卷</h3><p>创建启动容器时，使用<code>-v</code>设置数据卷</p><p><code>docker run -v 宿主机目录(或文件):容器内目录(或文件)</code></p><p>注意事项：</p><ol><li>目录必须是绝对路径</li><li>如果目录不存在，会自动创建</li><li>可以挂载多个数据卷</li></ol><p>例子：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it --name=c1 -v /root/data:/root/data_container centos:latest /bin/bash</span><br></pre></td></tr></table></figure><p>挂载多个数据卷：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker run -it --name=c2 \</span><br><span class="line">-v /root/data1:/root/data_container1 \</span><br><span class="line">-v /root/data2:/root/data_container2 \</span><br><span class="line">centos:latest /bin/bash</span><br></pre></td></tr></table></figure><h3 id="3-3-配置数据卷容器"><a href="#3-3-配置数据卷容器" class="headerlink" title="3.3 配置数据卷容器"></a>3.3 配置数据卷容器</h3><p>多容器进行数据交换：</p><ol><li>多个容器挂载同一个数据卷</li><li>数据卷容器</li></ol><p>创建启动c3数据卷容器，使用<code>-v 参数</code>设置数据卷：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it --name=c3 -v /volume centos:latest /bin/bash</span><br></pre></td></tr></table></figure><p>创建启动c1、c2容器，使用<code>--volume-from 参数</code>设置数据卷：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it --name=c1 --volume-from c3 centos:latest /bin/bash</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it --name=c2 --volume-from c3 centos:latest /bin/bash</span><br></pre></td></tr></table></figure><h3 id="3-4-数据卷小结"><a href="#3-4-数据卷小结" class="headerlink" title="3.4 数据卷小结"></a>3.4 数据卷小结</h3><blockquote><ol><li><p>数据卷的概念</p><p>宿主机的一个目录或文件</p></li><li><p>数据卷的作用</p><p>容器数据持久化</p><p>客户端和容器数据交换</p><p>容器之间数据交换</p></li><li><p>数据卷容器</p><p>创建一个容器，挂载一个目录，让其他容器继承该容器</p><p>通过简单方式实现数据卷配置</p></li></ol></blockquote></div><div class="story post-story"><h2 id="4-Docker应用部署"><a href="#4-Docker应用部署" class="headerlink" title="4.Docker应用部署"></a>4.Docker应用部署</h2><p>基本步骤：</p><blockquote><p>搜索镜像</p><p>拉取镜像</p><p>创建容器</p><p>操作容器</p></blockquote><ul><li><p>容器内的网络服务和外部机器不能直接通信</p></li><li><p>外部机器和宿主机可以直接通信</p></li><li><p>宿主机和容器可以直接通信</p></li><li><p>当容器中的网络服务需要被外部机器访问时，可以将容器中提供服务的端口映射到宿主机的端口上。外部机<br>器访问宿主机的该端口，从而问接访问容器的服务。</p></li><li><p>这种操作称为：<strong>端口映射</strong></p></li></ul><h3 id="4-1-MySQL部署"><a href="#4-1-MySQL部署" class="headerlink" title="4.1 MySQL部署"></a>4.1 MySQL部署</h3><p>需求：</p><p>在Docker容器中部署MySQL，并通过外部mysql客户端操作MySQL server</p><ol><li><p>搜索镜像</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker search mysql</span><br></pre></td></tr></table></figure></li><li><p>拉取镜像</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull mysql</span><br></pre></td></tr></table></figure></li><li><p>创建容器，设置端口映射、目录映射</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">在/root目录下创建mysql目录用于存储mysql数据信息</span></span><br><span class="line">mkdir ~/mysql</span><br><span class="line">cd ~/mysql</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker run -id \</span><br><span class="line">-p 3307:3306 \</span><br><span class="line">--name=c_mysql \</span><br><span class="line">-v $PWD/conf:/etc/mysql/conf.d \</span><br><span class="line">-v $PWD/data:/var/lib/mysql \</span><br><span class="line">-e MYSQL_ROOT_PASSWORD=123456 \</span><br><span class="line">mysql:latest</span><br></pre></td></tr></table></figure><p>参数说明：</p><ul><li><p><code>$PWD</code>：相当于主机目录的 &#x2F;root&#x2F;mysql</p></li><li><p><code>-p 3307:3306</code>：将容器的3306端口映射到宿主机的3306端口   <strong>端口映射</strong></p></li><li><p><code>-V $PWD/conf:/etc/mysql/conf.d</code>：将主机当前目录下的 conf&#x2F;my.cnf 挂载到容器的<br>&#x2F;etc&#x2F;mysql&#x2F;my.cnf   <strong>配置目录</strong></p></li><li><p><code>-V $PWD/logs:/logs</code>：将主机当前目录下的logs目录挂载到容器的 &#x2F;logs   <strong>日志目录</strong></p></li><li><p><code>-V $PWD/data:/var/lib/mysql</code>：将主机当前目录下的data目录挂载到容器的 &#x2F;var&#x2F;lib&#x2F;mysql   <strong>数据目录</strong></p></li><li><p><code>-e MYSOL_ROOT_PASSWORD=123456</code>：初始化root 用户的密码为123456</p></li></ul></li><li><p>操作MySQL容器</p><p>容器内连接MySQL：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker exec -it c_mysql /bin/bash</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -uroot -p123456</span><br></pre></td></tr></table></figure><p>图形化客户端连接MySQL：</p><blockquote><p>主机：宿主机的ip</p><p>端口：为上面映射为的3307</p><p>用户名：root</p><p>密码：为上面的123456</p></blockquote></li></ol><h3 id="4-2-Tomcat部署"><a href="#4-2-Tomcat部署" class="headerlink" title="4.2 Tomcat部署"></a>4.2 Tomcat部署</h3><p>需求：</p><p>在Docker容器中部署Tomcat，并通过外部机器访问Tomcat部署的项目</p><ol><li><p>搜索Tomcat镜像</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker search tomcat</span><br></pre></td></tr></table></figure></li><li><p>拉取Tomcat镜像</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull tomcat</span><br></pre></td></tr></table></figure></li><li><p>创建容器，设置端口映射、目录映射</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">在/root目录下创建tomcat目录用于存储tomcat数据信息</span></span><br><span class="line">mkdir ~/tomcat</span><br><span class="line">cd ~/tomcat</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker run -id \</span><br><span class="line">--name=c_tomcat \</span><br><span class="line">-p 8080:8080 \</span><br><span class="line">-v $PWD:/usr/local/tomcat/webapps \</span><br><span class="line">tomcat:latest</span><br></pre></td></tr></table></figure><p>参数说明：</p><ul><li><code>-p 8080:8080</code>：将容器的8080端口映射到主机的8080端口</li><li><code>-v $PWD:/user/local/tomcat/webapps</code>：将主机中当前目录挂载到容器中的 &#x2F;user&#x2F;local&#x2F;tomcat&#x2F;webapps</li></ul></li><li><p>测试Tomcat</p><p>在tomcat目录下，创建test包，在test包中创建一个测试文件：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir test</span><br><span class="line">cd test</span><br><span class="line">vim index.html</span><br></pre></td></tr></table></figure><p>在index.html文件中写入：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span> Hello Tomcat <span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br></pre></td></tr></table></figure><p>保存退出：</p><p><code>Esc</code>+<code>:wq</code></p><p>使用浏览器访问Tomcat：<code>主机地址:8080/test/index.html</code></p></li></ol><h3 id="4-3-Redis部署"><a href="#4-3-Redis部署" class="headerlink" title="4.3 Redis部署"></a>4.3 Redis部署</h3><p>需求：</p><p>在Docker容器中部署Redis，并通过外部机器连接Redis</p><ol><li><p>搜索Redis镜像</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker search redis</span><br></pre></td></tr></table></figure></li><li><p>拉取Tomcat镜像</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull redis</span><br></pre></td></tr></table></figure></li><li><p>创建容器，设置端口映射</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker run -id \</span><br><span class="line">-p 6379:6379 \</span><br><span class="line">--name=c_redis \</span><br><span class="line">redis:latest</span><br></pre></td></tr></table></figure></li><li><p>图形化客户端连接redis</p><blockquote><p>主机地址：宿主机的ip</p><p>端口：为6379</p></blockquote></li></ol><h3 id="4-4-Nginx部署"><a href="#4-4-Nginx部署" class="headerlink" title="4.4 Nginx部署"></a>4.4 Nginx部署</h3><p>需求：</p><p>在Docker容器中部署Nginx，并通过外部机器访问Nginx</p><ol><li><p>搜索Nginx镜像</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker search nginx</span><br></pre></td></tr></table></figure></li><li><p>拉取Nginx镜像</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull nginx</span><br></pre></td></tr></table></figure></li><li><p>部署Nginx</p><p>在&#x2F;root目录下创建nginx目录用于存储nginx数据信息：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir ~/nginx</span><br><span class="line">cd ~/nginx</span><br></pre></td></tr></table></figure><p>在~&#x2F;nginx&#x2F;conf&#x2F;下创建nginx.conf文件：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir conf</span><br><span class="line">cd conf</span><br><span class="line">vim nginx.conf</span><br></pre></td></tr></table></figure><p>在nginx.conf中写入：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">user  nginx;</span><br><span class="line">worker_processes  1;</span><br><span class="line"></span><br><span class="line">error_log  /var/log/nginx/error.log warn;</span><br><span class="line">pid        /var/run/nginx.pid;</span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections  1024;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line">    include       /etc/nginx/mime.types;</span><br><span class="line">    default_type  application/octet-stream;</span><br><span class="line"></span><br><span class="line">    log_format  main  &#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27;</span><br><span class="line">                      &#x27;$status $body_bytes_sent &quot;$http_referer&quot; &#x27;</span><br><span class="line">                      &#x27;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#x27;;</span><br><span class="line"></span><br><span class="line">    access_log  /var/log/nginx/access.log  main;</span><br><span class="line"></span><br><span class="line">    sendfile        on;</span><br><span class="line">    #tcp_nopush     on;</span><br><span class="line"></span><br><span class="line">    keepalive_timeout  65;</span><br><span class="line"></span><br><span class="line">    #gzip  on;</span><br><span class="line"></span><br><span class="line">include /etc/nginx/conf.d/*.conf;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>回到nginx目录：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd ..</span><br></pre></td></tr></table></figure><p>创建容器，设置端口映射、目录映射：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker run -id \</span><br><span class="line">--name=c_nginx \</span><br><span class="line">-p 80:80 \</span><br><span class="line">-v $PWD/conf/nginx.conf:/etc/nginx/nginx.conf \</span><br><span class="line">-v $PWD/logs:/var/log/nginx \</span><br><span class="line">-v $PWD/html:/usr/share/nginx/html \</span><br><span class="line">nginx:latest</span><br></pre></td></tr></table></figure><p>参数说明：</p><ul><li><code>-p 80:80</code>：将容器的80端口映射到宿主机的 80 端口</li><li><code>-v $PWD/conf/nginx.conf:/etc/nginx/nginx.conf</code>：将主机当前目录下的&#x2F;conf&#x2F;nginx.conf 挂载到容器的：&#x2F;etc&#x2F;nginx&#x2F;nginx.conf   <strong>配置目录</strong></li><li><code>-v $PWD/logs:/var/log/nginx</code>：将主机当前目录下的 logs 目录挂载到容器的&#x2F;var&#x2F;log&#x2F;nginx   <strong>日志目录</strong></li></ul></li><li><p>使用浏览器访问nginx</p><p>创建nginx&#x2F;html&#x2F;test&#x2F;index.html文件：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cd html</span><br><span class="line">mkdir test</span><br><span class="line">cd test</span><br><span class="line">vim index.html</span><br></pre></td></tr></table></figure><p>写入下面内容：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span> Hello Nginx <span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br></pre></td></tr></table></figure><p>浏览器访问：<code>主机地址/test/index.html</code></p></li></ol></div><div class="story post-story"><h2 id="5-DockerFile"><a href="#5-DockerFile" class="headerlink" title="5.DockerFile"></a>5.DockerFile</h2><h3 id="5-1-Docker镜像原理"><a href="#5-1-Docker镜像原理" class="headerlink" title="5.1 Docker镜像原理"></a>5.1 Docker镜像原理</h3><blockquote><p>操作系统组成部分：</p><ul><li>进程调度子系统</li><li>进程通信子系統</li><li>内存管理子系统</li><li>设备管理子系统</li><li><span style="color:red">文件管理子系统</span></li><li>网络通信子系统</li><li>作业控制子系统</li></ul><p>Linux文件系统由bootfs和rootfs两部分组成：</p><ul><li>bootfs：包含bootloader(引导加载程序)和kernel(内核）</li><li>rootfs：root文件系统，包含的就是典型Linux 系统中的&#x2F;dev、&#x2F;proc、&#x2F;bin、&#x2F;etc等标准目录和文件</li><li>不同的linux发行版，bootfs基本一样，而rootis不同。如ubuntu、centos等</li></ul></blockquote><p>Docker镜像原理：</p><ul><li><p>Docker镜像是由特殊的文件系统叠加而成</p></li><li><p>最底端是bootfs， 并使用宿主机的bootfs</p></li><li><p>第二层是root文件系统rootfs称为base image(基础镜像)</p></li><li><p>然后再往上可以叠加其他的镜像文件</p></li><li><p>统一文件系统 (Union File System）技术能够将不同的层整合成一个文件系统，为这些层提供了一个统一的视角，迹样就隐藏了多层的存在，在用户的角度看来，只存在一个文件系统。</p></li><li><p>一个镜像可以放在另一个镜像的上面。位于下面的镜像称为父镜像，最底部的镜像成为基础镜像。</p></li><li><p>当一个镜像启动容器时，Docker会在最底层加载一个读写文件系统作为容器</p></li><li><p>这样分层的好处就是<span style="color:red">复用</span></p></li></ul><img src="https://s2.loli.net/2022/08/12/yJsdAp5eOKuFraG.png" class="lazyload" data-srcset="https://s2.loli.net/2022/08/12/yJsdAp5eOKuFraG.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220812225117535" style="zoom: 50%;" /><p>总结：</p><ol><li><p>Docker镜像的本质是什么?</p><p>一个分层文件系统</p></li><li><p>centos镜像只有200MB，而一个centos的操作系统的iso文件要几个G？</p><p>centos的镜像文件包含bootfs和rootfs，而docker的centos镜像复用了操作系统(就是宿主机)的bootfs，只有rootfs和其他镜像层</p></li><li><p>Docker中一个tomcat镜像为什么有500MB，而—个tomcat安装包只有70多MB?</p><p>由于docker中镜像是分层的，tomcat虽然只有70多MB，但他需要依赖于父镜像和基础镜像，所有整个对外暴露的tomcat镜像加起来大小500多MB</p></li></ol><h3 id="5-2-容器转镜像"><a href="#5-2-容器转镜像" class="headerlink" title="5.2 容器转镜像"></a>5.2 容器转镜像</h3><p>容器转镜像</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker commit [容器id] [新的镜像名称]:[自定义版本号]</span><br></pre></td></tr></table></figure><p>镜像转压缩文件</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker save -o [自定义压缩文件名称.tar] [镜像名称]:[自定义版本号]</span><br></pre></td></tr></table></figure><p>压缩文件转镜像</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker load -i [压缩文件]</span><br></pre></td></tr></table></figure><h3 id="5-3-DockerFile概念"><a href="#5-3-DockerFile概念" class="headerlink" title="5.3 DockerFile概念"></a>5.3 DockerFile概念</h3><ul><li>DockerFile是一个文本系统</li><li>包含了一条条的指令</li><li>每条指令构建一层，基于基础镜像，最终构建出一个新的镜像</li><li>可以为开发团队提高一个完全一致的开发环境</li><li>在部署时，可以实现应用的无缝移植</li></ul><p>例如：</p><p><a href="https://github.com/CentOS/sig-cloud-instance-images/blob/b2d195220e1c5b181427c3172829c23ab9cd27eb/docker/Dockerfile">centos7的dockerfile</a></p><p><a href="https://github.com/nginxinc/docker-nginx/blob/f3d86e99ba2db5d9918ede7b094fcad7b9128cd8/mainline/debian/Dockerfile">nginx的dockerfile</a></p><h3 id="5-4-DockerFile的关键字"><a href="#5-4-DockerFile的关键字" class="headerlink" title="5.4 DockerFile的关键字"></a>5.4 DockerFile的关键字</h3><table><thead><tr><th align="center">关键字</th><th align="center">作用</th></tr></thead><tbody><tr><td align="center">FROM</td><td align="center">指定父镜像</td></tr><tr><td align="center">MAINTAINER</td><td align="center">作者信息</td></tr><tr><td align="center">LABEL</td><td align="center">标签</td></tr><tr><td align="center">RUN</td><td align="center">执行命令</td></tr><tr><td align="center">CMD</td><td align="center">容器启动命令</td></tr><tr><td align="center">ENTRYPOINT</td><td align="center">入口</td></tr><tr><td align="center">COPY</td><td align="center">复制文件</td></tr><tr><td align="center">ADD</td><td align="center">添加文件</td></tr><tr><td align="center">ENV</td><td align="center">环境变量</td></tr><tr><td align="center">ARG</td><td align="center">构建参数</td></tr><tr><td align="center">VOLUME</td><td align="center">定义外部可以挂载的数据卷</td></tr><tr><td align="center">EXPOSE</td><td align="center">暴露端口</td></tr><tr><td align="center">WORKDIR</td><td align="center">工作目录</td></tr><tr><td align="center">USER</td><td align="center">指定执行用户</td></tr><tr><td align="center">HEALTHCHECK</td><td align="center">健康检查</td></tr><tr><td align="center">ONBUILD</td><td align="center">触发器</td></tr><tr><td align="center">STOPSIGNAL</td><td align="center">发送信息量到宿主机</td></tr><tr><td align="center">SHELL</td><td align="center">执行执行脚本shell</td></tr></tbody></table><h3 id="5-5-部署SpringBoot项目"><a href="#5-5-部署SpringBoot项目" class="headerlink" title="5.5 部署SpringBoot项目"></a>5.5 部署SpringBoot项目</h3><p>需求：</p><p>定义dockerfile，发布springboot项目</p><p>实现步骤：</p><ol><li><p>定义父镜像</p></li><li><p>定义作者信息</p></li><li><p>将jar包添加到容器</p></li><li><p>定义容器启动执行的命令</p></li><li><p>通过dockerfile构建镜像</p></li><li><p>创建目录：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir ~/docker-files</span><br><span class="line">cd ~/docker-files</span><br></pre></td></tr></table></figure></li><li><p>将打包好的SpringBoot项目上传到~&#x2F;docker-files目录下</p><p>注意：SpringBoot项目也要为java8版本</p></li><li><p>在docker-files目录编写springboot_dockerfile：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim springboot_dockerfile</span><br></pre></td></tr></table></figure><p>写入下面的内容：</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> java:<span class="number">8</span></span><br><span class="line"><span class="keyword">MAINTAINER</span> Ai</span><br><span class="line"><span class="keyword">ADD</span><span class="language-bash"> springboot-demo-0.0.1-SNAPSHOT.jar app.jar</span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> java -jar app.jar</span></span><br></pre></td></tr></table></figure></li><li><p>保存退出，将jar包转换为镜像：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build -f ./springboot_dockerfile -t app .</span><br></pre></td></tr></table></figure></li><li><p>测试</p><p>创建容器：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -id --name=c_app -p 8080:8080 app:latest</span><br></pre></td></tr></table></figure><p>浏览器访问：<code>主机地址:8080/hello</code></p></li></ol><h3 id="5-6-自定义Centos"><a href="#5-6-自定义Centos" class="headerlink" title="5.6 自定义Centos"></a>5.6 自定义Centos</h3><p>需求：</p><p>自定义centos:7镜像，要求：</p><blockquote><ol><li>默认登录路径为&#x2F;usr</li><li>可以使用vim</li></ol></blockquote><p>实现步骤：</p><ol><li><p>定义父镜像</p></li><li><p>定义作者信息</p></li><li><p>执行安装vim命令</p></li><li><p>定义默认的工作目录</p></li><li><p>定义容器启动执行的命令</p></li><li><p>转到~&#x2F;docker-files目录</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd ~/docker-files</span><br></pre></td></tr></table></figure></li><li><p>编写centos7_dockerfile</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim centos7_dockerfile</span><br></pre></td></tr></table></figure><p>写入下面内容：</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> centos:<span class="number">7</span></span><br><span class="line"><span class="keyword">MAINTAINER</span> Ai</span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> yum install -y vim</span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /usr</span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> /bin/bash</span></span><br></pre></td></tr></table></figure><p>保存退出</p></li><li><p>创建自定义centos7镜像</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build -f ./centos7_dockerfile -t my_centos:1 .</span><br></pre></td></tr></table></figure></li></ol></div><div class="story post-story"><h2 id="6-Docker服务编排"><a href="#6-Docker服务编排" class="headerlink" title="6.Docker服务编排"></a>6.Docker服务编排</h2><h3 id="6-1-Docker-Compose概述"><a href="#6-1-Docker-Compose概述" class="headerlink" title="6.1 Docker Compose概述"></a>6.1 Docker Compose概述</h3><p>微服务架构的应用系统中一般包含若干个微服务，每个微服务一般都会部署多个实例，如果每个微服务都要手动启停，维护的工作量会很大。</p><ul><li>要从Dockerfile build image 或者去dockerhub拉取image</li><li>要创建多个container</li><li>要管理这些container(启动停止删除)</li></ul><p>服务编排：按照一定的业务规则批量管理容器</p><p>Docker Compose是一个编排多容器分布式部署的工具，提供命令集管理容器化应用的完整开发周期，包括服务构建、启动和停止。使用步骤：</p><blockquote><ol><li>利用 Dockerfile 定义运行环境镜像</li><li>使用 docker-compose.yml定义组成应用的各服务</li><li>运行 docker-compose up 启动应用</li></ol></blockquote><h3 id="6-2-Docker-Compose安装"><a href="#6-2-Docker-Compose安装" class="headerlink" title="6.2 Docker Compose安装"></a>6.2 Docker Compose安装</h3><p>在安装docker-compose之前要安装docker，以二进制包的方式安装在Linux中：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -L https://get.daocloud.io/docker/compose/releases/download/v2.9.0/docker-compose-`uname -s`-`uname -m` &gt; /usr/local/bin/docker-compose</span><br></pre></td></tr></table></figure><p>设置可执行权限：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod +x /usr/local/bin/docker-compose</span><br></pre></td></tr></table></figure><p>查看版本信息：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose -v</span><br></pre></td></tr></table></figure><p>docker-compose的卸载，删除二进制文件即可：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rm /usr/local/bin/docker-compose</span><br></pre></td></tr></table></figure><h3 id="6-3-编排Nginx-SpringBoot项目"><a href="#6-3-编排Nginx-SpringBoot项目" class="headerlink" title="6.3 编排Nginx+SpringBoot项目"></a>6.3 编排Nginx+SpringBoot项目</h3><ol><li><p>创建目录</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir ~/docker-compose</span><br><span class="line">cd ~/docker-compose</span><br><span class="line">vim docker-compose.yml </span><br></pre></td></tr></table></figure></li><li><p>编写docker-compose.yml文件</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3&#x27;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">nginx:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">80</span><span class="string">:80</span></span><br><span class="line">    <span class="attr">links:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">app</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./nginx/conf.d:/etc/nginx/conf.d</span></span><br><span class="line">  <span class="attr">app:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">app</span></span><br><span class="line">    <span class="attr">expose:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;8080&quot;</span></span><br></pre></td></tr></table></figure></li><li><p>创建.&#x2F;nginx&#x2F;conf.d目录下</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p ./nginx/conf.d</span><br><span class="line">cd ./nginx/conf.d</span><br><span class="line">vim my.conf</span><br></pre></td></tr></table></figure></li><li><p>编写my.conf文件：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">listen 80;</span><br><span class="line">access_log off;</span><br><span class="line">location / &#123;</span><br><span class="line">proxy_pass http://app:8080;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>在~&#x2F;docker-compose目录下使用docker-compose启动容器</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose up</span><br></pre></td></tr></table></figure></li><li><p>测试</p><p>使用浏览器访问：<code>主机地址:80/hello</code></p></li></ol></div><div class="story post-story"><h2 id="7-Docker私有仓库"><a href="#7-Docker私有仓库" class="headerlink" title="7.Docker私有仓库"></a>7.Docker私有仓库</h2><p><strong>Docker私有仓库</strong>：</p><p>Docker官方的<a href="https://hub.docker.com/">Docker hub</a>是一个用于管理公共镜像的仓库，我们可以从上面拉取镜像到本地，也可以把我们自己的镜像推送上去。但是，有时候我们的服务器无法访问互联网，或者你不希望将自己的镜像放到公网当中，那么我们就需要搭建自己的私有仓库来存储和管理自己的镜像。</p><h3 id="7-1-搭建私有仓库"><a href="#7-1-搭建私有仓库" class="headerlink" title="7.1 搭建私有仓库"></a>7.1 搭建私有仓库</h3><ol><li><p>拉取私有仓库镜像</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull registry</span><br></pre></td></tr></table></figure></li><li><p>启动私有仓库容器</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -id --name=registry -p 5000:5000 registry</span><br></pre></td></tr></table></figure></li><li><p>打开浏览器，输入地址<code>https://私有仓库服务器ip:5000/v2/_catalog</code></p><p>如果看到<code>&#123;&quot;repositories&quot;:[]&#125;</code>表示私有仓库搭建成功</p></li><li><p>修改deamon.json</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/docker/daemon.json</span><br></pre></td></tr></table></figure><p>在deamon.json中添加一个key，让docker信任私有仓库地址，<strong>添加</strong>下面内容：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;insecure-registries&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;私有仓库服务器ip:5000&quot;</span><span class="punctuation">]</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></li><li><p>重启docker服务</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart docker</span><br></pre></td></tr></table></figure></li><li><p>启动registry容器</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker start registry</span><br></pre></td></tr></table></figure></li></ol><h3 id="7-2-上传镜像到私有仓库"><a href="#7-2-上传镜像到私有仓库" class="headerlink" title="7.2 上传镜像到私有仓库"></a>7.2 上传镜像到私有仓库</h3><p>上传<code>centos:7</code>为例：</p><ol><li><p>标记镜像为私有仓库的镜像</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker tag centos:7 私有仓库地址ip:5000/centos:7</span><br></pre></td></tr></table></figure></li><li><p>上传标记的镜像</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker push 私有仓库地址ip:5000/centos:7</span><br></pre></td></tr></table></figure></li></ol><p>注意：要启动registry容器，才可以上传到私有仓库</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker start registry </span><br></pre></td></tr></table></figure><h3 id="7-3-从私有仓库拉取镜像"><a href="#7-3-从私有仓库拉取镜像" class="headerlink" title="7.3 从私有仓库拉取镜像"></a>7.3 从私有仓库拉取镜像</h3><p>拉取<code>centos:7</code>为例：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dokcer pull 私有仓库地址ip:5000/centos:7</span><br></pre></td></tr></table></figure></div>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 容器 </tag>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>数据结构的学习笔记</title>
      <link href="/2022/08/06/%E8%AE%A1%E7%AE%97%E6%9C%BA4%E4%BB%B6%E5%A5%97/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"/>
      <url>/2022/08/06/%E8%AE%A1%E7%AE%97%E6%9C%BA4%E4%BB%B6%E5%A5%97/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/</url>
      
        <content type="html"><![CDATA[<div class="story post-story"><h2 id="0-排序"><a href="#0-排序" class="headerlink" title="0.排序"></a>0.排序</h2><h3 id="0-1-冒泡排序"><a href="#0-1-冒泡排序" class="headerlink" title="0.1 冒泡排序"></a>0.1 冒泡排序</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;functional&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Bubble</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">T</span>, <span class="keyword">class</span> <span class="title class_">compare</span> = less&lt;&gt;&gt;</span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="built_in">sort</span>(T&amp; v)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = v.<span class="built_in">size</span>() - <span class="number">1</span>; i &gt; <span class="number">0</span>; i--)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; i; j++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (!<span class="built_in">compare</span>()(v[j], v[j + <span class="number">1</span>]))</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">swap</span>(v[j], v[j + <span class="number">1</span>]);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>由于使用了类模板，导致测试时，导入头文件，例如：<code>#include&quot;ArrayList.h&quot;</code>，会报错。</p><p>所以改用导入源文件，例如：<code>#include&quot;ArrayList.cpp&quot;</code>，这样就能成功运行了！</p></div><div class="story post-story"><h2 id="1-线性表"><a href="#1-线性表" class="headerlink" title="1.线性表"></a>1.线性表</h2><h3 id="1-1-顺序表-动态数组"><a href="#1-1-顺序表-动态数组" class="headerlink" title="1.1 顺序表(动态数组)"></a>1.1 顺序表(动态数组)</h3><p>Cpp实现，顺序表的基本实现</p><p>头文件<code>ArrayList.h</code>：</p><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"></span><br><span class="line">template &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt;</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ArrayList</span> </span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">private:</span><br><span class="line">T* arrayList;                  <span class="comment">// 存储元素的数组</span></span><br><span class="line"><span class="type">int</span> size;                      <span class="comment">// 数组的大小 </span></span><br><span class="line">    <span class="type">int</span> capacity;                  <span class="comment">// 数组的容量</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">resize</span><span class="params">(<span class="type">int</span> newCapacity)</span>;  <span class="comment">// 重新设置容量</span></span><br><span class="line">public:</span><br><span class="line">ArrayList(<span class="type">int</span> capacity);    <span class="comment">// 构造函数，初始化容量</span></span><br><span class="line">~ArrayList();                  <span class="comment">// 析构函数</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">clear</span><span class="params">()</span>;    <span class="comment">// 清空数组</span></span><br><span class="line"><span class="type">bool</span> <span class="title function_">isEmpty</span><span class="params">()</span>;    <span class="comment">// 数组是否为空</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">length</span><span class="params">()</span>;    <span class="comment">// 获取数组的长度</span></span><br><span class="line">T <span class="title function_">get</span><span class="params">(<span class="type">int</span> pos)</span>;                <span class="comment">// 获取该位置的元素</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">insert</span><span class="params">(T val)</span>;            <span class="comment">// 在数组末尾插入元素</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">insert</span><span class="params">(<span class="type">int</span> pos, T val)</span>;   <span class="comment">// 指定数组中的位置插入元素</span></span><br><span class="line">T <span class="title function_">remove</span><span class="params">(<span class="type">int</span> pos)</span>;             <span class="comment">// 删除该位置的元素并返回该元素</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">indexOf</span><span class="params">(T val)</span>;            <span class="comment">// 根据元素值查找最小索引的位置，没有返回-1</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>源文件<code>ArrayList.cpp</code>：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&quot;ArrayList.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line">ArrayList&lt;T&gt;::<span class="built_in">ArrayList</span>()</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">this</span>-&gt;capacity = <span class="number">5</span>;</span><br><span class="line"><span class="keyword">this</span>-&gt;arrayList = <span class="keyword">new</span> T[<span class="keyword">this</span>-&gt;capacity];</span><br><span class="line"><span class="keyword">this</span>-&gt;size = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line">ArrayList&lt;T&gt;::<span class="built_in">ArrayList</span>(<span class="type">int</span> capacity)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">this</span>-&gt;capacity = capacity;</span><br><span class="line"><span class="keyword">this</span>-&gt;arrayList = <span class="keyword">new</span> T[<span class="keyword">this</span>-&gt;capacity];</span><br><span class="line"><span class="keyword">this</span>-&gt;size = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line">ArrayList&lt;T&gt;::~<span class="built_in">ArrayList</span>() &#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">this</span>-&gt;arrayList != <span class="literal">nullptr</span>)&#123;</span><br><span class="line"><span class="keyword">delete</span>[] <span class="keyword">this</span>-&gt;arrayList;</span><br><span class="line"><span class="keyword">this</span>-&gt;arrayList = <span class="literal">nullptr</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line"><span class="type">void</span> ArrayList&lt;T&gt;::<span class="built_in">clear</span>()</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">this</span>-&gt;size = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line"><span class="type">bool</span> ArrayList&lt;T&gt;::<span class="built_in">isEmpty</span>()</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">this</span>-&gt;arrayList == <span class="literal">nullptr</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line"><span class="type">int</span> ArrayList&lt;T&gt;::<span class="built_in">length</span>()</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">this</span>-&gt;size;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line">T ArrayList&lt;T&gt;::<span class="built_in">get</span>(<span class="type">int</span> pos)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (pos &lt;<span class="number">0</span> || pos &gt;= <span class="keyword">this</span>-&gt;size) <span class="keyword">return</span> <span class="built_in">T</span>();</span><br><span class="line">    </span><br><span class="line"><span class="keyword">return</span> <span class="keyword">this</span>-&gt;arrayList[pos];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line"><span class="type">void</span> ArrayList&lt;T&gt;::<span class="built_in">insert</span>(T val)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">this</span>-&gt;size == <span class="keyword">this</span>-&gt;capacity)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">this</span>-&gt;<span class="built_in">resize</span>(<span class="keyword">this</span>-&gt;capacity * <span class="number">2</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">this</span>-&gt;arrayList[<span class="keyword">this</span>-&gt;size] = val;</span><br><span class="line"><span class="keyword">this</span>-&gt;size++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line"><span class="type">void</span> ArrayList&lt;T&gt;::<span class="built_in">insert</span>(<span class="type">int</span> pos, T val)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">this</span>-&gt;size == <span class="keyword">this</span>-&gt;capacity)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">this</span>-&gt;<span class="built_in">resize</span>(<span class="keyword">this</span>-&gt;capacity * <span class="number">2</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="keyword">this</span>-&gt;size - <span class="number">1</span>; i &gt;= pos ; i--)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">this</span>-&gt;arrayList[i + <span class="number">1</span>] = <span class="keyword">this</span>-&gt;arrayList[i];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">this</span>-&gt;arrayList[pos] = val;</span><br><span class="line"><span class="keyword">this</span>-&gt;size++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line">T ArrayList&lt;T&gt;::<span class="built_in">remove</span>(<span class="type">int</span> pos)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (pos &lt;<span class="number">0</span> || pos &gt;= <span class="keyword">this</span>-&gt;size) <span class="keyword">return</span> <span class="built_in">T</span>();</span><br><span class="line">    </span><br><span class="line">T val = <span class="keyword">this</span>-&gt;arrayList[pos];</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = pos; i &lt; <span class="keyword">this</span>-&gt;size; i++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">this</span>-&gt;arrayList[i] = <span class="keyword">this</span>-&gt;arrayList[i + <span class="number">1</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">this</span>-&gt;size--;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">this</span>-&gt;size &lt; <span class="keyword">this</span>-&gt;capacity / <span class="number">4</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">this</span>-&gt;<span class="built_in">resize</span>(<span class="keyword">this</span>-&gt;capacity / <span class="number">2</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> val;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line"><span class="type">int</span> ArrayList&lt;T&gt;::<span class="built_in">indexOf</span>(T val)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="keyword">this</span>-&gt;size; i++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">this</span>-&gt;arrayList[i] == val)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> val;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line"><span class="type">void</span> ArrayList&lt;T&gt;::<span class="built_in">resize</span>(<span class="type">int</span> newCapacity)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">this</span>-&gt;capacity = newCapacity;</span><br><span class="line">T* temp = <span class="keyword">new</span> T[<span class="keyword">this</span>-&gt;capacity];</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="keyword">this</span>-&gt;size; i++)</span><br><span class="line">&#123;</span><br><span class="line">temp[i] = <span class="keyword">this</span>-&gt;arrayList[i];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">delete</span>[] <span class="keyword">this</span>-&gt;arrayList;</span><br><span class="line"><span class="keyword">this</span>-&gt;arrayList = temp;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>部分测试<code>main.cpp</code>：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&quot;ArrayList.cpp&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="function">ArrayList <span class="title">a</span><span class="params">(<span class="number">3</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">6</span>; i++)</span><br><span class="line">&#123;</span><br><span class="line">a.<span class="built_in">insert</span>(i);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">cout &lt;&lt; a.<span class="built_in">isEmpty</span>() &lt;&lt; endl;</span><br><span class="line">cout &lt;&lt; a.<span class="built_in">remove</span>(<span class="number">1</span>) &lt;&lt; endl;</span><br><span class="line">cout &lt;&lt; a.<span class="built_in">indexOf</span>(<span class="number">1</span>) &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; a.<span class="built_in">length</span>(); i++)</span><br><span class="line">&#123;</span><br><span class="line">cout &lt;&lt; a.<span class="built_in">get</span>(i) &lt;&lt; <span class="string">&quot;  &quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">cout &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="1-2-单向链表"><a href="#1-2-单向链表" class="headerlink" title="1.2 单向链表"></a>1.2 单向链表</h3><p>头文件：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line"><span class="keyword">class</span>  <span class="title class_">LinkedList</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Node</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">T data;</span><br><span class="line">Node* next;</span><br><span class="line"><span class="built_in">Node</span>() &#123;&#125;</span><br><span class="line">        <span class="built_in">Node</span>(Node* next)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">this</span>-&gt;next = next;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">Node</span>(T data, Node* next)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">this</span>-&gt;data = data;</span><br><span class="line"><span class="keyword">this</span>-&gt;next = next;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line">Node* head;</span><br><span class="line"><span class="type">int</span> size;</span><br><span class="line">    <span class="function">Node* <span class="title">reverse</span><span class="params">(Node* curr)</span></span>; <span class="comment">// 当前节点实现反转</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="built_in">LinkedList</span>();</span><br><span class="line">~<span class="built_in">LinkedList</span>();</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">clear</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">isEmpty</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">length</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function">T <span class="title">get</span><span class="params">(<span class="type">int</span> pos)</span></span>;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">insert</span><span class="params">(T data)</span></span>;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">insert</span><span class="params">(<span class="type">int</span> pos, T data)</span></span>;</span><br><span class="line"><span class="function">T <span class="title">remove</span><span class="params">(<span class="type">int</span> pos)</span></span>;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">indexOf</span><span class="params">(T data)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">reverse</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function">T <span class="title">getMid</span><span class="params">()</span></span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>源文件：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&quot;LinkedList.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line"><span class="keyword">typename</span> LinkedList&lt;T&gt;::Node* LinkedList&lt;T&gt;::<span class="built_in">reverse</span>(Node* curr)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (curr-&gt;next == <span class="literal">nullptr</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">this</span>-&gt;head-&gt;next = curr;</span><br><span class="line"><span class="keyword">return</span> curr;</span><br><span class="line">&#125;</span><br><span class="line">Node* p = <span class="built_in">reverse</span>(curr-&gt;next);</span><br><span class="line">p-&gt;next = curr;</span><br><span class="line">curr-&gt;next = <span class="literal">nullptr</span>;</span><br><span class="line"><span class="keyword">return</span> curr;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line">LinkedList&lt;T&gt;::<span class="built_in">LinkedList</span>()</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">this</span>-&gt;head = <span class="keyword">new</span> <span class="built_in">Node</span>(<span class="literal">nullptr</span>);</span><br><span class="line"><span class="keyword">this</span>-&gt;size = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line">LinkedList&lt;T&gt;::~<span class="built_in">LinkedList</span>()</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">this</span>-&gt;head == <span class="literal">nullptr</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">this</span>-&gt;<span class="built_in">clear</span>();</span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">this</span>-&gt;head;</span><br><span class="line"><span class="keyword">this</span>-&gt;head = <span class="literal">nullptr</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line"><span class="type">void</span> LinkedList&lt;T&gt;::<span class="built_in">clear</span>()</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">this</span>-&gt;head == <span class="literal">nullptr</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line">Node* p = <span class="keyword">this</span>-&gt;head-&gt;next;</span><br><span class="line"><span class="keyword">while</span> (p != <span class="literal">nullptr</span>)</span><br><span class="line">&#123;</span><br><span class="line">Node* newNode = p-&gt;next;</span><br><span class="line"><span class="keyword">delete</span> p;</span><br><span class="line">p = newNode;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">this</span>-&gt;head-&gt;next = <span class="literal">nullptr</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">this</span>-&gt;size = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line"><span class="type">bool</span> LinkedList&lt;T&gt;::<span class="built_in">isEmpty</span>()</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">this</span>-&gt;size == <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line"><span class="type">int</span> LinkedList&lt;T&gt;::<span class="built_in">length</span>()</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">this</span>-&gt;size;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line">T LinkedList&lt;T&gt;::<span class="built_in">get</span>(<span class="type">int</span> pos)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (pos &lt; <span class="number">0</span> || pos &gt;= <span class="keyword">this</span>-&gt;size) <span class="keyword">return</span> <span class="built_in">T</span>();</span><br><span class="line"></span><br><span class="line">Node* p = <span class="keyword">this</span>-&gt;head-&gt;next;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; pos; i++)</span><br><span class="line">&#123;</span><br><span class="line">p = p-&gt;next;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> p-&gt;data;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line"><span class="type">void</span> LinkedList&lt;T&gt;::<span class="built_in">insert</span>(T data)</span><br><span class="line">&#123;</span><br><span class="line">Node* p = <span class="keyword">this</span>-&gt;head;</span><br><span class="line"><span class="keyword">while</span> (p-&gt;next != <span class="literal">nullptr</span>)</span><br><span class="line">&#123;</span><br><span class="line">p = p-&gt;next;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Node* newNode = <span class="keyword">new</span> <span class="built_in">Node</span>(data, <span class="literal">nullptr</span>);</span><br><span class="line">p-&gt;next = newNode;</span><br><span class="line"></span><br><span class="line"><span class="keyword">this</span>-&gt;size++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line"><span class="type">void</span> LinkedList&lt;T&gt;::<span class="built_in">insert</span>(<span class="type">int</span> pos, T data)</span><br><span class="line">&#123;</span><br><span class="line">Node* p = <span class="keyword">this</span>-&gt;head;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; pos; i++)</span><br><span class="line">&#123;</span><br><span class="line">p = p-&gt;next;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Node* newNode = <span class="keyword">new</span> <span class="built_in">Node</span>(data, p-&gt;next);</span><br><span class="line">p-&gt;next = newNode;</span><br><span class="line"></span><br><span class="line"><span class="keyword">this</span>-&gt;size++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line">T LinkedList&lt;T&gt;::<span class="built_in">remove</span>(<span class="type">int</span> pos)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (pos &lt; <span class="number">0</span> || pos &gt;= <span class="keyword">this</span>-&gt;size) <span class="keyword">return</span> <span class="built_in">T</span>();</span><br><span class="line"></span><br><span class="line">Node* p = <span class="keyword">this</span>-&gt;head;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; pos; i++)</span><br><span class="line">&#123;</span><br><span class="line">p = p-&gt;next;</span><br><span class="line">&#125;</span><br><span class="line">Node* e = p-&gt;next;</span><br><span class="line">p-&gt;next = e-&gt;next;</span><br><span class="line"></span><br><span class="line">T res = e-&gt;data;</span><br><span class="line"><span class="keyword">delete</span> e;</span><br><span class="line">e = <span class="literal">nullptr</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">this</span>-&gt;size--;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line"><span class="type">int</span> LinkedList&lt;T&gt;::<span class="built_in">indexOf</span>(T data)</span><br><span class="line">&#123;</span><br><span class="line">Node* p = <span class="keyword">this</span>-&gt;head-&gt;next;</span><br><span class="line"><span class="type">int</span> pos = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span> (p != <span class="literal">nullptr</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (p-&gt;data == data)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> pos;</span><br><span class="line">&#125;</span><br><span class="line">p = p-&gt;next;</span><br><span class="line">pos++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line"><span class="type">void</span> LinkedList&lt;T&gt;::<span class="built_in">reverse</span>()</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">this</span>-&gt;size &lt; <span class="number">2</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">reverse</span>(<span class="keyword">this</span>-&gt;head-&gt;next);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line">T LinkedList&lt;T&gt;::<span class="built_in">getMid</span>()</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">this</span>-&gt;head-&gt;next == <span class="literal">nullptr</span>) <span class="keyword">return</span> <span class="built_in">T</span>();</span><br><span class="line"></span><br><span class="line">Node* fast = <span class="keyword">this</span>-&gt;head-&gt;next;</span><br><span class="line">Node* slow = <span class="keyword">this</span>-&gt;head-&gt;next;</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (fast != <span class="literal">nullptr</span> &amp;&amp; fast-&gt;next != <span class="literal">nullptr</span>)</span><br><span class="line">&#123;</span><br><span class="line">fast = fast-&gt;next-&gt;next;</span><br><span class="line">slow = slow-&gt;next;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> slow-&gt;data;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>测试：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&quot;LinkedList.cpp&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">LinkedList&lt;<span class="type">int</span>&gt; list;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">6</span>; i++)</span><br><span class="line">&#123;</span><br><span class="line">list.<span class="built_in">insert</span>(i);</span><br><span class="line">&#125;</span><br><span class="line">list.<span class="built_in">insert</span>(<span class="number">2</span>, <span class="number">100</span>);</span><br><span class="line"></span><br><span class="line">cout &lt;&lt; list.<span class="built_in">isEmpty</span>() &lt;&lt; endl;</span><br><span class="line">cout &lt;&lt; list.<span class="built_in">remove</span>(<span class="number">5</span>) &lt;&lt; endl;</span><br><span class="line">cout &lt;&lt; list.<span class="built_in">indexOf</span>(<span class="number">5</span>) &lt;&lt; endl;</span><br><span class="line"><span class="comment">//list.clear();</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; list.<span class="built_in">length</span>(); i++)</span><br><span class="line">&#123;</span><br><span class="line">cout &lt;&lt; list.<span class="built_in">get</span>(i) &lt;&lt; <span class="string">&quot;  &quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">cout &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="1-3-双向链表"><a href="#1-3-双向链表" class="headerlink" title="1.3 双向链表"></a>1.3 双向链表</h3><p>头文件：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DoubleLinkedList</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Node</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">T data;</span><br><span class="line">Node* pre;</span><br><span class="line">Node* next;</span><br><span class="line"><span class="built_in">Node</span>() &#123;&#125;</span><br><span class="line">        <span class="built_in">Node</span>(Node* pre, Node* next)</span><br><span class="line">&#123;</span><br><span class="line">            <span class="keyword">this</span>-&gt;pre = pre;</span><br><span class="line"><span class="keyword">this</span>-&gt;next = next;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">Node</span>(Node* pre, T data, Node* next)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">this</span>-&gt;pre = pre;</span><br><span class="line"><span class="keyword">this</span>-&gt;data = data;</span><br><span class="line"><span class="keyword">this</span>-&gt;next = next;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line">Node* head;</span><br><span class="line">Node* last;</span><br><span class="line"><span class="type">int</span> size;</span><br><span class="line"><span class="function">Node* <span class="title">getNode</span><span class="params">(<span class="type">int</span> pos)</span></span>;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="built_in">DoubleLinkedList</span>();</span><br><span class="line">~<span class="built_in">DoubleLinkedList</span>();</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">clear</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">isEmpty</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">length</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function">T <span class="title">get</span><span class="params">(<span class="type">int</span> pos)</span></span>;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">insert</span><span class="params">(T data)</span></span>;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">insert</span><span class="params">(<span class="type">int</span> pos, T data)</span></span>;</span><br><span class="line"><span class="function">T <span class="title">remove</span><span class="params">(<span class="type">int</span> pos)</span></span>;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">indexOf</span><span class="params">(T data)</span></span>;</span><br><span class="line"><span class="function">T <span class="title">getFirst</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function">T <span class="title">getLast</span><span class="params">()</span></span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>源文件：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&quot;DoubleLinkedList.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line"><span class="keyword">typename</span> DoubleLinkedList&lt;T&gt;::Node* DoubleLinkedList&lt;T&gt;::<span class="built_in">getNode</span>(<span class="type">int</span> pos)</span><br><span class="line">&#123;</span><br><span class="line">Node* p;</span><br><span class="line"><span class="comment">//从前往后遍历</span></span><br><span class="line"><span class="keyword">if</span> (pos &lt; <span class="built_in">int</span>(<span class="keyword">this</span>-&gt;size / <span class="number">2</span>))</span><br><span class="line">&#123;</span><br><span class="line">p = <span class="keyword">this</span>-&gt;head-&gt;next;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; pos; i++)</span><br><span class="line">&#123;</span><br><span class="line">p = p-&gt;next;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//从后往前遍历</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">p = <span class="keyword">this</span>-&gt;last;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; pos; i++)</span><br><span class="line">&#123;</span><br><span class="line">p = p-&gt;pre;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> p;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line">DoubleLinkedList&lt;T&gt;::<span class="built_in">DoubleLinkedList</span>()</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">this</span>-&gt;head = <span class="keyword">new</span> <span class="built_in">Node</span>(<span class="literal">nullptr</span>, <span class="literal">nullptr</span>);</span><br><span class="line"><span class="keyword">this</span>-&gt;last = <span class="keyword">this</span>-&gt;head;</span><br><span class="line"><span class="keyword">this</span>-&gt;size = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line">DoubleLinkedList&lt;T&gt;::~<span class="built_in">DoubleLinkedList</span>()</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">this</span>-&gt;head == <span class="literal">nullptr</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">this</span>-&gt;<span class="built_in">clear</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">this</span>-&gt;head;</span><br><span class="line"><span class="keyword">this</span>-&gt;head = <span class="literal">nullptr</span>;</span><br><span class="line"><span class="keyword">this</span>-&gt;last = <span class="literal">nullptr</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line"><span class="type">void</span> DoubleLinkedList&lt;T&gt;::<span class="built_in">clear</span>()</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">this</span>-&gt;head == <span class="literal">nullptr</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line">Node* p = <span class="keyword">this</span>-&gt;head-&gt;next;</span><br><span class="line"><span class="keyword">while</span> (p != <span class="literal">nullptr</span>)</span><br><span class="line">&#123;</span><br><span class="line">Node* newNode = p-&gt;next;</span><br><span class="line"><span class="keyword">delete</span> p;</span><br><span class="line">p = newNode;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">this</span>-&gt;head-&gt;next = <span class="literal">nullptr</span>;</span><br><span class="line"><span class="keyword">this</span>-&gt;last = <span class="keyword">this</span>-&gt;head;</span><br><span class="line"><span class="keyword">this</span>-&gt;size = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line"><span class="type">bool</span> DoubleLinkedList&lt;T&gt;::<span class="built_in">isEmpty</span>()</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">this</span>-&gt;size == <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line"><span class="type">int</span> DoubleLinkedList&lt;T&gt;::<span class="built_in">length</span>()</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">this</span>-&gt;size;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line">T DoubleLinkedList&lt;T&gt;::<span class="built_in">get</span>(<span class="type">int</span> pos)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (pos &lt; <span class="number">0</span> || pos &gt;= <span class="keyword">this</span>-&gt;size) <span class="keyword">return</span> <span class="built_in">T</span>();</span><br><span class="line"></span><br><span class="line">Node* p = <span class="keyword">this</span>-&gt;<span class="built_in">getNode</span>(pos);</span><br><span class="line"><span class="keyword">return</span> p-&gt;data;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line"><span class="type">void</span> DoubleLinkedList&lt;T&gt;::<span class="built_in">insert</span>(T data)</span><br><span class="line">&#123;</span><br><span class="line">Node* newNode = <span class="keyword">new</span> <span class="built_in">Node</span>(<span class="keyword">this</span>-&gt;last, data, <span class="literal">nullptr</span>);</span><br><span class="line"><span class="keyword">this</span>-&gt;last-&gt;next = newNode;</span><br><span class="line"><span class="keyword">this</span>-&gt;last = newNode;</span><br><span class="line"></span><br><span class="line"><span class="keyword">this</span>-&gt;size++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line"><span class="type">void</span> DoubleLinkedList&lt;T&gt;::<span class="built_in">insert</span>(<span class="type">int</span> pos, T data)</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">Node* p = <span class="keyword">this</span>-&gt;<span class="built_in">getNode</span>(pos);</span><br><span class="line"></span><br><span class="line">Node* newNode = <span class="keyword">new</span> <span class="built_in">Node</span>(p, data, p-&gt;next);</span><br><span class="line">p-&gt;next-&gt;pre = newNode;</span><br><span class="line">p-&gt;next = newNode;</span><br><span class="line"></span><br><span class="line"><span class="keyword">this</span>-&gt;size++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line">T DoubleLinkedList&lt;T&gt;::<span class="built_in">remove</span>(<span class="type">int</span> pos)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (pos &lt; <span class="number">0</span> || pos &gt;= <span class="keyword">this</span>-&gt;size) <span class="keyword">return</span> <span class="built_in">T</span>();</span><br><span class="line"></span><br><span class="line">Node* p = <span class="keyword">this</span>-&gt;<span class="built_in">getNode</span>(pos);</span><br><span class="line">T res = p-&gt;data;</span><br><span class="line"></span><br><span class="line">p-&gt;pre-&gt;next = p-&gt;next;</span><br><span class="line">p-&gt;next-&gt;pre = p-&gt;pre;</span><br><span class="line"><span class="keyword">delete</span> p;</span><br><span class="line">p = <span class="literal">nullptr</span>;</span><br><span class="line"><span class="keyword">this</span>-&gt;size--;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line"><span class="type">int</span> DoubleLinkedList&lt;T&gt;::<span class="built_in">indexOf</span>(T data)</span><br><span class="line">&#123;</span><br><span class="line">Node* p = <span class="keyword">this</span>-&gt;head-&gt;next;</span><br><span class="line"><span class="type">int</span> pos = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span> (p != <span class="literal">nullptr</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (p-&gt;data == data)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> pos;</span><br><span class="line">&#125;</span><br><span class="line">p = p-&gt;next;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line">T DoubleLinkedList&lt;T&gt;::<span class="built_in">getFirst</span>()</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">this</span>-&gt;<span class="built_in">isEmpty</span>()) <span class="keyword">return</span> <span class="built_in">T</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="keyword">this</span>-&gt;head-&gt;next-&gt;data;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line">T DoubleLinkedList&lt;T&gt;::<span class="built_in">getLast</span>()</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">this</span>-&gt;<span class="built_in">isEmpty</span>()) <span class="keyword">return</span> <span class="built_in">T</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="keyword">this</span>-&gt;last-&gt;data;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="1-4-栈-链栈"><a href="#1-4-栈-链栈" class="headerlink" title="1.4 栈(链栈)"></a>1.4 栈(链栈)</h3><p>头文件：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Stack</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Node</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">T data;</span><br><span class="line">Node* next;</span><br><span class="line"><span class="built_in">Node</span>() &#123;&#125;</span><br><span class="line">        <span class="built_in">Node</span>(Node* next)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">this</span>-&gt;next = next;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">Node</span>(T data, Node* next)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">this</span>-&gt;data = data;</span><br><span class="line"><span class="keyword">this</span>-&gt;next = next;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line">Node* head;</span><br><span class="line"><span class="type">int</span> size;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="built_in">Stack</span>();</span><br><span class="line">~<span class="built_in">Stack</span>();</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">isEmpty</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">getSize</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function">T <span class="title">pop</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">push</span><span class="params">(T data)</span></span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>源文件：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Stack.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line">Stack&lt;T&gt;::<span class="built_in">Stack</span>()</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">this</span>-&gt;head = <span class="keyword">new</span> <span class="built_in">Node</span>(<span class="literal">nullptr</span>);</span><br><span class="line"><span class="keyword">this</span>-&gt;size = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line">Stack&lt;T&gt;::~<span class="built_in">Stack</span>()</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">this</span>-&gt;head == <span class="literal">nullptr</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line">Node* p = <span class="keyword">this</span>-&gt;head-&gt;next;</span><br><span class="line"><span class="keyword">while</span> (p != <span class="literal">nullptr</span>)</span><br><span class="line">&#123;</span><br><span class="line">Node* newNode = p-&gt;next;</span><br><span class="line"><span class="keyword">delete</span> p;</span><br><span class="line">p = newNode;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">this</span>-&gt;head;</span><br><span class="line"><span class="keyword">this</span>-&gt;head = <span class="literal">nullptr</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line"><span class="type">bool</span> Stack&lt;T&gt;::<span class="built_in">isEmpty</span>()</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">this</span>-&gt;size == <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line"><span class="type">int</span> Stack&lt;T&gt;::<span class="built_in">getSize</span>()</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">this</span>-&gt;size;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line">T Stack&lt;T&gt;::<span class="built_in">pop</span>()</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">this</span>-&gt;size == <span class="number">0</span>) <span class="keyword">return</span> <span class="built_in">T</span>();</span><br><span class="line"></span><br><span class="line">Node* p = <span class="keyword">this</span>-&gt;head-&gt;next;</span><br><span class="line">T data = p-&gt;data;</span><br><span class="line"><span class="keyword">this</span>-&gt;head-&gt;next = p-&gt;next;</span><br><span class="line"></span><br><span class="line"><span class="keyword">this</span>-&gt;size--;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> data;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line"><span class="type">void</span> Stack&lt;T&gt;::<span class="built_in">push</span>(T data)</span><br><span class="line">&#123;</span><br><span class="line">Node* p = <span class="keyword">new</span> <span class="built_in">Node</span>(data, <span class="keyword">this</span>-&gt;head-&gt;next);</span><br><span class="line"><span class="keyword">this</span>-&gt;head-&gt;next = p;</span><br><span class="line"></span><br><span class="line"><span class="keyword">this</span>-&gt;size++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="1-5-队列-链队"><a href="#1-5-队列-链队" class="headerlink" title="1.5 队列(链队)"></a>1.5 队列(链队)</h3><p>头文件：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Queue</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Node</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">T data;</span><br><span class="line">Node* next;</span><br><span class="line"><span class="built_in">Node</span>() &#123;&#125;</span><br><span class="line">        <span class="built_in">Node</span>(Node* next)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">this</span>-&gt;next = next;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">Node</span>(T data, Node* next)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">this</span>-&gt;data = data;</span><br><span class="line"><span class="keyword">this</span>-&gt;next = next;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line">Node* head;</span><br><span class="line">Node* last;</span><br><span class="line"><span class="type">int</span> size;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="built_in">Queue</span>();</span><br><span class="line">~<span class="built_in">Queue</span>();</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">isEmpty</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function">T <span class="title">dequeue</span><span class="params">()</span></span>; <span class="comment">//出队</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">enqueue</span><span class="params">(T data)</span></span>; <span class="comment">//入队</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>源文件：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Queue.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line">Queue&lt;T&gt;::<span class="built_in">Queue</span>()</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">this</span>-&gt;head = <span class="keyword">new</span> <span class="built_in">Node</span>(<span class="literal">nullptr</span>);</span><br><span class="line"><span class="keyword">this</span>-&gt;last = <span class="keyword">this</span>-&gt;head;</span><br><span class="line"></span><br><span class="line"><span class="keyword">this</span>-&gt;size = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line">Queue&lt;T&gt;::~<span class="built_in">Queue</span>()</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">this</span>-&gt;head == <span class="literal">nullptr</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line">Node* p = <span class="keyword">this</span>-&gt;head-&gt;next;</span><br><span class="line"><span class="keyword">while</span> (p != <span class="literal">nullptr</span>)</span><br><span class="line">&#123;</span><br><span class="line">Node* newNode = p-&gt;next;</span><br><span class="line"><span class="keyword">delete</span> p;</span><br><span class="line">p = newNode;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">this</span>-&gt;head;</span><br><span class="line"><span class="keyword">this</span>-&gt;head = <span class="literal">nullptr</span>;</span><br><span class="line"><span class="keyword">this</span>-&gt;last = <span class="literal">nullptr</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line"><span class="type">bool</span> Queue&lt;T&gt;::<span class="built_in">isEmpty</span>()</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">this</span>-&gt;size == <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line">T Queue&lt;T&gt;::<span class="built_in">dequeue</span>()</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">this</span>-&gt;size == <span class="number">0</span>) <span class="keyword">return</span> <span class="built_in">T</span>();</span><br><span class="line"></span><br><span class="line">Node* p = <span class="keyword">this</span>-&gt;head-&gt;next;</span><br><span class="line">T data = p-&gt;data;</span><br><span class="line"><span class="keyword">this</span>-&gt;head-&gt;next = p-&gt;next;</span><br><span class="line"><span class="keyword">delete</span> p;</span><br><span class="line"><span class="keyword">this</span>-&gt;size--;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">this</span>-&gt;<span class="built_in">isEmpty</span>())</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">this</span>-&gt;last = <span class="keyword">this</span>-&gt;head;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> data;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line"><span class="type">void</span> Queue&lt;T&gt;::<span class="built_in">enqueue</span>(T data)</span><br><span class="line">&#123;</span><br><span class="line">Node* newNode = <span class="keyword">new</span> <span class="built_in">Node</span>(data, <span class="literal">nullptr</span>);</span><br><span class="line"><span class="keyword">this</span>-&gt;last-&gt;next = newNode;</span><br><span class="line"><span class="keyword">this</span>-&gt;last = newNode;</span><br><span class="line"></span><br><span class="line"><span class="keyword">this</span>-&gt;size++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="2-符号表"><a href="#2-符号表" class="headerlink" title="2.符号表"></a>2.符号表</h2><h3 id="2-1-符号表-map"><a href="#2-1-符号表-map" class="headerlink" title="2.1 符号表(map)"></a>2.1 符号表(map)</h3><p>头文件：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">K</span>, <span class="keyword">class</span> <span class="title class_">V</span>&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Map</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Node</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">K key;</span><br><span class="line">V value;</span><br><span class="line">Node* next;</span><br><span class="line"><span class="built_in">Node</span>() &#123;&#125;</span><br><span class="line">        <span class="built_in">Node</span>(Node* next)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">this</span>-&gt;next = next;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">Node</span>(K key, V value, Node* next)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">this</span>-&gt;key = key;</span><br><span class="line"><span class="keyword">this</span>-&gt;value = value;</span><br><span class="line"><span class="keyword">this</span>-&gt;next = next;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line">Node* head;</span><br><span class="line"><span class="type">int</span> size;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="built_in">Map</span>();</span><br><span class="line">~<span class="built_in">Map</span>();</span><br><span class="line"><span class="function">V <span class="title">get</span><span class="params">(K key)</span></span>;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">put</span><span class="params">(K key, V value)</span></span>;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">remove</span><span class="params">(K key)</span></span>;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">getSize</span><span class="params">()</span></span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>源文件：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&quot;Map.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">K</span>, <span class="keyword">class</span> <span class="title class_">V</span>&gt;</span><br><span class="line">Map&lt;K, V&gt;::<span class="built_in">Map</span>()</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">this</span>-&gt;head = <span class="keyword">new</span> <span class="built_in">Node</span>(<span class="literal">nullptr</span>);</span><br><span class="line"><span class="keyword">this</span>-&gt;size = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">K</span>, <span class="keyword">class</span> <span class="title class_">V</span>&gt;</span><br><span class="line">Map&lt;K, V&gt;::~<span class="built_in">Map</span>()</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">this</span>-&gt;head == <span class="literal">nullptr</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line">Node* p = <span class="keyword">this</span>-&gt;head-&gt;next;</span><br><span class="line"><span class="keyword">while</span> (p != <span class="literal">nullptr</span>)</span><br><span class="line">&#123;</span><br><span class="line">Node* newNode = p-&gt;next;</span><br><span class="line"><span class="keyword">delete</span> p;</span><br><span class="line">p = newNode;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">this</span>-&gt;head;</span><br><span class="line"><span class="keyword">this</span>-&gt;head = <span class="literal">nullptr</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">K</span>, <span class="keyword">class</span> <span class="title class_">V</span>&gt;</span><br><span class="line">V Map&lt;K, V&gt;::<span class="built_in">get</span>(K key)</span><br><span class="line">&#123;</span><br><span class="line">Node* p = <span class="keyword">this</span>-&gt;head-&gt;next;</span><br><span class="line"><span class="keyword">while</span> (p != <span class="literal">nullptr</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (p-&gt;key == key)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> p-&gt;value;</span><br><span class="line">&#125;</span><br><span class="line">p = p-&gt;next;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">V</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">K</span>, <span class="keyword">class</span> <span class="title class_">V</span>&gt;</span><br><span class="line"><span class="type">void</span> Map&lt;K, V&gt;::<span class="built_in">put</span>(K key, V value)</span><br><span class="line">&#123;</span><br><span class="line">Node* p = <span class="keyword">this</span>-&gt;head;</span><br><span class="line"><span class="keyword">while</span> (p-&gt;next != <span class="literal">nullptr</span>)</span><br><span class="line">&#123;</span><br><span class="line">p = p-&gt;next;</span><br><span class="line"><span class="keyword">if</span> (p-&gt;key == key)</span><br><span class="line">&#123;</span><br><span class="line">p-&gt;value = value;</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">Node* newNode = <span class="keyword">new</span> <span class="built_in">Node</span>(key, value, <span class="literal">nullptr</span>);</span><br><span class="line">p-&gt;next = newNode;</span><br><span class="line"><span class="keyword">this</span>-&gt;size++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">K</span>, <span class="keyword">class</span> <span class="title class_">V</span>&gt;</span><br><span class="line"><span class="type">bool</span> Map&lt;K, V&gt;::<span class="built_in">remove</span>(K key)</span><br><span class="line">&#123;</span><br><span class="line">Node* p = <span class="keyword">this</span>-&gt;head;</span><br><span class="line"><span class="keyword">while</span> (p-&gt;next != <span class="literal">nullptr</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (p-&gt;next-&gt;key == key)</span><br><span class="line">&#123;</span><br><span class="line">Node* e = p-&gt;next;</span><br><span class="line">p-&gt;next = e-&gt;next;</span><br><span class="line"><span class="keyword">delete</span> e;</span><br><span class="line"><span class="keyword">this</span>-&gt;size--;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line">p = p-&gt;next;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">K</span>, <span class="keyword">class</span> <span class="title class_">V</span>&gt;</span><br><span class="line"><span class="type">int</span> Map&lt;K, V&gt;::<span class="built_in">getSize</span>()</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">this</span>-&gt;size;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-2-有序符号表"><a href="#2-2-有序符号表" class="headerlink" title="2.2 有序符号表"></a>2.2 有序符号表</h3><p>头文件：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;functional&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">K</span>, <span class="keyword">class</span> <span class="title class_">V</span>, <span class="keyword">class</span> <span class="title class_">compare</span> = less&lt;K&gt;&gt;</span><br><span class="line"><span class="keyword">class</span> OrderMap</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line"><span class="keyword">class</span> Node</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">K key;</span><br><span class="line">V value;</span><br><span class="line">Node* next;</span><br><span class="line"><span class="built_in">Node</span>() &#123;&#125;</span><br><span class="line"><span class="built_in">Node</span>(Node* next)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">this</span>-&gt;next = next;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">Node</span>(K key, V value, Node* next)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">this</span>-&gt;key = key;</span><br><span class="line"><span class="keyword">this</span>-&gt;value = value;</span><br><span class="line"><span class="keyword">this</span>-&gt;next = next;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line">Node* head;</span><br><span class="line"><span class="type">int</span> size;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="built_in">OrderMap</span>();</span><br><span class="line">~<span class="built_in">OrderMap</span>();</span><br><span class="line"><span class="function">V <span class="title">get</span><span class="params">(K key)</span></span>;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">put</span><span class="params">(K key, V value)</span></span>;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">remove</span><span class="params">(K key)</span></span>;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">getSize</span><span class="params">()</span></span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>源文件：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;OrderMap.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">K</span>, <span class="keyword">class</span> <span class="title class_">V</span>, <span class="keyword">class</span> <span class="title class_">compare</span>&gt;</span><br><span class="line">OrderMap&lt;K, V, compare&gt;::<span class="built_in">OrderMap</span>()</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">this</span>-&gt;head = <span class="keyword">new</span> <span class="built_in">Node</span>(<span class="literal">nullptr</span>);</span><br><span class="line"><span class="keyword">this</span>-&gt;size = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">K</span>, <span class="keyword">class</span> <span class="title class_">V</span>, <span class="keyword">class</span> <span class="title class_">compare</span>&gt;</span><br><span class="line">OrderMap&lt;K, V, compare&gt;::~<span class="built_in">OrderMap</span>()</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">this</span>-&gt;head == <span class="literal">nullptr</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line">Node* p = <span class="keyword">this</span>-&gt;head-&gt;next;</span><br><span class="line"><span class="keyword">while</span> (p != <span class="literal">nullptr</span>)</span><br><span class="line">&#123;</span><br><span class="line">Node* newNode = p-&gt;next;</span><br><span class="line"><span class="keyword">delete</span> p;</span><br><span class="line">p = newNode;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">this</span>-&gt;head;</span><br><span class="line"><span class="keyword">this</span>-&gt;head = <span class="literal">nullptr</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">K</span>, <span class="keyword">class</span> <span class="title class_">V</span>, <span class="keyword">class</span> <span class="title class_">compare</span>&gt;</span><br><span class="line">V OrderMap&lt;K, V, compare&gt;::<span class="built_in">get</span>(K key)</span><br><span class="line">&#123;</span><br><span class="line">Node* p = <span class="keyword">this</span>-&gt;head-&gt;next;</span><br><span class="line"><span class="keyword">while</span> (p != <span class="literal">nullptr</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (p-&gt;key == key)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> p-&gt;value;</span><br><span class="line">&#125;</span><br><span class="line">p = p-&gt;next;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">V</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">K</span>, <span class="keyword">class</span> <span class="title class_">V</span>, <span class="keyword">class</span> <span class="title class_">compare</span>&gt;</span><br><span class="line"><span class="type">void</span> OrderMap&lt;K, V, compare&gt;::<span class="built_in">put</span>(K key, V value)</span><br><span class="line">&#123;</span><br><span class="line">Node* p = <span class="keyword">this</span>-&gt;head-&gt;next;</span><br><span class="line">Node* pre = <span class="keyword">this</span>-&gt;head;</span><br><span class="line"><span class="keyword">while</span> (p != <span class="literal">nullptr</span> &amp;&amp; <span class="built_in">compare</span>()(p-&gt;key, key))</span><br><span class="line">&#123;</span><br><span class="line">p = p-&gt;next;</span><br><span class="line">pre = pre-&gt;next;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (p == <span class="literal">nullptr</span>)</span><br><span class="line">&#123;</span><br><span class="line">Node* newNode = <span class="keyword">new</span> <span class="built_in">Node</span>(key, value, <span class="literal">nullptr</span>);</span><br><span class="line">pre-&gt;next = newNode;</span><br><span class="line"><span class="keyword">this</span>-&gt;size++;</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (p-&gt;key == key)</span><br><span class="line">&#123;</span><br><span class="line">p-&gt;value = value;</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line">Node* newNode = <span class="keyword">new</span> <span class="built_in">Node</span>(key, value, p);</span><br><span class="line">pre-&gt;next = newNode;</span><br><span class="line"><span class="keyword">this</span>-&gt;size++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">K</span>, <span class="keyword">class</span> <span class="title class_">V</span>, <span class="keyword">class</span> <span class="title class_">compare</span>&gt;</span><br><span class="line"><span class="type">bool</span> OrderMap&lt;K, V, compare&gt;::<span class="built_in">remove</span>(K key)</span><br><span class="line">&#123;</span><br><span class="line">Node* p = <span class="keyword">this</span>-&gt;head;</span><br><span class="line"><span class="keyword">while</span> (p-&gt;next != <span class="literal">nullptr</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (p-&gt;next-&gt;key == key)</span><br><span class="line">&#123;</span><br><span class="line">Node* e = p-&gt;next;</span><br><span class="line">p-&gt;next = e-&gt;next;</span><br><span class="line"><span class="keyword">delete</span> e;</span><br><span class="line"><span class="keyword">this</span>-&gt;size--;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line">p = p-&gt;next;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">K</span>, <span class="keyword">class</span> <span class="title class_">V</span>, <span class="keyword">class</span> <span class="title class_">compare</span>&gt;</span><br><span class="line"><span class="type">int</span> OrderMap&lt;K, V, compare&gt;::<span class="built_in">getSize</span>()</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">this</span>-&gt;size;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="3-树"><a href="#3-树" class="headerlink" title="3.树"></a>3.树</h2><h3 id="3-1-二叉查找树"><a href="#3-1-二叉查找树" class="headerlink" title="3.1 二叉查找树"></a>3.1 二叉查找树</h3><p>头文件：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">K</span>, <span class="keyword">class</span> <span class="title class_">V</span>&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BinaryTree</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Node</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">K key;</span><br><span class="line">V value;</span><br><span class="line">Node* left;</span><br><span class="line">Node* right;</span><br><span class="line"><span class="built_in">Node</span>() &#123;&#125;</span><br><span class="line"><span class="built_in">Node</span>(K key, V value, Node* left, Node* right)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">this</span>-&gt;key = key;</span><br><span class="line"><span class="keyword">this</span>-&gt;value = value;</span><br><span class="line"><span class="keyword">this</span>-&gt;left = left;</span><br><span class="line"><span class="keyword">this</span>-&gt;right = right;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line">Node* root;</span><br><span class="line"><span class="type">int</span> size;</span><br><span class="line"><span class="function">Node* <span class="title">put</span><span class="params">(Node* node, K key, V value)</span></span>;</span><br><span class="line"><span class="function">V <span class="title">get</span><span class="params">(Node* node, K key)</span></span>;</span><br><span class="line"><span class="function">Node* <span class="title">remove</span><span class="params">(Node* node, K key)</span></span>;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">destroy</span><span class="params">(Node* node)</span></span>;</span><br><span class="line"><span class="function">Node* <span class="title">min</span><span class="params">(Node* node)</span></span>;</span><br><span class="line"><span class="function">Node* <span class="title">max</span><span class="params">(Node* node)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">depth</span><span class="params">(Node* node)</span></span>;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ergodic</span><span class="params">(Node* node, vector&lt;K&gt;&amp; keys, <span class="type">int</span> select)</span></span>;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">layerErgodic</span><span class="params">(Node* node, vector&lt;K&gt;&amp; keys)</span></span>;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="built_in">BinaryTree</span>();</span><br><span class="line">~<span class="built_in">BinaryTree</span>();</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">put</span><span class="params">(K key, V value)</span></span>;</span><br><span class="line"><span class="function">V <span class="title">get</span><span class="params">(K key)</span></span>;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">remove</span><span class="params">(K key)</span></span>;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">getSize</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function">K <span class="title">getMin</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function">K <span class="title">getMax</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">getDepth</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function">vector&lt;K&gt; <span class="title">ergodic</span><span class="params">(<span class="type">int</span> select)</span></span>; <span class="comment">//0 层序 先序1 中序2 后序3</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>源文件：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;BinaryTree.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">K</span>, <span class="keyword">class</span> <span class="title class_">V</span>&gt;</span><br><span class="line"><span class="keyword">typename</span> BinaryTree&lt;K, V&gt;::Node* BinaryTree&lt;K, V&gt;::<span class="built_in">put</span>(Node* node, K key, V value)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (node == <span class="literal">nullptr</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">this</span>-&gt;size++;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Node</span>(key, value, <span class="literal">nullptr</span>, <span class="literal">nullptr</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (node-&gt;key &gt; key) node-&gt;left = <span class="keyword">this</span>-&gt;<span class="built_in">put</span>(node-&gt;left, key, value);</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (node-&gt;key &lt; key) node-&gt;right = <span class="keyword">this</span>-&gt;<span class="built_in">put</span>(node-&gt;right, key, value);</span><br><span class="line"><span class="keyword">else</span> node-&gt;value = value;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> node;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">K</span>, <span class="keyword">class</span> <span class="title class_">V</span>&gt;</span><br><span class="line">V BinaryTree&lt;K, V&gt;::<span class="built_in">get</span>(Node* node, K key)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (node == <span class="literal">nullptr</span>) <span class="keyword">return</span> <span class="built_in">V</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (node-&gt;key &gt; key) <span class="keyword">return</span> <span class="keyword">this</span>-&gt;<span class="built_in">get</span>(node-&gt;left, key);</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (node-&gt;key &lt; key) <span class="keyword">return</span> <span class="keyword">this</span>-&gt;<span class="built_in">get</span>(node-&gt;right, key);</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">return</span> node-&gt;value;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="built_in">V</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">K</span>, <span class="keyword">class</span> <span class="title class_">V</span>&gt;</span><br><span class="line"><span class="keyword">typename</span> BinaryTree&lt;K, V&gt;::Node* BinaryTree&lt;K, V&gt;::<span class="built_in">remove</span>(Node* node, K key)</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//未找到key值</span></span><br><span class="line"><span class="keyword">if</span> (node == <span class="literal">nullptr</span>) <span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (node-&gt;key &gt; key) node-&gt;left = <span class="keyword">this</span>-&gt;<span class="built_in">remove</span>(node-&gt;left, key);</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (node-&gt;key &lt; key) node-&gt;right = <span class="keyword">this</span>-&gt;<span class="built_in">remove</span>(node-&gt;right, key);</span><br><span class="line"><span class="comment">// node-&gt;key == key情况</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//左子树为空的情况</span></span><br><span class="line"><span class="keyword">if</span> (node-&gt;left == <span class="literal">nullptr</span>)</span><br><span class="line">&#123;</span><br><span class="line">Node* temp = node-&gt;right;</span><br><span class="line"><span class="keyword">delete</span> node;</span><br><span class="line">node = temp;</span><br><span class="line"><span class="keyword">this</span>-&gt;size--;</span><br><span class="line">            <span class="keyword">return</span> node;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//右子树为空的情况</span></span><br><span class="line"><span class="keyword">if</span> (node-&gt;right == <span class="literal">nullptr</span>)</span><br><span class="line">&#123;</span><br><span class="line">Node* temp = node-&gt;left;</span><br><span class="line"><span class="keyword">delete</span> node;</span><br><span class="line">node = temp;</span><br><span class="line"><span class="keyword">this</span>-&gt;size--;</span><br><span class="line">            <span class="keyword">return</span> node;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//左右字树都不为空的情况</span></span><br><span class="line">Node* nodeLeft = node-&gt;left; <span class="comment">//要删除的节点的左子树</span></span><br><span class="line">Node* nodeRight = node-&gt;right; <span class="comment">//要删除的节点的左子树</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//循环，找到右子树的左节点的底节点e以及e的父节点p</span></span><br><span class="line">Node* p = node; <span class="comment">//初始化父节点为node</span></span><br><span class="line">Node* e = node-&gt;right; <span class="comment">//初始化底节点e为node的右节点</span></span><br><span class="line"><span class="keyword">while</span> (e-&gt;left != <span class="literal">nullptr</span>)</span><br><span class="line">&#123;</span><br><span class="line">p = e;</span><br><span class="line">e = e-&gt;left;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 如果node的右节点就是底节点e了</span></span><br><span class="line"><span class="keyword">if</span> (p == node)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">delete</span> node; <span class="comment">//将node节点销毁</span></span><br><span class="line">node = e; <span class="comment">//换成e节点</span></span><br><span class="line">node-&gt;left = nodeLeft; <span class="comment">//e节点(就是现在的node)的左子树为nodeLeft</span></span><br><span class="line"><span class="keyword">this</span>-&gt;size--; <span class="comment">//size-1</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 获取底层节点e，将e的父节点p左子树置空</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">p-&gt;left = <span class="literal">nullptr</span>; <span class="comment">//将父节点置空</span></span><br><span class="line"><span class="keyword">delete</span> node; <span class="comment">//将node节点销毁</span></span><br><span class="line">node = e; <span class="comment">//换成e节点</span></span><br><span class="line">node-&gt;left = nodeLeft; <span class="comment">//e节点(就是现在的node)的左子树为nodeLeft</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//e节点遍历右子树到底层节点temp</span></span><br><span class="line">Node* temp = node;</span><br><span class="line"><span class="keyword">while</span> (temp-&gt;right != <span class="literal">nullptr</span>)</span><br><span class="line">&#123;</span><br><span class="line">temp = temp-&gt;right;</span><br><span class="line">&#125;</span><br><span class="line">temp-&gt;right = nodeRight; <span class="comment">//temp的右子树为nodeRight</span></span><br><span class="line"><span class="keyword">this</span>-&gt;size--; <span class="comment">//size-1</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> node;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">K</span>, <span class="keyword">class</span> <span class="title class_">V</span>&gt;</span><br><span class="line"><span class="type">void</span> BinaryTree&lt;K, V&gt;::<span class="built_in">destroy</span>(Node* node)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (node == <span class="literal">nullptr</span>) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">this</span>-&gt;<span class="built_in">destroy</span>(node-&gt;left);</span><br><span class="line"><span class="keyword">this</span>-&gt;<span class="built_in">destroy</span>(node-&gt;right);</span><br><span class="line"></span><br><span class="line"><span class="keyword">delete</span> node;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">K</span>, <span class="keyword">class</span> <span class="title class_">V</span>&gt;</span><br><span class="line"><span class="keyword">typename</span> BinaryTree&lt;K, V&gt;::Node* BinaryTree&lt;K, V&gt;::<span class="built_in">min</span>(Node* node)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (node-&gt;left == <span class="literal">nullptr</span>) <span class="keyword">return</span> node;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="keyword">this</span>-&gt;<span class="built_in">min</span>(node-&gt;left);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">K</span>, <span class="keyword">class</span> <span class="title class_">V</span>&gt;</span><br><span class="line"><span class="keyword">typename</span> BinaryTree&lt;K, V&gt;::Node* BinaryTree&lt;K, V&gt;::<span class="built_in">max</span>(Node* node)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (node-&gt;right == <span class="literal">nullptr</span>) <span class="keyword">return</span> node;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="keyword">this</span>-&gt;<span class="built_in">max</span>(node-&gt;right);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">K</span>, <span class="keyword">class</span> <span class="title class_">V</span>&gt;</span><br><span class="line"><span class="type">int</span> BinaryTree&lt;K, V&gt;::<span class="built_in">depth</span>(Node* node)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (node == <span class="literal">nullptr</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> left = <span class="keyword">this</span>-&gt;<span class="built_in">depth</span>(node-&gt;left) + <span class="number">1</span>;</span><br><span class="line"><span class="type">int</span> right = <span class="keyword">this</span>-&gt;<span class="built_in">depth</span>(node-&gt;right) + <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (left &gt; right) <span class="keyword">return</span> left;</span><br><span class="line"><span class="keyword">return</span> right;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">K</span>, <span class="keyword">class</span> <span class="title class_">V</span>&gt;</span><br><span class="line"><span class="type">void</span> BinaryTree&lt;K, V&gt;::<span class="built_in">ergodic</span>(Node* node, vector&lt;K&gt;&amp; keys, <span class="type">int</span> select)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (node == <span class="literal">nullptr</span>) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (select == <span class="number">1</span>) keys.<span class="built_in">emplace_back</span>(node-&gt;key); <span class="comment">//先序的选择</span></span><br><span class="line"><span class="keyword">this</span>-&gt;<span class="built_in">ergodic</span>(node-&gt;left, keys, select);</span><br><span class="line"><span class="keyword">if</span> (select == <span class="number">2</span>) keys.<span class="built_in">emplace_back</span>(node-&gt;key); <span class="comment">//中序的选择</span></span><br><span class="line"><span class="keyword">this</span>-&gt;<span class="built_in">ergodic</span>(node-&gt;right, keys, select);</span><br><span class="line"><span class="keyword">if</span> (select == <span class="number">3</span>) keys.<span class="built_in">emplace_back</span>(node-&gt;key); <span class="comment">//后序的选择</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">K</span>, <span class="keyword">class</span> <span class="title class_">V</span>&gt;</span><br><span class="line"><span class="type">void</span> BinaryTree&lt;K, V&gt;::<span class="built_in">layerErgodic</span>(Node* node, vector&lt;K&gt;&amp; keys)</span><br><span class="line">&#123;</span><br><span class="line">queue&lt;Node*&gt; q;</span><br><span class="line">q.<span class="built_in">emplace</span>(node);</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (!q.<span class="built_in">empty</span>())</span><br><span class="line">&#123;</span><br><span class="line">Node* temp = q.<span class="built_in">front</span>();</span><br><span class="line">keys.<span class="built_in">emplace_back</span>(temp-&gt;key);</span><br><span class="line">q.<span class="built_in">pop</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (temp-&gt;left != <span class="literal">nullptr</span>) q.<span class="built_in">emplace</span>(temp-&gt;left);</span><br><span class="line"><span class="keyword">if</span> (temp-&gt;right != <span class="literal">nullptr</span>) q.<span class="built_in">emplace</span>(temp-&gt;right);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">K</span>, <span class="keyword">class</span> <span class="title class_">V</span>&gt;</span><br><span class="line">BinaryTree&lt;K, V&gt;::<span class="built_in">BinaryTree</span>()</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">this</span>-&gt;root = <span class="literal">nullptr</span>;</span><br><span class="line"><span class="keyword">this</span>-&gt;size = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">K</span>, <span class="keyword">class</span> <span class="title class_">V</span>&gt;</span><br><span class="line">BinaryTree&lt;K, V&gt;::~<span class="built_in">BinaryTree</span>()</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">this</span>-&gt;<span class="built_in">destroy</span>(<span class="keyword">this</span>-&gt;root);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">K</span>, <span class="keyword">class</span> <span class="title class_">V</span>&gt;</span><br><span class="line"><span class="type">void</span> BinaryTree&lt;K, V&gt;::<span class="built_in">put</span>(K key, V value)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">this</span>-&gt;root = <span class="keyword">this</span>-&gt;<span class="built_in">put</span>(<span class="keyword">this</span>-&gt;root, key, value);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">K</span>, <span class="keyword">class</span> <span class="title class_">V</span>&gt;</span><br><span class="line">V BinaryTree&lt;K, V&gt;::<span class="built_in">get</span>(K key)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">this</span>-&gt;<span class="built_in">get</span>(<span class="keyword">this</span>-&gt;root, key);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">K</span>, <span class="keyword">class</span> <span class="title class_">V</span>&gt;</span><br><span class="line"><span class="type">void</span> BinaryTree&lt;K, V&gt;::<span class="built_in">remove</span>(K key)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">this</span>-&gt;root = <span class="keyword">this</span>-&gt;<span class="built_in">remove</span>(<span class="keyword">this</span>-&gt;root, key);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">K</span>, <span class="keyword">class</span> <span class="title class_">V</span>&gt;</span><br><span class="line"><span class="type">int</span> BinaryTree&lt;K, V&gt;::<span class="built_in">getSize</span>()</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">this</span>-&gt;size;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">K</span>, <span class="keyword">class</span> <span class="title class_">V</span>&gt;</span><br><span class="line">K BinaryTree&lt;K, V&gt;::<span class="built_in">getMin</span>()</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">this</span>-&gt;<span class="built_in">min</span>(<span class="keyword">this</span>-&gt;root)-&gt;key;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">K</span>, <span class="keyword">class</span> <span class="title class_">V</span>&gt;</span><br><span class="line">K BinaryTree&lt;K, V&gt;::<span class="built_in">getMax</span>()</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">this</span>-&gt;<span class="built_in">max</span>(<span class="keyword">this</span>-&gt;root)-&gt;key;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">K</span>, <span class="keyword">class</span> <span class="title class_">V</span>&gt;</span><br><span class="line"><span class="type">int</span> BinaryTree&lt;K, V&gt;::<span class="built_in">getDepth</span>()</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">this</span>-&gt;<span class="built_in">depth</span>(<span class="keyword">this</span>-&gt;root);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">K</span>, <span class="keyword">class</span> <span class="title class_">V</span>&gt;</span><br><span class="line">vector&lt;K&gt; BinaryTree&lt;K, V&gt;::<span class="built_in">ergodic</span>(<span class="type">int</span> select)</span><br><span class="line">&#123;</span><br><span class="line">vector&lt;K&gt; keys;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (select == <span class="number">0</span>) <span class="keyword">this</span>-&gt;<span class="built_in">layerErgodic</span>(<span class="keyword">this</span>-&gt;root, keys); <span class="comment">//0 层序</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">this</span>-&gt;<span class="built_in">ergodic</span>(<span class="keyword">this</span>-&gt;root, keys, select);</span><br><span class="line"><span class="keyword">return</span> keys;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-2-红黑树"><a href="#3-2-红黑树" class="headerlink" title="3.2 红黑树"></a>3.2 红黑树</h3><p>红黑树含有黑红链接满足下列条件：</p><ol><li>红链接均为左链接</li><li>没有任何一个结点同时和两条红链接相连</li><li>该树是完美黑色平衡，即任意空链接到根节点的路径上的黑链接数量相同</li></ol><p>头文件：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;functional&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="comment">//默认为less&lt;&gt;为左小右大，可修改为greater&lt;&gt;左大右小</span></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">K</span>, <span class="keyword">class</span> <span class="title class_">V</span>, <span class="keyword">class</span> <span class="title class_">compare</span> = less&lt;K&gt;&gt;</span><br><span class="line"><span class="keyword">class</span> RedBlackTree</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line"><span class="keyword">class</span> Node</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">K key;</span><br><span class="line">V value;</span><br><span class="line">Node* left;</span><br><span class="line">Node* right;</span><br><span class="line"><span class="type">bool</span> color;</span><br><span class="line"><span class="built_in">Node</span>() &#123;&#125;</span><br><span class="line"><span class="built_in">Node</span>(K key, V value, Node* left, Node* right, <span class="type">bool</span> color)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">this</span>-&gt;key = key;</span><br><span class="line"><span class="keyword">this</span>-&gt;value = value;</span><br><span class="line"><span class="keyword">this</span>-&gt;left = left;</span><br><span class="line"><span class="keyword">this</span>-&gt;right = right;</span><br><span class="line"><span class="keyword">this</span>-&gt;color = color;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line">Node* root;</span><br><span class="line"><span class="type">int</span> size;</span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">bool</span> RED = <span class="literal">true</span>;</span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">bool</span> BLACK = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">isRed</span><span class="params">(Node* node)</span></span>;</span><br><span class="line"><span class="function">Node* <span class="title">rotateLeft</span><span class="params">(Node* node)</span></span>;</span><br><span class="line"><span class="function">Node* <span class="title">rotateRight</span><span class="params">(Node* node)</span></span>;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">flipColors</span><span class="params">(Node* node)</span></span>;                    <span class="comment">//颜色反转</span></span><br><span class="line"><span class="function">Node* <span class="title">put</span><span class="params">(Node* node, K key, V value)</span></span>;</span><br><span class="line"><span class="function">V <span class="title">get</span><span class="params">(Node* node, K key)</span></span>;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">destroy</span><span class="params">(Node* node)</span></span>;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="built_in">RedBlackTree</span>();</span><br><span class="line">~<span class="built_in">RedBlackTree</span>();</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">put</span><span class="params">(K key, V value)</span></span>;</span><br><span class="line"><span class="function">V <span class="title">get</span><span class="params">(K key)</span></span>;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">getSize</span><span class="params">()</span></span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>源文件：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;RedBlackTree.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">K</span>, <span class="keyword">class</span> <span class="title class_">V</span>, <span class="keyword">class</span> <span class="title class_">compare</span>&gt;</span><br><span class="line"><span class="type">bool</span> RedBlackTree&lt;K, V, compare&gt;::<span class="built_in">isRed</span>(Node* node)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (node == <span class="literal">nullptr</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">return</span> node-&gt;color == <span class="keyword">this</span>-&gt;RED;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">K</span>, <span class="keyword">class</span> <span class="title class_">V</span>, <span class="keyword">class</span> <span class="title class_">compare</span>&gt;</span><br><span class="line"><span class="keyword">typename</span> RedBlackTree&lt;K, V, compare&gt;::Node* RedBlackTree&lt;K, V, compare&gt;::<span class="built_in">rotateLeft</span>(Node* node)</span><br><span class="line">&#123;</span><br><span class="line">Node* r = node-&gt;right;     <span class="comment">//获取node的右节点r</span></span><br><span class="line">node-&gt;right = r-&gt;left;       <span class="comment">//将node的右节点指向之前的右节点r的左节点</span></span><br><span class="line">r-&gt;left = node;                <span class="comment">//将右节点r的左节点指向node</span></span><br><span class="line">r-&gt;color = node-&gt;color;</span><br><span class="line">node-&gt;color = <span class="keyword">this</span>-&gt;RED;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> r;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">K</span>, <span class="keyword">class</span> <span class="title class_">V</span>, <span class="keyword">class</span> <span class="title class_">compare</span>&gt;</span><br><span class="line"><span class="keyword">typename</span> RedBlackTree&lt;K, V, compare&gt;::Node* RedBlackTree&lt;K, V, compare&gt;::<span class="built_in">rotateRight</span>(Node* node)</span><br><span class="line">&#123;</span><br><span class="line">Node* l = node-&gt;left;</span><br><span class="line">node-&gt;left = l-&gt;right;</span><br><span class="line">l-&gt;right = node;</span><br><span class="line">l-&gt;color = node-&gt;color;</span><br><span class="line">node-&gt;color = <span class="keyword">this</span>-&gt;RED;</span><br><span class="line"><span class="keyword">return</span> l;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">K</span>, <span class="keyword">class</span> <span class="title class_">V</span>, <span class="keyword">class</span> <span class="title class_">compare</span>&gt;</span><br><span class="line"><span class="type">void</span> RedBlackTree&lt;K, V, compare&gt;::<span class="built_in">flipColors</span>(Node* node)</span><br><span class="line">&#123;</span><br><span class="line">node-&gt;color = <span class="keyword">this</span>-&gt;RED;</span><br><span class="line">node-&gt;left-&gt;color = <span class="keyword">this</span>-&gt;BLACK;</span><br><span class="line">node-&gt;right-&gt;color = <span class="keyword">this</span>-&gt;BLACK;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">K</span>, <span class="keyword">class</span> <span class="title class_">V</span>, <span class="keyword">class</span> <span class="title class_">compare</span>&gt;</span><br><span class="line"><span class="keyword">typename</span> RedBlackTree&lt;K, V, compare&gt;::Node* RedBlackTree&lt;K, V, compare&gt;::<span class="built_in">put</span>(Node* node, K key, V value)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (node == <span class="literal">nullptr</span>) &#123;</span><br><span class="line"><span class="keyword">this</span>-&gt;size++;</span><br><span class="line">Node* newNode = <span class="keyword">new</span> <span class="built_in">Node</span>(key, value, <span class="literal">nullptr</span>, <span class="literal">nullptr</span>, RED);</span><br><span class="line"><span class="keyword">return</span> newNode;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">compare</span>()(key, node-&gt;key)) node-&gt;left = <span class="keyword">this</span>-&gt;<span class="built_in">put</span>(node-&gt;left, key, value);</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">compare</span>()(node-&gt;key, key)) node-&gt;right = <span class="keyword">this</span>-&gt;<span class="built_in">put</span>(node-&gt;right, key, value);</span><br><span class="line"><span class="keyword">else</span> node-&gt;value = value;</span><br><span class="line"><span class="comment">//左旋</span></span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">isRed</span>(node-&gt;right) &amp;&amp; !<span class="built_in">isRed</span>(node-&gt;left)) node = <span class="keyword">this</span>-&gt;<span class="built_in">rotateLeft</span>(node);</span><br><span class="line"><span class="comment">//右旋</span></span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">isRed</span>(node-&gt;left) &amp;&amp; <span class="built_in">isRed</span>(node-&gt;left-&gt;left)) node = <span class="keyword">this</span>-&gt;<span class="built_in">rotateRight</span>(node);</span><br><span class="line"><span class="comment">//颜色反转</span></span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">isRed</span>(node-&gt;left) &amp;&amp; <span class="built_in">isRed</span>(node-&gt;right)) <span class="keyword">this</span>-&gt;<span class="built_in">flipColors</span>(node);</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> node;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">K</span>, <span class="keyword">class</span> <span class="title class_">V</span>, <span class="keyword">class</span> <span class="title class_">compare</span>&gt;</span><br><span class="line">V RedBlackTree&lt;K, V, compare&gt;::<span class="built_in">get</span>(Node* node, K key)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (node == <span class="literal">nullptr</span>) <span class="keyword">return</span> <span class="built_in">V</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">compare</span>()(key, node-&gt;key)) <span class="keyword">return</span> <span class="keyword">this</span>-&gt;<span class="built_in">get</span>(node-&gt;left, key);</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">compare</span>()(node-&gt;key, key)) <span class="keyword">return</span> <span class="keyword">this</span>-&gt;<span class="built_in">get</span>(node-&gt;right, key);</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">return</span> node-&gt;value;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="built_in">V</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">K</span>, <span class="keyword">class</span> <span class="title class_">V</span>, <span class="keyword">class</span> <span class="title class_">compare</span>&gt;</span><br><span class="line"><span class="type">void</span> RedBlackTree&lt;K, V, compare&gt;::<span class="built_in">destroy</span>(Node* node)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (node == <span class="literal">nullptr</span>) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">this</span>-&gt;<span class="built_in">destroy</span>(node-&gt;left);</span><br><span class="line"><span class="keyword">this</span>-&gt;<span class="built_in">destroy</span>(node-&gt;right);</span><br><span class="line"></span><br><span class="line"><span class="keyword">delete</span> node;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">K</span>, <span class="keyword">class</span> <span class="title class_">V</span>, <span class="keyword">class</span> <span class="title class_">compare</span>&gt;</span><br><span class="line">RedBlackTree&lt;K, V, compare&gt;::<span class="built_in">RedBlackTree</span>()</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">this</span>-&gt;size = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">this</span>-&gt;root = <span class="literal">nullptr</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">K</span>, <span class="keyword">class</span> <span class="title class_">V</span>, <span class="keyword">class</span> <span class="title class_">compare</span>&gt;</span><br><span class="line">RedBlackTree&lt;K, V, compare&gt;::~<span class="built_in">RedBlackTree</span>()</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">this</span>-&gt;<span class="built_in">destroy</span>(<span class="keyword">this</span>-&gt;root);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">K</span>, <span class="keyword">class</span> <span class="title class_">V</span>, <span class="keyword">class</span> <span class="title class_">compare</span>&gt;</span><br><span class="line"><span class="type">void</span> RedBlackTree&lt;K, V, compare&gt;::<span class="built_in">put</span>(K key, V value)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">this</span>-&gt;root = <span class="keyword">this</span>-&gt;<span class="built_in">put</span>(<span class="keyword">this</span>-&gt;root, key, value);</span><br><span class="line"><span class="keyword">this</span>-&gt;root-&gt;color = <span class="keyword">this</span>-&gt;BLACK;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">K</span>, <span class="keyword">class</span> <span class="title class_">V</span>, <span class="keyword">class</span> <span class="title class_">compare</span>&gt;</span><br><span class="line">V RedBlackTree&lt;K, V, compare&gt;::<span class="built_in">get</span>(K key)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">this</span>-&gt;<span class="built_in">get</span>(<span class="keyword">this</span>-&gt;root, key);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">K</span>, <span class="keyword">class</span> <span class="title class_">V</span>, <span class="keyword">class</span> <span class="title class_">compare</span>&gt;</span><br><span class="line"> <span class="type">int</span> RedBlackTree&lt;K, V, compare&gt;::<span class="built_in">getSize</span>()</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">this</span>-&gt;size;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-3-并查集"><a href="#3-3-并查集" class="headerlink" title="3.3 并查集"></a>3.3 并查集</h3><p>头文件：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UF_Tree_Weighted</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line"><span class="type">int</span>* array;</span><br><span class="line"><span class="type">int</span>* size;</span><br><span class="line"><span class="type">int</span> count;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="built_in">UF_Tree_Weighted</span>(<span class="type">int</span> capacity);</span><br><span class="line">~<span class="built_in">UF_Tree_Weighted</span>();</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">getCount</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">connected</span><span class="params">(<span class="type">int</span> p, <span class="type">int</span> q)</span></span>;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">find</span><span class="params">(<span class="type">int</span> p)</span></span>;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">merge</span><span class="params">(<span class="type">int</span> p, <span class="type">int</span> q)</span></span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>源文件：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;UF_Tree_Weighted.h&quot;</span></span></span><br><span class="line"></span><br><span class="line">UF_Tree_Weighted::<span class="built_in">UF_Tree_Weighted</span>(<span class="type">int</span> capacity)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">this</span>-&gt;array = <span class="keyword">new</span> <span class="type">int</span>[capacity];</span><br><span class="line">    <span class="keyword">this</span>-&gt;size = <span class="keyword">new</span> <span class="type">int</span>[capacity];</span><br><span class="line">    <span class="keyword">this</span>-&gt;count = capacity;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="keyword">this</span>-&gt;count; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">this</span>-&gt;array[i] = i;</span><br><span class="line">        <span class="keyword">this</span>-&gt;size[i] = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">UF_Tree_Weighted::~<span class="built_in">UF_Tree_Weighted</span>()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>-&gt;array != <span class="literal">nullptr</span>) &#123;</span><br><span class="line">        <span class="keyword">delete</span>[] array;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">UF_Tree_Weighted::getCount</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>-&gt;count;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">UF_Tree_Weighted::connected</span><span class="params">(<span class="type">int</span> p, <span class="type">int</span> q)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">find</span>(p) == <span class="built_in">find</span>(q);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">UF_Tree_Weighted::find</span><span class="params">(<span class="type">int</span> p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>-&gt;array[p] == p) <span class="keyword">return</span> p;</span><br><span class="line">        p = <span class="keyword">this</span>-&gt;array[p];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">UF_Tree_Weighted::merge</span><span class="params">(<span class="type">int</span> p, <span class="type">int</span> q)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> pRoot = <span class="keyword">this</span>-&gt;<span class="built_in">find</span>(p);</span><br><span class="line">    <span class="type">int</span> qRoot = <span class="keyword">this</span>-&gt;<span class="built_in">find</span>(q);</span><br><span class="line">    <span class="keyword">if</span> (pRoot == qRoot) <span class="keyword">return</span>;</span><br><span class="line">    <span class="comment">//判断哪个结点长，哪个就当根节点</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>-&gt;size[pRoot] &lt; <span class="keyword">this</span>-&gt;size[qRoot]) &#123;</span><br><span class="line">        <span class="comment">//让p的根节点指向q的根节点</span></span><br><span class="line">        <span class="keyword">this</span>-&gt;array[pRoot] = qRoot;</span><br><span class="line">        <span class="keyword">this</span>-&gt;size[qRoot] += <span class="keyword">this</span>-&gt;size[pRoot];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">this</span>-&gt;array[qRoot] = pRoot;</span><br><span class="line">        <span class="keyword">this</span>-&gt;size[pRoot] += <span class="keyword">this</span>-&gt;size[qRoot];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">this</span>-&gt;count--;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="4-堆"><a href="#4-堆" class="headerlink" title="4.堆"></a>4.堆</h2><h3 id="4-1-堆-完全二叉树"><a href="#4-1-堆-完全二叉树" class="headerlink" title="4.1 堆(完全二叉树)"></a>4.1 堆(完全二叉树)</h3><p>堆是用数组完成数据元素的存储(0位置被废止了)</p><p>如果一个节点的位置为<code>k</code>，那么它的父节点的位置为<code>k/2</code>，而它的子节点的位置为<code>2k</code>和<code>2k+1</code></p><p>并且每个节点都要大于它的子节点之和，但是这两个子节点的顺序位置没有要求</p><p>头文件：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;functional&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="comment">//默认less&lt;&gt;为小堆顶，使用可修改为greater&lt;&gt;为大堆顶</span></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>, <span class="keyword">class</span> <span class="title class_">compare</span> = less&lt;T&gt;&gt;</span><br><span class="line"><span class="keyword">class</span> Heap</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">T* arrayList;</span><br><span class="line"><span class="type">int</span> size;</span><br><span class="line"><span class="type">int</span> capacity;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">less</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> j)</span></span>;    <span class="comment">//判断i位置的元素是否小于j位置的元素</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">exch</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> j)</span></span>;   <span class="comment">//交换i位置与j位置的元素</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">swim</span><span class="params">(<span class="type">int</span> pos)</span></span>;     <span class="comment">//使用上浮算法，使pos位置的元素能处于正确位置</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">sink</span><span class="params">(<span class="type">int</span> pos)</span></span>;      <span class="comment">//使用下浮算法，使pos位置的元素能处于正确位置</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">resize</span><span class="params">(<span class="type">int</span> newCapacity)</span></span>;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="built_in">Heap</span>();</span><br><span class="line"><span class="built_in">Heap</span>(<span class="type">int</span> capacity);</span><br><span class="line">~<span class="built_in">Heap</span>();</span><br><span class="line"><span class="function">T <span class="title">delMax</span><span class="params">()</span></span>;               <span class="comment">//删除堆中最大的元素，并返回该元素</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">insert</span><span class="params">(T val)</span></span>;       <span class="comment">//插入一个元素</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>源文件：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Heap.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>, <span class="keyword">class</span> <span class="title class_">compare</span>&gt;</span><br><span class="line"><span class="type">bool</span> Heap&lt;T, compare&gt;::<span class="built_in">less</span>(<span class="type">int</span> i, <span class="type">int</span> j)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">compare</span>()(<span class="keyword">this</span>-&gt;arrayList[i], <span class="keyword">this</span>-&gt;arrayList[j]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>, <span class="keyword">class</span> <span class="title class_">compare</span>&gt;</span><br><span class="line"><span class="type">void</span> Heap&lt;T, compare&gt;::<span class="built_in">exch</span>(<span class="type">int</span> i, <span class="type">int</span> j)</span><br><span class="line">&#123;</span><br><span class="line">T temp = <span class="keyword">this</span>-&gt;arrayList[i];</span><br><span class="line"><span class="keyword">this</span>-&gt;arrayList[i] = <span class="keyword">this</span>-&gt;arrayList[j];</span><br><span class="line"><span class="keyword">this</span>-&gt;arrayList[j] = temp;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>, <span class="keyword">class</span> <span class="title class_">compare</span>&gt;</span><br><span class="line"><span class="type">void</span> Heap&lt;T, compare&gt;::<span class="built_in">swim</span>(<span class="type">int</span> pos)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">while</span> (pos &gt; <span class="number">1</span> &amp;&amp; <span class="keyword">this</span>-&gt;<span class="built_in">less</span>(pos, <span class="built_in">int</span>(pos / <span class="number">2</span>)))</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">this</span>-&gt;<span class="built_in">exch</span>(<span class="built_in">int</span>(pos / <span class="number">2</span>), pos);</span><br><span class="line">pos = <span class="built_in">int</span>(pos / <span class="number">2</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>, <span class="keyword">class</span> <span class="title class_">compare</span>&gt;</span><br><span class="line"><span class="type">void</span> Heap&lt;T, compare&gt;::<span class="built_in">sink</span>(<span class="type">int</span> pos)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">while</span> (<span class="number">2</span> * pos &lt;= <span class="keyword">this</span>-&gt;size)</span><br><span class="line">&#123;</span><br><span class="line"><span class="type">int</span> min;</span><br><span class="line"><span class="comment">// 如果存在右节点，判断两个子节点哪个最小</span></span><br><span class="line"><span class="keyword">if</span> (<span class="number">2</span> * pos + <span class="number">1</span> &lt;= <span class="keyword">this</span>-&gt;size)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">this</span>-&gt;<span class="built_in">less</span>(<span class="number">2</span> * pos + <span class="number">1</span>, <span class="number">2</span> * pos)) min = <span class="number">2</span> * pos + <span class="number">1</span>;</span><br><span class="line"><span class="keyword">else</span> min = <span class="number">2</span> * pos;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 只有左节点</span></span><br><span class="line"><span class="keyword">else</span> min = <span class="number">2</span> * pos;</span><br><span class="line"><span class="comment">// 父节点pos小于最小的子节点，不需要继续下浮了</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">this</span>-&gt;<span class="built_in">less</span>(pos, min)) <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">this</span>-&gt;<span class="built_in">exch</span>(pos, min); <span class="comment">//交换</span></span><br><span class="line">pos = min;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>, <span class="keyword">class</span> <span class="title class_">compare</span>&gt;</span><br><span class="line"><span class="type">void</span> Heap&lt;T, compare&gt;::<span class="built_in">resize</span>(<span class="type">int</span> newCapacity)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">this</span>-&gt;capacity = newCapacity;</span><br><span class="line">T* temp = <span class="keyword">new</span> T[<span class="keyword">this</span>-&gt;capacity + <span class="number">1</span>];</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= <span class="keyword">this</span>-&gt;size; i++)</span><br><span class="line">&#123;</span><br><span class="line">temp[i] = <span class="keyword">this</span>-&gt;arrayList[i];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">delete</span>[] <span class="keyword">this</span>-&gt;arrayList;</span><br><span class="line"><span class="keyword">this</span>-&gt;arrayList = temp;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>, <span class="keyword">class</span> <span class="title class_">compare</span>&gt;</span><br><span class="line">Heap&lt;T, compare&gt;::<span class="built_in">Heap</span>()</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">this</span>-&gt;capacity = <span class="number">5</span>;</span><br><span class="line"><span class="keyword">this</span>-&gt;arrayList = <span class="keyword">new</span> T[<span class="keyword">this</span>-&gt;capacity + <span class="number">1</span>];</span><br><span class="line"><span class="keyword">this</span>-&gt;size = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>, <span class="keyword">class</span> <span class="title class_">compare</span>&gt;</span><br><span class="line">Heap&lt;T, compare&gt;::<span class="built_in">Heap</span>(<span class="type">int</span> capacity)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">this</span>-&gt;capacity = capacity;</span><br><span class="line"><span class="keyword">this</span>-&gt;arrayList = <span class="keyword">new</span> T[<span class="keyword">this</span>-&gt;capacity + <span class="number">1</span>];</span><br><span class="line"><span class="keyword">this</span>-&gt;size = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>, <span class="keyword">class</span> <span class="title class_">compare</span>&gt;</span><br><span class="line">Heap&lt;T, compare&gt;::~<span class="built_in">Heap</span>()</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">this</span>-&gt;arrayList != <span class="literal">nullptr</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">delete</span>[] <span class="keyword">this</span>-&gt;arrayList;</span><br><span class="line"><span class="keyword">this</span>-&gt;arrayList = <span class="literal">nullptr</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>, <span class="keyword">class</span> <span class="title class_">compare</span>&gt;</span><br><span class="line">T Heap&lt;T, compare&gt;::<span class="built_in">delMax</span>()</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">this</span>-&gt;size == <span class="number">0</span>) <span class="keyword">return</span> <span class="built_in">T</span>();</span><br><span class="line"></span><br><span class="line">T val = <span class="keyword">this</span>-&gt;arrayList[<span class="number">1</span>];</span><br><span class="line"><span class="keyword">this</span>-&gt;<span class="built_in">exch</span>(<span class="number">1</span>, <span class="keyword">this</span>-&gt;size);</span><br><span class="line"><span class="keyword">this</span>-&gt;size--;</span><br><span class="line"></span><br><span class="line"><span class="keyword">this</span>-&gt;<span class="built_in">sink</span>(<span class="number">1</span>); <span class="comment">//下沉算法</span></span><br><span class="line"><span class="keyword">return</span> val;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>, <span class="keyword">class</span> <span class="title class_">compare</span>&gt;</span><br><span class="line"><span class="type">void</span> Heap&lt;T, compare&gt;::<span class="built_in">insert</span>(T val)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">this</span>-&gt;size == <span class="keyword">this</span>-&gt;capacity) </span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">this</span>-&gt;<span class="built_in">resize</span>(<span class="keyword">this</span>-&gt;capacity * <span class="number">2</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//不用0位置</span></span><br><span class="line"><span class="keyword">this</span>-&gt;arrayList[<span class="keyword">this</span>-&gt;size + <span class="number">1</span>] = val;</span><br><span class="line"><span class="keyword">this</span>-&gt;size++;</span><br><span class="line"></span><br><span class="line"><span class="keyword">this</span>-&gt;<span class="built_in">swim</span>(<span class="keyword">this</span>-&gt;size); <span class="comment">//上浮算法</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="5-优先队列"><a href="#5-优先队列" class="headerlink" title="5.优先队列"></a>5.优先队列</h2><h3 id="5-1-优先队列-堆实现"><a href="#5-1-优先队列-堆实现" class="headerlink" title="5.1 优先队列(堆实现)"></a>5.1 优先队列(堆实现)</h3><p>头文件：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;functional&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="comment">//默认为greater&lt;&gt;最大优先队列，可修改为less&lt;&gt;为最小优先队列</span></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>, <span class="keyword">class</span> <span class="title class_">compare</span> = greater&lt;T&gt;&gt;</span><br><span class="line"><span class="keyword">class</span> PriorityQueue</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">T* arrayList;</span><br><span class="line"><span class="type">int</span> size;</span><br><span class="line"><span class="type">int</span> capacity;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">less</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> j)</span></span>;    <span class="comment">//判断i位置的元素是否小于j位置的元素</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">exch</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> j)</span></span>;   <span class="comment">//交换i位置与j位置的元素</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">swim</span><span class="params">(<span class="type">int</span> pos)</span></span>;     <span class="comment">//使用上浮算法，使pos位置的元素能处于正确位置</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">sink</span><span class="params">(<span class="type">int</span> pos)</span></span>;      <span class="comment">//使用下浮算法，使pos位置的元素能处于正确位置</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">resize</span><span class="params">(<span class="type">int</span> newCapacity)</span></span>;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="built_in">PriorityQueue</span>();</span><br><span class="line"><span class="built_in">PriorityQueue</span>(<span class="type">int</span> capacity);</span><br><span class="line">~<span class="built_in">PriorityQueue</span>();</span><br><span class="line"><span class="function">T <span class="title">delMax</span><span class="params">()</span></span>;               <span class="comment">//删除堆中最大的元素，并返回该元素</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">insert</span><span class="params">(T val)</span></span>;       <span class="comment">//插入一个元素</span></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">getSize</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">isEmpty</span><span class="params">()</span></span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>源文件：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;PriorityQueue.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>, <span class="keyword">class</span> <span class="title class_">compare</span>&gt;</span><br><span class="line"><span class="type">bool</span> PriorityQueue&lt;T, compare&gt;::<span class="built_in">less</span>(<span class="type">int</span> i, <span class="type">int</span> j)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">compare</span>()(<span class="keyword">this</span>-&gt;arrayList[i], <span class="keyword">this</span>-&gt;arrayList[j]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>, <span class="keyword">class</span> <span class="title class_">compare</span>&gt;</span><br><span class="line"><span class="type">void</span> PriorityQueue&lt;T, compare&gt;::<span class="built_in">exch</span>(<span class="type">int</span> i, <span class="type">int</span> j)</span><br><span class="line">&#123;</span><br><span class="line">T temp = <span class="keyword">this</span>-&gt;arrayList[i];</span><br><span class="line"><span class="keyword">this</span>-&gt;arrayList[i] = <span class="keyword">this</span>-&gt;arrayList[j];</span><br><span class="line"><span class="keyword">this</span>-&gt;arrayList[j] = temp;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>, <span class="keyword">class</span> <span class="title class_">compare</span>&gt;</span><br><span class="line"><span class="type">void</span> PriorityQueue&lt;T, compare&gt;::<span class="built_in">swim</span>(<span class="type">int</span> pos)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">while</span> (pos &gt; <span class="number">1</span> &amp;&amp; <span class="keyword">this</span>-&gt;<span class="built_in">less</span>(pos, <span class="built_in">int</span>(pos / <span class="number">2</span>)))</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">this</span>-&gt;<span class="built_in">exch</span>(<span class="built_in">int</span>(pos / <span class="number">2</span>), pos);</span><br><span class="line">pos = <span class="built_in">int</span>(pos / <span class="number">2</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>, <span class="keyword">class</span> <span class="title class_">compare</span>&gt;</span><br><span class="line"><span class="type">void</span> PriorityQueue&lt;T, compare&gt;::<span class="built_in">sink</span>(<span class="type">int</span> pos)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">while</span> (<span class="number">2</span> * pos &lt;= <span class="keyword">this</span>-&gt;size)</span><br><span class="line">&#123;</span><br><span class="line"><span class="type">int</span> max;</span><br><span class="line"><span class="comment">// 如果存在右节点，判断两个子节点哪个最大</span></span><br><span class="line"><span class="keyword">if</span> (<span class="number">2</span> * pos + <span class="number">1</span> &lt;= <span class="keyword">this</span>-&gt;size)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">this</span>-&gt;<span class="built_in">less</span>(<span class="number">2</span> * pos + <span class="number">1</span>, <span class="number">2</span> * pos)) max = <span class="number">2</span> * pos + <span class="number">1</span>;</span><br><span class="line"><span class="keyword">else</span> max = <span class="number">2</span> * pos;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 只有左节点</span></span><br><span class="line"><span class="keyword">else</span> max = <span class="number">2</span> * pos;</span><br><span class="line"><span class="comment">// 父节点pos大于最大的子节点，不需要继续下浮了</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">this</span>-&gt;<span class="built_in">less</span>(pos, max)) <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">this</span>-&gt;<span class="built_in">exch</span>(pos, max); <span class="comment">//交换</span></span><br><span class="line">pos = max;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>, <span class="keyword">class</span> <span class="title class_">compare</span>&gt;</span><br><span class="line"><span class="type">void</span> PriorityQueue&lt;T, compare&gt;::<span class="built_in">resize</span>(<span class="type">int</span> newCapacity)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">this</span>-&gt;capacity = newCapacity;</span><br><span class="line">T* temp = <span class="keyword">new</span> T[<span class="keyword">this</span>-&gt;capacity + <span class="number">1</span>];</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= <span class="keyword">this</span>-&gt;size; i++)</span><br><span class="line">&#123;</span><br><span class="line">temp[i] = <span class="keyword">this</span>-&gt;arrayList[i];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">delete</span>[] <span class="keyword">this</span>-&gt;arrayList;</span><br><span class="line"><span class="keyword">this</span>-&gt;arrayList = temp;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>, <span class="keyword">class</span> <span class="title class_">compare</span>&gt;</span><br><span class="line">PriorityQueue&lt;T, compare&gt;::<span class="built_in">PriorityQueue</span>()</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">this</span>-&gt;capacity = <span class="number">5</span>;</span><br><span class="line"><span class="keyword">this</span>-&gt;arrayList = <span class="keyword">new</span> T[<span class="keyword">this</span>-&gt;capacity + <span class="number">1</span>];</span><br><span class="line"><span class="keyword">this</span>-&gt;size = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>, <span class="keyword">class</span> <span class="title class_">compare</span>&gt;</span><br><span class="line">PriorityQueue&lt;T, compare&gt;::<span class="built_in">PriorityQueue</span>(<span class="type">int</span> capacity)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">this</span>-&gt;capacity = capacity;</span><br><span class="line"><span class="keyword">this</span>-&gt;arrayList = <span class="keyword">new</span> T[<span class="keyword">this</span>-&gt;capacity + <span class="number">1</span>];</span><br><span class="line"><span class="keyword">this</span>-&gt;size = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>, <span class="keyword">class</span> <span class="title class_">compare</span>&gt;</span><br><span class="line">PriorityQueue&lt;T, compare&gt;::~<span class="built_in">PriorityQueue</span>()</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">this</span>-&gt;arrayList != <span class="literal">nullptr</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">delete</span>[] <span class="keyword">this</span>-&gt;arrayList;</span><br><span class="line"><span class="keyword">this</span>-&gt;arrayList = <span class="literal">nullptr</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>, <span class="keyword">class</span> <span class="title class_">compare</span>&gt;</span><br><span class="line">T PriorityQueue&lt;T, compare&gt;::<span class="built_in">delMax</span>()</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">this</span>-&gt;size == <span class="number">0</span>) <span class="keyword">return</span> <span class="built_in">T</span>();</span><br><span class="line"></span><br><span class="line">T val = <span class="keyword">this</span>-&gt;arrayList[<span class="number">1</span>];</span><br><span class="line"><span class="keyword">this</span>-&gt;<span class="built_in">exch</span>(<span class="number">1</span>, <span class="keyword">this</span>-&gt;size);</span><br><span class="line"><span class="keyword">this</span>-&gt;size--;</span><br><span class="line"></span><br><span class="line"><span class="keyword">this</span>-&gt;<span class="built_in">sink</span>(<span class="number">1</span>); <span class="comment">//下沉算法</span></span><br><span class="line"><span class="keyword">return</span> val;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>, <span class="keyword">class</span> <span class="title class_">compare</span>&gt;</span><br><span class="line"><span class="type">void</span> PriorityQueue&lt;T, compare&gt;::<span class="built_in">insert</span>(T val)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">this</span>-&gt;size == <span class="keyword">this</span>-&gt;capacity)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">this</span>-&gt;<span class="built_in">resize</span>(<span class="keyword">this</span>-&gt;capacity * <span class="number">2</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//不用0位置</span></span><br><span class="line"><span class="keyword">this</span>-&gt;arrayList[<span class="keyword">this</span>-&gt;size + <span class="number">1</span>] = val;</span><br><span class="line"><span class="keyword">this</span>-&gt;size++;</span><br><span class="line"></span><br><span class="line"><span class="keyword">this</span>-&gt;<span class="built_in">swim</span>(<span class="keyword">this</span>-&gt;size); <span class="comment">//上浮算法</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>, <span class="keyword">class</span> <span class="title class_">compare</span>&gt;</span><br><span class="line"><span class="type">int</span> PriorityQueue&lt;T, compare&gt;::<span class="built_in">getSize</span>()</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">this</span>-&gt;size;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>, <span class="keyword">class</span> <span class="title class_">compare</span>&gt;</span><br><span class="line"><span class="type">bool</span> PriorityQueue&lt;T, compare&gt;::<span class="built_in">isEmpty</span>()</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">this</span>-&gt;size == <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5-2-索引优先队列"><a href="#5-2-索引优先队列" class="headerlink" title="5.2 索引优先队列"></a>5.2 索引优先队列</h3><p>头文件：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure><p>源文件：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="6-图"><a href="#6-图" class="headerlink" title="6.图"></a>6.图</h2><h3 id="6-1-无向图-邻接表"><a href="#6-1-无向图-邻接表" class="headerlink" title="6.1 无向图(邻接表)"></a>6.1 无向图(邻接表)</h3><p>头文件：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Graph</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line"><span class="type">int</span> V;</span><br><span class="line"><span class="type">int</span> E;</span><br><span class="line">vector&lt;<span class="type">int</span>&gt;* adj;</span><br><span class="line"><span class="type">int</span> start;</span><br><span class="line"><span class="type">int</span>* edgeTo;</span><br><span class="line"><span class="type">bool</span>* visited;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> v, <span class="type">bool</span>* marked, vector&lt;<span class="type">int</span>&gt;&amp; visit)</span></span>;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">bfs</span><span class="params">(<span class="type">int</span> v, <span class="type">bool</span>* marked, vector&lt;<span class="type">int</span>&gt;&amp; visit)</span></span>;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfsSeek</span><span class="params">(<span class="type">int</span> s, <span class="type">bool</span>* visited)</span></span>;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="built_in">Graph</span>(<span class="type">int</span> v);</span><br><span class="line">~<span class="built_in">Graph</span>();</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">getV</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">getE</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">addEdge</span><span class="params">(<span class="type">int</span> v, <span class="type">int</span> w)</span></span>;</span><br><span class="line"><span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">get</span><span class="params">(<span class="type">int</span> v)</span></span>;</span><br><span class="line"><span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">dfs</span><span class="params">(<span class="type">int</span> v)</span></span>;</span><br><span class="line"><span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">bfs</span><span class="params">(<span class="type">int</span> v)</span></span>;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">isPath</span><span class="params">(<span class="type">int</span> start, <span class="type">int</span> end)</span></span>;</span><br><span class="line"><span class="function">stack&lt;<span class="type">int</span>&gt; <span class="title">getPath</span><span class="params">(<span class="type">int</span> start, <span class="type">int</span> end)</span></span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>源文件：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Graph.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Graph::dfs</span><span class="params">(<span class="type">int</span> v, <span class="type">bool</span>* marked, vector&lt;<span class="type">int</span>&gt;&amp; visit)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">marked[v] = <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">auto</span>&amp; w : <span class="keyword">this</span>-&gt;adj[v])</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (marked[w])</span><br><span class="line">&#123;</span><br><span class="line">visit.<span class="built_in">emplace_back</span>(w);</span><br><span class="line"><span class="keyword">this</span>-&gt;<span class="built_in">dfs</span>(w, marked, visit);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Graph::bfs</span><span class="params">(<span class="type">int</span> v, <span class="type">bool</span>* marked, vector&lt;<span class="type">int</span>&gt;&amp; visit)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">queue&lt;<span class="type">int</span>&gt; q;</span><br><span class="line">marked[v] = <span class="literal">false</span>;</span><br><span class="line">q.<span class="built_in">emplace</span>(v);</span><br><span class="line"><span class="keyword">while</span> (!q.<span class="built_in">empty</span>())</span><br><span class="line">&#123;</span><br><span class="line"><span class="type">int</span> temp = q.<span class="built_in">front</span>();</span><br><span class="line">q.<span class="built_in">pop</span>();</span><br><span class="line">visit.<span class="built_in">emplace_back</span>(temp);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">auto</span>&amp; w : <span class="keyword">this</span>-&gt;adj[v])</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (marked[w])</span><br><span class="line">&#123;</span><br><span class="line">marked[w] = <span class="literal">false</span>;</span><br><span class="line">q.<span class="built_in">emplace</span>(w);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Graph::dfsSeek</span><span class="params">(<span class="type">int</span> s, <span class="type">bool</span>* visited)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">visited[s] = <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">auto</span>&amp; w : <span class="keyword">this</span>-&gt;adj[s])</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (visited[w])</span><br><span class="line">&#123;</span><br><span class="line">edgeTo[w] = s;</span><br><span class="line"><span class="keyword">this</span>-&gt;<span class="built_in">dfsSeek</span>(w, visited);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Graph::<span class="built_in">Graph</span>(<span class="type">int</span> v)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">this</span>-&gt;V = v;</span><br><span class="line"><span class="keyword">this</span>-&gt;E = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">this</span>-&gt;start = <span class="number">-1</span>;</span><br><span class="line"><span class="keyword">this</span>-&gt;edgeTo = <span class="keyword">new</span> <span class="type">int</span>[v];</span><br><span class="line"><span class="keyword">this</span>-&gt;visited = <span class="keyword">new</span> <span class="type">bool</span>[v];</span><br><span class="line"><span class="keyword">this</span>-&gt;adj = <span class="keyword">new</span> vector&lt;<span class="type">int</span>&gt;[v];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Graph::~<span class="built_in">Graph</span>()</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">this</span>-&gt;adj != <span class="literal">nullptr</span>)</span><br><span class="line"><span class="keyword">delete</span>[] <span class="keyword">this</span>-&gt;adj;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">this</span>-&gt;edgeTo != <span class="literal">nullptr</span>)</span><br><span class="line"><span class="keyword">delete</span>[] <span class="keyword">this</span>-&gt;edgeTo;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">this</span>-&gt;visited != <span class="literal">nullptr</span>)</span><br><span class="line"><span class="keyword">delete</span>[] <span class="keyword">this</span>-&gt;visited;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Graph::getV</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>-&gt;V;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Graph::getE</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>-&gt;E;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Graph::addEdge</span><span class="params">(<span class="type">int</span> v, <span class="type">int</span> w)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">this</span>-&gt;adj[v].<span class="built_in">emplace_back</span>(w);</span><br><span class="line"><span class="keyword">this</span>-&gt;adj[w].<span class="built_in">emplace_back</span>(v);</span><br><span class="line"><span class="keyword">this</span>-&gt;E++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">Graph::get</span><span class="params">(<span class="type">int</span> v)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">this</span>-&gt;adj[v];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">Graph::dfs</span><span class="params">(<span class="type">int</span> v)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">vector&lt;<span class="type">int</span>&gt; visit;</span><br><span class="line"><span class="type">bool</span>* marked = <span class="keyword">new</span> <span class="type">bool</span>[<span class="keyword">this</span>-&gt;<span class="built_in">getV</span>()];</span><br><span class="line"><span class="keyword">this</span>-&gt;<span class="built_in">dfs</span>(v, marked, visit);</span><br><span class="line"><span class="keyword">delete</span>[] marked;</span><br><span class="line"><span class="keyword">return</span> visit;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">Graph::bfs</span><span class="params">(<span class="type">int</span> v)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">vector&lt;<span class="type">int</span>&gt; visit;</span><br><span class="line"><span class="type">bool</span>* marked = <span class="keyword">new</span> <span class="type">bool</span>[<span class="keyword">this</span>-&gt;<span class="built_in">getV</span>()];</span><br><span class="line"><span class="keyword">this</span>-&gt;<span class="built_in">bfs</span>(v, marked, visit);</span><br><span class="line"><span class="keyword">delete</span>[] marked;</span><br><span class="line"><span class="keyword">return</span> visit;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">Graph::isPath</span><span class="params">(<span class="type">int</span> start, <span class="type">int</span> end)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">this</span>-&gt;start != start)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">delete</span>[] visited;</span><br><span class="line"><span class="keyword">this</span>-&gt;visited = <span class="keyword">new</span> <span class="type">bool</span>[<span class="keyword">this</span>-&gt;<span class="built_in">getV</span>()];</span><br><span class="line"><span class="keyword">this</span>-&gt;start = start;</span><br><span class="line"><span class="keyword">this</span>-&gt;<span class="built_in">dfsSeek</span>(<span class="keyword">this</span>-&gt;start, visited);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> !visited[end];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">stack&lt;<span class="type">int</span>&gt; <span class="title">Graph::getPath</span><span class="params">(<span class="type">int</span> start, <span class="type">int</span> end)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span>(<span class="built_in">isPath</span>(start, end))</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">stack</span>&lt;<span class="type">int</span>&gt;();</span><br><span class="line">stack&lt;<span class="type">int</span>&gt; s;</span><br><span class="line">s.<span class="built_in">emplace</span>(end);</span><br><span class="line"><span class="type">int</span> temp = end;</span><br><span class="line"><span class="keyword">while</span> (temp != start)</span><br><span class="line">&#123;</span><br><span class="line">temp = <span class="keyword">this</span>-&gt;edgeTo[temp];</span><br><span class="line">s.<span class="built_in">emplace</span>(temp);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> s;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="6-2-有向图"><a href="#6-2-有向图" class="headerlink" title="6.2 有向图"></a>6.2 有向图</h3><p>头文件：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Digraph</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line"><span class="type">int</span> V;</span><br><span class="line"><span class="type">int</span> E;</span><br><span class="line">vector&lt;<span class="type">int</span>&gt;* adj;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfsIsCycle</span><span class="params">(<span class="type">int</span> v, <span class="type">bool</span>* marked, <span class="type">bool</span>* toStack, <span class="type">bool</span>&amp; isCycle)</span></span>;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfsSort</span><span class="params">(<span class="type">int</span> v, <span class="type">bool</span>* marked, stack&lt;<span class="type">int</span>&gt;&amp; s)</span></span>;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">reversePost</span><span class="params">(stack&lt;<span class="type">int</span>&gt;&amp; s)</span></span>;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="built_in">Digraph</span>(<span class="type">int</span> v);</span><br><span class="line">~<span class="built_in">Digraph</span>();</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">getV</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">getE</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">addEdge</span><span class="params">(<span class="type">int</span> v, <span class="type">int</span> w)</span></span>;</span><br><span class="line"><span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">get</span><span class="params">(<span class="type">int</span> v)</span></span>;</span><br><span class="line"><span class="function">Digraph <span class="title">reverse</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">isCycle</span><span class="params">()</span></span>;       <span class="comment">//是否有环</span></span><br><span class="line"><span class="function">stack&lt;<span class="type">int</span>&gt; <span class="title">order</span><span class="params">()</span></span>; <span class="comment">//拓扑排序</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>源文件：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Digraph.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Digraph::dfsIsCycle</span><span class="params">(<span class="type">int</span> v, <span class="type">bool</span>* marked, <span class="type">bool</span>* toStack, <span class="type">bool</span>&amp; isCycle)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">marked[v] = <span class="literal">false</span>; <span class="comment">//将此点标记为已经遍历过了</span></span><br><span class="line">toStack[v] = <span class="literal">false</span>; <span class="comment">//第一次标记此点</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">auto</span>&amp; w : <span class="keyword">this</span>-&gt;adj[v])</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//如果没遍历过此点，则遍历</span></span><br><span class="line"><span class="keyword">if</span> (marked[w])</span><br><span class="line"><span class="keyword">this</span>-&gt;<span class="built_in">dfsIsCycle</span>(w, marked, toStack, isCycle);</span><br><span class="line"><span class="comment">//如果遍历过了此点，又出现了，说明此点存在环</span></span><br><span class="line"><span class="keyword">if</span> (!toStack[w]) </span><br><span class="line">&#123;</span><br><span class="line">isCycle = <span class="literal">true</span>;</span><br><span class="line"><span class="keyword">return</span>; <span class="comment">//直接退出，无需继续遍历了</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//遍历完成，说明此点不存在环，将此点取消标记</span></span><br><span class="line"><span class="comment">//只有不存在环，才会运行到这里，并且结束递归时toStack又恢复到原来状态了</span></span><br><span class="line">toStack[v] = <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Digraph::dfsSort</span><span class="params">(<span class="type">int</span> v, <span class="type">bool</span>* marked, stack&lt;<span class="type">int</span>&gt;&amp; s)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">marked[v] = <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">auto</span>&amp; w : <span class="keyword">this</span>-&gt;adj[v])</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (marked[w])</span><br><span class="line"><span class="keyword">this</span>-&gt;<span class="built_in">dfsSort</span>(w, marked, s);</span><br><span class="line">&#125;</span><br><span class="line">s.<span class="built_in">emplace</span>(v);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Digraph::reversePost</span><span class="params">(stack&lt;<span class="type">int</span>&gt;&amp; s)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">bool</span>* marked = <span class="keyword">new</span> <span class="type">bool</span>[<span class="keyword">this</span>-&gt;<span class="built_in">getV</span>()];</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> v = <span class="number">0</span>; v &lt; <span class="keyword">this</span>-&gt;<span class="built_in">getV</span>(); v++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (marked[v])</span><br><span class="line"><span class="keyword">this</span>-&gt;<span class="built_in">dfsSort</span>(v, marked, s);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">delete</span>[] marked;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Digraph::<span class="built_in">Digraph</span>(<span class="type">int</span> v)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">this</span>-&gt;V = v;</span><br><span class="line"><span class="keyword">this</span>-&gt;E = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">this</span>-&gt;adj = <span class="keyword">new</span> vector&lt;<span class="type">int</span>&gt;[v];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Digraph::~<span class="built_in">Digraph</span>()</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">this</span>-&gt;adj != <span class="literal">nullptr</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">delete</span>[] <span class="keyword">this</span>-&gt;adj;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Digraph::getV</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>-&gt;V;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Digraph::getE</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>-&gt;E;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Digraph::addEdge</span><span class="params">(<span class="type">int</span> v, <span class="type">int</span> w)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">this</span>-&gt;adj[v].<span class="built_in">emplace_back</span>(w);</span><br><span class="line"><span class="keyword">this</span>-&gt;E++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">Digraph::get</span><span class="params">(<span class="type">int</span> v)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">this</span>-&gt;adj[v];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">Digraph <span class="title">Digraph::reverse</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="function">Digraph <span class="title">newDigraph</span><span class="params">(<span class="keyword">this</span>-&gt;getV())</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> v = <span class="number">0</span>; v &lt; <span class="keyword">this</span>-&gt;<span class="built_in">getV</span>(); v++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">auto</span>&amp; w : <span class="keyword">this</span>-&gt;adj[v])</span><br><span class="line">&#123;</span><br><span class="line">newDigraph.<span class="built_in">addEdge</span>(w, v);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> newDigraph;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">Digraph::isCycle</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">bool</span> isCycle = <span class="literal">false</span>;</span><br><span class="line"><span class="type">bool</span>* marked = <span class="keyword">new</span> <span class="type">bool</span>[<span class="keyword">this</span>-&gt;<span class="built_in">getV</span>()];</span><br><span class="line"><span class="type">bool</span>* toStack = <span class="keyword">new</span> <span class="type">bool</span>[<span class="keyword">this</span>-&gt;<span class="built_in">getV</span>()];</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> v = <span class="number">0</span>; v &lt; <span class="keyword">this</span>-&gt;<span class="built_in">getV</span>(); v++) </span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span> (marked[v]) </span><br><span class="line"><span class="keyword">this</span>-&gt;<span class="built_in">dfsIsCycle</span>(v, marked, toStack, isCycle);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">delete</span>[] marked, toStack;</span><br><span class="line"><span class="keyword">return</span> isCycle;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">stack&lt;<span class="type">int</span>&gt; <span class="title">Digraph::order</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">this</span>-&gt;<span class="built_in">isCycle</span>())</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">stack</span>&lt;<span class="type">int</span>&gt;();</span><br><span class="line">stack&lt;<span class="type">int</span>&gt; s;</span><br><span class="line"><span class="keyword">this</span>-&gt;<span class="built_in">reversePost</span>(s);</span><br><span class="line"><span class="keyword">return</span> s;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="6-3-加权无向图"><a href="#6-3-加权无向图" class="headerlink" title="6.3 加权无向图"></a>6.3 加权无向图</h3></div>]]></content>
      
      
      <categories>
          
          <category> 计算机4件套 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据结构 </tag>
            
            <tag> c++ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>操作系统的学习笔记</title>
      <link href="/2022/08/06/%E8%AE%A1%E7%AE%97%E6%9C%BA4%E4%BB%B6%E5%A5%97/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/"/>
      <url>/2022/08/06/%E8%AE%A1%E7%AE%97%E6%9C%BA4%E4%BB%B6%E5%A5%97/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/</url>
      
        <content type="html"><![CDATA[<h1 id="一、操作系统概述"><a href="#一、操作系统概述" class="headerlink" title="一、操作系统概述"></a>一、操作系统概述</h1><h3 id="1-1-特征"><a href="#1-1-特征" class="headerlink" title="1.1 特征"></a>1.1 特征</h3><p>操作系统的特征：</p><ul><li><p><span style="color:red">并发</span>：指两个多个事件在同一时间间隔内发生</p><p>这些事件<span style="color:red">宏观上是同时发生</span>的，但<span style="color:red">微观上是交替发生</span>的</p><p><span style="color:red">并行</span>：指两个或多个事件在同一时刻同时发生</p><p><strong>操作系统的并发性</strong>指计算机系统中同时存在着多个运行着的程序。</p><p>单核CPU同一时刻只能执行一个程序，因此操作系统会负责协调<span style="color:red">多个程序交替执行</span>，但在宏观上看多个程序在<span style="color:red">同时执行</span></p><p>操作系统是伴随着”多道程序技术”而出现的，因此，操作系统和程序并发是一起诞生的</p><p>如今一般都是多核CPU，比如一个4核的CPU，同一时刻可以有<span style="color:red">4个程序并行执行</span>，但是<span style="color:red">操作系统的并发性依然必不可少</span>，因为不可能只运行4个程序</p></li><li><p><span style="color:red">共享</span>：即资源共享，是指系统中的资源可供内存中多个并发程序执行的进程共同使用</p><p>资源共享的方式：</p><ul><li><p>互斥共享方式：系统中的某些资源，虽然可以提供给多个进程使用，但是<span style="color:red">一段时间内只允许一个进程访问该资源</span></p><p>示例：使用QQ和微信视频，<strong>同一时间内摄像头只能分配给其中一个进程</strong></p></li><li><p>同时共享方式：系统中的某些资源，允许一个时间段由<span style="color:red">多个进程”同时”对它们进行访问</span></p><p>其中所谓”同时”，是在宏观上，而微观上，这些进程可能是<strong>交替地对该资源进行访问</strong></p><p>示例：使用QQ发送文件A，同时使用微信发送文件B。<strong>从宏观上，两边都在同时读取并发送文件，从微观上，两个进程在交替着访问硬盘</strong></p></li></ul></li><li><p><span style="color:red">虚拟</span>：是指把一个<span style="color:red">物理上的实体</span>变为若干<span style="color:red">逻辑上的对应物</span>。<span style="color:red">物理实体</span>实际存在的，而<span style="color:red">逻辑上对应物</span>是用户感受到的</p><p>一个程序需要放入内存并分配给CPU才能执行</p><p>一个电脑内存4GB，GTA5运行需要4GB，QQ运行需要256MB，但是还是可以此电脑上运行。</p><p>这是因为使用了<strong>虚拟存储器技术</strong>，虚拟技术中的<span style="color:red">“空分复用技术”</span></p><p>在单核CPU的计算机中，打开多个的软件，依旧能运行，实际上只有一个单核CPU，但是用户认为有多个CPU在为自己服务。</p><p>这是运用了<strong>虚拟处理器技术</strong>中的<span style="color:red">“时分复用技术”</span>，微观上处理机在各个微小的时间段内<strong>交替着为各个进程服务</strong></p><p>虚拟技术：</p><ul><li><p>空分复用技术</p></li><li><p>时分复用技术</p><p>如果失去并发性一段时间只能运行一个程序，则失去了虚拟性的意义(没有并发就谈不上虚拟性)</p></li></ul></li><li><p><span style="color:red">异步</span>：在多道程序环境下，允许多个程序并发执行，但由于资源有限，进程的执行不是一贯到底的。而是走走停停的，已不可预知的速度向前推进，这就是进程的异步。</p><p>只有系统拥有并发性，才有可能导致异步性</p></li></ul><p>并发与共享的关系：</p><ul><li>如果失去并发性，则共享性失去存在意义(不需要两个进程交替着访问硬盘了)</li><li>如果失去共享性，则无法并发(QQ与微信无法同时读取硬盘资源)</li><li>并发性与共线性<strong>互为存在条件</strong></li></ul><p><strong>没有并发和共享，就没有虚拟和异步，因此并发和共享是操作系统的两个最基本的特征</strong></p><h3 id="1-2-发展与分类"><a href="#1-2-发展与分类" class="headerlink" title="1.2 发展与分类"></a>1.2 发展与分类</h3><p>发展：</p><ol><li><p>手工操作阶段</p><p>主要缺点：用户独占全机，人机速度矛盾导致资源利用率极低</p></li><li><p>批处理阶段</p><ol><li><p>单道批处理系统</p><p>引入<strong>脱机输入&#x2F;输出技术</strong>(用磁带完成)，并<strong>监督程序</strong>(操作系统的雏形)负责控制作业的输入、输出</p><p>主要优点：缓解了一定程度的人机速度矛盾，资源利用率有所提升。</p><p>主要缺点：内存中<strong>仅能有一道程序运行</strong>，只有该程序运行结束后才会进入下一道程序。CPU有大量的时间是在空闲<strong>等待IO完成</strong>，资源利用率依然很低</p><img src="C:\Users\26919\AppData\Roaming\Typora\typora-user-images\image-20220917092729299.png" class="lazyload" data-srcset="C:\Users\26919\AppData\Roaming\Typora\typora-user-images\image-20220917092729299.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220917092729299" style="zoom: 50%;" /></li><li><p>多道批处理系统</p><p>主要优点：多道程序<strong>并发</strong>执行，<strong>共享</strong>计算加资源。<strong>资源利用率</strong>大幅提升，CPU和其他资源保持”忙碌”状态，系统吞吐量增大</p><p>主要缺点：用户响应时间长，没有<strong>人机交互功能</strong>(用户提交作业后只能等待计算机处理完成，中间不能控制自己的作业执行)</p><img src="C:\Users\26919\AppData\Roaming\Typora\typora-user-images\image-20220917092823353.png" class="lazyload" data-srcset="C:\Users\26919\AppData\Roaming\Typora\typora-user-images\image-20220917092823353.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220917092823353" style="zoom:67%;" /></li></ol></li><li><p>分时操作系统：计算机以<strong>时间片</strong>为单位<span style="color:red">轮流为各个用户&#x2F;作业服务</span>，各个用户可通过终端与计算机进行交互</p><p>主要优点：用户请求可以被即时响应，<span style="color:red">解决了人机交互问题</span>，允许多个用户同时使用一台计算机，并且用户对计算机的操作相互独立，感受不到别人的存在</p><p>主要缺点：<span style="color:red">不能优先处理一些紧急任务</span>，操作系统对各个用户&#x2F;作业完全公平，不区分任务的紧急性</p></li><li><p>实时操作系统</p><p>主要优点：能够<span style="color:red">优先响应一些紧急任务</span> ，某些紧急任务不需要时间片排队</p><p>在实时操作系统的控制下，计算机接收到信号后及时处理，并且在严格的时间内限时完成任务，实时操作系统的主要特点是：<span style="color:red">及时性和可靠性</span></p><ul><li>硬实时系统：必须在绝对严格的规定时间内完成处理</li><li>软实时系统：能接受偶尔违反时间规定</li></ul></li></ol><p>其他几种操作系统：</p><ul><li>网络操作系统：能够把网络中各个计算机有机的结合起来，实现数据传送等功能，实现网络中的各种资源的共享和各个计算机之间的通信</li><li>分布式操作系统：主要特点是分布式与并行性，任何工作都可以分布在这些计算机上，由它们并行、协同完成这个任务</li><li>个人计算机操作系统：如Windows、MacOS等</li></ul><h3 id="1-3-运行机制与体系结构"><a href="#1-3-运行机制与体系结构" class="headerlink" title="1.3 运行机制与体系结构"></a>1.3 运行机制与体系结构</h3><p><strong>运行机制</strong>：</p><ul><li><p>指令：处理器能够识别、执行的最基本命令</p><ul><li>特权指令：如内存清零指令(不允许用户程序使用)</li><li>非特权指令：如普通的运算指令</li></ul></li><li><p>判断是否可以执行特权指令可以通过<span style="color:red">两种处理器状态</span>：</p><ul><li>用户态(目态)：此时CPU只能执行非特权指令</li><li>核心态(管态)：特权和非特权都可以执行</li></ul><p>用程序状态寄存器(PSW)来标识当前处理器处于什么状态。如0为用户态，1为核心态</p></li><li><p>两种程序：</p><ul><li>内核程序：操作系统的内核程序是系统发管理者，运行在核心态</li><li>应用程序：为了保证系统的安全运行，普通应用程序只能运行在用户态</li></ul></li></ul><p><strong>操作系统内核</strong>又细分为：非内核功能和内核</p><ul><li>内核：计算机上配置的底层软件，是操作系统最基本、最核心的部分<ul><li>对系统资源进行管理功能(有的操作系统<strong>不会</strong>把这部分功能当作内核功能)：<ul><li>进程管理、存储器管理、设备管理等功能</li></ul></li><li>时钟管理：实现计时功能</li><li>中断处理：负责实现中断机制</li><li>原语(设备驱动、CPU切换等)<ul><li>一种特殊的程序。</li><li>是最接近硬件的部分，</li><li>这种程序的运行具有原子性(要么不执行，要么一直执行到结束)</li></ul></li></ul></li></ul><p><strong>操作系统的体系结构</strong>：大内核和微内核</p><ul><li><p>大内核：将操作系统的主要功能模块都作为系统内核，运行在核心态</p><p>优点：高性能</p><p>缺点：内核代码庞大、结构混乱、难以维护</p></li><li><p>微内核：只把最基本的功能保留在内核</p><p>优点：内核功能少、结构清晰、方便维护</p><p>缺点：需要频繁地在核心态和用户态之间切换、性能低</p></li></ul><h3 id="1-4-中断与异常"><a href="#1-4-中断与异常" class="headerlink" title="1.4 中断与异常"></a>1.4 中断与异常</h3><p>中断：</p><ul><li>当中断发生时，CPU立即进入核心态</li><li>当中断发生后，当前运行的进程暂停运行，并由操作系统内核对中断进行处理</li><li>对于不同的中断信号，会进行不同的处理</li></ul><p>发生了中断，就意味着需要操作系统介入，开展管理工作。由于操作系统的管理工作(比如进程切换、分配IO设备等)需要使用特权指令，因此CPU要从用户态转换为核心态。</p><p><span style="color:red">中断可以使CPU从用户态切换为核心态</span>，使用操作系统获得计算机的控制权。有了中断，才能实现多道程序并发执行</p><p>用户态与核心态的转换：</p><ul><li><p>用户态-&gt;核心态：通过<strong>中断实现</strong>的，并且只能是中断</p></li><li><p>核心态-&gt;用户态：通过<strong>执行一个特权指令</strong>，将程序状态标志设置为用户态</p></li></ul><p>中断的分类：</p><p>内中断：</p><p>外中断：</p><h1 id="二、进程与线程"><a href="#二、进程与线程" class="headerlink" title="二、进程与线程"></a>二、进程与线程</h1><p>OS中进程作为资源分配与独立运行的基本单位出现。OS的四大特征(并发、共享、虚拟、异步)都是基于进程而形成的。所以在OS中，进程是一个及其重要的概念</p><p>到了80年代中期，又出现了比进程更小的基本单位——线程。用来提高程序并发执行程度，以进一步改善系统的服务质量。现代OS无一例外的引入了线程，线程也是一个重要的概念</p><h3 id="2-1-进程的描述"><a href="#2-1-进程的描述" class="headerlink" title="2.1 进程的描述"></a>2.1 进程的描述</h3><h4 id="进程控制块PCB"><a href="#进程控制块PCB" class="headerlink" title="进程控制块PCB"></a>进程控制块PCB</h4><ul><li><p>为了方便控制和管理参与并发执行的每个程序的独立运行，在操作系统中为之配置一种专门的数据结构，称为进程控制块：PCB(Process Control Block)。</p></li><li><p>系统利用PCB来描述进程的基本信息与活动过程，进而控制和管理程。</p></li><li><p><span style="color:red">PCB、程序段、数据段</span>三部分构成了<span style="color:red">进程实体(进程映像)</span>，也叫<span style="color:red">进程</span></p></li></ul><h4 id="PCB在进程切换的作用"><a href="#PCB在进程切换的作用" class="headerlink" title="PCB在进程切换的作用"></a>PCB在进程切换的作用</h4><p>操作系统就是根据PCB来感知进程的存在的。</p><p>PCB在进程切换过程中起着非常重要的作用，操作系统可以通过对PCB的修改来达到对进程的控制。</p><img src="C:\Users\26919\AppData\Roaming\Typora\typora-user-images\image-20220919102403455.png" class="lazyload" data-srcset="C:\Users\26919\AppData\Roaming\Typora\typora-user-images\image-20220919102403455.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220919102403455" style="zoom:67%;" /><p>以下是PCB结构体的部分描述属性：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">task_struct</span> &#123;</span></span><br><span class="line"><span class="type">long</span> state;              <span class="comment">// 进程运行状态：-1不可运行，0可运行，&gt;0已停止</span></span><br><span class="line"><span class="type">long</span> priority;           <span class="comment">// 进程运行优先级</span></span><br><span class="line"><span class="type">long</span> counter;   <span class="comment">// 已运行时间计数器</span></span><br><span class="line"><span class="type">long</span> exit_code;  <span class="comment">// 进程停止执行后退出码，其父进程需要读取</span></span><br><span class="line"><span class="type">unsigned</span> <span class="type">long</span> start_code;   <span class="comment">// 代码段起始地址</span></span><br><span class="line"><span class="type">unsigned</span> <span class="type">long</span> end_code;  <span class="comment">// 代码段长度，单位字节</span></span><br><span class="line"><span class="type">unsigned</span> <span class="type">long</span> next_code;    <span class="comment">// 下一条要执行代码的地址</span></span><br><span class="line"><span class="type">unsigned</span> <span class="type">long</span> start_data;   <span class="comment">// 数据段起始地址</span></span><br><span class="line"><span class="type">unsigned</span> <span class="type">long</span> end_data;     <span class="comment">// 代码段长度+数据段长度，单位字节</span></span><br><span class="line"><span class="type">unsigned</span> <span class="type">long</span> next_data;    <span class="comment">// 下一条要读取数据的地址</span></span><br><span class="line"><span class="type">long</span> pid; <span class="comment">// 进程标识</span></span><br><span class="line"><span class="type">long</span> father; <span class="comment">// 父进程标识</span></span><br><span class="line">...</span><br><span class="line">&#125;；</span><br></pre></td></tr></table></figure><h4 id="进程定义"><a href="#进程定义" class="headerlink" title="进程定义"></a>进程定义</h4><blockquote><p>从不同的角度，进程可以有不同的定义，比较传统典型的定义有：</p><ol><li>进程是程序的一次<strong>执行的过程</strong></li><li>进程是一个程序以及数据在处理顺序执行时所<strong>发生的活动</strong></li><li>进程是具有独立功能的程序在数据集合上的<strong>运行的过程</strong>，它是系统进行资源分配和调度的一个独立单位</li></ol><p>这3个定义都强调了**”动态性”**</p><p>引入进程实体的概念后，可以把<strong>进程定义</strong>为：</p><ul><li>进程是<span style="color:red">进程实体的运行程序</span>，是系统进行<span style="color:red">资源分配和调度</span>的一个独立单位</li></ul><p>注意：严格来说，<strong>进程实体</strong>和<strong>进程</strong>并不一样，进程实体是<span style="color:red">静态的</span>，进程则是<span style="color:red">动态的</span>。不过，除非题目刻意考察二者区别，否则是可以认为<strong>进程就是进程实体</strong></p></blockquote><p>引入进程后使得作业的并发执行得以实现，</p><p>同时也带来了一些问题：</p><ul><li>增加了空间开销<ul><li>需要为进程创建PCB</li></ul></li><li>增加了时间开销<ul><li>管理、协调、跟踪进程的执行需要时间 </li><li>创建、更新、回收PCB需要时间 </li><li>进程切换、保护、恢复CPU现场需要时间</li></ul></li><li>增加了控制难度<ul><li>协调多个进程对资源的竞争与共享增加了控制难度 </li><li>对可能由进程引发的异常进行处理增加了控制难度</li></ul></li></ul><h3 id="2-2-进程状态"><a href="#2-2-进程状态" class="headerlink" title="2.2 进程状态"></a>2.2 进程状态</h3><h4 id="五种状态"><a href="#五种状态" class="headerlink" title="五种状态"></a>五种状态</h4><p>根据进程所拥有资源的不同，可以将进程所处的状态划分为五种状态：</p><ul><li>就绪状态：进程已经获取到了除处理器之外执行所需的所有资源的状态。 </li><li>执行状态：进程已经获取到了包括处理器在内的执行所需的所有资源的状态。 </li><li>阻塞状态：进程在执行过程中因等待某事件的发生而无法继续执行的状态。 </li><li>创建状态：进程缺少完整PCB与运行所需资源的状态。</li><li>终止状态：进程释放所拥有资源的过程的状态。</li></ul><p>其中，就绪状态、执行状态、阻塞状态，称为进程的基本状态</p><h4 id="状态转换"><a href="#状态转换" class="headerlink" title="状态转换"></a>状态转换</h4><pre class="mermaid">flowchart LRA(创建状态)B(就绪状态)C(执行状态)D(阻塞状态)E(终止状态)A--资源分配-->B--获得CPU-->C--请求I/O-->DD--I/O完成-->BC--释放CPU-->BC--释放PCB-->E</pre><p>状态转换的特点： </p><ul><li><strong>创建</strong>好的进程直接到达的是<strong>就绪态</strong> </li><li><strong>就绪态</strong>进程无法直接转换为<strong>阻塞态</strong> </li><li><strong>阻塞态</strong>只能是进程执行过程中由于等待某事件的发生而引发的 </li><li>进程只能是在<strong>执行</strong>时<strong>终止</strong></li></ul><h4 id="挂起与激活"><a href="#挂起与激活" class="headerlink" title="挂起与激活"></a>挂起与激活</h4><h4 id="PCB的组织方式"><a href="#PCB的组织方式" class="headerlink" title="PCB的组织方式"></a>PCB的组织方式</h4><p>不同应用可以产生很多异类进程，一个应用可以产生很多同类进程。无论是何类进程，其会按照它们的 状态将它们组织到一起。</p><p>常见的组织方式有两种： </p><ul><li>链表方式：<strong>同一状态的进程的PCB组成一个链表</strong>，所以多种状态的进程PCB组成多个链表。此时就会产生诸如就绪链表、阻塞链表等不同链表。 </li><li>索引表方式：<strong>所有PCB都放入同一链表</strong>，再为<strong>每种状态创建出不同的PCB索引链表</strong>，其中存放的就是该状态的所有PCB的索引</li></ul><p>粗俗的理解就是，无论就绪队列，还是阻塞队列中的元素就是PCB</p><img src="C:\Users\26919\AppData\Roaming\Typora\typora-user-images\image-20220919183526346.png" class="lazyload" data-srcset="C:\Users\26919\AppData\Roaming\Typora\typora-user-images\image-20220919183526346.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220919183526346" style="zoom:67%;" /><h3 id="2-3-进程控制"><a href="#2-3-进程控制" class="headerlink" title="2.3 进程控制"></a>2.3 进程控制</h3><p>进程控制是进程管理中最基本的功能。如，进程的创建与终止、进程状态转换等。进程控制一般是由 OS内核中的原语实现的。</p><p>进程控制就是实现进程状态的转换。</p><h4 id="进程的创建"><a href="#进程的创建" class="headerlink" title="进程的创建"></a>进程的创建</h4><p>无论是OS内核创建进程，还是用户进程创建子进程，都是调用了进程创建原语完成的。</p><p><strong>进程创建过程</strong></p><p><strong>进程创建原语</strong>的创建过程如下：</p><ul><li>生成进程标识符PID<ul><li>这是一个数字标识符，用于区分系统中的所有进程，在系统中具有唯一 性。</li></ul></li><li>申请空白PCB。</li><li>为进程分配其运行所需的一切资源（除CPU外）<ul><li>这些资源要么从OS直接获得，要么从父进程获 得。</li></ul></li><li>初始化PCB。<ul><li>这些初始化信息包括自己的PID及父进程的PID，当前处理器的状态数据，进程的状态数据。</li></ul></li><li>将进程写入就绪队列 (创建态-&gt;就绪态)</li></ul><p><strong>进程创建事件</strong></p><p>一个进程可以由系统内核创建，也可以由另一个进程创建。发生进程创建的典型事件有三类： </p><ul><li>用户登录：在分时系统中，用户登录后，系统内核会为该用户创建一个进程。 </li><li>作业调度：在多道批处理系统中，当作业调度程序调度到某作业后，会将其装入内存，并由系统 内核为该作业创建一个进程。 </li><li>提供服务：当某进程在运行过程中提出某种请求后，系统内核或主进程将会创建一个相应的子进程来处理该请求，以使主进程与子进程可以并发执行。<ul><li>例如，用户进程提交了一个文件打印请求后，系统内核会创建一个打印进程来处理该请求。</li></ul></li><li>应用请求：由用户主动请求创建一个子进程</li></ul><h4 id="进程的终止"><a href="#进程的终止" class="headerlink" title="进程的终止"></a>进程的终止</h4><p><strong>进程终止过程</strong> </p><p>系统中发生进程终止事件，OS就会调用进程终止原语去终止进程。</p><p><strong>进程终止原语</strong>的终止过程如下： </p><ul><li><p>根据被终止进程的PID，找出其PCB。 </p></li><li><p>从PCB中读取其状态，若该进程处于执行态，则立即终止其执行，并置调度标志为真，用于标志该进程可被重新调度。 </p></li><li><p>从PCB中读取其子进程PID，若该进程还有子进程，则要将其所有子进程全部终止。 </p></li><li><p>从PCB中读取其所拥有的全部资源，并全部释放，归还给其父进程或系统。 </p><p>这个资源释放的过程主要包含两步： </p><ul><li>将其PCB赋值为null </li><li>在其父进程或系统的资源数量上增加相应释放的数量。</li></ul></li><li><p>将该进程的PCB从PCB队列或链表中移出。 </p></li><li><p>释放该PCB空间。</p></li></ul><p>进程终止事件 </p><p>引起进程终止的事件典型的有三类： </p><ul><li><p>正常结束：进程的任务正常执行完毕后的进程终止。当进程的任务执行完毕后，进程会发出一条终止指令，此时会产生一个中断，以通知OS进程马上终止。 </p></li><li><p>异常结束：进程在运行过程中发生了某种异常事件，导致进程无法继续运行。 </p><p>常见的异常事件有： </p><ul><li>访问越界 </li><li>非法指令 </li><li>权限异常</li><li>运行超时 </li><li>等待超时 </li><li>运算异常 </li><li>IO异常</li></ul></li><li><p>外界干预：进程被外界干预终止。</p><p>外界干预主要指三方面：</p><ul><li>用户直接终止</li><li>OS终止</li><li>父进程终止</li></ul></li></ul><h4 id="进程的堵塞与唤醒"><a href="#进程的堵塞与唤醒" class="headerlink" title="进程的堵塞与唤醒"></a>进程的堵塞与唤醒</h4><p><strong>进程阻塞</strong></p><p>阻塞是进程自身的一种主动行为。当系统中发生进程阻塞事件后，进程自己会调用进程阻塞原语将自 己阻塞。</p><p><strong>进程阻塞原语</strong>的阻塞过程如下： </p><ol><li>立即暂停CPU的执行，保留当前CPU的现场。</li><li>将PCB中的状态由执行态修改为阻塞态。</li><li>将PCB写入到相应阻塞原因的阻塞队列。</li><li>启动调度程序进行重新调度，即将CPU分配给另一就绪进程。 </li><li>按照新进程的PCB设置CPU新的环境。</li></ol><p>引发进程阻塞的事件 </p><p>进程发生阻塞是由于**正在执行的进程突然发生执行条件缺失事件(需要等待系统分配资源和等待相互合作的进程的完成工作)**，进而暂停执行等待条件的满足</p><p><strong>进程唤醒</strong></p><p>进程唤醒过程 当被阻塞进程所期待的事件发生时，由“相关进程（促使执行条件满足的进程）”调用唤醒原语，将阻塞进程唤醒（唤醒是进程的被动行为）。</p><p><strong>进程唤醒原语</strong>的唤醒过程如下： </p><ol><li>将该进程的PCB从阻塞队列移出。</li><li>修改PCB中的状态由阻塞变为就绪。</li><li>将PCB插入到就绪队列</li></ol><p>阻塞进程被唤醒则是由于发生了某些事件，从而具备了执行条件，到达了执行时机。</p><h3 id="2-4-进程通信"><a href="#2-4-进程通信" class="headerlink" title="2.4 进程通信"></a>2.4 进程通信</h3><h4 id="共享存储"><a href="#共享存储" class="headerlink" title="共享存储"></a>共享存储</h4><p>为了保证安全，一个进程不能直接访问另一个进程的地址空间</p><ol><li><p>在通信的进程之间存在一块可直接访问的共享空间，通过对这片共享空间进行写&#x2F;读操作实现进程之间的信息交换。</p></li><li><p>两个进程对共享空间的访问必须是互斥的(互斥访问通过操作系统提供的工具实现)。</p><p>互斥访问就是在同一时间只能有一个进程对同一资源进行访问</p><p>操作系统只负责提供共享空间和同步互斥工具(如P、V操作)。</p></li><li><p>共享方式分为两种：</p></li></ol><ul><li><p>低级方式的共享是基于数据结构的共享</p><p><strong>基于数据结构的共享：</strong>比如共享空间里只能发放一个长度为10的数组，这种共享方式速度慢，限制多，是一种低级通信方式。</p></li><li><p>高级方式的共享则是基于存储区的共享</p><p><strong>基于存储区的共享：</strong>在内存中画出一块共享存储区，数据的形式、存放的位置都由进程决定，而不是操作系统。相比之下，这种共享方式速度更快，是一种高级通信方式。</p></li></ul><h4 id="管道通信"><a href="#管道通信" class="headerlink" title="管道通信"></a>管道通信</h4><ol><li><p>“管道”是指用于连接读写进程的一个共享文件，又名pipe文件，其实就是在内存中开辟的一个大小固定的缓冲区。</p></li><li><p>管道通信只能采用半双工通信，某一个时段内只能实现<strong>单向的传输</strong>，如果要实现双向同时通信，则需要<strong>设置两个管道</strong>。</p></li><li><p>各个进程要互斥的访问管道。write</p></li><li><p>数据以字符流的形式写入管道，当管道写满时，写进程的write()系统调用将被阻塞，等待读进程将数据取走。当读进程将数据全部取走后，管道变空，此时读进程的read()系统调用将被阻塞。</p><p><strong>注意：</strong>如果没有写满，是不允许读的，如果没有读空，是不允许写的。</p></li><li><p>数据一旦被读出，就会从管道中被抛弃，这就意味着读进程最多只能有一个，否则可能会有读错数据的情况。</p></li></ol><h4 id="消息传递"><a href="#消息传递" class="headerlink" title="消息传递"></a>消息传递</h4><p>进程间的数据交换以<strong>格式化的消息</strong>(Message)为单位。</p><p>进程通过操作系统提供的”发送消息&#x2F;接收消息”两个<strong>原语进行数据交换</strong></p><p>格式化的消息分为：消息头和消息体</p><ul><li>消息头：包括发送的进程ID、接受进程ID、消息类型、消息长度等格式化信息</li></ul><p>直接通信方式：A进程发送消息(原语)直接挂到接收进程B的<strong>消息缓冲队列</strong>上</p><p>间接通信方式：发送消息(原语)要先发送到**中间实体(信箱)**中，因此也称”信箱通信方式”。如：计网中的电子邮箱系统</p><h3 id="2-5-线程的描述"><a href="#2-5-线程的描述" class="headerlink" title="2.5 线程的描述"></a>2.5 线程的描述</h3><h4 id="为什么要引入线程"><a href="#为什么要引入线程" class="headerlink" title="为什么要引入线程"></a>为什么要引入线程</h4><ol><li><p>进程是资源分配的基本单位，也是调度的基本单位</p><p>引入线程之后，线程是CPU调度的基本单位</p></li><li><p>由于切换进程时，需要保存&#x2F;恢复进程运行环境，还需要切换内存地址空间(更新快表、更新缓冲)</p><p>引入线程后，同一个进程内各个线程间并发，不需要切换进程运行环境和内存地址空间，省时省力。</p><p><strong>注意：</strong>从属于不同进程的线程间的切换，也会导致进程的切换，开销也大</p></li><li><p>引入进程的目的是：</p><ul><li>为了更好的让多道程序并发执行，提高资源利用率和系统吞吐量</li><li>为了减少程序在并发执行时所付出的时空开销，提高操作系统的并发性能。</li></ul></li></ol><p>进程可能需要”同时”做很多事情，而传统的进程只能</p><h4 id="线程的特点"><a href="#线程的特点" class="headerlink" title="线程的特点"></a>线程的特点</h4><ol><li><p><strong>各个进程的内存地址空间相互独立</strong>，只能通过请求操作系统内核的帮助来完成进程之间的通信。</p><p>但<strong>同一个进程下的各个线程之间共享内存地址空间</strong>，可以直接通过读&#x2F;写内存空间进行通信。</p></li><li><p>从属于同一个进程各个线程共享进程的所有资源。</p></li><li><p><strong>进程之间的通信</strong>必须请求操作系统服务(CPU要求换到核心态)，<strong>开销大</strong>。</p><p><strong>同进程下的线程间通信</strong>不需要操作系统干预，<strong>开销更小</strong>。</p></li><li><p>引入线程前，进程既是资源分配的基本单位，也是调度的基本单位。</p><p>但是引入线程后，<strong>进程是资源分配的基本单位</strong>，而<strong>线程是调度的基本单位</strong>。同样线程也有运行态，就绪态和阻塞态。</p><p>而线程几乎不拥有资源，只拥有极少量的资源(线程控制块TCB、寄存器信息、堆栈等)</p></li><li><p>在多核CPU环境下，各个线程也可以分配到不同的CPU上并行的执行。</p></li></ol><h3 id="2-6-线程的实现方式"><a href="#2-6-线程的实现方式" class="headerlink" title="2.6 线程的实现方式"></a>2.6 线程的实现方式</h3><p>线程分为：用户级线程和内核级线程</p><h4 id="用户级线程"><a href="#用户级线程" class="headerlink" title="用户级线程"></a>用户级线程</h4><ol><li><p>用户级线程由应用程序通过<strong>线程库</strong>实现，所有的<strong>线程管理工作都由应用程序负责</strong>（包括线程切换）</p></li><li><p>用户级线程中，线程切换可以在用户态下即可完成，无需操作系统干预。</p></li><li><p>在用户看来，是有多个线程，但是在操作系统的内核来看，并不意识到线程的存在。</p><p>“用户级线程”就是从用户视角所能看到的线程。</p></li><li><p>优点：用户级线程的切换在用户空间即可完成，<strong>不需要切换到核心态</strong>，线程管理的系统开销小，效率高。</p></li><li><p>缺点：当一个用户级线程被阻塞后，<strong>整个线程都会被阻塞，并发度不高</strong>。多个线程必须在多核处理机上并行运行。</p></li><li><p>在用户级线程中，<strong>CPU调度的基本单位依旧是进程</strong>，并非线程</p></li></ol><p>​</p><h4 id="内核级线程"><a href="#内核级线程" class="headerlink" title="内核级线程"></a>内核级线程</h4><ol><li><p>内核级线程：又称”内核支撑的线程”，是由操作系统支撑的线程。</p><p>大多数的现代操作系统都实现了内核级线程，如Windows、Linux。</p></li><li><p>内核级线程的管理工作是<strong>由操作系统内核完成</strong>。</p></li><li><p>线程调度和切换等工作都是由内核负责，因此内核级线程的切换必然需要在核心态下才能完成。</p></li><li><p>操作系统会为**每个内核级线程建立相应的TCB(进程控制块)**，通过TCB对线程进行管理”。</p></li><li><p>“内核级线程”就是从操作系统内核视角看到的线程。</p></li><li><p>优点：当一个线程被阻塞后，别的线程还可以继续执行，<strong>并发能力强</strong>。<strong>多线程可在多核处理机上并行执行</strong>。</p></li><li><p>缺点：<strong>一个用户进程会占用多个内核程序</strong>，<strong>线程切换</strong>由操作系统内核完成，<strong>需要从用户态变为核心态</strong>，因此线程管理的成本高，<strong>开销大</strong>。</p></li></ol><h3 id="2-7-多线程模型"><a href="#2-7-多线程模型" class="headerlink" title="2.7 多线程模型"></a>2.7 多线程模型</h3><h4 id="一对一模型"><a href="#一对一模型" class="headerlink" title="一对一模型"></a>一对一模型</h4><p>一对一模型：</p><ul><li>一个用户及线程映射到一个肉核级线程。每个用户进程有与用户级线程同数量的内核级线程。</li><li>优点：当一个线程被阻塞后，别的线程还可以继续执行，并发能力强。多线程可在多核处理机上并行执行。</li><li>缺点：一个用户进程会占用多个内核级线程，线程切换由操作系统内核完成，需要切换到核心态，因此线程管理的成本高，开销大。</li></ul><img src="C:\Users\26919\AppData\Roaming\Typora\typora-user-images\image-20220920140036089.png" class="lazyload" data-srcset="C:\Users\26919\AppData\Roaming\Typora\typora-user-images\image-20220920140036089.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220920140036089" style="zoom:50%;" /><h4 id="多对一模型"><a href="#多对一模型" class="headerlink" title="多对一模型"></a>多对一模型</h4><p>多对一模型：</p><ul><li>多个用户及线程映射到一个内核级线程。每个用户进程只对应一个内核级<br>线程。</li><li>优点：用户级线程的切换在用户空间即可完成，不需要切换到核心态，线程管理的系统<br>开销小，效率高</li><li>缺点：当一个用户级线程被阻塞后，整个进程都会被阻塞，并发度不高。多个线程不可在多核处理机上并行运行</li></ul><img src="C:\Users\26919\AppData\Roaming\Typora\typora-user-images\image-20220920140146980.png" class="lazyload" data-srcset="C:\Users\26919\AppData\Roaming\Typora\typora-user-images\image-20220920140146980.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220920140146980" style="zoom:50%;" /><h4 id="多对多模型"><a href="#多对多模型" class="headerlink" title="多对多模型"></a>多对多模型</h4><p>多对多模型：</p><ul><li>n用户及线程映射到m个内核级线程(n&gt;&#x3D;m)。每个用户进程对应m个内核级线程。</li><li>克服了多对一模型并发度不高的缺点，又克服了一对一模型中一个用户进程占用太多内核级线程，开销太大的缺点。</li></ul><img src="C:\Users\26919\AppData\Roaming\Typora\typora-user-images\image-20220920140239032.png" class="lazyload" data-srcset="C:\Users\26919\AppData\Roaming\Typora\typora-user-images\image-20220920140239032.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220920140239032" style="zoom:50%;" /><h3 id="2-8-处理机调度"><a href="#2-8-处理机调度" class="headerlink" title="2.8  处理机调度"></a>2.8  处理机调度</h3><ol><li><p>当有一堆任务要处理，但由于资源有限，这些事情没法同时处理。这就需要确定某种规则(时间短优先、先来先服务等)来决定这些任务的顺序，这就是“调度”研究的问题。</p></li><li><p>在多道程序系统中，进程的数量往往是多于处理机的个数的，这样不可能同时并行的处理各个进程。</p><p>处理机调度：就是从就绪队列中按照一定的算法选择一个进程并将处理机分配给它运行，以实现进程的并发执行。</p></li></ol><h4 id="高级调度"><a href="#高级调度" class="headerlink" title="高级调度"></a>高级调度</h4><p>高级调度是，也称为作业调度，根据不同的作业调度算法，将磁盘中后备队列中的不同的若干作业调入 内存的过程。作业一旦被调入内存，就会将其创建为进程，并为之分配必要的资源，进入就绪队列。</p><ul><li>高级调度，主要存在于多道批处理系统，实时系统与分时系统中没有该调度方式</li></ul><h4 id="中级调度"><a href="#中级调度" class="headerlink" title="中级调度"></a>中级调度</h4><p>中级调度，也称为内存调度，也是OS中最基本的一种调度，是为提高内存利用率与系统吞吐量而引入 的一类调度。其功能是，将内存中暂时不能运行的进程，调到外存等待。当具备运行条件且内存有空闲 时，再根据不同的调度算法将其重新调入到内存。</p><ul><li>中级调度，无论是多道批处理系统，还是分时系统、实时系统，都存在该调度方式</li></ul><h4 id="低级调度"><a href="#低级调度" class="headerlink" title="低级调度"></a>低级调度</h4><p>低级调度是，也称为进程调度，是OS中最基本的一种调度，是一个根据不同的进程调度算法，选择不 同的进程为其分配处理机的过程。</p><ul><li>低级调度，无论是多道批处理系统，还是分时系统、实时系统，都存在该调度方式</li></ul><h3 id="2-9-进程调度"><a href="#2-9-进程调度" class="headerlink" title="2.9 进程调度"></a>2.9 进程调度</h3><h4 id="进程调度的时机"><a href="#进程调度的时机" class="headerlink" title="进程调度的时机"></a>进程调度的时机</h4><p>进程调度(低级调度)，就是按照某种算法从就绪队列中选择一个进程为其分配处理机。</p><p><strong>需要进行进程调度</strong>与切换的情况：</p><ul><li>当前运行的进程<strong>主动放弃</strong>处理机<ul><li>进程正常终止</li><li>运行过程中发生异常而终止</li><li>进程主动请求阻塞，如等待I&#x2F;O</li></ul></li><li>当前运行的进程<strong>被动放弃</strong>处理机<ul><li>分给进程的时间片用完</li><li>有更紧急的事需要处理，如I&#x2F;O中断</li><li>有更高优先级的进程进入就绪队列</li></ul></li></ul><p>不能进行进程调度与切一换的情况：</p><ul><li>在<strong>处理中断的过程</strong>中。中断处理过程复杂，与硬件密切相关，很难做到在中断处理过程中进行进程切换。</li><li>进程在<strong>操作系统内核程序临界区</strong>中。</li><li>在<strong>原子操作过程</strong>中(原语)。原子操作不可中断，要一气呵成。如之前讲过的修改PCB中进程状态标志，并把PCB放到相应队列</li></ul><h4 id="进程调度的方式"><a href="#进程调度的方式" class="headerlink" title="进程调度的方式"></a>进程调度的方式</h4><ul><li><p><strong>非剥夺调度方式</strong>，又称非抢占方式：</p><p>即，只允许进程主动放弃处理机。在运行过程中即便有更紧迫的任务到达，当前进程依然会继续使用处理机，直到该进程终止或主动要求进入阻塞态。<br>特点：实现简单，系统开的小但是无法及时处理紧急任务，适合于早期的批处理系统</p></li><li><p><strong>剥夺调度方式</strong>，又称抢占方式：</p><p>当一个进程正在处理机上执行时，如果有一个更重要或更紧迫的进程需要使用处理机，则立即暂停正在执行的进程，将处理机分配给更重要紧迫的那个进程。<br>特点：可以优先处理更紧急的进程，也可实现让各进程按时间片轮流执行的功能（通过时钟中断）。适合于分时操作系统、实时操作系统</p></li></ul><h4 id="进程的切换与过程"><a href="#进程的切换与过程" class="headerlink" title="进程的切换与过程"></a>进程的切换与过程</h4><p>“<strong>狭义的进程调度”与“进程切换”的区别：</strong></p><ul><li><p><strong>狭义的进程调度</strong>：指的是从就绪队列中选中一个要运行的进程(这个进程可以是刚刚被暂停执行的进程，也可能是另一个进程，后一种情况就需要进程切换)</p></li><li><p><strong>进程切换</strong>：是指一个进程让出处理机，由另一个进程占用处理机的过程。</p></li><li><p><strong>广义的进程调度</strong>：包含了选择一个进程和进程切换两个步骤。</p></li></ul><p><strong>进程切换过程完成后：</strong></p><ul><li><p>对原来运行进程各种数据的保存</p></li><li><p>对新的进程各种数据的恢复</p><p>如：程序计数器、程序状态字、各种数据寄存器等处理机现场信息，这些信息一班保存在进程控制块PCB中</p></li></ul><p>注意：<strong>进程切换是有代价的</strong>，不能说进程切换越频繁系统并发性就越好，因为如果<strong>过于频繁的进行进程调度、切换</strong>，必然会使得<strong>整个系统的效率降低</strong>，使得系统大部分时间都花在了进程的切换上，而真正<strong>用于执行进程的时间减少</strong>。</p><h3 id="2-10-调度算法"><a href="#2-10-调度算法" class="headerlink" title="2.10 调度算法"></a>2.10 调度算法</h3><h4 id="调度算法的评价指标"><a href="#调度算法的评价指标" class="headerlink" title="调度算法的评价指标"></a>调度算法的评价指标</h4><p>调度算法的评价指标主要有：CPU利用率，系统吞吐量、周转时间、等待时间和响应时间</p><ul><li><p><strong>CPU利用率</strong>：指的是CPU”忙碌”的时间占总时间的比例</p><ul><li><code>利用率 = CPU忙碌的时间 / 总时间</code></li></ul></li><li><p><strong>系统吞吐量</strong>：单位时间内完成作业的数量</p><ul><li><code>系统吞吐量 = 总共完成了多少道作业 / 总共花了多少时间</code></li></ul></li><li><p><strong>周转时间</strong>：是指从作业被提交给系统开始，到作业完成为止的这段时间间隔</p><ul><li><p><code>周转时间 = 作业完成时间 - 作业提交时间</code></p><p>对于用户，更关心自己的单个作业的周转时间</p></li><li><p><code>平均周转时间 = 各个作业周转时间之和 / 作业数</code></p><p>对于操作系统，更关心系统的整体表现，因此更关心所有作业的周转时间的平均值</p></li><li><p><code>带权周转时间 = 作业周转时间 / 作业实际运行时间</code></p><p>​   <code>= (作业完成时间 - 作业提交时间) / 作业实际运行时间</code></p><p>带权周转时间与周转时间都是越小越好(带权周转时间必然 &gt;&#x3D; 1)</p></li><li><p><code>平均带权周转时间 = 各个带权周转时间之和 / 作业数</code></p></li></ul></li><li><p>等待时间：指进程&#x2F;作业<strong>处于等待处理机状态时间之和</strong>，等待时间越短，用户越满意</p><ul><li>对于<strong>进程</strong>来说，等待时间就是指<strong>进程建立后等待被服务的时间之和</strong>，在等待I&#x2F;O完成的期间其实进程也是被服务的，所以不计入等待时间。</li><li>而对于<strong>作业</strong>来说，<strong>不仅要考虑建立进程后的等待时间，还要加上作业在外存后备队列中的等待时间</strong>。</li><li>一个作业总共需要被CPU服务多久，被I&#x2F;O设备服务多久一般是确定不变的，因此调度算法其实只能影响作业或者进程的等待时间。当然，与前面指标类似，也有”平均等待时间”来评价整体性能。</li></ul></li><li><p>响应时间：指从用户请求到首次产生响应所用的时间</p></li></ul><h4 id="调度算法"><a href="#调度算法" class="headerlink" title="调度算法"></a>调度算法</h4><p>先来先服务(FCFS)：</p><p>短作业优先(SJF)：</p><p>高响应比优先(HRRN)：</p><h1 id="三、内存"><a href="#三、内存" class="headerlink" title="三、内存"></a>三、内存</h1><h1 id="四、文件"><a href="#四、文件" class="headerlink" title="四、文件"></a>四、文件</h1><h1 id="五、I-O设备"><a href="#五、I-O设备" class="headerlink" title="五、I-O设备"></a>五、I-O设备</h1>]]></content>
      
      
      <categories>
          
          <category> 计算机4件套 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据结构 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/06/%E5%B0%8F%E6%8A%80%E5%B7%A7/@Autowired%E4%B8%8E@Resource/"/>
      <url>/2022/08/06/%E5%B0%8F%E6%8A%80%E5%B7%A7/@Autowired%E4%B8%8E@Resource/</url>
      
        <content type="html"><![CDATA[<div class="story post-story"><h2 id="Autowired和-Resource区别"><a href="#Autowired和-Resource区别" class="headerlink" title="@Autowired和@Resource区别"></a>@Autowired和@Resource区别</h2><h3 id="1-提供方不同："><a href="#1-提供方不同：" class="headerlink" title="1.提供方不同："></a>1.提供方不同：</h3><ul><li><p>@Autowired是由Spring提供，属于第三方</p></li><li><p>@Resource是由J2EE提供，属于Java的</p></li></ul><h3 id="2-装配时默认类型不同："><a href="#2-装配时默认类型不同：" class="headerlink" title="2.装配时默认类型不同："></a>2.装配时默认类型不同：</h3><ul><li><p><strong>@Autowired默认按type装配</strong></p><p>默认情况下必须要求依赖对象存在，如果要允许<code>null</code>值，可以设置它的<code>required</code>属性为<code>false</code>。</p><p>如果想使用名称装配可以结合<code>@Qualifier注解</code>进行使用。</p></li><li><p><strong>@Resource默认按name装配</strong></p><p>名称可以通过<code>name</code>属性进行指定，如果没有指定<code>name</code>属性，当注解写在字段上时，默认取字段名进行名称查找。</p><p>如果注解写在setter方法上默认取属性名进行装配。</p><p>当找不到与名称匹配的<code>bean</code>时才按照类型进行装配。</p><p>但是需要注意的是，如果<code>name</code>属性一旦指定，就只会按照名称进行装配。</p></li></ul><h3 id="3-使用注意："><a href="#3-使用注意：" class="headerlink" title="3.使用注意："></a>3.使用注意：</h3><ul><li><p><strong>@Autowired</strong></p><p><strong>@Qualifier(“userService”)</strong> </p><p>是直接按照名字进行搜索，也就是说，对于UserServiceImpl 上面@Service注解必须写名字，不写就会报错，而且名字必须是@Autowired @Qualifier(“userService”) 保持一致。如果@Service上面写了名字，而@Autowired @Qualifier() ，一样会报错。</p></li><li><p><strong>@Resource</strong></p><p>根据这个注解的匹配效果可以看出，它进行了两次匹配，也就是说，如果你在UserService这个类上面这样写注解@Service。首先是找相同名字的，如果没有找到，再找相同类型的，而这里的@Service没有写名字，这个时候就进行了两次搜索，显然，速度就下降了许多。</p><p>@Resource根据名字搜索是这样写@Resource(“userService”)，如果你写了这个名字叫userService，那么UserServiceImpl的@Service注解也必须也是这个名字，不然还是会报错。</p></li></ul></div>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/06/Python/%E5%9B%BE%E5%BD%A2%E5%A4%84%E7%90%86/"/>
      <url>/2022/08/06/Python/%E5%9B%BE%E5%BD%A2%E5%A4%84%E7%90%86/</url>
      
        <content type="html"><![CDATA[<div class="story post-story"><h2 id="1-计算机眼中的图像"><a href="#1-计算机眼中的图像" class="headerlink" title="1.计算机眼中的图像"></a>1.计算机眼中的图像</h2><p>彩色图像中每一个小格叫做像素点，由R(红)G(绿)B(蓝)组成</p><p>导包：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> cv2</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">img = cv2.imread(<span class="string">&#x27;scenery.jpg&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(img)</span><br></pre></td></tr></table></figure><p>运行结果：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[[[<span class="number">23</span> <span class="number">14</span> <span class="number">11</span>]</span><br><span class="line">  [<span class="number">23</span> <span class="number">14</span> <span class="number">11</span>]</span><br><span class="line">  [<span class="number">24</span> <span class="number">15</span> <span class="number">12</span>]</span><br><span class="line">  ...</span><br><span class="line">  [<span class="number">15</span> <span class="number">10</span>  <span class="number">9</span>]</span><br><span class="line">  [<span class="number">14</span>  <span class="number">9</span>  <span class="number">8</span>]</span><br><span class="line">  [<span class="number">14</span>  <span class="number">9</span>  <span class="number">8</span>]]</span><br><span class="line"></span><br><span class="line"> ...</span><br><span class="line"></span><br><span class="line"> [[ <span class="number">0</span>  <span class="number">0</span>  <span class="number">0</span>]</span><br><span class="line">  [ <span class="number">0</span>  <span class="number">0</span>  <span class="number">0</span>]</span><br><span class="line">  [ <span class="number">0</span>  <span class="number">0</span>  <span class="number">0</span>]</span><br><span class="line">  ...</span><br><span class="line">  [ <span class="number">0</span>  <span class="number">0</span>  <span class="number">0</span>]</span><br><span class="line">  [ <span class="number">0</span>  <span class="number">0</span>  <span class="number">0</span>]</span><br><span class="line">  [ <span class="number">0</span>  <span class="number">0</span>  <span class="number">0</span>]]]</span><br></pre></td></tr></table></figure><p>展示图像函数：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">show_img</span>(<span class="params">name, img</span>):</span><br><span class="line">    cv2.imshow(name, img)</span><br><span class="line">    <span class="comment"># 等待时间，毫秒级，0表示任意键终止</span></span><br><span class="line">    cv2.waitKey(<span class="number">0</span>)</span><br><span class="line">    <span class="comment"># 关闭所有窗口</span></span><br><span class="line">    cv2.destroyAllWindows()</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show_img(<span class="string">&quot;111&quot;</span>, img) <span class="comment"># 展示图像</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(img.shape) <span class="comment"># 获取图像的三维数值</span></span><br></pre></td></tr></table></figure><p>运行结果：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(<span class="number">799</span>, <span class="number">1200</span>, <span class="number">3</span>)</span><br></pre></td></tr></table></figure><p>展示灰度图像：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">img = cv2.imread(<span class="string">&#x27;scenery.jpg&#x27;</span>, cv2.IMREAD_GRAYSCALE)</span><br><span class="line"><span class="built_in">print</span>(img)</span><br><span class="line">show_img(<span class="string">&quot;111&quot;</span>, img)</span><br><span class="line"><span class="built_in">print</span>(img.shape)</span><br></pre></td></tr></table></figure><p>运行结果：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[[<span class="number">14</span> <span class="number">14</span> <span class="number">15</span> ... <span class="number">10</span>  <span class="number">9</span>  <span class="number">9</span>]</span><br><span class="line"> [<span class="number">14</span> <span class="number">14</span> <span class="number">15</span> ... <span class="number">10</span>  <span class="number">9</span>  <span class="number">9</span>]</span><br><span class="line"> [<span class="number">14</span> <span class="number">14</span> <span class="number">15</span> ... <span class="number">10</span>  <span class="number">9</span>  <span class="number">9</span>]</span><br><span class="line"> ...</span><br><span class="line"> [ <span class="number">0</span>  <span class="number">0</span>  <span class="number">0</span> ...  <span class="number">0</span>  <span class="number">0</span>  <span class="number">0</span>]</span><br><span class="line"> [ <span class="number">0</span>  <span class="number">0</span>  <span class="number">0</span> ...  <span class="number">0</span>  <span class="number">0</span>  <span class="number">0</span>]</span><br><span class="line"> [ <span class="number">0</span>  <span class="number">0</span>  <span class="number">0</span> ...  <span class="number">0</span>  <span class="number">0</span>  <span class="number">0</span>]]</span><br><span class="line">(<span class="number">799</span>, <span class="number">1200</span>)</span><br></pre></td></tr></table></figure><p>保存图片：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cv2.imwrite(<span class="string">&quot;sc.jpg&quot;</span>, img)</span><br></pre></td></tr></table></figure></div>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Spring框架的学习笔记</title>
      <link href="/2022/08/06/Java/Spring%E6%A1%86%E6%9E%B6/"/>
      <url>/2022/08/06/Java/Spring%E6%A1%86%E6%9E%B6/</url>
      
        <content type="html"><![CDATA[<div class="story post-story"><h2 id="1-初识Spring"><a href="#1-初识Spring" class="headerlink" title="1.初识Spring"></a>1.初识Spring</h2><ul><li>官网：<a href="https://spring.io/">spring官网</a></li><li>Spring已经发展成了一种开发的生态圈，Spring提供了若干个项目，每个项目用于完成特定的功能<ul><li><strong>Spring Framework</strong></li><li>Spring Boot</li><li>Spring Cloud</li><li>….</li></ul></li><li>目前已经发展到<strong>Spring 5.0</strong>，需要<strong>JDK8</strong>以上支持</li></ul></div><div class="story post-story"><h2 id="2-Spring-Framework架构"><a href="#2-Spring-Framework架构" class="headerlink" title="2.Spring Framework架构"></a>2.Spring Framework架构</h2><ul><li><p>Spring Framework是Spring生态圈中最基础的项目，是其他项目的根基</p><img src="https://s2.loli.net/2022/06/22/P2TnXF8qp9gDHxS.png" class="lazyload" data-srcset="https://s2.loli.net/2022/06/22/P2TnXF8qp9gDHxS.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="QQ图片20220622160146" style="zoom: 67%;"/><blockquote><ul><li>Data Access：数据访问</li><li>Data Integeration：数据集成</li><li>Web：web开发 </li><li>AOP：面向切面编程</li><li>Aspects：AOP思想实现</li><li>Core Container：核心容器</li><li>Test：单元测试与集成测试</li></ul></blockquote></li></ul></div><div class="story post-story"><h2 id="3-核心概念"><a href="#3-核心概念" class="headerlink" title="3.核心概念"></a>3.核心概念</h2><h3 id="3-1-项目结构"><a href="#3-1-项目结构" class="headerlink" title="3.1 项目结构"></a>3.1 项目结构</h3><blockquote><p>java包</p><blockquote><p>com包</p><blockquote><p>spring包</p><blockquote><p>dao包</p><p><code>BookDao.java</code></p><blockquote><p>impl包</p><blockquote><p><code>BookDaoImpl.java</code></p></blockquote></blockquote></blockquote><blockquote><p>service包</p><p><code>BookSerive.java</code></p><blockquote><p>impl包</p><blockquote><p><code>BookServiceImpl.java</code></p></blockquote></blockquote><p><code>App.java</code>主函数</p></blockquote></blockquote></blockquote><p>resources包</p><blockquote><p><code>applicationContext.xml</code></p><p><code>jdbc.properties</code></p></blockquote></blockquote><h3 id="3-2-初识IOC和DI"><a href="#3-2-初识IOC和DI" class="headerlink" title="3.2 初识IOC和DI"></a>3.2 初识IOC和DI</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">BookDao</span> &#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">()</span> &#123;</span><br><span class="line">System.out.println(<span class="string">&quot;book dao save...&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">BookService</span> &#123;</span><br><span class="line"><span class="keyword">private</span> <span class="type">BookDao</span> <span class="variable">bookDao</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BookDaoImpl</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">()</span> &#123;</span><br><span class="line">bookDao.save();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>这是一种很常见的写法。<br>但是这样的写法<strong>耦合度</strong>太高，<strong>耦合度</strong>可以简单的理解为：<strong>两个类之间的关联程度</strong>，耦合度高就代表两个类之间关联程度很高，<strong>动其中一个类，就不得不动另外一个类</strong>。</p></blockquote><p>所以就需要<code>解耦</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">BookService</span> &#123;</span><br><span class="line"><span class="keyword">private</span> BookDao bookDao;<span class="comment">//service:我免费啦！</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">()</span> &#123;</span><br><span class="line">bookDao.save();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p><strong><code>IOC</code>(Inversion of Control) 控制反转</strong></p><ul><li><blockquote><p>使用对象时，由以前主动<code>new</code>一个对象转换为由<strong>外部</strong>提供对象，创建对象的控制权交给了<strong>外部</strong>，此思想为<strong>控制反转</strong>。</p></blockquote></li></ul></li><li><p><strong>Spring技术对<code>IOC</code>进行实现</strong></p><blockquote><ul><li><strong>Spring</strong>提供一个<code>容器</code>，称为<code>IOC容器</code>，用来当作<code>IOC</code>思想中的**”外部”**</li><li><strong>IOC容器</strong>负责对象的<code>创建</code>、<code>初始化</code>等工作</li><li>在<strong>IOC容器</strong>中被创建或被管理的对象称之为<code>Bean</code></li></ul></blockquote></li><li><p><strong><code>DI</code>(Dependency Injection) 依赖注入</strong></p><ul><li><blockquote><p>在容器中建立的<code>bean</code>与<code>bean</code>之间的依赖关系的整个过程，称之为<code>依赖注入</code>。          </p><p>例：<code>service层</code>需要依赖<code>dao层</code>运行，但无需自己<code>new</code>一个<code>dao层</code>，它会自动生成<code>dao层</code>。</p></blockquote></li></ul></li><li><p>目标：<strong>充分解耦</strong></p><blockquote><ul><li>使用<strong>IOC容器</strong>管理<code>bean</code>(IOC思想)</li><li>在<strong>ICO容器</strong>内将依赖关系的<code>bean</code>进行关系绑定(DI思想)</li><li>在使用对象时不仅可以从<code>IOC容器</code>中获取，并且也可以获取到<code>bean</code>已经绑定的所有依赖关系</li></ul></blockquote></li></ul></div><div class="story post-story"><h2 id="4-IOC入门"><a href="#4-IOC入门" class="headerlink" title="4.IOC入门"></a>4.IOC入门</h2><ol><li><p>pom.xml导入spring的坐标</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.3.18<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p><code>resources</code>目录创建Spring配置文件<code>applicationContext.xml</code></p><p>配置<code>bean</code></p><blockquote><ul><li><code>bean</code>标签：配置bean</li><li><code>id</code>属性：给bean起名字</li><li><code>class</code>属性：给bean定义类型</li></ul></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;bookDao&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.spring.dao.impl.BookDaoImpl&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;bookService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.spring.service.impl.BookServiceImpl&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>创建名为启动类App</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line"><span class="keyword">import</span> com.spring.dao.BookDao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">App</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//获取ICO容器</span></span><br><span class="line">    <span class="type">ApplicationContext</span> <span class="variable">ac</span> <span class="operator">=</span> <span class="keyword">new</span></span><br><span class="line">      <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line">        <span class="comment">//获取bean</span></span><br><span class="line">        <span class="type">BookDao</span> <span class="variable">bookDao</span> <span class="operator">=</span> (BookDao) ac.getBean(<span class="string">&quot;bookDao&quot;</span>);</span><br><span class="line">        bookDao.save();</span><br><span class="line">        </span><br><span class="line">        <span class="type">BookService</span> <span class="variable">bookService</span> <span class="operator">=</span> (BookService) ac.getBean(<span class="string">&quot;bookService&quot;</span>);</span><br><span class="line">        bookService.save();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol></div><div class="story post-story"><h2 id="5-DI入门"><a href="#5-DI入门" class="headerlink" title="5.DI入门"></a>5.DI入门</h2><blockquote><ul><li>基于IOC管理bean</li><li>不能保留Service层中用new创建的对象</li><li>通过spring配置文件进行配置Service与Dao的关系</li></ul></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">BookService</span> &#123;</span><br><span class="line">    <span class="comment">//删除业务层中用new创建对象的方式</span></span><br><span class="line">    <span class="comment">//private BookDao bookDao = new BookDaoImpl();</span></span><br><span class="line">    <span class="keyword">private</span> BookDao bookDao;</span><br><span class="line"><span class="comment">//提供相应的set的方法</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setBookDao</span><span class="params">(BookDao bookDao)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.bookDao = bookDao;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">()</span> &#123;</span><br><span class="line">        bookDao.save();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在spring配置文件<code>applicationContext.xml</code>中，配置property</p><blockquote><ul><li><code>property</code>标签：配置当前bean的属性</li><li><code>name</code>属性：配置哪个具体的属性</li><li><code>ref</code>属性：参照spring配置文件中的哪个bean的id</li></ul></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;bookDao&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.spring.dao.impl.BookDaoImpl&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;bookService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.spring.service.impl.BookServiceImpl&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 配置service与dao的关系 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;bookDao&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;bookDao&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>配置完成后，BookDao无需使用new来手动创建对象，而是通过spring来自动创建</p></blockquote></div><div class="story post-story"><h2 id="6-bean基础配置"><a href="#6-bean基础配置" class="headerlink" title="6.bean基础配置"></a>6.bean基础配置</h2><h3 id="6-1-bean别名配置"><a href="#6-1-bean别名配置" class="headerlink" title="6.1 bean别名配置"></a>6.1 bean别名配置</h3><blockquote><p>name属性：可以起多个别名用<code>;</code>分号<code> </code>空格<code>,</code>逗号分隔</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;bookDao&quot;</span> <span class="attr">name</span>=<span class="string">&quot;dao Dao&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.spring.dao.impl.BookDaoImpl&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;bookService&quot;</span> <span class="attr">name</span>=<span class="string">&quot;Service service&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.spring.service.impl.BookServiceImpl&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><p>别名可以用于getBean()方法</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">App</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//获取ICO容器</span></span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">ac</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line">        <span class="comment">//获取bean</span></span><br><span class="line">        <span class="comment">//BookService bookService=(BookService)ac.getBean(&quot;bookService&quot;);</span></span><br><span class="line">        <span class="comment">//通过别名获取BookService</span></span><br><span class="line">        BookService bookService=(BookService)ac.getBean(<span class="string">&quot;Service&quot;</span>);</span><br><span class="line">        bookService.save();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>别名也可以用于<code>ref</code>属性，<strong>不建议用别名，建议使用id</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;bookService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.spring.service.impl.BookServiceImpl&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;bookDao&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;Dao&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="6-2-bean的作用范围"><a href="#6-2-bean的作用范围" class="headerlink" title="6.2 bean的作用范围"></a>6.2 bean的作用范围</h3><p>创建的<code>bean</code>是否为多个对象</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">App</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//获取ICO容器</span></span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">ac</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line">        <span class="comment">//获取bean</span></span><br><span class="line">        <span class="type">BookDao</span> <span class="variable">bookDao1</span> <span class="operator">=</span> (BookDao) ac.getBean(<span class="string">&quot;bookDao&quot;</span>);</span><br><span class="line">        <span class="type">BookDao</span> <span class="variable">bookDao2</span> <span class="operator">=</span> (BookDao) ac.getBean(<span class="string">&quot;bookDao&quot;</span>);</span><br><span class="line"></span><br><span class="line">        System.out.println(bookDao1);</span><br><span class="line">        System.out.println(bookDao2);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">运行结果：</span><br><span class="line">com.spring.dao.impl.BookDaoImpl@7219ec67</span><br><span class="line">com.spring.dao.impl.BookDaoImpl@7219ec67</span><br></pre></td></tr></table></figure></blockquote><p>结论：两个对象地址相同，spring默认创建的<code>bean</code>是单例的</p><p>需要在配置文件的<code>bean</code>标签里添加一个<code>scope</code>属性</p><blockquote><ul><li>scope属性有<code>singleton</code>单例模式和<code>prototype</code>非单例模式</li><li>scope属性默认为<code>singleton</code>单例模式</li></ul></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;bookDao&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.spring.dao.impl.BookDaoImpl&quot;</span> <span class="attr">scope</span>=<span class="string">&quot;prtotype&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">再次运行后，运行结果：</span><br><span class="line">com.spring.dao.impl.BookDaoImpl@7219ec67</span><br><span class="line">com.spring.dao.impl.BookDaoImpl@<span class="number">45018215</span></span><br></pre></td></tr></table></figure></blockquote><p>结论：两个对象地址不同，为非单例模式</p><ul><li><p>bean作用范围说明</p><ul><li><blockquote><p><strong>单例bean的优势</strong></p><p>减少了新生成实例的消耗，可以快速获取到bean，更大程度的复用</p></blockquote></li><li><blockquote><p><strong>适合</strong>交给容器进行管理的bean</p><p>表现层对象，业务层对象，数据层对象，工具对象</p></blockquote></li><li><blockquote><p><strong>不适合</strong>交给容器进行管理的bean</p><p>封装实体的域对象(存在变量的)</p></blockquote></li></ul></li></ul></div><div class="story post-story"><h2 id="7-bean实例化"><a href="#7-bean实例化" class="headerlink" title="7.bean实例化"></a>7.bean实例化</h2><p>   bean的本质就是对象，创建bean都需要使用<strong>构造方法</strong>完成</p><h3 id="7-1-构造方法实例化bean"><a href="#7-1-构造方法实例化bean" class="headerlink" title="7.1 构造方法实例化bean"></a>7.1 构造方法实例化bean</h3><p>(常用)</p><p>在<code>BookDaoImpl</code>类中创建构造方法：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">BookDao</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">BookDaoImpl</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;BookDaoImpl构造函数&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/*private BookDaoImpl()&#123;</span></span><br><span class="line"><span class="comment">        System.out.println(&quot;BookDaoImpl构造函数&quot;);</span></span><br><span class="line"><span class="comment">    &#125;*/</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;BookDao~~~~~&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>AppForInstanceBook</code>类进行测试：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppForInstanceBook</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">ac</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">BookDao</span> <span class="variable">bookDao</span> <span class="operator">=</span> (BookDao) ac.getBean(<span class="string">&quot;bookDao&quot;</span>);</span><br><span class="line">        bookDao.save();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">运行结果：</span><br><span class="line">BookDaoImpl构造函数</span><br><span class="line">BookDao~~~~~</span><br></pre></td></tr></table></figure></blockquote><blockquote><p>并且<code>BookDaoImpl</code>中的构造方法无论是否私有都可以被调用，这就是<strong>反射</strong>。</p></blockquote><p><strong>无参构造方法不存在，将会抛出异常</strong></p><p>在<code>BookDaoImpl</code>类中构造方法改为有参构造：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">BookDaoImpl</span><span class="params">(<span class="type">int</span> i)</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;BookDaoImpl构造函数&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>运行后会<strong>报错</strong>，同时说明<strong>Spring</strong>创建<code>bean</code>的时候，调用的是<strong>无参构造</strong>。</p></blockquote><h3 id="7-2-静态工厂实例化bean"><a href="#7-2-静态工厂实例化bean" class="headerlink" title="7.2 静态工厂实例化bean"></a>7.2 静态工厂实例化bean</h3><p>(<strong>早期</strong>实例化bean <strong>了解</strong>)</p><p>创建一个factory软件包，并在里面创建一个<code>BookDaoFactory</code>类：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookDaoFactory</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> BookDao <span class="title function_">getBookDao</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;factory is running&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">BookDaoImpl</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>AppForInstanceBook</code>类运行：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppForInstanceBook</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">BookDao</span> <span class="variable">bookDao</span> <span class="operator">=</span> BookDaoFactory.getBookDao();</span><br><span class="line">        bookDao.save();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//运行成功</span></span><br></pre></td></tr></table></figure><p>通过配置文件使用静态工厂实例化bean：</p><p>Spring配置文件中：</p><p><code>factory-method</code>属性：选择工厂里的bean实例方法</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;bookDao&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.spring.factory.BookDaoFactory&quot;</span> </span></span><br><span class="line"><span class="tag">      <span class="attr">factory-method</span>=<span class="string">&quot;getBookDao&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><p><code>AppForInstanceBook</code>类运行：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppForInstanceBook</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">ac</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">BookDao</span> <span class="variable">bookDao</span> <span class="operator">=</span> (BookDao) ac.getBean(<span class="string">&quot;bookDao&quot;</span>);</span><br><span class="line">        bookDao.save();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">运行结果：</span><br><span class="line">factory is running</span><br><span class="line">BookDaoImpl构造函数</span><br><span class="line">BookDao~~~~~</span><br></pre></td></tr></table></figure></blockquote><h3 id="7-3-实例工厂实例化bean"><a href="#7-3-实例工厂实例化bean" class="headerlink" title="7.3 实例工厂实例化bean"></a>7.3 实例工厂实例化bean</h3><p>(非静态工厂 <strong>了解</strong>)</p><p><code>BookDaoFactory</code>类中，将方法改为非静态方法</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookDaoFactory</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> BookDao <span class="title function_">getBookDao</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;factory is running~~~~~&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">BookDaoImpl</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>AppForInstanceBook</code>类运行：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppForInstanceBook</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">BookDaoFactory</span> <span class="variable">bookDaoFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BookDaoFactory</span>();</span><br><span class="line">        <span class="type">BookDao</span> <span class="variable">bookDao</span> <span class="operator">=</span> bookDaoFactory.getBookDao();</span><br><span class="line">        bookDao.save();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">运行结果：</span><br><span class="line">factory is running~~~~~</span><br><span class="line">BookDaoImpl构造函数</span><br><span class="line">BookDao~~~~~</span><br></pre></td></tr></table></figure></blockquote><p>通过配置文件使用静态工厂实例化bean：</p><p>Spring配置文件中：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 先要造出工厂的bean --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;bookDaoFactory&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.spring.factory.BookDaoFactory&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;bookDao&quot;</span> <span class="attr">factory-bean</span>=<span class="string">&quot;bookDaoFactory&quot;</span> </span></span><br><span class="line"><span class="tag">      <span class="attr">factory-method</span>=<span class="string">&quot;getBookDao&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure><p><code>AppForInstanceBook</code>类运行：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppForInstanceBook</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">       <span class="type">ApplicationContext</span> <span class="variable">ac</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">BookDao</span> <span class="variable">bookDao</span> <span class="operator">=</span> (BookDao) ac.getBean(<span class="string">&quot;bookDao&quot;</span>);</span><br><span class="line">        bookDao.save();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">运行结果：</span><br><span class="line">factory is running~~~~~</span><br><span class="line">BookDaoImpl构造函数</span><br><span class="line">BookDao~~~~~</span><br></pre></td></tr></table></figure></blockquote><blockquote><p>配置文件中bean<code>bookDaoFactory</code>只是为了配合使用，实际没有意义。</p></blockquote><p>Spring对这种实例化bean方法进行了改良：</p><ul><li><p><strong>4.通过FactoryBean实例化bean</strong>(实用)</p><p>创建<code>BookDaoFactoryBean</code>类实现接口<code>FactoryBean&lt;T&gt;</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookDaoFactoryBean</span> <span class="keyword">implements</span> <span class="title class_">FactoryBean</span>&lt;BookDao&gt; &#123;</span><br><span class="line">    <span class="comment">//代替原始实例工厂中创建对象的方法</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> BookDao <span class="title function_">getObject</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">BookDaoImpl</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Class&lt;?&gt; getObjectType() &#123;</span><br><span class="line">        <span class="keyword">return</span> BookDao.class;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Spring配置文件中：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;bookDao&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.spring.factory.BookDaoFactoryBean&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><p><code>AppForInstanceBook</code>类运行：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppForInstanceBook</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">       <span class="type">ApplicationContext</span> <span class="variable">ac</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">BookDao</span> <span class="variable">bookDao</span> <span class="operator">=</span> (BookDao) ac.getBean(<span class="string">&quot;bookDao&quot;</span>);</span><br><span class="line">        bookDao.save();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">运行结果：</span><br><span class="line">BookDaoImpl构造函数</span><br><span class="line">BookDao~~~~~</span><br></pre></td></tr></table></figure></blockquote><p>并且<code>BookDaoFactoryBean</code>类中可以重写<code>isSinglenton</code>方法：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&lt;table&gt;</span><br><span class="line"></span><br><span class="line">    &lt;th align=<span class="string">&quot;center&quot;</span>&gt;         </span><br><span class="line">    &lt;td rowspan=<span class="string">&quot;2&quot;</span>&gt;Key&lt;/td&gt;         </span><br><span class="line">    &lt;td colspan=<span class="string">&quot;2&quot;</span>&gt;Value&lt;/td&gt;</span><br><span class="line">&lt;/th&gt;</span><br><span class="line">&lt;tr align=<span class="string">&quot;center&quot;</span>&gt;                 </span><br><span class="line">    &lt;td&gt;field&lt;/td&gt;</span><br><span class="line">    &lt;td&gt;value&lt;/td&gt;</span><br><span class="line">&lt;/tr&gt;</span><br><span class="line">    &lt;tr align=<span class="string">&quot;center&quot;</span>&gt;         </span><br><span class="line">    &lt;td rowspan=<span class="string">&quot;2&quot;</span>&gt;REQUIRES_NEW&lt;/td&gt;         </span><br><span class="line">    &lt;td&gt;开启T&lt;/td&gt;</span><br><span class="line">    &lt;td&gt;新建T2&lt;/td&gt;</span><br><span class="line">&lt;/tr&gt;</span><br><span class="line">&lt;tr align=<span class="string">&quot;center&quot;</span>&gt;                 </span><br><span class="line">    &lt;td&gt;无&lt;/td&gt;</span><br><span class="line">    &lt;td&gt;新建T2&lt;/td&gt;</span><br><span class="line">&lt;/tr&gt;</span><br><span class="line">    &lt;tr align=<span class="string">&quot;center&quot;</span>&gt;         </span><br><span class="line">    &lt;td rowspan=<span class="string">&quot;2&quot;</span>&gt;SUPPORTS&lt;/td&gt;         </span><br><span class="line">    &lt;td&gt;开启T&lt;/td&gt;</span><br><span class="line">    &lt;td&gt;加入T&lt;/td&gt;</span><br><span class="line">&lt;/tr&gt;</span><br><span class="line">&lt;tr align=<span class="string">&quot;center&quot;</span>&gt;                 </span><br><span class="line">    &lt;td&gt;无&lt;/td&gt;</span><br><span class="line">    &lt;td&gt;无&lt;/td&gt;</span><br><span class="line">&lt;/tr&gt;</span><br><span class="line">&lt;/table&gt;</span><br></pre></td></tr></table></figure></li></ul></div><div class="story post-story"><h2 id="8-bean的生命周期"><a href="#8-bean的生命周期" class="headerlink" title="8.bean的生命周期"></a>8.bean的生命周期</h2><blockquote><p>bean生命周期：bean从创建到销毁的整体过程</p><p>bean生命周期控制：在bean创建后到销毁前做一些事</p></blockquote><p>在<code>BookDaoImpl</code>类中，创建<code>init</code>和<code>destroy</code>方法</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">BookDao</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;BookDao~~~~~&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;init~~~&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;destroy~~~&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在Spring配置文件中：</p><p><code>init-method</code>和<code>destroy-method</code>属性</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;bookDao&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.spring.dao.impl.BookDaoImpl&quot;</span> </span></span><br><span class="line"><span class="tag">      <span class="attr">init-method</span>=<span class="string">&quot;init&quot;</span> <span class="attr">destroy-method</span>=<span class="string">&quot;destroy&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><p>调用主函数：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">App</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//获取ICO容器</span></span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">ac</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line">        <span class="comment">//获取bean</span></span><br><span class="line">        <span class="type">BookDao</span> <span class="variable">bookDao</span> <span class="operator">=</span> (BookDao) ac.getBean(<span class="string">&quot;bookDao&quot;</span>);</span><br><span class="line">        bookDao.save();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">运行结果：</span><br><span class="line">init~~~</span><br><span class="line">BookDao~~~~~</span><br></pre></td></tr></table></figure></blockquote><p>控制台并没有输出<code>destroy~~~</code>；</p><p>因为销毁函数还没有来得及调用，程序就被杀死了；</p><p>所以需要进行手动关闭；</p><p>我们调用主函数中的<code>ac</code>中的<code>close()</code>方法，但是<code>ApplicationContext</code>接口中并没有提供<code>close()</code>方法，所以我们要改用<code>ClassPathXmlApplicationContext</code>类。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">App</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//获取ICO容器</span></span><br><span class="line">        <span class="type">ClassPathXmlApplicationContext</span> <span class="variable">ac</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line">        <span class="comment">//获取bean</span></span><br><span class="line">        <span class="type">BookDao</span> <span class="variable">bookDao</span> <span class="operator">=</span> (BookDao) ac.getBean(<span class="string">&quot;bookDao&quot;</span>);</span><br><span class="line">        bookDao.save();</span><br><span class="line">        ac.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">运行结果：</span><br><span class="line">init~~~</span><br><span class="line">BookDao~~~~~</span><br><span class="line">destroy~~~</span><br><span class="line">    成功！！！！</span><br></pre></td></tr></table></figure></blockquote><p>容器还提供另外一种方式关闭容器：<strong>设置关闭钩子</strong></p><p>调用<code>ac</code>的<code>registerShutdownHook()</code>方法</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">App</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//获取ICO容器</span></span><br><span class="line">        <span class="type">ClassPathXmlApplicationContext</span> <span class="variable">ac</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line">        <span class="comment">//获取bean</span></span><br><span class="line">        <span class="type">BookDao</span> <span class="variable">bookDao</span> <span class="operator">=</span> (BookDao) ac.getBean(<span class="string">&quot;bookDao&quot;</span>);</span><br><span class="line">        bookDao.save();</span><br><span class="line"></span><br><span class="line">        ac.registerShutdownHook();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">运行结果：</span><br><span class="line">init~~~</span><br><span class="line">BookDao~~~~~</span><br><span class="line">destroy~~~</span><br></pre></td></tr></table></figure></blockquote><p><code>close()</code>和<code>registerShutdownHook()</code>的区别</p><p>将<code>registerShutdownHook()</code>放到上面：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">App</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//获取ICO容器</span></span><br><span class="line">        <span class="type">ClassPathXmlApplicationContext</span> <span class="variable">ac</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line">        ac.registerShutdownHook();</span><br><span class="line">        <span class="comment">//获取bean</span></span><br><span class="line">        <span class="type">BookDao</span> <span class="variable">bookDao</span> <span class="operator">=</span> (BookDao) ac.getBean(<span class="string">&quot;bookDao&quot;</span>);</span><br><span class="line">        bookDao.save(); </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">运行成功：</span><br><span class="line">init~~~</span><br><span class="line">BookDao~~~~~</span><br><span class="line">destroy~~~</span><br></pre></td></tr></table></figure></blockquote><p>将<code>close()</code>放到上面：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">App</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//获取ICO容器</span></span><br><span class="line">        <span class="type">ClassPathXmlApplicationContext</span> <span class="variable">ac</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line">        ac.close();</span><br><span class="line">        <span class="comment">//获取bean</span></span><br><span class="line">        <span class="type">BookDao</span> <span class="variable">bookDao</span> <span class="operator">=</span> (BookDao) ac.getBean(<span class="string">&quot;bookDao&quot;</span>);</span><br><span class="line">        bookDao.save();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">运行结果：</span><br><span class="line">init~~~</span><br><span class="line">destroy~~~</span><br><span class="line">报错：BeanFactory not initialized or already closed - call <span class="string">&#x27;refresh&#x27;</span> before accessing beans via the ApplicationContext</span><br><span class="line">    BeanFactory没有被初始化或者已经被关闭了</span><br><span class="line">    运行失败！！</span><br></pre></td></tr></table></figure></blockquote><p>或者通过接口的方式实现：</p><p><code>BookServiceImpl</code>类实现接口<code>InitializingBean</code>和<code>DisposableBean</code>的方法</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">BookService</span>, InitializingBean, DisposableBean &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> BookDao bookDao;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setBookDao</span><span class="params">(BookDao bookDao)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;BookDao set~~~&quot;</span>);</span><br><span class="line">        <span class="built_in">this</span>.bookDao = bookDao;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">()</span> &#123;</span><br><span class="line">        bookDao.save();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;service destroy~~~~&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterPropertiesSet</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;service init~~~~&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>配置文件：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;bookDao&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.spring.dao.impl.BookDaoImpl&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">init-method</span>=<span class="string">&quot;init&quot;</span> <span class="attr">destroy-method</span>=<span class="string">&quot;destroy&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;bookService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.spring.service.impl.BookServiceImpl&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;bookDao&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;bookDao&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><p>主函数运行：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">App</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//获取ICO容器</span></span><br><span class="line">        <span class="type">ClassPathXmlApplicationContext</span> <span class="variable">ac</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line">        <span class="comment">//获取bean</span></span><br><span class="line">        <span class="type">BookDao</span> <span class="variable">bookDao</span> <span class="operator">=</span> (BookDao) ac.getBean(<span class="string">&quot;bookDao&quot;</span>);</span><br><span class="line">        bookDao.save();</span><br><span class="line">        ac.registerShutdownHook();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">运行结果：</span><br><span class="line">init~~~</span><br><span class="line">BookDao set~~~</span><br><span class="line">service init~~~~</span><br><span class="line">BookDao~~~~~</span><br><span class="line">service destroy~~~~</span><br><span class="line">destroy~~~</span><br></pre></td></tr></table></figure></blockquote><p><code>BookServiceImpl</code>类中<code>destroy()</code>方法和<code>afterPropertiesSet()</code>方法被调用</p><p>并且<code>setBookDao()</code>方法之后才调用的<code>afterPropertiesSet()</code>方法</p></div><div class="story post-story"><h2 id="9-依赖注入方式"><a href="#9-依赖注入方式" class="headerlink" title="9.依赖注入方式"></a>9.依赖注入方式</h2><p>向一个类传递数据的方式有：set方法、构造方法</p><h3 id="9-1-setter注入"><a href="#9-1-setter注入" class="headerlink" title="9.1 setter注入"></a>9.1 setter注入</h3><ul><li><p><strong>引用类型</strong></p><p>在bean中定义引用类型属性并提供可访问的<code>set</code>方法</p><p><code>BookServiceImpl</code>类中：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">BookService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> BookDao bookDao;</span><br><span class="line"><span class="comment">//提供相应的set的方法</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setBookDao</span><span class="params">(BookDao bookDao)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.bookDao = bookDao;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在配置文件中使用<code>property</code>标签<code>ref</code>属性注入引用类型对象</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;bookDao&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.spring.dao.impl.BookDaoImpl&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;bookService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.spring.service.impl.BookServiceImpl&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;bookDao&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;bookDao&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p><strong>简单类型</strong></p><p>在bean中定义引用类型属性并提供可访问的<code>set</code>方法</p><p><code>BookDaoImpl</code>类中：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">BookDao</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAge</span><span class="params">(<span class="type">int</span> age)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;BookDao~~~~~&quot;</span>+<span class="string">&quot;姓名：&quot;</span>+name+<span class="string">&quot;年龄：&quot;</span>+age);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>配置文件中，在<code>property</code>标签<code>value</code>属性注入简单类型数据</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;bookDao&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.spring.dao.impl.BookDaoImpl&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;DaHuang&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;age&quot;</span> <span class="attr">value</span>=<span class="string">&quot;18&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><p>运行主函数：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">App</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//获取ICO容器</span></span><br><span class="line">        <span class="type">ClassPathXmlApplicationContext</span> <span class="variable">ac</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line">        <span class="comment">//获取bean</span></span><br><span class="line">        <span class="type">BookDao</span> <span class="variable">bookDao</span> <span class="operator">=</span> (BookDao) ac.getBean(<span class="string">&quot;bookDao&quot;</span>);</span><br><span class="line">        bookDao.save();</span><br><span class="line">        ac.registerShutdownHook();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">运行结果：</span><br><span class="line">BookDao~~~~~姓名：DaHuang年龄：<span class="number">18</span></span><br></pre></td></tr></table></figure></blockquote></li></ul><h3 id="9-2-构造器注入"><a href="#9-2-构造器注入" class="headerlink" title="9.2 构造器注入"></a>9.2 构造器注入</h3><ul><li><p><strong>引用类型</strong></p><p>在bean中定义引用类型属性并提供可访问的<strong>构造</strong>方法</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">BookService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> BookDao bookDao;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">BookServiceImpl</span><span class="params">(BookDao bookDao)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;BookServiceImpl构造器运行~~~&quot;</span>);</span><br><span class="line">        <span class="built_in">this</span>.bookDao = bookDao;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>配置文件中，使用<code>constructor-arg</code>标签中的<code>ref</code>属性注入引用类型对象</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;bookDao&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.spring.dao.impl.BookDaoImpl&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;DaHuang&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;age&quot;</span> <span class="attr">value</span>=<span class="string">&quot;18&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;bookService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.spring.service.impl.BookServiceImpl&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;bookDao&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;bookDao&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><p>运行主函数：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">App</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//获取ICO容器</span></span><br><span class="line">        <span class="type">ClassPathXmlApplicationContext</span> <span class="variable">ac</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line">        <span class="comment">//获取bean</span></span><br><span class="line">        <span class="type">BookDao</span> <span class="variable">bookDao</span> <span class="operator">=</span> (BookDao) ac.getBean(<span class="string">&quot;bookDao&quot;</span>);</span><br><span class="line">        bookDao.save();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">运行结果：</span><br><span class="line">BookServiceImpl构造器运行~~~</span><br></pre></td></tr></table></figure></blockquote></li><li><p><strong>简单类型</strong></p><p><code>BookDaoImpl</code>类中：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">BookDao</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">BookDaoImpl</span><span class="params">(String name, <span class="type">int</span> age)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>配置文件中：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;bookDao&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.spring.dao.impl.BookDaoImpl&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;DaHei&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;age&quot;</span> <span class="attr">value</span>=<span class="string">&quot;20&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><p>如果要更改<code>BookDaoImpl</code>类中的形参名字，还要更改配置文件中的<code>name</code>属性的名字；</p><p>存在形参与<code>name</code>属性名不耦合的问题。</p><p><code>constructor-arg</code>标签还有<code>type</code>和<code>index</code>属性</p><ul><li>type：形参的数据类型(存在多个同数据类型的形参，无法使用)</li><li>index：形参的位置顺序</li></ul><p>在配置文件中，使用<code>index</code>属性设置按形参位置顺序注入</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean id=<span class="string">&quot;bookDao&quot;</span> class=<span class="string">&quot;com.spring.dao.impl.BookDaoImpl&quot;</span>&gt;</span><br><span class="line">        &lt;constructor-arg index=<span class="string">&quot;0&quot;</span> value=<span class="string">&quot;DaHei&quot;</span>/&gt;</span><br><span class="line">        &lt;constructor-arg index=<span class="string">&quot;1&quot;</span> value=<span class="string">&quot;20&quot;</span>/&gt;</span><br><span class="line">&lt;/bean&gt;</span><br></pre></td></tr></table></figure><p>运行主函数：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">App</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//获取ICO容器</span></span><br><span class="line">        <span class="type">ClassPathXmlApplicationContext</span> <span class="variable">ac</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">BookDao</span> <span class="variable">bookDao</span> <span class="operator">=</span> (BookDao) ac.getBean(<span class="string">&quot;bookDao&quot;</span>);</span><br><span class="line">        bookDao.save();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">运行结果：</span><br><span class="line">BookDao~~~~~姓名：DaHei年龄：<span class="number">20</span></span><br></pre></td></tr></table></figure></li></ul><h3 id="9-3-依赖注入方式的选择"><a href="#9-3-依赖注入方式的选择" class="headerlink" title="9.3 依赖注入方式的选择"></a>9.3 依赖注入方式的选择</h3><ol><li><blockquote><p><strong>强制依赖使用<code>构造器注入</code>，使用<code>setter注入</code>有概率不注入导致<code>null</code>对象出现。</strong></p><p>bean必须要的东西，要用构造器注入。因为构造器必须被执行，必须注入，否则报错</p><p>而<code>setter</code>方法可以执行也可以不执行，如果没有进行<code>setter</code>注入，会导致<code>null</code>对象</p></blockquote></li><li><blockquote><p><strong>可选依赖使用<code>setter注入</code>进行，灵活性强。</strong></p><p><code>setter注入</code>可以执行也可以不执行</p></blockquote></li><li><blockquote><p><strong>Spring框架倡导使用构造器。</strong></p><p>第三方框架大多采用构造器注入的形式初始化数据，更加严谨</p></blockquote></li><li><blockquote><p><strong>setter注入和构造器注入可以同时使用。</strong></p><p>使用构造器完成强制依赖注入，使用setter注入完成可选依赖注入</p></blockquote></li><li><blockquote><p><strong>自己开发的模块推荐使用setter注入</strong></p></blockquote></li></ol></div><div class="story post-story"><h2 id="10-依赖自动装配"><a href="#10-依赖自动装配" class="headerlink" title="10.依赖自动装配"></a>10.依赖自动装配</h2><p>IOC容器根据bean都依赖的资源在容器中自动查找并注入到bean中的过程称为<strong>自动装配</strong></p><p>自动装配的方式：</p><blockquote><ul><li><strong>按类型(常用)</strong></li><li>按名称</li><li>按构造方法(不推荐)</li><li>不启用自动装配</li></ul></blockquote><h3 id="10-1-按类型"><a href="#10-1-按类型" class="headerlink" title="10.1 按类型"></a>10.1 按类型</h3><p>需要提供相应的<code>setter</code>方法</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">BookService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> BookDao bookDao;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setBookDao</span><span class="params">(BookDao bookDao)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;BookDao set~~~&quot;</span>);</span><br><span class="line">        <span class="built_in">this</span>.bookDao = bookDao;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>配置文件中，要提前写好<code>bookDao</code>的<code>bean</code>否则无法装配，</p><p><code>autowire</code>属性设置为<code>byTpye</code> 通过类型自动装配</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;bookDao&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.spring.dao.impl.BookDaoImpl&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;bookService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.spring.service.impl.BookServiceImpl&quot;</span> </span></span><br><span class="line"><span class="tag">      <span class="attr">autowire</span>=<span class="string">&quot;byType&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure><p>主函数：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">App</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="type">ClassPathXmlApplicationContext</span> <span class="variable">ac</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">BookService</span> <span class="variable">bookService</span> <span class="operator">=</span> (BookService) ac.getBean(<span class="string">&quot;bookService&quot;</span>);</span><br><span class="line">        bookService.save();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">运行结果：</span><br><span class="line">BookDao set~~~</span><br></pre></td></tr></table></figure></blockquote><p>如果出现一下这种情况：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;bookDao1&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.spring.dao.impl.BookDaoImpl&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;bookDao2&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.spring.dao.impl.BookDaoImpl&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;bookService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.spring.service.impl.BookServiceImpl&quot;</span> </span></span><br><span class="line"><span class="tag">      <span class="attr">autowire</span>=<span class="string">&quot;byType&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>出现了两个<code>BookDao</code>的bean，导致Spring无法区分了，这时就需要<strong>按名称装配</strong></p></blockquote><h3 id="10-2-按名称"><a href="#10-2-按名称" class="headerlink" title="10.2 按名称"></a>10.2 按名称</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">BookService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> BookDao bookDao;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setBookDao</span><span class="params">(BookDao bookDao)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;BookDao set~~~&quot;</span>);</span><br><span class="line">        <span class="built_in">this</span>.bookDao = bookDao;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>配置文件中，<code>autowire</code>属性设置为<code>byName</code> 通过名称自动装配</p><p>是通过<code>BookServiceImpl</code>类的变量名<code>bookDao</code>与配置文件的bean中<code>id</code>相同名称的进行绑定</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;bookDao&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.spring.dao.impl.BookDaoImpl&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;bookDao2&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.spring.dao.impl.BookDaoImpl&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;bookService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.spring.service.impl.BookServiceImpl&quot;</span> </span></span><br><span class="line"><span class="tag">      <span class="attr">autowire</span>=<span class="string">&quot;ByName&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure><h3 id="10-3-总结"><a href="#10-3-总结" class="headerlink" title="10.3 总结"></a>10.3 总结</h3><blockquote><ul><li><p>自动装配用于引用类型依赖注入，不能对简单类型进行操作</p></li><li><p>使用按类型装配<code>byType</code>，必须保障容器中相同类型的bean<strong>唯一</strong>，推荐使用</p></li><li><p>使用按名称装配<code>byName</code>，必须保障容器中具有指定名称的bean，变量名要与配置耦合，</p><p>不推荐使用</p></li><li><p>自动装配优先级低于<code>setter注入</code>和<code>构造器注入</code>，同时出现时自动装配配置失效</p></li></ul></blockquote></div><div class="story post-story"><h2 id="11-集合注入"><a href="#11-集合注入" class="headerlink" title="11.集合注入"></a>11.集合注入</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">BookDao</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span>[] array;</span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; list;</span><br><span class="line">    <span class="keyword">private</span> Set&lt;String&gt; set;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, String&gt; map;</span><br><span class="line">    <span class="keyword">private</span> Properties properties;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setArray</span><span class="params">(<span class="type">int</span>[] array)</span> &#123;<span class="built_in">this</span>.array = array;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setList</span><span class="params">(List&lt;String&gt; list)</span> &#123;<span class="built_in">this</span>.list = list;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setSet</span><span class="params">(Set&lt;String&gt; set)</span> &#123;<span class="built_in">this</span>.set = set;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setMap</span><span class="params">(Map&lt;String, String&gt; map)</span> &#123;<span class="built_in">this</span>.map = map;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setProperties</span><span class="params">(Properties properties)</span> &#123;<span class="built_in">this</span>.properties = properties;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;BookDaoImpl&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;\narray=&quot;</span> + Arrays.toString(array) +</span><br><span class="line">                <span class="string">&quot;, \nlist=&quot;</span> + list +</span><br><span class="line">                <span class="string">&quot;, \nset=&quot;</span> + set +</span><br><span class="line">                <span class="string">&quot;, \nmap=&quot;</span> + map +</span><br><span class="line">                <span class="string">&quot;, \nproperties=&quot;</span> + properties +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>配置文件中：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;bookDao&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.spring.dao.impl.BookDaoImpl&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;array&quot;</span> &gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">array</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>100<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>200<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>300<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">array</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;list&quot;</span> &gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>唱<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>跳<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>Rap<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;set&quot;</span> &gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>唱<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>跳<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>Rap<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>Rap<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;map&quot;</span> &gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">map</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;county&quot;</span> <span class="attr">value</span>=<span class="string">&quot;china&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;province&quot;</span> <span class="attr">value</span>=<span class="string">&quot;tianjin&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;city&quot;</span> <span class="attr">value</span>=<span class="string">&quot;baodi&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">map</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;properties&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">props</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">&quot;county&quot;</span>&gt;</span>china<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">&quot;province&quot;</span>&gt;</span>tianjin<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">&quot;city&quot;</span>&gt;</span>baodi<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">props</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><p>运行主函数：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">App</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ClassPathXmlApplicationContext</span> <span class="variable">ac</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="type">BookDao</span> <span class="variable">bookDao</span> <span class="operator">=</span> (BookDao) ac.getBean(<span class="string">&quot;bookDao&quot;</span>);</span><br><span class="line">        bookDao.save();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">运行结果：</span><br><span class="line">BookDaoImpl&#123;</span><br><span class="line">array=[<span class="number">100</span>, <span class="number">200</span>, <span class="number">300</span>], </span><br><span class="line">list=[唱, 跳, Rap], </span><br><span class="line">set=[唱, 跳, Rap], </span><br><span class="line">map=&#123;county=china, province=tianjin, city=baodi&#125;, </span><br><span class="line">properties=&#123;province=tianjin, city=baodi, county=china&#125;&#125;</span><br></pre></td></tr></table></figure></blockquote></div><div class="story post-story"><h2 id="12-数据源对象管理"><a href="#12-数据源对象管理" class="headerlink" title="12.数据源对象管理"></a>12.数据源对象管理</h2><p>在<code>pom.xml</code>导入<code>druid</code>坐标</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.8<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.0.28<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>配置文件中，管理<code>DruidDataSouurce</code>对象</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.alibaba.druid.pool.DruidDataSource&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClassName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql://localhost:3306/demo&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;123456&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><p>运行主函数：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">App</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//获取ICO容器</span></span><br><span class="line">        <span class="type">ClassPathXmlApplicationContext</span> <span class="variable">ac</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">DataSource</span> <span class="variable">dataSource</span> <span class="operator">=</span> (DataSource) ac.getBean(<span class="string">&quot;dataSource&quot;</span>);</span><br><span class="line">        System.out.println(dataSource);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">运行结果：</span><br><span class="line">&#123;</span><br><span class="line">CreateTime:&quot;2022-06-24 22:27:03&quot;,</span><br><span class="line">ActiveCount:0,</span><br><span class="line">PoolingCount:0,</span><br><span class="line">CreateCount:0,</span><br><span class="line">DestroyCount:0,</span><br><span class="line">CloseCount:0,</span><br><span class="line">ConnectCount:0,</span><br><span class="line">Connections:[</span><br><span class="line">]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></blockquote></div><div class="story post-story"><h2 id="13-加载properties配置信息"><a href="#13-加载properties配置信息" class="headerlink" title="13.加载properties配置信息"></a>13.加载properties配置信息</h2><p>在<code>rescource</code>资源包中创建<code>jdbc.properties</code>文件：</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">jdbc.driver</span>=<span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line"><span class="attr">jdbc.url</span>=<span class="string">jdbc:mysql://localhost:3306/demo</span></span><br><span class="line"><span class="attr">jdbc.username</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">jdbc.password</span>=<span class="string">123456</span></span><br><span class="line"></span><br><span class="line"><span class="attr">username</span>=<span class="string">dahuang</span></span><br><span class="line"><span class="attr">age</span>=<span class="string">18</span></span><br></pre></td></tr></table></figure><p>配置文件中:</p><blockquote><ul><li>在<code>beans</code>标签中开启<code>context</code>命名空间</li><li>使用<code>context</code>空间加载<code>properties</code>文件</li></ul></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag"></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       </span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/beans </span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">   </span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 1.开启context命名空间 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 2.使用context空间加载properties文件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">&quot;jdbc.properties&quot;</span> </span></span><br><span class="line"><span class="tag">                                  <span class="attr">system-properties-mode</span>=<span class="string">&quot;NEVER&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.alibaba.druid.pool.DruidDataSource&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 使用占位符$&#123;&#125;读取properties中的属性 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClassName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.driver&#125;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.url&#125;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.username&#125;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.password&#125;&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;bookDao&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.spring.dao.impl.BookDaoImpl&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;username&#125;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;age&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;age&#125;&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>加载properties文件格式：</strong></p><ul><li>不加载系统属性：</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&lt;context</span>:<span class="string">property-placeholder location=&quot;jdbc.properties&quot; </span></span><br><span class="line">                              <span class="attr">system-properties-mode</span>=<span class="string">&quot;NEVER&quot;/&gt;</span></span><br></pre></td></tr></table></figure><ul><li>加载多个properties文件：</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&lt;context</span>:<span class="string">property-placeholder location=&quot;jdbc.properties, jdbc2.properties&quot;/&gt;</span></span><br></pre></td></tr></table></figure><ul><li>加载所有properties文件：</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&lt;context</span>:<span class="string">property-placeholder location=&quot;*.properties&quot;/&gt;</span></span><br></pre></td></tr></table></figure><ul><li>加载properties文件<span style="color:red">标准格式</span>：</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&lt;context</span>:<span class="string">property-placeholder location=&quot;classpath:*.properties&quot;/&gt;</span></span><br></pre></td></tr></table></figure><ul><li>从类路径或jar包中搜索加载properties文件：</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&lt;context</span>:<span class="string">property-placeholder location=&quot;classpath*:*.properties&quot;/&gt;</span></span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="14-容器"><a href="#14-容器" class="headerlink" title="14.容器"></a>14.容器</h2><h3 id="14-1-创建容器的几种方式"><a href="#14-1-创建容器的几种方式" class="headerlink" title="14.1 创建容器的几种方式"></a>14.1 创建容器的几种方式</h3><ul><li>类路径下的加载配置文件</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ApplicationContext</span> <span class="variable">ac</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br></pre></td></tr></table></figure><ul><li>文件系统下加载的配置文件</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ApplicationContext</span> <span class="variable">ac</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;E:\Java_Web\Spring\spring_01_IOC\src\main\resources\applicationContext.xml&quot;</span>);</span><br></pre></td></tr></table></figure><ul><li>加载多个配置文件：</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ApplicationContext</span> <span class="variable">ac</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;applicationContext1.xml&quot;</span>,<span class="string">&quot;applicationContext2.xml&quot;</span>);</span><br></pre></td></tr></table></figure><h3 id="14-2-获取bean的几种方式"><a href="#14-2-获取bean的几种方式" class="headerlink" title="14.2 获取bean的几种方式"></a>14.2 获取bean的几种方式</h3><ul><li>使用bean名称获取</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">BookDao</span> <span class="variable">bookDao</span> <span class="operator">=</span> (BookDao) ac.getBean(<span class="string">&quot;bookDao&quot;</span>);</span><br></pre></td></tr></table></figure><ul><li>使用bean名称获取并指定类型</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">BookDao</span> <span class="variable">bookDao</span> <span class="operator">=</span> ac.getBean(<span class="string">&quot;bookDao&quot;</span>,BookDao.class);</span><br></pre></td></tr></table></figure><ul><li>使用bean类型获取</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">BookDao</span> <span class="variable">bookDao</span> <span class="operator">=</span> ac.getBean(BookDao.class);<span class="comment">//对应的容器中只能有一个该类型，唯一</span></span><br></pre></td></tr></table></figure><h3 id="14-3-容器类层次结构"><a href="#14-3-容器类层次结构" class="headerlink" title="14.3 容器类层次结构"></a>14.3 容器类层次结构</h3><p>使用<code>ctrl+H</code>打开容器类的层次结构图：</p><img src="https://s2.loli.net/2022/06/26/zCFTWykYuqBf23S.png" class="lazyload" data-srcset="https://s2.loli.net/2022/06/26/zCFTWykYuqBf23S.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220626113036937.png" style="zoom: 67%;" /><blockquote><p>BeanFactory：是IOC容器的顶层接口，初始化BeanFactory对象时，加载的bean延迟加载</p><p>ApplicationContext：是Spring容器的核心接口，初始化时bean立即加载</p><p>​  提供基础的bean操作相关的方法，通过其他接口扩展其功能</p><p>ConfigurableApplicationContext：提供关闭容器功能</p><p>ClassPathXmlApplicationContext：常用实现类</p></blockquote><h3 id="14-4-BeanFactory初始化"><a href="#14-4-BeanFactory初始化" class="headerlink" title="14.4 BeanFactory初始化"></a>14.4 BeanFactory初始化</h3><p>类路径加载配置文件：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">App</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Rescoure</span> <span class="variable">rescoure</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathRescoure</span>(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line">        <span class="type">BeanFactory</span> <span class="variable">bf</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">XmlBeanFactory</span>(rescoure);</span><br><span class="line">        <span class="type">BookDao</span> <span class="variable">bookDao</span> <span class="operator">=</span> bf.getBean(<span class="string">&quot;bookDao&quot;</span>,BookDao.class);</span><br><span class="line">        bookDao.save();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>BeanFactory创建完毕后，所有bean均为延迟加载</p></div><div class="story post-story"><h2 id="15-注解开发"><a href="#15-注解开发" class="headerlink" title="15.注解开发*"></a>15.注解开发*</h2><h3 id="15-1-用注释定义bean"><a href="#15-1-用注释定义bean" class="headerlink" title="15.1 用注释定义bean"></a>15.1 用注释定义bean</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@component(&quot;bookDao&quot;)</span> <span class="comment">//等价于&lt;bean id=&quot;bookDao&quot; class=&quot;com.spring.dao.impl.BookDaoImpl&quot;/&gt;</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">BookDao</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;BookDao~~~~~&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span> <span class="comment">//没有写bean名，要通过类型获取bean</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">BookService</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;BookService~~~~&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>但是，Spring怎么感知到注释呢？</p><p>配置文件中，需要添加扫描组件：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 扫描@component组件 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- base-package为扫描的位置 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.spring&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><p>主函数：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">App</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//获取ICO容器</span></span><br><span class="line">        <span class="type">ClassPathXmlApplicationContext</span> <span class="variable">ac</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line">        <span class="comment">//获取bean</span></span><br><span class="line">        <span class="type">BookDao</span> <span class="variable">bookDao</span> <span class="operator">=</span> (BookDao) ac.getBean(<span class="string">&quot;bookDao&quot;</span>);</span><br><span class="line">        bookDao.save();</span><br><span class="line"><span class="comment">//因为@component，并没有写bean名，所以要用类型获取bean</span></span><br><span class="line">        <span class="type">BookService</span> <span class="variable">bookService</span> <span class="operator">=</span> ac.getBean(BookService.class);</span><br><span class="line">        bookService.save();   </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">运行结果：</span><br><span class="line">BookDao~~~~~</span><br><span class="line">BookService~~~~</span><br></pre></td></tr></table></figure></blockquote><p><strong>Spring提供@component注解的三个衍生注解</strong></p><blockquote><p>@Repository：用于数据层bean定义(Dao层)</p><p>​  也可以加括号来指定bean名，如：@Repository(“bookDao2”)</p><p>@Service：用于业务层bean定义(Service层)</p><p>@Controller：用于表现层bean定义(Controller层)</p><p><span style="color:red">@Service,@Repository不能写在接口上,需要写在接口的实现类上</span></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">BookDao</span> &#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">BookService</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookController</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="15-2-纯注释开发"><a href="#15-2-纯注释开发" class="headerlink" title="15.2 纯注释开发"></a>15.2 纯注释开发</h3><p>新建一个<code>SpringConfig</code>类，用来替代配置文件。</p><p>其位置：<code>com.spring.config.SpringConfig.java</code></p><blockquote><p>com包</p><blockquote><p>spring包</p><blockquote><p>config包</p><blockquote><p><code>SpringConfig.java</code></p></blockquote></blockquote></blockquote></blockquote><blockquote><p><code>@Configuration</code> ：用于设定当前类为配置类<br><code>@ComponentScan(&quot;com.spring&quot;)</code> ：用用于设定扫描路径，此注释只能添加一次，多个数据用数组格式</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//用来替代 &lt;context:component-scan base-package=&quot;com.spring&quot;/&gt;</span></span><br><span class="line"><span class="meta">@Configuration</span> <span class="comment">//用于设定当前类为配置类</span></span><br><span class="line"><span class="meta">@ComponentScan(&quot;com.spring&quot;)</span> <span class="comment">//用用于设定扫描路径，此注释只能添加一次，多个数据用数组格式</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringConfig</span> &#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>主函数：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppForAnnotation</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//改用注释配置初始化容器</span></span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">ac</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>(SpringConfig.class);</span><br><span class="line">        <span class="type">BookDao</span> <span class="variable">bookDao</span> <span class="operator">=</span> ac.getBean(BookDao.class);</span><br><span class="line">        bookDao.save();</span><br><span class="line"></span><br><span class="line">        <span class="type">BookService</span> <span class="variable">bookService</span> <span class="operator">=</span> ac.getBean(BookService.class);</span><br><span class="line">        bookService.save();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">运行结果：</span><br><span class="line">BookDao~~~~~</span><br><span class="line">BookService~~~~</span><br></pre></td></tr></table></figure></blockquote><h3 id="15-3-bean管理"><a href="#15-3-bean管理" class="headerlink" title="15.3 bean管理"></a>15.3 bean管理</h3><blockquote><p>作用范围</p><ul><li><code>@Scope(&quot;singleton&quot;)</code>：单例，默认单例</li><li><code>@Scope(&quot;prototype&quot;)</code>：多例</li></ul><p>bean生命周期控制</p><ul><li><p><code>@PostConstruct</code>注解：init</p></li><li><p><code>@PreDestroy</code>注解：destory</p></li></ul></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="meta">@Scope(&quot;prototype&quot;)</span> <span class="comment">//多例</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">BookDao</span> &#123;</span><br><span class="line"><span class="meta">@PostConstruct</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;init~~~&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@PreDestroy</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;destroy~~~&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="15-4-依赖注入"><a href="#15-4-依赖注入" class="headerlink" title="15.4 依赖注入"></a>15.4 依赖注入</h3><p><strong><span style="color:red">1.引用类型</span></strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">BookService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> BookDao bookDao;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;BookService~~~~&quot;</span>);</span><br><span class="line">        bookDao.save();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>主函数：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppForAnnotation</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">ac</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>(SpringConfig.class);</span><br><span class="line">        </span><br><span class="line">        <span class="type">BookService</span> <span class="variable">bookService</span> <span class="operator">=</span> ac.getBean(BookService.class);</span><br><span class="line">        bookService.save();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">运行结果：</span><br><span class="line">BookService~~~~ //在创建好BookService的bean,并注入BookDao</span><br><span class="line">BookDao~~~~~ //调用BookDao的方法save();</span><br></pre></td></tr></table></figure></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Repository(&quot;bookDao&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">BookDao</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Repository(&quot;bookDao2&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookDaoImpl2</span> <span class="keyword">implements</span> <span class="title class_">BookDao</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>当有多个同类型的bean，使用<code>@Qualifier(&quot;bookDao2&quot;)</code>来指定bean名</p><p>并且需要<code>@Autowired</code>和<code>@Qualifier(&quot;bookDao2&quot;)</code>一起使用</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">BookService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="meta">@Qualifier(&quot;bookDao2&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> BookDao bookDao;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;BookService~~~~&quot;</span>);</span><br><span class="line">        bookDao.save();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>注意：</strong></p><ul><li><strong>自动装配</strong>基于<strong>反射</strong>设计创建对象并<strong>暴力反射</strong>对应属性为私有属性初始化数据，无需提供<code>setter</code>方法</li><li><strong>自动装配</strong>建议使用<strong>无参构造方法</strong>创建对象，如果不提供对应的构造方法，请提供唯一的构造方法</li><li><code>@Qualifier</code>注解无法单独使用，必须配合<code>@Autowired</code>注解使用</li></ul><p><strong><span style="color:red">2.简单类型</span></strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">BookDao</span> &#123;</span><br><span class="line"><span class="meta">@Value(&quot;dahuang&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;BookDao~~~~~&quot;</span>+<span class="string">&quot;姓名：&quot;</span>+name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>主函数：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppForAnnotation</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">ac</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>(SpringConfig.class);</span><br><span class="line">        <span class="type">BookDao</span> <span class="variable">bookDao</span> <span class="operator">=</span> ac.getBean(BookDao.class);</span><br><span class="line">        bookDao.save();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">运行结果：</span><br><span class="line">BookDao~~~~~姓名：dahaung</span><br></pre></td></tr></table></figure></blockquote><p>但是，我们为什么不直接赋值，为什么要用<code>@Value</code>注解呢？</p><p>我们可以用<code>properties</code>文件，向其传值。</p><p><strong><span style="color:red">3.读取properties文件</span></strong></p><p>通过创建一个<code>jdbc.properties</code>文件：</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">name</span>=<span class="string">dahei</span></span><br></pre></td></tr></table></figure><p>在配置类中新加注解<code>@PropertySource()</code>，括号中指定文件名：</p><blockquote><p>如：<code>@PropertySource(&quot;jdbc.properties&quot;)</code>或者<code>@PropertySource(&quot;classpath:jdbc.properties&quot;)</code></p><p>也可以指定多个文件：</p><p>如：<code>@PropertySource(&#123;&quot;jdbc.properties&quot;,&quot;jdbc1.properties&quot;,&quot;jdbc2.properties&quot;&#125;)</code></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(&quot;com.spring&quot;)</span></span><br><span class="line"><span class="meta">@PropertySource(&quot;jdbc.properties&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringConfig</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在<code>BookDaoImpl</code>中将注解改为：<code>@Value(&quot;$&#123;&#125;&quot;)</code>，在<code>&#123;&#125;</code>中填入properties文件中的属性</p><p>如：<code>@Value(&quot;$&#123;name&#125;&quot;)</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">BookDao</span> &#123;</span><br><span class="line"><span class="meta">@Value(&quot;$&#123;name&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;BookDao~~~~~&quot;</span>+<span class="string">&quot;姓名：&quot;</span>+name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="15-5-第三方bean管理"><a href="#15-5-第三方bean管理" class="headerlink" title="15.5 第三方bean管理"></a>15.5 第三方bean管理</h3><p><strong><span style="color:red">1.使用独立的配置管理第三方bean</span></strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringConfig</span> &#123;</span><br><span class="line">    <span class="comment">//定义一个方法获得想要管理的bean</span></span><br><span class="line">    <span class="meta">@Bean</span> <span class="comment">// 表示当前方法返回值是一个bean</span></span><br><span class="line">    <span class="keyword">public</span> DruidDataSource <span class="title function_">dataSource</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">DruidDataSource</span> <span class="variable">ds</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DruidDataSource</span>();</span><br><span class="line">    <span class="comment">//相关配置</span></span><br><span class="line">        ds.setDriverClassName(<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>);</span><br><span class="line">        ds.setUrl(<span class="string">&quot;jdbc:mysql://localhost:3306/demo&quot;</span>);</span><br><span class="line">        ds.getUsername(<span class="string">&quot;root&quot;</span>);</span><br><span class="line">        ds.setPassword(<span class="string">&quot;123456&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> ds;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>但是<strong>不建议</strong>将独立配置<strong>直接</strong>写在核心配置类中：</p><p><strong>方法一：<span style="color:red">导入式</span>(建议使用)</strong></p><p>在<code>config包</code>创建一个<code>JdbcConfig.java</code>配置类：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JdbcConfig</span> &#123;</span><br><span class="line">    <span class="comment">//定义一个方法获得想要管理的bean</span></span><br><span class="line">    <span class="meta">@Bean</span> <span class="comment">// 表示当前方法返回值是一个bean</span></span><br><span class="line">    <span class="keyword">public</span> DruidDataSource <span class="title function_">dataSource</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">DruidDataSource</span> <span class="variable">ds</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DruidDataSource</span>();</span><br><span class="line">        <span class="comment">//相关配置</span></span><br><span class="line">        ds.setDriverClassName(<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>);</span><br><span class="line">        ds.setUrl(<span class="string">&quot;jdbc:mysql://localhost:3306/demo&quot;</span>);</span><br><span class="line">        ds.setUsername(<span class="string">&quot;root&quot;</span>);</span><br><span class="line">        ds.setPassword(<span class="string">&quot;123456&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> ds;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在<code>SpringConfig.java</code>核心配置类中导入：</p><blockquote><p>使用注解<code>@Import()</code>在括号中添加要导入的配置类的类型</p><p>如：<code>@Import(JdbcConfig.class)</code></p><p>此注解只能添加一次，导入多个配置类，可以使用数组格式导入</p><p>如：<code>@Import(&#123;JdbcConfig.class, XXXConfig.class, XXXConfig.calss&#125;)</code></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@Import(JdbcConfig.class)</span> <span class="comment">//导入JdbcConfigpei</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>方式二：<span style="color:red">扫描式</span>(不建议使用)</strong></p><p><strong>注意：使用扫描式需要在独立的配置类加入注解<code>@Configuration</code></strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JdbcConfig</span> &#123;</span><br><span class="line">    <span class="comment">//定义一个方法获得想要管理的bean</span></span><br><span class="line">    <span class="meta">@Bean</span> <span class="comment">// 表示当前方法返回值是一个bean</span></span><br><span class="line">    <span class="keyword">public</span> DataSource <span class="title function_">dataSource</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">DruidDataSource</span> <span class="variable">ds</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DruidDataSource</span>();</span><br><span class="line">        <span class="comment">//相关配置</span></span><br><span class="line">        ds.setDriverClassName(<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>);</span><br><span class="line">        ds.setUrl(<span class="string">&quot;jdbc:mysql://localhost:3306/demo&quot;</span>);</span><br><span class="line">        ds.setUsername(<span class="string">&quot;root&quot;</span>);</span><br><span class="line">        ds.setPassword(<span class="string">&quot;123456&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> ds;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在<code>SpringConfig.java</code>核心配置类中扫描：</p><p>使用注解<code>@ComponentScan()</code>在括号中添加要扫描的路径</p><p>如：<code>@@ComponentScan(&quot;com.spring.config&quot;)</code></p><p>扫描多个路径，可以使用数组格式导入</p><p>如：<code>@Import(&#123;&quot;com.spring.config&quot;,&quot;com.spring.dao&quot;&#125;)</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(&quot;com.spring.config&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong><span style="color:red">2.第三方bean注入资源</span></strong></p><ul><li>简单类型依赖注入(<strong><span style="color:red">成员变量</span></strong>)：</li></ul><p>利用注解<code>@PropertySource(&quot;jdbc.properties&quot;)</code>和<code>@Import(JdbcConfig.class)</code>导入核心主配置文件中</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(&quot;com.spring&quot;)</span></span><br><span class="line"><span class="meta">@PropertySource(&quot;jdbc.properties&quot;)</span></span><br><span class="line"><span class="meta">@Import(JdbcConfig.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringConfig</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>利用注解<code>@Value(&quot;$&#123;&#125;&quot;)</code>注入数据</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JdbcConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;jdbc.driver&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String driver;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;jdbc.url&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String url;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;jdbc.username&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String userName;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;jdbc.password&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//定义一个方法获得想要管理的bean</span></span><br><span class="line">    <span class="meta">@Bean</span> <span class="comment">// 表示当前方法返回值是一个bean</span></span><br><span class="line">    <span class="keyword">public</span> DataSource <span class="title function_">dataSource</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">DruidDataSource</span> <span class="variable">ds</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DruidDataSource</span>();</span><br><span class="line">        </span><br><span class="line">        ds.setDriverClassName(driver);</span><br><span class="line">        ds.setUrl(url);</span><br><span class="line">        ds.setUsername(userName);</span><br><span class="line">        ds.setPassword(password);</span><br><span class="line">        <span class="keyword">return</span> ds;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>引入类型依赖注入(<strong><span style="color:red">方法形参</span></strong>)：</li></ul><blockquote><p>引用类型注入只需要为<strong>bean定义的方法</strong>设置<strong>形参</strong>，容器会根据类型自动装配对象</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//定义一个方法获得想要管理的bean</span></span><br><span class="line">    <span class="meta">@Bean</span> <span class="comment">// 表示当前方法返回值是一个bean</span></span><br><span class="line">    <span class="keyword">public</span> DataSource <span class="title function_">dataSource</span><span class="params">(BookDao bookDao)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;已引用：&quot;</span>+bookDao);</span><br><span class="line">        </span><br><span class="line">        <span class="type">DruidDataSource</span> <span class="variable">ds</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DruidDataSource</span>();</span><br><span class="line"><span class="comment">//对ds进行相关设置</span></span><br><span class="line">        <span class="keyword">return</span> ds;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h3 id="15-6-总结"><a href="#15-6-总结" class="headerlink" title="15.6 总结"></a>15.6 总结</h3><p><strong><span style="color:red">XML配置与注解配置的比较：</span></strong></p><table><thead><tr><th align="center">功能</th><th>XML配置</th><th>注解</th></tr></thead><tbody><tr><td align="center">定义bean</td><td>bean标签：<br>&gt;id属性<br>&gt;class属性</td><td>@Component <br>&gt;@Controller <br>&gt;<span style="color:red">@Service</span> <br>&gt;@Repository<br><span style="color:red">@ComponentScan</span></td></tr><tr><td align="center">设置依赖注入</td><td>setter注入(set方法)<br>&gt;引用&#x2F;简单<br>构造器注入(构造方法)<br>&gt;自动装配</td><td><span style="color:red">@Autowird</span><br>&gt;@Qualifier<br>@Value</td></tr><tr><td align="center">配置第三方bean</td><td>bean标签<br>&gt;静态工厂<br>&gt;实例工厂<br>&gt;FactoryBean</td><td><span style="color:red">@Bean</span></td></tr><tr><td align="center">作用范围</td><td>scope属性</td><td>@Scope</td></tr><tr><td align="center">生命周期</td><td>标准接口<br>&gt;init-method<br>&gt;destory-method</td><td>@PostConstructor<br>@PreDestroy</td></tr></tbody></table></div><div class="story post-story"><h2 id="16-AOP"><a href="#16-AOP" class="headerlink" title="16.AOP"></a>16.AOP</h2><h3 id="16-1-AOP简介"><a href="#16-1-AOP简介" class="headerlink" title="16.1 AOP简介"></a>16.1 AOP简介</h3><blockquote><p>AOP(Aspect Oriented Programming)面向切面编程，一种编程范式，指导开发者如何组织程序结构</p><ul><li>OOP(Object Oriented Programing)面向对象编程</li></ul><p>作用：在不惊动原始设计的基础上为其进行功能增强</p><p>Spring理念：无入侵式&#x2F;无侵入式</p></blockquote><p><img src="https://s2.loli.net/2022/06/27/Nzn7AdMOxjL5fPk.jpg" class="lazyload" data-srcset="https://s2.loli.net/2022/06/27/Nzn7AdMOxjL5fPk.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="2176E56AC16DA86709ADB8795730ABC7.png"></p><p>执行<code>save()</code>方法 </p><ul><li><p>运行结果：</p><p>打印出一万次的book dao <strong>save</strong> … 和消耗的时间</p></li></ul><p>执行<code>update()</code>方法没有图中<strong>蓝色区域的代码</strong>，</p><ul><li><p>但是，运行结果：</p><p>仍会打印打印出一万次的book dao <strong>update</strong> … 和消耗的时间</p></li></ul><blockquote><p>连接点(JoinPoint)：程序执行过程中的任意位置，粒度为执行方法，抛出异常，设置变量等(<strong>代表所有的方法</strong>)</p><ul><li>在SpringAOP中，理解方法的执行</li></ul><p>切入点(Pointcut)：匹配连接点的式子(<strong>代表要追加功能的方法</strong>)</p><ul><li>在SpringAOP中，一个切入点只描述一个具体方法，也可以匹配多个方法<ul><li>一个具体方法：com.spring.dao包下的BookDao接口中的五星参无返回值的save()方法</li><li>匹配多个方法：所有save方法，所有的get开头的方法，所有以Dao结尾的接口中的任意方法，所有带有一个形参的方法</li></ul></li></ul><p>通知(Advice)：在切入点执行的操作，也就是共性功能(<strong>代表追加的功能</strong>)</p><ul><li>在SpringAOP中，功能最终以方法的形式呈现</li></ul><p>通知类：定义通知的类</p><p>切面(Aspect)：描述通知与切入的对应关系</p></blockquote><h3 id="16-2-AOP入门"><a href="#16-2-AOP入门" class="headerlink" title="16.2 AOP入门"></a>16.2 AOP入门</h3><blockquote><p>案例设定：测试接口执行效率</p><p>简化设定：在接口执行当前输出当前的系统时间</p><p>开发模式：XML or <span style="color:red">注解</span>(此入门案例采用注解的方式)</p><p>思路分析：</p><ol><li>导入坐标(pom.xml)</li><li>制作连接点方法(原始操作，Dao接口与实现类)</li><li>制作共性功能(通知类与通知)</li><li>定义切入点</li><li>绑定切入点与通知关系(切面)</li></ol></blockquote><p>pom.xml：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.3.18<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.aspectj<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aspectjweaver<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.9.9.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>创建一个<code>MyAdivice.java</code>类</p><p>其位置：<code>com.spring.aop.MyAdivice.java</code></p><blockquote><p><code>@Component</code>注解：定义为Spring加载的bean</p><p><code>@Aspect</code>注解：把当前类标识为⼀个切⾯供容器读取</p><p><code>@Pointcut(&quot;execution()&quot;)</code>注解：定义切入点，⽅法签名必须是public及void型。</p><p><code>@Before(&quot;pt()&quot;)</code>注解：标识⼀个前置增强⽅法</p><p>切入点<code>pt()</code>的定义依托一个不具有实际意义的方法进行，即无参数、无返回值、方法无实际逻辑</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyAdvice</span> &#123;</span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(void com.spring.dao.BookDao.update())&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">pt</span><span class="params">()</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before(&quot;pt()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">method</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(System.currentTimeMillis());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>@EnableAspectJAutoProxy</code>注解：开启<em>AOP</em>代理自动配置</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(&quot;com.spring&quot;)</span></span><br><span class="line"><span class="meta">@EnableAspectJAutoProxy</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>主函数：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">App</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">ac</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>(SpringConfig.class);</span><br><span class="line">        <span class="type">BookDao</span> <span class="variable">bookDao</span> <span class="operator">=</span> ac.getBean(BookDao.class);</span><br><span class="line">        bookDao.update();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">运行结果：</span><br><span class="line">1656341601464</span><br><span class="line">book dao update~~~</span><br></pre></td></tr></table></figure></blockquote><h3 id="16-3-AOP工作流程"><a href="#16-3-AOP工作流程" class="headerlink" title="16.3 AOP工作流程"></a>16.3 AOP工作流程</h3><ol><li><p>Spring容器启动</p></li><li><p>读取所有切面配置中的切入点</p></li><li><p>初始化bean，判定bean对应的类中的方法是否匹配到任意切入点</p><ul><li><p>匹配失败，创建对象</p><p>获取bean，调用方法并执行，完成操作</p></li><li><p>匹配成功，调用方法并执行，完成操作</p><p>获取的bean是代理对象时，根据代理对象的运行模式运行原始方法与增强内容，完成操作</p></li></ul></li><li><p>AOP核心本质：代理模式</p><p>目标对象(Target)：原始功能去掉共性功能对应的类产生的对象，这种对象是无法直接完成最终工作的</p><p>代理(proxy)：目标对象无法直接完成工作，需要进行功能回填，通过原始对象的代理对象实现</p></li></ol><p>代码依旧是入门案例的</p><p>但是将主函数修改，打印<code>bookDao</code>的类型：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">App</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">ac</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>(SpringConfig.class);</span><br><span class="line">        <span class="type">BookDao</span> <span class="variable">bookDao</span> <span class="operator">=</span> ac.getBean(BookDao.class);</span><br><span class="line">        System.out.println(bookDao);</span><br><span class="line">        System.out.println(bookDao.getClass());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">运行结果：</span><br><span class="line">com.spring.dao.impl.BookDaoImpl@d23e042</span><br><span class="line">class jdk.proxy2.$Proxy20</span><br></pre></td></tr></table></figure></blockquote><blockquote><p><code>System.out.println(bookDao)</code>打印出<code>com.spring.dao.impl.BookDaoImpl@d23e042</code></p><p>是因为AOP对<code>BookDao</code>的<code>toString()</code>方法进行了重写</p><p><code>class jdk.proxy2.$Proxy20</code>：最终用的是代理的对象</p></blockquote><h3 id="16-4-AOP切入点表达式"><a href="#16-4-AOP切入点表达式" class="headerlink" title="16.4 AOP切入点表达式"></a>16.4 AOP切入点表达式</h3><p>切入点：要进行增强的方法</p><p>切入点表达式：要进行增强的方法的描述方法</p><p><strong>1.语法格式</strong></p><p>切入点标准格式：<code>动作关键字(访问修饰符 返回值 包名.接口/类名.方法(参数) 异常名)</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">execution(<span class="keyword">public</span> User com.spring.service.UserService.findById(<span class="type">int</span>))</span><br><span class="line">execution(<span class="keyword">public</span> User com.spring.service.impl.UserServiceImpl.findById(<span class="type">int</span>))</span><br></pre></td></tr></table></figure><ul><li>动作关键字：描述切入点行为动作，如execution表示执行到指定切入点</li><li>访问修饰符：public，private等，可以省略</li><li>返回值</li><li>包名</li><li>接口&#x2F;类名：接口名或者类名都可以</li><li>方法名</li><li>参数</li><li>异常名：方法定义中抛出指定异常，可以省略</li></ul><p><strong>2.通配符</strong></p><p>可以使用通配符描述切入点，快速描述</p><ul><li><code>*</code>：单个独立的任意符号，可以独立出现，也可以作为前缀或者后缀的匹配符出现</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">execution(<span class="keyword">public</span> * com.spring.*.UserService.find*(*))</span><br></pre></td></tr></table></figure><p>解释：匹配com.spring包下的任意包中含有UserService类或接口中所有含有find开头的带有任意<strong>一个</strong>参数的方法</p><ul><li><code>..</code>：多个连续的任意符号，可以独立出现，常用于简化包名与参数的书写</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">execution(<span class="keyword">public</span> User com..UserService.findById(..))</span><br></pre></td></tr></table></figure><p>解释：匹配com包中的任意包中的UserService类或接口中的<strong>所有</strong>名称为findById的方法</p><ul><li><code>+</code>：专用于匹配子类类型</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">execution(* *..*Service+.*(..))</span><br></pre></td></tr></table></figure><p>解释：匹配·任意包下的以Service结尾的类或接口的子类中<strong>业务层的所有方法</strong></p><ul><li><span style="color:red">常用写法</span></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">execution(* com.spring.*.*Service.save(..))</span><br></pre></td></tr></table></figure><p>解释：匹配业务层所有的名为save的方法</p><p><strong>3.书写技巧</strong></p><blockquote><ul><li><p>所有代码按照标准规范开发，<strong>否则</strong>一下技巧<span style="color:red">全部失效</span></p></li><li><p>描述切入点<span style="color:red">通常描述接口</span>，而不描述实现类</p></li><li><p>访问控制修饰符针对接口开发均采用public描述(<span style="color:red">可省略</span>)</p></li><li><p>返回值类型对应<span style="color:red">增删改类</span>使用精准类型加速匹配，对于<span style="color:red">查询类</span>返回值使用<code>*</code>通配符快速描述</p></li><li><p><span style="color:red">包名</span>书写尽量<span style="color:red">不使用<code>..</code>匹配</span>，效率过低，常用<code>*</code>做单个包描述匹配，或精准匹配</p></li><li><p><span style="color:red">接口名&#x2F;类名</span>书写名称与模块的<span style="color:red">采用<code>*</code>匹配</span></p><p>如：<code>UserService</code>书写成<code>*Service</code>，绑定业务层接口名</p></li><li><p><span style="color:red">方法名</span>书写以<span style="color:red">动词</span>进行<span style="color:red">精准匹配</span>，名词采用<code>*</code>匹配</p><p>如：<code>getById</code>书写成<code>getBy*</code>，<code>selectAll</code>书写成<code>selectAll</code></p></li><li><p>参数规则较为复杂，根据业务方法灵活调整</p></li><li><p>通常<span style="color:red">不使用异常</span>作为匹配规则</p></li></ul></blockquote><h3 id="16-5-AOP通知类型"><a href="#16-5-AOP通知类型" class="headerlink" title="16.5 AOP通知类型"></a>16.5 AOP通知类型</h3><p>AOP通知描述了抽取的共性功能，根据共性功能抽取的位置不同，最终运行代码时要将其加入到合理的位置</p><p>AOP通知共分为5钟类型</p><ul><li>前置通知</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyAdvice</span> &#123;</span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(void com.spring.dao.BookDao.update())&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">pt</span><span class="params">()</span>&#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Before(&quot;pt()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">method</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;before~~~&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">运行结果：</span><br><span class="line">before~~~</span><br><span class="line">book dao update~~~</span><br></pre></td></tr></table></figure></blockquote><ul><li>后置通知</li></ul><p>​    </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyAdvice</span> &#123;</span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(void com.spring.dao.BookDao.update())&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">pt</span><span class="params">()</span>&#123;&#125;</span><br><span class="line">    </span><br><span class="line"><span class="meta">@Before(&quot;pt()&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">method</span><span class="params">()</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;after~~~&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">运行结果：</span><br><span class="line">book dao update~~~</span><br><span class="line">after~~~</span><br></pre></td></tr></table></figure></blockquote><ul><li>环绕通知(重点)</li></ul><p><strong>1.无返回值</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyAdvice</span> &#123;</span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(void com.spring.dao.BookDao.update())&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">pt</span><span class="params">()</span>&#123;&#125;</span><br><span class="line">    </span><br><span class="line"><span class="meta">@Around(&quot;pt()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">method</span><span class="params">(ProceedingJoinPoint pjp)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;before~~~&quot;</span>);</span><br><span class="line">        <span class="comment">//表示对原始操作的调用</span></span><br><span class="line">        pjp.proceed();</span><br><span class="line">        System.out.println(<span class="string">&quot;after~~~&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">运行结果：</span><br><span class="line">before~~~</span><br><span class="line">book dao update~~~</span><br><span class="line">after~~~</span><br></pre></td></tr></table></figure></blockquote><p><strong>2.有返回值</strong></p><p>在<code>BookDaoImpl</code>中新写一个有返回值的<code>select</code>方法</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">BookDao</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">select</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;book dao select~~~&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">100</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyAdvice</span> &#123;</span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(void com.spring.dao.BookDao.select())&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">pt</span><span class="params">()</span>&#123;&#125;</span><br><span class="line">    </span><br><span class="line"><span class="meta">@Around(&quot;pt()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">method</span><span class="params">(ProceedingJoinPoint pjp)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;before~~~&quot;</span>);</span><br><span class="line">        <span class="comment">//表示对原始操作的调用，并获得返回值</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">ret</span> <span class="operator">=</span> pjp.proceed();</span><br><span class="line">        System.out.println(<span class="string">&quot;after~~~&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>主函数：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">App</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">ac</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>(SpringConfig.class);</span><br><span class="line">        <span class="type">BookDao</span> <span class="variable">bookDao</span> <span class="operator">=</span> ac.getBean(BookDao.class);</span><br><span class="line">        <span class="type">int</span> <span class="variable">num</span> <span class="operator">=</span> bookDao.select();</span><br><span class="line">        System.out.println(num);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">运行结果：</span><br><span class="line">before~~~</span><br><span class="line">book dao select~~~</span><br><span class="line">after~~~</span><br><span class="line">100</span><br></pre></td></tr></table></figure></blockquote><p>并且有无返回值都<span style="color:red">建议</span>这样的写法：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Around(&quot;pt()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">method</span><span class="params">(ProceedingJoinPoint pjp)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;before~~~&quot;</span>);</span><br><span class="line">        <span class="type">Object</span> <span class="variable">ret</span> <span class="operator">=</span> pjp.proceed();</span><br><span class="line">        System.out.println(<span class="string">&quot;after~~~&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p><code>@Around</code>注意事项</p><blockquote><ol><li>环绕通知必须依赖形参<code>ProceedingJoinPoint</code>才能实现对原始方法的调用 ,进而实现原始方法调用前后同时添加通知</li><li>通知中如果未使用<code>ProceedingJoinPoint</code>对原始方法进行调用将跳过原始方法的执行</li><li>对原始方法的调用可以不接收返回值 ,通知方法设置成<code>void</code>即可, 如果接收返回值, 必须设定为<code>Object</code>类型</li><li>原始方法的返回值如果 是<code>void</code>类型,通知方法的返回值类型可以设置成<code>void</code> ,也可以设置成<code>Object</code></li><li>由于无法预知原始方法运行后是否会抛出异常 ,因此环绕通知方法必须抛出<code>Throwable</code>对象</li></ol></blockquote><ul><li>返回后通知(了解)</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyAdvice</span> &#123;</span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(int com.spring.dao.BookDao.select())&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">pt</span><span class="params">()</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@AfterReturning(&quot;pt()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">method</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;afterReturn~~~&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">运行结果：</span><br><span class="line">book dao select~~~</span><br><span class="line">afterReturn~~~</span><br><span class="line">100</span><br></pre></td></tr></table></figure></blockquote><p><code>@after</code>和<code>@AfterReturning</code>的区别：</p><blockquote><p>原始方法有异常时：</p><p><code>@after</code>也会打印通知的方法</p><p><code>@AfterReturning</code>不会打印通知的方法</p></blockquote><ul><li>抛出异常后通知(了解)</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyAdvice</span> &#123;</span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(int com.spring.dao.BookDao.select())&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">pt</span><span class="params">()</span>&#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@AfterThrowing(&quot;pt()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">method</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;afterThrowing~~~&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">运行结果：</span><br><span class="line">book dao select~~~</span><br><span class="line"><span class="number">100</span></span><br></pre></td></tr></table></figure></blockquote><p><code>@AfterThrowing</code>注解：只有原始方法抛出异常，才会执行通知的方法</p><h3 id="16-6-AOP通知获取数据"><a href="#16-6-AOP通知获取数据" class="headerlink" title="16.6 AOP通知获取数据"></a>16.6 AOP通知获取数据</h3><blockquote><p>获取切入点方法的参数</p><ul><li>JoinPoint：适用于前置、后置、返回后、抛出异常后通知 </li><li>ProceedJointPoint：适用于环绕通知</li></ul><p>获取切入点方法返回值</p><ul><li>返回后通知</li><li>环绕通知</li></ul><p>获取切入点方法运行异常信息</p><ul><li>抛出异常后通知</li><li>环绕通知</li></ul></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">BookDao</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">select</span><span class="params">(<span class="type">int</span> id, String name)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;book dao select~~~&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;id:&quot;</span>+id+<span class="string">&quot; name:&quot;</span>+name);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">100</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>AOP通知获取参数数据</strong></p><p><code>joinPoint</code>对象描述了连接点方法的运行状态，可以获取到原始方法的<strong>调用参数</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyAdvice</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(int com.spring.dao.BookDao.select(..))&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">pt</span><span class="params">()</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before(&quot;pt()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">method</span><span class="params">(JoinPoint jp)</span>&#123;</span><br><span class="line">        Object[] args = jp.getArgs();</span><br><span class="line">        System.out.println(Arrays.toString(args));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>主函数调用<code>select</code>方法：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">App</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">ac</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>(SpringConfig.class);</span><br><span class="line">        <span class="type">BookDao</span> <span class="variable">bookDao</span> <span class="operator">=</span> ac.getBean(BookDao.class);</span><br><span class="line">        bookDao.select(<span class="number">100</span>, <span class="string">&quot;dahuang&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">运行结果：</span><br><span class="line">[100, dahuang]</span><br><span class="line">book dao select~~~</span><br></pre></td></tr></table></figure></blockquote><p>ProceedingJoinPoint是JoinPoint的子类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Around(&quot;pt()&quot;)</span></span><br><span class="line">   <span class="keyword">public</span> Object <span class="title function_">method</span><span class="params">(ProceedingJoinPoint pjp)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">       Object[] args = pjp.getArgs();</span><br><span class="line">       System.out.println(Arrays.toString(args));</span><br><span class="line">       args[<span class="number">0</span>] = <span class="number">666</span>;</span><br><span class="line">       <span class="type">Object</span> <span class="variable">ret</span> <span class="operator">=</span> pjp.proceed(args);</span><br><span class="line">       <span class="keyword">return</span> ret;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">运行结果：</span><br><span class="line">[100, dahuang]</span><br><span class="line">book dao select~~~</span><br><span class="line">id:666 name:dahuang</span><br></pre></td></tr></table></figure></blockquote><p><strong>AOP通知获取返回数据</strong></p><p>抛出异常后通知可以获取切入点方法中出现的异常信息，使用形参可以接收对应的异常对象</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@AfterReturning(value = &quot;pt()&quot;, returning = &quot;ret&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">method</span><span class="params">(JoinPoint jp, <span class="type">int</span> ret)</span>&#123;</span><br><span class="line">System.out.println(<span class="string">&quot;afterReturn~~~&quot;</span>+ret);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>环绕通知中可以手工书写对原始方法的调用，得到的结果即为原始方法的返回值</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Around(&quot;pt()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">method</span><span class="params">(ProceedingJoinPoint pjp)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="type">Object</span> <span class="variable">ret</span> <span class="operator">=</span> pjp.proceed();</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p><strong>AOP通知获取异常数据(了解)</strong></p><p>抛出异常后通知可以获取切入点方法中出现的异常信息，使用形参可以接收对应的异常对象</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@AfterThrowing(value = &quot;pt()&quot;, throwing = &quot;t&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">method</span><span class="params">(JoinPoint jp, Throwable t)</span>&#123;</span><br><span class="line">System.out.println(<span class="string">&quot;afterThrowing~~~&quot;</span>+t);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>抛出异常后通知可以获取切入点方法运行的异常信息，使用形参可以接收运行时抛出的异常对象</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Around(&quot;pt()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">method</span><span class="params">(ProceedingJoinPoint pjp)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="type">Object</span> <span class="variable">ret</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            ret = pjp.proceed();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span>(Throwable t)&#123;</span><br><span class="line">            t.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h3 id="16-7-AOP总结"><a href="#16-7-AOP总结" class="headerlink" title="16.7 AOP总结"></a>16.7 AOP总结</h3><p>1.基本概念：</p><blockquote><p>概念：AOP(Aspect Oriented Programming) 面向切面编程，一种编程范式 </p><p>作用：在不惊动原始设计的基础上为方法进行功能<span style="color:red">增强</span></p><p>核心概念</p><ul><li>代理(Proxy)：SpringAOP的核心本质是采用代理模式实现的</li><li>连接点(JoinPoint )：在SpringAOP中 ,理解为任意方法的执行</li><li>切入点( Pointcut )：匹配连接点的式子,也是具有共性功能的方法描述</li><li>通知(Advice)：若干个方法的共性功能,在切入点处执行,最终体现为-一个方法 </li><li>切面( Aspect )：描述通知与切入点的对应关系</li><li>目标对象 ( Target )：被代理的原始对象成为目标对象</li></ul></blockquote><p>2.切入点：</p><blockquote><p>切入点表达式标准格式：</p><ul><li>动作关键字(访问修饰符 返回值 包名.类&#x2F;接口名.方法名(参数) 异常名) </li><li><code>execution(* com.spring.service.*Service.*(..))</code></li></ul><p>切入点表达式描述通配符：</p><ul><li><p>作用: 用于快速描述,范围描述</p></li><li><p><code>*</code>：匹配任意符号(常用)</p></li><li><p><code>..</code>：匹配多个连续的任意符号(常用)</p></li><li><p><code>+</code>：匹配子类类型</p></li></ul><p>切入点表达式书写技巧 </p><ol><li>按<span style="color:red">标准规范</span>开发</li><li>查询操作的返回值建议使用<code>*</code>匹配</li><li>减少使用<code>..</code>的形式描述包</li><li><span style="color:red">对接口进行描述</span>,使用<code>*</code>表示模块名,例如<code>UserService</code>的匹配描述为<code>*Service</code></li><li>方法名书写保留动词,例如get ,使用<code>*</code>表示名词,例如<code>getById</code>匹配描述为<code>getBy*</code></li><li>参数根据实际情况灵活调整</li></ol></blockquote><p>3.通知类型：</p><blockquote><p>前置通知</p><p>后置通知</p><p><span style="color:red">环绕通知</span>(重点)</p><ul><li>环绕通知依赖形参<code>ProceedingJoinPoint</code>才能实现对原始方法的调用</li><li>环绕通知可以隔离原始方法的调用执行</li><li>环绕通知返回值设置为<code>0bject</code>类型</li><li>环绕通知中可以对原始方法调用过程中出现的异常进行处理</li></ul><p>返回后通知</p><p>抛出异常后通知</p></blockquote><p>4.通知获取数据：</p><blockquote><p>获取切入点方法的参数</p><ul><li>JoinPoint：适用于前置、后置、返回后、抛出异常后通知,设置为方法的第一个形参</li><li>ProceedJointPoint：适用于环绕通知</li></ul><p>获取切入点方法返回值</p><ul><li>返回后通知 .</li><li>环绕通知</li></ul><p>获取切入点方法运行异常信息</p><ul><li>抛出异常后通知</li><li>环绕通知</li></ul></blockquote></div><div class="story post-story"><h2 id="17-Spring事务"><a href="#17-Spring事务" class="headerlink" title="17.Spring事务"></a>17.Spring事务</h2><h3 id="17-1-Spring事务简介"><a href="#17-1-Spring事务简介" class="headerlink" title="17.1 Spring事务简介"></a>17.1 Spring事务简介</h3><p>事务作用：在数据层保障一系列的数据库操作同成功同失败</p><p>Spring事务作用：在数据层或业务层保障一系列的数据库操作同成功同失败</p><p>案例：银行转账</p><blockquote><p>需求:实现任意两个账户间转账操作</p><p>需求微缩: A账户减钱, B账户加钱</p><p>分析:</p><p>①数据层提供基础操作, 指定账户减钱( outMoney ) , 指定账户加钱( inMoney ) </p><p>②业务层提供转账操作( transfer ) , 调用减钱与加钱的操作</p><p>③提供2个账号和操作金额执行转账操作</p><p>④基于Spring整合MyBatis环境搭建上述操作</p></blockquote><p>JDK版本：8</p><p>项目结构：</p><img src="https://s2.loli.net/2022/06/30/rxS3XABMkZpz1qI.png" class="lazyload" data-srcset="https://s2.loli.net/2022/06/30/rxS3XABMkZpz1qI.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="项目结构" style="zoom: 67%;" /><p><code>pom.xml</code></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.2.10.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.16<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.47<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.2.10.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.2.10.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><p>com.spring.config包下：</p><p><code>JdbcConfig</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JdbcConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;jdbc.driver&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String driver;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;jdbc.url&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String url;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;jdbc.username&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String userName;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;jdbc.password&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> DataSource <span class="title function_">dataSource</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">DruidDataSource</span> <span class="variable">ds</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DruidDataSource</span>();</span><br><span class="line">        ds.setDriverClassName(driver);</span><br><span class="line">        ds.setUrl(url);</span><br><span class="line">        ds.setUsername(userName);</span><br><span class="line">        ds.setPassword(password);</span><br><span class="line">        <span class="keyword">return</span> ds;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//配置事务管理器，mybatis使用的是jdbc事务</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> PlatformTransactionManager <span class="title function_">transactionManager</span><span class="params">(DataSource dataSource)</span>&#123;</span><br><span class="line">        <span class="type">DataSourceTransactionManager</span> <span class="variable">transactionManager</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DataSourceTransactionManager</span>();</span><br><span class="line">        transactionManager.setDataSource(dataSource);</span><br><span class="line">        <span class="keyword">return</span> transactionManager;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>MybatisConfig</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MybatisConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> SqlSessionFactoryBean <span class="title function_">sqlSessionFactory</span><span class="params">(DataSource dataSource)</span>&#123;</span><br><span class="line">        <span class="type">SqlSessionFactoryBean</span> <span class="variable">ssfb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBean</span>();</span><br><span class="line">        ssfb.setTypeAliasesPackage(<span class="string">&quot;com.itheima.p&quot;</span>);</span><br><span class="line">        ssfb.setDataSource(dataSource);</span><br><span class="line">        <span class="keyword">return</span> ssfb;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> MapperScannerConfigurer <span class="title function_">mapperScannerConfigurer</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">MapperScannerConfigurer</span> <span class="variable">msc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MapperScannerConfigurer</span>();</span><br><span class="line">        msc.setBasePackage(<span class="string">&quot;com.itheima.dao&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> msc;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>核心配置类：<code>SpringConfig</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(&quot;com.itheima&quot;)</span></span><br><span class="line"><span class="meta">@PropertySource(&quot;classpath:jdbc.properties&quot;)</span></span><br><span class="line"><span class="meta">@Import(&#123;JdbcConfig.class,MybatisConfig.class&#125;)</span></span><br><span class="line"><span class="comment">//开启注解式事务驱动</span></span><br><span class="line"><span class="meta">@EnableTransactionManagement</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringConfig</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>Account</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Account</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Double money;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">getId</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setId</span><span class="params">(Integer id)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Double <span class="title function_">getMoney</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> money;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setMoney</span><span class="params">(Double money)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.money = money;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Account&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;id=&quot;</span> + id +</span><br><span class="line">                <span class="string">&quot;, name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, money=&quot;</span> + money +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>com.spring.dao包下：</p><p><code>AccountDao</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">AccountDao</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Update(&quot;update demo.account set money = money + #&#123;money&#125; where name = #&#123;name&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">inMoney</span><span class="params">(<span class="meta">@Param(&quot;name&quot;)</span> String name, <span class="meta">@Param(&quot;money&quot;)</span> Double money)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Update(&quot;update demo.account set money = money - #&#123;money&#125; where name = #&#123;name&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">outMoney</span><span class="params">(<span class="meta">@Param(&quot;name&quot;)</span> String name, <span class="meta">@Param(&quot;money&quot;)</span> Double money)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>AccountService</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">AccountService</span> &#123;</span><br><span class="line">    <span class="comment">//配置当前接口方法具有事务</span></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">transfer</span><span class="params">(String out,String in ,Double money)</span> ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>AccountServiceImpl</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AccountServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">AccountService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AccountDao accountDao;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">transfer</span><span class="params">(String out,String in ,Double money)</span> &#123;</span><br><span class="line">        accountDao.outMoney(out,money);</span><br><span class="line">        accountDao.inMoney(in,money);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>测试类：<code>AccountServiceTest</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith(SpringJUnit4ClassRunner.class)</span></span><br><span class="line"><span class="meta">@ContextConfiguration(classes = SpringConfig.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AccountServiceTest</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AccountService accountService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testTransfer</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        accountService.transfer(<span class="string">&quot;Tom&quot;</span>,<span class="string">&quot;Jerry&quot;</span>,<span class="number">100D</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="17-2-Spring事务角色"><a href="#17-2-Spring事务角色" class="headerlink" title="17.2 Spring事务角色"></a>17.2 Spring事务角色</h3><p>事务角色</p><ul><li><p>事务管理员：发起事务方，在Spring中通常代指业务层开启事务的方法</p></li><li><p>事务协调员：加入事务方，在Spring中通常代指数据层方法，也可以是业务层的方法</p></li></ul><h3 id="17-3-Spring事务属性"><a href="#17-3-Spring事务属性" class="headerlink" title="17.3 Spring事务属性"></a>17.3 Spring事务属性</h3><table><thead><tr><th align="center">属性</th><th align="center">作用</th><th align="center">示例</th></tr></thead><tbody><tr><td align="center">readOnly</td><td align="center">设置是否为只读事务</td><td align="center">readOnly&#x3D;true 只读事务</td></tr><tr><td align="center">timeout</td><td align="center">设置事务超时时间</td><td align="center">timeout&#x3D;-1 永不超时</td></tr><tr><td align="center"><span style="color:red">rollbackFor</span></td><td align="center">设置事务回滚异常(class)</td><td align="center">rollbackFor&#x3D;{NullPointException.class}</td></tr><tr><td align="center">rollbackForClassName</td><td align="center">设置事务回滚异常(String)</td><td align="center">同上字符串格式</td></tr><tr><td align="center">noRollbackFor</td><td align="center">设置事务不回滚异常(class)</td><td align="center">norollbackFor&#x3D;{NullPointException.class}</td></tr><tr><td align="center">noRollbackForClassName</td><td align="center">设置事务不回滚异常(String)</td><td align="center">同上字符串格式</td></tr><tr><td align="center"><span style="color:red">propagation</span></td><td align="center">设置事务传播行为</td><td align="center">…..</td></tr></tbody></table><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AccountServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">AccountService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AccountDao accountDao;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">transfer</span><span class="params">(String out, String in, Double money)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        accountDao.outMoney(out,money);</span><br><span class="line">        <span class="comment">//添加IOException类型错误</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="literal">true</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IOException</span>();</span><br><span class="line">        accountDao.inMoney(in,money);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>运行后，报错，<code>outMoney</code>方法执行了，但<code>inMoney</code>方法没有执行。</p><p>并不是所有错误类型都会回滚，</p><p>我们希望<code>transfer</code>方法，调用的事务同失败。</p><p>在<code>@Transactional</code>注解中的属性<code>rollbackFor</code>添加错误的类型：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">AccountService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Transactional(rollbackFor = &#123;IOException.class&#125;)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">transfer</span><span class="params">(String out, String in, Double money)</span> <span class="keyword">throws</span> IOException;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>再次运行后，报错，<code>outMoney</code>和<code>inMoney</code>方法都没有执行</p><p>案例：转账业务追加日志</p><blockquote><p>需求:实现任意两个账户间转账操作,并对每次转账操作在数据库进行留痕 </p><p>需求微缩: A账户减钱, B账户加钱,数据库记录日志</p><p>分析:</p><p>①:基于转账操作案例添加日志模块,实现数据库中记录日志</p><p>②:业务层转账操作( transfer ) ,调用减钱、加钱与记录日志功能</p><p>实现效果预期：</p><p>​<strong>无论转账操作是否成功,均进行转账操作的日志留痕</strong></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AccountServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">AccountService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AccountDao accountDao;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> LogService logService;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">transfer</span><span class="params">(String out, String in, Double money)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            accountDao.outMoney(out,money);</span><br><span class="line">            <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>/<span class="number">0</span>;</span><br><span class="line">        accountDao.inMoney(in,money);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">finally</span>&#123;</span><br><span class="line">            logService.log(out,in,money);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>运行后，<code>outMoney</code>方法和<code>inMoney</code>方法进行回滚，同时<code>log</code>方法也进行了回滚，未将日志记录到数据库中</p><p>存在问题：</p><p> 日志的记录与转账操作隶属同一个事务，同成功同失败</p><ul><li>事务传播行为：事务协调员对事物管理员所携带事务的处理态度</li></ul><p><img src="https://s2.loli.net/2022/06/30/yXdkb8CIgoGnWVp.jpg" class="lazyload" data-srcset="https://s2.loli.net/2022/06/30/yXdkb8CIgoGnWVp.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="事务传播.png"></p><p>在业务层接口添加Spring事务，</p><p><code>@Transactional</code>注解中的<code>propagation</code>属性设置事务传播行为<span style="color:red">REQIRES_NEW</span>(需要新事务)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">LogService</span> &#123;</span><br><span class="line">    <span class="comment">//设置为新事务</span></span><br><span class="line"><span class="meta">@Transactional(propagation=Propagation.REQIRES_NEW)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">log</span><span class="params">(String out, String in, Double money)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>运行后，<code>outMoney</code>方法和<code>inMoney</code>方法进行回滚，事务成功。</p><p><code>log</code>方法执行，将日志记录到数据库中</p><table>    <tr>        <th>传播属性</th>        <th>事务管理员</th>        <th>事务协调员</th>    </tr>    <tr align="center">                 <td rowspan="2">REQUIRED(默认)</td>                 <td>开启T</td>        <td>加入T</td>    </tr>    <tr align="center">                         <td>无</td>        <td>新建T2</td>    </tr>    <tr align="center">                 <td rowspan="2">REQUIRES_NEW</td>                 <td>开启T</td>        <td>新建T2</td>    </tr>    <tr align="center">                         <td>无</td>        <td>新建T2</td>    </tr>    <tr align="center">                 <td rowspan="2">SUPPORTS</td>                 <td>开启T</td>        <td>加入T</td>    </tr>    <tr align="center">                         <td>无</td>        <td>无</td>    </tr>    <tr align="center">                 <td rowspan="2">NOT_SUPPORTED</td>                 <td>开启T</td>        <td>无</td>    </tr>    <tr align="center">                         <td>无</td>        <td>无</td>    </tr>    <tr align="center">                 <td rowspan="2">MANDATORY</td>                 <td>开启T</td>        <td>加入T</td>    </tr>    <tr align="center">                         <td>无</td>        <td style="color:red">ERROR</td>    </tr>    <tr align="center">                 <td rowspan="2">NEVER</td>                 <td>开启T</td>        <td style="color:red">ERROR</td>    </tr>    <tr align="center">                         <td>无</td>        <td>无</td>    </tr>    <tr align="center">                 <td>NESTED</td>        <td colspan="2">设置savePoint，一旦事务回滚，事务将回滚到savePoint处，交由客户端提交/回滚</td>    </tr></table><p>​      </p></div><div class="story post-story"><h2 id="18-结语"><a href="#18-结语" class="headerlink" title="18.结语"></a>18.结语</h2><p>你竟然看完了(不敢相信！！)，真的人会看吗！真的吗！ゞ◎Д◎ヾ</p><p>本人也是初学Spring，笔记中如果有什么遗漏或错误的地方欢迎大佬指正（≧∀≦）</p><ul><li>本人QQ：2691936018</li><li>备注：Spring</li></ul><p>另外关于Spring框架，如果有新的内容需要补充，本人也会进行更新的</p><p>本笔记的学习视频：<a href="https://www.bilibili.com/video/BV1Fi4y1S7ix">黑马2022最新SSM框架</a></p><p>我们SpringMVC见！！(还是不太相信能有人看╮(╯▽╰)╭)</p></div>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> 框架 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringMVC框架的学习笔记</title>
      <link href="/2022/08/06/Java/SpringMCV%E6%A1%86%E6%9E%B6/"/>
      <url>/2022/08/06/Java/SpringMCV%E6%A1%86%E6%9E%B6/</url>
      
        <content type="html"><![CDATA[<div class="story post-story"><h2 id="1-初认SpringMVC"><a href="#1-初认SpringMVC" class="headerlink" title="1.初认SpringMVC"></a>1.初认SpringMVC</h2><h3 id="1-1-SpringMVC简介"><a href="#1-1-SpringMVC简介" class="headerlink" title="1.1 SpringMVC简介"></a>1.1 SpringMVC简介</h3><blockquote><p>SpringMVC技术与Servlet技术功能等同，均属于web层开发技术</p><p>SpringMVC是一种基于java实现MVC模型的轻量级<span style="color:red">Web框架</span></p><p>优点：</p><ul><li>使用简单，开发便捷(相比与Servlet)</li><li>灵活性强</li></ul></blockquote><p>项目结构：</p><img src="https://s2.loli.net/2022/07/02/45iHRuqkbcsFL2A.png" class="lazyload" data-srcset="https://s2.loli.net/2022/07/02/45iHRuqkbcsFL2A.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220702172705111" style="zoom:67%;" /><h3 id="1-2-SpringMVC入门"><a href="#1-2-SpringMVC入门" class="headerlink" title="1.2 SpringMVC入门"></a>1.2 SpringMVC入门</h3><p>1.使用SpringMVC技术需要先导入SpringMVC坐标与Servlet</p><p>不需要导入spring-context包，spring-webmvc包中包含spring-context包</p><p>2.导入Tomcat插件</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.servlet-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>3.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span> <span class="comment">&lt;!-- 和Tomcat有冲突 --&gt;</span>       </span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-webmvc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.2.10.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span>        </span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--Tomcat插件--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.tomcat.maven<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>tomcat7-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">port</span>&gt;</span>8888<span class="tag">&lt;/<span class="name">port</span>&gt;</span> <span class="comment">&lt;!--端口可任意只要没有被占用--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">path</span>&gt;</span>/<span class="tag">&lt;/<span class="name">path</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure><p>3.创建SpringMVC控制器类(等同于Servlet功能)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line">    <span class="comment">//设置当前控制器方法的请求路径</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/save&quot;)</span></span><br><span class="line">    <span class="comment">//设置当前控制器方法响应内容为当前返回值，无需解析</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">save</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;user is saving~~&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&#123;&#x27;info&#x27;:&#x27;springmvc&#x27;&#125;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>4.初始化SpringMVC环境(同Spring环境)，设定SpringMVC加载对应的bean</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建SpringMVC的配置文件，加载controller对应的bean</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(&quot;com.springmvc.controller&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringMvcConfig</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>5.初始化Servlet容器，加载SpringMVC环境，并设置SpringMVC技术处理的请求</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//定义一个servlet容器启动的配置类，在里面加载Spring的配置</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ServletContainerInitConfig</span> <span class="keyword">extends</span> <span class="title class_">AbstractDispatcherServletInitializer</span> &#123;</span><br><span class="line">    <span class="comment">//加载SpringMVC容器的配置</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> WebApplicationContext <span class="title function_">createServletApplicationContext</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">AnnotationConfigWebApplicationContext</span> <span class="variable">acwac</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigWebApplicationContext</span>();</span><br><span class="line">        acwac.register(SpringMvcConfig.class);</span><br><span class="line">        <span class="keyword">return</span> acwac;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//设定SpringMVC对应的请求的映射路径</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> String[] getServletMappings() &#123;</span><br><span class="line">        <span class="comment">//设置为/表示拦截所有请求，任意请求都将转入到SpringMVC中进行处理</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>[]&#123;<span class="string">&quot;/&quot;</span>&#125;;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//加载Spring容器配置，现在不需要</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> WebApplicationContext <span class="title function_">createRootApplicationContext</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>右键找到<code>Run Maven</code>再找到<code>tomcat7:run</code>点击运行，打开浏览器打开<code>http://localhost:8888/save</code></p><p>页面即可出现内容：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span>&#x27;info&#x27;<span class="punctuation">:</span>&#x27;springmvc&#x27;<span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>此时控制台打印出：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">user is saving~~</span><br></pre></td></tr></table></figure><h3 id="1-3-入门总结"><a href="#1-3-入门总结" class="headerlink" title="1.3 入门总结"></a>1.3 入门总结</h3><blockquote><p>SpringMVC入门程序开发总结(1+N)</p><ul><li><p>一次性工作</p><ul><li>创建工程, 设置服务器，加载工程</li><li>导入坐标</li><li>创建web容器启动类, 加载SpringMVC配置， 并设置SpringMVC请求拦截路径</li><li>SpringMVC核心配置类 (设置配置类,扫描controller包, 加载Controller控制器bean)</li></ul></li><li><p>多次工作</p><ul><li>定义处理请求的控制器类</li><li>定义处理请求的控制器方法， 并配置映射路径<code>@RequestMapping</code>与返回json数据<code>@ResponseBody</code></li></ul></li></ul></blockquote><h3 id="1-4-工作流程"><a href="#1-4-工作流程" class="headerlink" title="1.4 工作流程"></a>1.4 工作流程</h3><p>入门案例工作流程分析</p><blockquote><ul><li><p>启动服务器初始化过程</p><ol><li>服务器启动, 执行<code>ServletContainersInitConfig</code>类,初始化web容器</li><li>执行<code>createServletApplicationContext</code>方法，创建了<code>WebApplicationContext</code>对象</li><li>加载<code>SpringMvcConfig</code>配置文件</li><li>执行<code>@ComponentScan</code>加载对应的bean</li><li>加载<code>UserController</code>, 每个<code>@RequestMapping</code>的名称对应一 个具体的方法</li><li>执行<code>getServletMappings</code>方法, 定义所有的请求都通过SpringMVC</li></ol></li><li><p>单次请求过程</p><ol><li>发送请求<code>http:localhost:8888/save</code></li><li>web容器发现所有请求都经过SpringMVC, 将请求交给SpringMVC处理</li><li>解析请求路径&#x2F;save</li><li>由&#x2F;save匹配执行对应的方法<code>save()</code></li><li>执行<code>save()</code> </li><li>检测到有<code>@ResponseBody</code>直接将<code>save()</code>方法的返回值作为响应求体返回给请求方</li></ol></li></ul></blockquote><h3 id="1-5-bean加载控制"><a href="#1-5-bean加载控制" class="headerlink" title="1.5 bean加载控制"></a>1.5 bean加载控制</h3><blockquote><p>com</p><blockquote><p>springmvc</p><blockquote><p>config</p><p>controller</p><p>service</p><p>dao</p></blockquote></blockquote></blockquote><p>Controller加载控制业务与业务bean加载控制</p><p>SpringMVC相关bean</p><ul><li>表现层bean(Controller)</li></ul><p>Spring控制的bean</p><ul><li>业务bean(Service)</li><li>功能bean(DataSourse等)</li></ul><p>SpringMVC相关的bean加载控制</p><ul><li>SpringMVC加载的bean对应的包均在<code>com.springnvc.controller</code>包内</li></ul><p>Spring相关bean加载控制</p><ul><li>Spring加载的bean设定范围为<code>com.springmvc</code>，排除controller包内的bean</li><li>Spring加载的bean设定范围为精准范围，如：<code>com.springmvc.dao</code>、<code>com.springmvc.service</code>等(常用)</li><li>不区分Spring与SpringMVC的环境，加载到同一个环境中</li></ul><p>方式一(常用)：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(&#123;&quot;com.springmvc.dao&quot;,&quot;com.springmvc.service&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringConfig</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>方式二：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(value = &quot;com.springmvc&quot;, </span></span><br><span class="line"><span class="meta">        excludeFilters = @ComponentScan.Filter(</span></span><br><span class="line"><span class="meta">                type = FilterType.ANNOTATION, //按照注解排除</span></span><br><span class="line"><span class="meta">                classes = Controller.class //需要排除的注解类型</span></span><br><span class="line"><span class="meta">        )</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringConfig</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>加载SpringMVC和Spring配置</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ServletContainerInitConfig</span> <span class="keyword">extends</span> <span class="title class_">AbstractDispatcherServletInitializer</span> &#123;</span><br><span class="line">    <span class="comment">//加载SpringMVC配置</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> WebApplicationContext <span class="title function_">createServletApplicationContext</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">AnnotationConfigWebApplicationContext</span> <span class="variable">acwac</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigWebApplicationContext</span>();</span><br><span class="line">        acwac.register(SpringMvcConfig.class);</span><br><span class="line">        <span class="keyword">return</span> acwac;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> String[] getServletMappings() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>[]&#123;<span class="string">&quot;/&quot;</span>&#125;;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//加载SpringMVC配置</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> WebApplicationContext <span class="title function_">createRootApplicationContext</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">AnnotationConfigWebApplicationContext</span> <span class="variable">acwac</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigWebApplicationContext</span>();</span><br><span class="line">        acwac.register(SpringConfig.class);</span><br><span class="line">        <span class="keyword">return</span> acwac;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>简化操作(常用)：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ServletContainerInitConfig</span> <span class="keyword">extends</span> <span class="title class_">AbstractAnnotationConfigDispatcherServletInitializer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> Class&lt;?&gt;[] getRootConfigClasses() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;SpringConfig.class&#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> Class&lt;?&gt;[] getServletConfigClasses() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;SpringMvcConfig.class&#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> String[] getServletMappings() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>[]&#123;<span class="string">&quot;/&quot;</span>&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="2-请求与响应"><a href="#2-请求与响应" class="headerlink" title="2.请求与响应"></a>2.请求与响应</h2><h3 id="2-1-请求映射路径"><a href="#2-1-请求映射路径" class="headerlink" title="2.1 请求映射路径"></a>2.1 请求映射路径</h3><p>项目结构：</p><p><img src="https://s2.loli.net/2022/07/04/2gBEA6xmdpzqMPQ.png" class="lazyload" data-srcset="https://s2.loli.net/2022/07/04/2gBEA6xmdpzqMPQ.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220704114846464.png"></p><p>BookController：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookController</span> &#123;</span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/save&quot;)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">save</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;book is saving~~&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&#123;&#x27;info&#x27;:&#x27;springmvc&#x27;&#125;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>UserController：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/save&quot;)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">save</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;user is saving~~&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&#123;&#x27;info&#x27;:&#x27;springmvc&#x27;&#125;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>运行程序后报错，无法启动。</p><p>因为路径都为<code>/save</code>的话，在网页请求<code>/save</code>，程序会不知道调用哪个控制器方法</p></blockquote><p>改进：</p><p>BookController：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookController</span> &#123;</span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/book/save&quot;)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">save</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;book is saving~~&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&#123;&#x27;info&#x27;:&#x27;springmvc&#x27;&#125;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>UserController：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/user/save&quot;)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">save</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;user is saving~~&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&#123;&#x27;info&#x27;:&#x27;springmvc&#x27;&#125;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>还可以更加精简，增加模块的请求路径前缀：</p><blockquote><p><code>@RequestMapping</code>注解：</p><ul><li>设置在控制器方法上：请求访问路径</li><li>设置在类上：统一设置当前类中控制器方法请求路径前缀</li></ul></blockquote><p>BookController：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/book&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookController</span> &#123;</span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/save&quot;)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">save</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;book is saving~~&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&#123;&#x27;info&#x27;:&#x27;springmvc&#x27;&#125;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>UserController：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/save&quot;)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">save</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;user is saving~~&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&#123;&#x27;info&#x27;:&#x27;springmvc&#x27;&#125;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-2-请求方式"><a href="#2-2-请求方式" class="headerlink" title="2.2 请求方式"></a>2.2 请求方式</h3><blockquote><ul><li>Get请求</li><li>Post请求</li></ul></blockquote><p>所要访问的控制器方法：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/save&quot;)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">save</span><span class="params">(String name, <span class="type">int</span> age)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;user is saving~~&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;name=&quot;</span>+name+<span class="string">&quot;  age=&quot;</span>+age);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&#123;&#x27;info&#x27;:&#x27;springmvc&#x27;&#125;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><span style="color:red">get请求</span>：</p><ul><li>url地址传参，地址参数要与形参变量名相同，定义形参几个接收参数</li></ul><p>访问链接：<code>http://localhost:8888/user/save?name=dahuang&amp;age=18</code></p><p>控制台打印：</p><blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">user is saving~~</span><br><span class="line">name=dahuang  age=18</span><br></pre></td></tr></table></figure></blockquote><p><span style="color:red">post请求</span>：</p><ul><li>form表单post请求传参，表单参数名要与形参变量名相同，定义形参几个接收参数</li></ul><p>访问链接：<code>http://localhost:8888/user/save</code></p><p>提交数据形式：<code>x-www-form-urlencoded</code></p><img src="https://s2.loli.net/2022/07/04/vRYxZPSKoEeOFpA.png" class="lazyload" data-srcset="https://s2.loli.net/2022/07/04/vRYxZPSKoEeOFpA.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220704190432127" style="zoom:67%;" /><p>控制台打印：</p><blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">user is saving~~</span><br><span class="line">name=dahei  age=20</span><br></pre></td></tr></table></figure></blockquote><p>如果参数为中文呢？</p><img src="https://s2.loli.net/2022/07/04/NVSRTfE2vUmruy7.png" class="lazyload" data-srcset="https://s2.loli.net/2022/07/04/NVSRTfE2vUmruy7.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220704190806620" style="zoom:67%;" /><p>控制台打印，会乱码：</p><blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">user is saving~~</span><br><span class="line">name=å¤§é»  age=20</span><br></pre></td></tr></table></figure></blockquote><p><span style="color:red">Post请求中文乱码处理</span>：</p><p>在<code>ServletContainerInitConfig</code>配置文件中重写<code>getServletFilters()</code>方法</p><p>为web容器添加过滤器并指定字符集，Spring-web包中提供了专用的字符过滤器</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> Filter[] getServletFilters() &#123;</span><br><span class="line">    <span class="type">CharacterEncodingFilter</span> <span class="variable">aef</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CharacterEncodingFilter</span>();</span><br><span class="line">    aef.setEncoding(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Filter</span>[]&#123;aef&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>再次运行后，控制台打印：</p><blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">user is saving~~</span><br><span class="line">name=大黄  age=20</span><br></pre></td></tr></table></figure></blockquote><h3 id="2-3-5种类型参数传递"><a href="#2-3-5种类型参数传递" class="headerlink" title="2.3 5种类型参数传递"></a>2.3 5种类型参数传递</h3><blockquote><p>参数种类</p><ul><li>普通参数</li><li>POJO参数</li><li>嵌套POJO参数</li><li>数组类型参数</li><li>集合类型参数</li></ul></blockquote><p><span style="color:red">普通参数</span>：请求参数名与形参变量名不同，使用<code>@RequestParam</code>注解绑定参数关系</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/save&quot;)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">save</span><span class="params">(<span class="meta">@RequestParam(&quot;name&quot;)</span> String userName, <span class="type">int</span> age)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;user is saving~~&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;name=&quot;</span>+userName+<span class="string">&quot;  age=&quot;</span>+age);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&#123;&#x27;info&#x27;:&#x27;springmvc&#x27;&#125;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><span style="color:red">POJO参数</span>：请求参数名与形参对象名相同，定义POJO类型形参即可接收参数</p><p>创建一个实体类<code>User</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;<span class="keyword">return</span> name;&#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;<span class="built_in">this</span>.name = name;&#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getAge</span><span class="params">()</span> &#123;<span class="keyword">return</span> age;&#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAge</span><span class="params">(<span class="type">int</span> age)</span> &#123;<span class="built_in">this</span>.age = age;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;User&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, age=&quot;</span> + age +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>UserController</code>中：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/save&quot;)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">save</span><span class="params">(User user)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;user is saving~~&quot;</span>);</span><br><span class="line">   System.out.println(user.toString());</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&#123;&#x27;info&#x27;:&#x27;springmvc&#x27;&#125;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>get请求：</p><p>url地址：<code>http://localhost:8888/user/save?name=dahei&amp;age=16</code></p><p>控制台打印：</p><blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">user is saving~~</span><br><span class="line">User&#123;name=&#x27;dahei&#x27;, age=16&#125;</span><br></pre></td></tr></table></figure></blockquote><p><span style="color:red">嵌套POJO参数</span>：POJO对象中包含POJO对象</p><p>创建一个新实体类<code>Address</code>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Address</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String province;</span><br><span class="line">    <span class="keyword">private</span> String city;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getProvince</span><span class="params">()</span> &#123;<span class="keyword">return</span> province;&#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setProvince</span><span class="params">(String province)</span> &#123;<span class="built_in">this</span>.province = province;&#125;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getCity</span><span class="params">()</span> &#123;<span class="keyword">return</span> city;&#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCity</span><span class="params">(String city)</span> &#123;<span class="built_in">this</span>.city = city;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Address&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;province=&#x27;&quot;</span> + province + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, city=&#x27;&quot;</span> + city + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>将<code>Address</code>对象加入到<code>User</code>对象中：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line">    <span class="keyword">private</span> Address address;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Address <span class="title function_">getAddress</span><span class="params">()</span> &#123;<span class="keyword">return</span> address;&#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAddress</span><span class="params">(Address address)</span> &#123;<span class="built_in">this</span>.address = address;&#125;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;<span class="keyword">return</span> name;&#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;<span class="built_in">this</span>.name = name;&#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getAge</span><span class="params">()</span> &#123;<span class="keyword">return</span> age;&#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAge</span><span class="params">(<span class="type">int</span> age)</span> &#123;<span class="built_in">this</span>.age = age;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;User&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, age=&quot;</span> + age +</span><br><span class="line">                <span class="string">&quot;, address=&quot;</span> + address +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>get请求：</p><p>url地址：<code>http://localhost:8888/user/save?name=dahuang&amp;age=20&amp;address.province=tianjin&amp;address.city=baodi</code></p><p>控制台打印：</p><blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">user is saving~~</span><br><span class="line">User&#123;name=&#x27;dahuang&#x27;, age=20, address=Address&#123;province=&#x27;tianjin&#x27;, city=&#x27;baodi&#x27;&#125;&#125;</span><br></pre></td></tr></table></figure></blockquote><p><span style="color:red">数组参数</span>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/save&quot;)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">save</span><span class="params">(String[] hobbies)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;user is saving~~&quot;</span>);</span><br><span class="line">        System.out.println(Arrays.toString(hobbies));</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&#123;&#x27;info&#x27;:&#x27;springmvc&#x27;&#125;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>get请求：</p><p>url地址：<code>http://localhost:8888/user/save?hobbies=TV&amp;hobbies=game&amp;hobbies=food</code></p><p>控制台打印：</p><blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">user is saving~~</span><br><span class="line">[TV, game, food]</span><br></pre></td></tr></table></figure></blockquote><p><span style="color:red">集合参数</span>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/save&quot;)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">save</span><span class="params">(<span class="meta">@RequestParam</span> List&lt;String&gt; hobbies)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;user is saving~~&quot;</span>);</span><br><span class="line">        System.out.println(hobbies.toString());</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&#123;&#x27;info&#x27;:&#x27;springmvc&#x27;&#125;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>get请求：</p><p>url地址：<code>http://localhost:8888/user/save?hobbies=TV&amp;hobbies=game&amp;hobbies=food</code></p><p>控制台打印：</p><blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">user is saving~~</span><br><span class="line">[TV, game, food]</span><br></pre></td></tr></table></figure></blockquote><h3 id="2-4-传递json数据"><a href="#2-4-传递json数据" class="headerlink" title="2.4 传递json数据*"></a>2.4 传递json数据*</h3><p>导入<code>jackson</code>坐标：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-databind<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>json有两种格式：</p><ul><li>对象格式：<code>&#123;&quot;key1&quot;:obj,&quot;key2&quot;:obj,&quot;key3&quot;:obj...&#125;</code></li><li>数组&#x2F;集合格式：<code>[obj,obj,obj...]</code></li></ul><p>在<code>SpringMvcConfig</code>配置文件中，添加注解<code>@EnableWebMvc</code>：</p><p><code>@EnableWebMvc</code>注解：开启json数据转换成对象的功能</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(&quot;com.springmvc.controller&quot;)</span></span><br><span class="line"><span class="meta">@EnableWebMvc</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringMvcConfig</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><span style="color:red">集合参数</span>：json格式</p><p><code>@RequestBody</code>注解：将请求中请求体所包含的数据传递给请求参数，此注解一个处理器方法只能使用一次</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/save&quot;)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">save</span><span class="params">(<span class="meta">@RequestBody</span> List&lt;String&gt; hobbies)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;user is saving~~&quot;</span>);</span><br><span class="line">        System.out.println(hobbies.toString());</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&#123;&#x27;info&#x27;:&#x27;springmvc&#x27;&#125;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><img src="https://s2.loli.net/2022/07/04/bVpUlEH5xgsIyo1.png" class="lazyload" data-srcset="https://s2.loli.net/2022/07/04/bVpUlEH5xgsIyo1.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220704214758222.png" style="zoom:67%;" /><p>控制台打印：</p><blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">user is saving~~</span><br><span class="line">[TV, game, food]</span><br></pre></td></tr></table></figure></blockquote><p><span style="color:red">POJO参数</span>：json格式</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/save&quot;)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">save</span><span class="params">(<span class="meta">@RequestBody</span> User user)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;user is saving~~&quot;</span>);</span><br><span class="line">        System.out.println(user.toString());</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&#123;&#x27;info&#x27;:&#x27;springmvc&#x27;&#125;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><img src="https://s2.loli.net/2022/07/04/3iM7ZXNQSEkJ4ep.png" class="lazyload" data-srcset="https://s2.loli.net/2022/07/04/3iM7ZXNQSEkJ4ep.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220704220445677.png" style="zoom:67%;" /><p>控制台打印：</p><blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">user is saving~~</span><br><span class="line">User&#123;name=&#x27;dahuang&#x27;, age=20, address=Address&#123;province=&#x27;tianjin&#x27;, city=&#x27;baodi&#x27;&#125;&#125;</span><br></pre></td></tr></table></figure></blockquote><p><span style="color:red">集合对象参数</span>：json格式</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/save&quot;)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">save</span><span class="params">(<span class="meta">@RequestBody</span> List&lt;User&gt; list)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;user is saving~~&quot;</span>);</span><br><span class="line">        System.out.println(list.toString());</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&#123;&#x27;info&#x27;:&#x27;springmvc&#x27;&#125;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><img src="https://s2.loli.net/2022/07/04/SVgIhQqeRl9yjN7.png" class="lazyload" data-srcset="https://s2.loli.net/2022/07/04/SVgIhQqeRl9yjN7.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220704221250254.png" style="zoom:67%;" /><p>控制台打印：</p><blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">user is saving~~</span><br><span class="line">[User&#123;name=&#x27;dahei&#x27;, age=20, address=Address&#123;province=&#x27;tianjin&#x27;, city=&#x27;baodi&#x27;&#125;&#125;, User&#123;name=&#x27;dahuang&#x27;, age=20, address=Address&#123;province=&#x27;guizhou&#x27;, city=&#x27;zunyi&#x27;&#125;&#125;]</span><br></pre></td></tr></table></figure></blockquote><p><code>@RequestBody</code>与<code>@RequestParam</code>的区别：</p><blockquote><p>区别</p><ul><li><code>@RequestParam</code>用于url地址传参，表单传参 <code>application/x-www-form-urlencoded</code></li><li><code>@RequestBody</code>用于接收json数据  <code>application/json</code></li></ul><p>应用</p><ul><li>后期开发，发送json格式数据为主，<code>@RequestBody</code>拥有较广</li><li>如果发送非json格式数据，选用<code>@RequestParam</code>接收请求参数</li></ul></blockquote><h3 id="2-5-日期类型参数传递"><a href="#2-5-日期类型参数传递" class="headerlink" title="2.5 日期类型参数传递"></a>2.5 日期类型参数传递</h3><p>日期类型数据基于系统不同格式也不尽相同</p><ul><li>2022-07-04</li><li>2022&#x2F;07&#x2F;04</li><li>07&#x2F;04&#x2F;2022</li></ul><p>接收形参时，根据不同的日期格式设置不同的接收方式</p><p><code>@DataTimeFormat</code>注解中的<code>pattern</code>属性来自定义日期时间型数据格式</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/date&quot;)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">save</span><span class="params">(Date date1,</span></span><br><span class="line"><span class="params">                       <span class="meta">@DateTimeFormat(pattern = &quot;yyyy-mm-dd&quot;)</span> Date date2,</span></span><br><span class="line"><span class="params">                       <span class="meta">@DateTimeFormat(pattern = &quot;yyyy/mm/dd HH:mm:ss&quot;)</span> Date date3)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;date1==&gt;&quot;</span>+date1);</span><br><span class="line">        System.out.println(<span class="string">&quot;date2==&gt;&quot;</span>+date2);</span><br><span class="line">        System.out.println(<span class="string">&quot;date3==&gt;&quot;</span>+date3);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&#123;&#x27;info&#x27;:&#x27;springmvc&#x27;&#125;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><img src="https://s2.loli.net/2022/07/04/y5KgH9NFTUPoXBR.png" class="lazyload" data-srcset="https://s2.loli.net/2022/07/04/y5KgH9NFTUPoXBR.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220704231311600.png" style="zoom:67%;" /><p>控制台打印：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">date1==&gt;Mon Jul 04 00:00:00 CST 2022</span><br><span class="line">date2==&gt;Tue Jan 04 00:07:00 CST 2022</span><br><span class="line">date3==&gt;Tue Jan 04 23:10:00 CST 2022</span><br></pre></td></tr></table></figure><p>类型转换器：</p><p>Converter接口</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Converter</span>&lt;S, T&gt; &#123;</span><br><span class="line"><span class="meta">@Nullable</span></span><br><span class="line">T <span class="title function_">convert</span><span class="params">(S val)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>请求参数年龄数据(String&#x3D;&#x3D;&gt;Integer)</li><li>日期格式转换(String&#x3D;&#x3D;&gt;Date)</li></ul><p><code>@EnableWebMvc</code>注解作用之一：根据类型匹配对应的类型转换器</p><h3 id="2-6-响应数据"><a href="#2-6-响应数据" class="headerlink" title="2.6 响应数据"></a>2.6 响应数据</h3><blockquote><p>响应页面</p><p>响应数据</p><ul><li><p>文本数据</p></li><li><p>json数据</p></li></ul></blockquote><p><span style="color:red">响应页面</span>：</p><p>在<code>webapp</code>资源包中新建文件：<code>page.jsp</code></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>Hello SpringMVC!<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>页面跳转：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/jumpPage&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">jumpPage</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;页面跳转&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;page.jsp&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>url地址：<code>http://localhost:8888/jumpPage</code></p><p>会自动跳转到<code>page.jsp</code>页面</p><p><span style="color:red">响应文本数据</span>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/toText&quot;)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toText</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;返回纯文本数据&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;hello SpringMVC&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>url地址：<code>http://localhost:8888/toText</code></p><p>页面数据：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hello SpringMVC</span><br></pre></td></tr></table></figure><p><span style="color:red">响应POJO对象</span>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/toPojo&quot;)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">toPojo</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;返回POJO数据&quot;</span>);</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">        user.setName(<span class="string">&quot;大黄&quot;</span>);</span><br><span class="line">        user.setAge(<span class="number">18</span>);</span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>url地址：<code>http://localhost:8888/toPojo</code></p><p>页面数据：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;大黄&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;age&quot;</span><span class="punctuation">:</span> <span class="number">18</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;address&quot;</span><span class="punctuation">:</span> <span class="keyword">null</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>其中是<code>jackson</code>自动将对象转换成json数据</p><p>所以一定要导入<code>jackson</code>坐标</p><p><span style="color:red">响应POJO集合对象</span>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/toPojoList&quot;)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;User&gt; <span class="title function_">toPojoList</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;返回POJO集合对象数据&quot;</span>);</span><br><span class="line">        <span class="type">User</span> <span class="variable">user1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">        user1.setName(<span class="string">&quot;大黄&quot;</span>);</span><br><span class="line">        user1.setAge(<span class="number">18</span>);</span><br><span class="line">        <span class="type">User</span> <span class="variable">user2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">        user2.setName(<span class="string">&quot;大黑&quot;</span>);</span><br><span class="line">        user2.setAge(<span class="number">20</span>);</span><br><span class="line">        List&lt;User&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        list.add(user1);</span><br><span class="line">        list.add(user2);</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>url地址：<code>http://localhost:8888/toPojoList</code></p><p>页面数据：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;大黄&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;age&quot;</span><span class="punctuation">:</span> <span class="number">18</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;address&quot;</span><span class="punctuation">:</span> <span class="keyword">null</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;大黑&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;age&quot;</span><span class="punctuation">:</span> <span class="number">20</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;address&quot;</span><span class="punctuation">:</span> <span class="keyword">null</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">]</span></span><br></pre></td></tr></table></figure><blockquote><p><code>@ResponseBody</code>注解：</p><p>设置当前控制器返回值作为响应体</p><p>控制器方法返回值数据类型为<code>String</code>，则返回文本数据</p><p>控制器方法返回值数据类型为对象，则自动将对象转换成json数据</p><p>类型转换器：</p><p>web请求专用类型转换器：HttpMessageConverter接口</p></blockquote></div><div class="story post-story"><h2 id="3-REST风格"><a href="#3-REST风格" class="headerlink" title="3.REST风格"></a>3.REST风格</h2><h3 id="3-1-REST简介"><a href="#3-1-REST简介" class="headerlink" title="3.1 REST简介"></a>3.1 REST简介</h3><blockquote><p>REST(Representational State Transfer)：表现形式状态转换</p><ul><li><p>传统风格资源描述形式</p><ul><li><code>http://localhost:8888/user/getById?id=1</code></li><li><code>http://localhost:8888/user/saveUser</code></li></ul></li><li><p>REST风格描述形式</p><ul><li><code>http://localhost:8888/user/1</code></li><li><code>http://localhost:8888/user</code></li></ul></li></ul><p>优点：</p><ul><li>隐藏资源的访问行为，无法通过地址得知对资源是如何操作</li><li>书写简化</li></ul></blockquote><blockquote><p>按照REST风格访问资源时使用行为动作区分对资源进行了何种操作</p><ul><li><p><code>http://localhost:8888/users</code>            查询全部用户信息(get)</p></li><li><p><code>http://localhost:8888/users/1</code>        查询指定用户信息(post)</p></li><li><p><code>http://localhost:8888/users</code>            添加用户信息(post)</p></li><li><p><code>http://localhost:8888/users</code>            修改用户信息(put)</p></li><li><p><code>http://localhost:8888/users/1</code>        删除用户信息(delete)</p></li></ul><p>描述模块的名称通常使用复数，也就是加<code>s</code>的格式描述，表示此类资源，而非单个资源。</p><ul><li>例如：users、books….</li></ul><p>根据REST风格对资源进行访问称为<span style="color:red">RESTFul</span></p></blockquote><h3 id="3-2-REST入门"><a href="#3-2-REST入门" class="headerlink" title="3.2 REST入门"></a>3.2 REST入门</h3><p><code>@RequestMapping</code>注解中<code>method</code>属性可以设定http请求地址，例如：GET、POST、PUT、DELETE…</p><p><code>@PathVariable</code>注解：绑定路径参数与处理器方法形参间的关系，要求路径参数名与形参名一一对应</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/users&quot;, method = RequestMethod.POST)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">save</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;save~~&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;save success&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/users&quot;, method = RequestMethod.PUT)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">update</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;update~~&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;update success&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/users/&#123;id&#125;&quot;, method = RequestMethod.DELETE)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">delete</span><span class="params">(<span class="meta">@PathVariable</span> Integer id)</span>&#123; <span class="comment">//路径变量</span></span><br><span class="line">        System.out.println(<span class="string">&quot;delete~~&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;delete success&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/users&quot;, method = RequestMethod.GET)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getAll</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;getAll~~&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;getAll success&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/users/&#123;id&#125;&quot;, method = RequestMethod.POST)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getById</span><span class="params">(<span class="meta">@PathVariable</span> Integer id)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;getById~~&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;getById success&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong><code>@RequestBody</code> <code>@RequestParam</code> <code>@PathVariable</code></strong></p><blockquote><p>区别</p><ul><li><p><code>@RequestParam</code>用于接收url地址传参或表单传参</p></li><li><p><code>@RequestBody</code>用于接收json数据</p></li><li><p><code>@PathVariab1e</code>用于接收路径参数, 使用{参数名称}描述路径参数</p></li></ul><p>应用</p><ul><li><p>后期开发中，发送请求参数超过1个时，以json格式为主, <code>@RequestBody</code>应用较广</p></li><li><p>如果发送非json格式数据 ,选用<code>@RequestParam</code>接收请求参数</p></li><li><p>采用RESTful进行开发，当参数数量较少时，例如1个， 可以采用<code>@PathVariable</code>接收请求路径变量，通常用于传递id值</p></li></ul></blockquote><h3 id="3-3-REST快速开发"><a href="#3-3-REST快速开发" class="headerlink" title="3.3 REST快速开发"></a>3.3 REST快速开发</h3><p><code>@ResponseBody</code>：</p><ul><li>设置当前控制器类为RESTful风格，等同于<code>@Controller</code>与<code>@ResponseBody</code>两个注解组合功能</li></ul><p>标准请求动作映射：</p><ul><li><p><code>@GetMapping</code>：对应GET请求</p></li><li><p><code>@PostMapping</code>：对应POST请求</p></li><li><p><code>@PutMapping</code>：对应PUT请求</p></li><li><p><code>@DeleteMapping</code>：对应DELETE请求</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//@ResponseBody + @Controller ==&gt; @RestController</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/users&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line">    <span class="meta">@PostMapping</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">save</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;save~~&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;save success&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PutMapping</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">update</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;update~~&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;update success&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@DeleteMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">delete</span><span class="params">(<span class="meta">@PathVariable</span> Integer id)</span>&#123; <span class="comment">//路径变量</span></span><br><span class="line">        System.out.println(<span class="string">&quot;delete~~&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;delete success&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getAll</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;getAll~~&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;getAll success&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getById</span><span class="params">(<span class="meta">@PathVariable</span> Integer id)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;getById~~&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;getById success&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="4-SSM整合"><a href="#4-SSM整合" class="headerlink" title="4.SSM整合"></a>4.SSM整合</h2><h2 id="5-拦截器"><a href="#5-拦截器" class="headerlink" title="5.拦截器"></a>5.拦截器</h2><h3 id="5-1-拦截器的概念"><a href="#5-1-拦截器的概念" class="headerlink" title="5.1 拦截器的概念"></a>5.1 拦截器的概念</h3><blockquote><p>拦截器(Interceptor)是一种动态拦截方法调用的机制，再SpringMVC中动态拦截控制器方法的执行</p><p>作用：</p><ul><li><p>在指定的方法调用前后执行预先设定的代码</p></li><li><p>阻止原始方法的执行</p></li></ul></blockquote><p>拦截器与过滤器的区别：</p><blockquote><p>归属不同：Filter属于Servlet技术，Interceptor属于SpringMVC技术</p><p>拦截内容不同：Filter对所有访问进行数据增强，Interceptor仅针对SpringMVC的访问进行增强</p></blockquote><h3 id="5-2-拦截器入门"><a href="#5-2-拦截器入门" class="headerlink" title="5.2 拦截器入门"></a>5.2 拦截器入门</h3><blockquote><ol><li><p>制作拦截器功能类</p></li><li><p>配置拦截器的执行位置</p></li></ol></blockquote><p>项目结构：</p><img src="C:\Users\26919\AppData\Roaming\Typora\typora-user-images\image-20220706220216540.png" class="lazyload" data-srcset="C:\Users\26919\AppData\Roaming\Typora\typora-user-images\image-20220706220216540.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220706220216540" style="zoom:67%;" /><p>ProjectInterceptor：</p><p>此时<code>preHandle</code>方法的返回值为<code>true</code>：执行请求的方法</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProjectInterceptor</span> <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;preHandle~~~&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">postHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;postHandle~~~&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;afterCompletion~~~&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>SpringMvcSupport：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringMvcSupport</span> <span class="keyword">extends</span> <span class="title class_">WebMvcConfigurationSupport</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ProjectInterceptor projectInterceptor;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> &#123;</span><br><span class="line">        registry.addInterceptor(projectInterceptor).addPathPatterns(<span class="string">&quot;/users&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>SpringMvcConfig中添加扫描路径”com.springmvc.config”</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(&#123;&quot;com.springmvc.controller&quot;,&quot;com.springmvc.config&quot;&#125;)</span></span><br><span class="line"><span class="meta">@EnableWebMvc</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringMvcConfig</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>UserController：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/users&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line">    <span class="meta">@PostMapping</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">save</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;save~~&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;save success&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PutMapping</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">update</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;update~~&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;update success&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@DeleteMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">delete</span><span class="params">(<span class="meta">@PathVariable</span> Integer id)</span>&#123; <span class="comment">//路径变量</span></span><br><span class="line">        System.out.println(<span class="string">&quot;delete~~&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;delete success&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getAll</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;getAll~~&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;getAll success&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getById</span><span class="params">(<span class="meta">@PathVariable</span> Integer id)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;getById~~&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;getById success&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><img src="C:\Users\26919\AppData\Roaming\Typora\typora-user-images\image-20220706220756908.png" class="lazyload" data-srcset="C:\Users\26919\AppData\Roaming\Typora\typora-user-images\image-20220706220756908.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220706220756908" style="zoom:67%;" /><p>页面展示：</p><blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">getAll success</span><br></pre></td></tr></table></figure></blockquote><p>控制台打印：</p><blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">preHandle~~~</span><br><span class="line">getAll~~</span><br><span class="line">postHandle~~~</span><br><span class="line">afterCompletion~~~</span><br></pre></td></tr></table></figure></blockquote><p>如果<code>preHandle</code>方法的返回值为<code>false</code>：不会执行请求的方法</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProjectInterceptor</span> <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;preHandle~~~&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">postHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;postHandle~~~&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;afterCompletion~~~&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><img src="https://s2.loli.net/2022/07/06/7Bo9Guw6TZtga2C.png" class="lazyload" data-srcset="https://s2.loli.net/2022/07/06/7Bo9Guw6TZtga2C.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220706221253148" style="zoom:67%;" /><p>页面无内容，被拦截</p><p>控制台打印：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">preHandle~~~</span><br></pre></td></tr></table></figure><p>所以可以通过if语句进行某种判断，返回<code>true</code>或<code>false</code>，来是否执行请求的方法</p><h3 id="5-3-拦截器参数"><a href="#5-3-拦截器参数" class="headerlink" title="5.3 拦截器参数"></a>5.3 拦截器参数</h3><p>前置处理：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, </span></span><br><span class="line"><span class="params">                         HttpServletResponse response, </span></span><br><span class="line"><span class="params">                         Object handler)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;preHandle~~~&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>参数：</p><ul><li>request：请求对象</li></ul><ul><li>response：响应对象</li></ul><ul><li>handle：被调用的处理器对象，本质为一个方法对象，对反射技术中的Method对象进行了再包装</li></ul><p>返回值：</p><ul><li><p>返回值为false，被拦截的处理将不执行</p></li><li><p>返回值为true，被拦截的处理将会执行</p></li></ul></blockquote><p>后置处理：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">postHandle</span><span class="params">(HttpServletRequest request, </span></span><br><span class="line"><span class="params">                       HttpServletResponse response, </span></span><br><span class="line"><span class="params">                       Object handler, </span></span><br><span class="line"><span class="params">                       ModelAndView modelAndView)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;postHandle~~~&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>参数：</p><ul><li>modelAndView：如果处理器执行完成具有返回结果，可以读取到对应数据与页面信息，并进行调整(了解即可)</li></ul></blockquote><p>完成后处理：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterCompletion</span><span class="params">(HttpServletRequest request, </span></span><br><span class="line"><span class="params">                            HttpServletResponse response, </span></span><br><span class="line"><span class="params">                            Object handler, </span></span><br><span class="line"><span class="params">                            Exception ex)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;afterCompletion~~~&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>参数：</p><ul><li>ex：如果处理执行过程中出现异常对象，可以针对异常情况进行单独处理(了解即可)</li></ul></blockquote><h3 id="5-4-拦截器链配置-了解"><a href="#5-4-拦截器链配置-了解" class="headerlink" title="5.4 拦截器链配置(了解)"></a>5.4 拦截器链配置(了解)</h3><blockquote><p>当配置多个拦截器时，形成拦截链</p><p>拦截器链的运行顺序：</p><ul><li>preHandle：与配置顺序相同，必定运行</li><li>postHandle：与配置顺序相反，可能不运行</li><li>afterCompletion：与配置顺序相反，可能不运行</li></ul><p>但拦截器出现对原始处理器的拦截，后面的拦截器均终止运行</p><p>当拦截器运行中断，仅运行配置再前面的拦截器的<code>afterCompletion</code>操作</p><p>通常开发项目时，很少会用到拦截器链，一般一个拦截器就可以解决问题</p></blockquote><p>按照1、2、3的顺序配置</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringMvcSupport</span> <span class="keyword">extends</span> <span class="title class_">WebMvcConfigurationSupport</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ProjectInterceptor1 projectInterceptor1;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ProjectInterceptor2 projectInterceptor2;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ProjectInterceptor3 projectInterceptor3;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> &#123;</span><br><span class="line">        registry.addInterceptor(projectInterceptor1).addPathPatterns(<span class="string">&quot;/users&quot;</span>);</span><br><span class="line">        registry.addInterceptor(projectInterceptor2).addPathPatterns(<span class="string">&quot;/users&quot;</span>);</span><br><span class="line">        registry.addInterceptor(projectInterceptor3).addPathPatterns(<span class="string">&quot;/users&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>全部的<code>preHandle</code>方法返回值都为<code>true</code>：</li></ul><pre class="mermaid">graph LR;    pre1-->pre2-->pre3-->c(controller)-->post3-->post2-->post1-->after3-->after2-->after1;</pre><ul><li>3的<code>preHandle</code>方法返回值为false：</li></ul><pre class="mermaid">graph LR;    pre1-->pre2-->pre3-->after2-->after1;</pre><ul><li>2的<code>preHandle</code>方法返回值为false：</li></ul><pre class="mermaid">graph LR;    pre1-->pre2-->after1;</pre><ul><li>1的<code>preHandle</code>方法返回值为false：</li></ul><pre class="mermaid">graph LR;    pre1;</pre></div>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> 框架 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringCloud框架的学习笔记</title>
      <link href="/2022/08/06/Java/SpringCloud%E6%A1%86%E6%9E%B6/"/>
      <url>/2022/08/06/Java/SpringCloud%E6%A1%86%E6%9E%B6/</url>
      
        <content type="html"><![CDATA[<p>微服务技术栈：</p><img src="https://s2.loli.net/2022/08/06/B7LsSzUhuZjyKDQ.png" class="lazyload" data-srcset="https://s2.loli.net/2022/08/06/B7LsSzUhuZjyKDQ.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="IMG_2719" style="zoom:120%;" /><img src="https://s2.loli.net/2022/08/14/rhAQoPUmKETVqlD.png" class="lazyload" data-srcset="https://s2.loli.net/2022/08/14/rhAQoPUmKETVqlD.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220814132340938.png" style="zoom: 50%;" /><h1 id="实用篇"><a href="#实用篇" class="headerlink" title="实用篇"></a>实用篇</h1><div class="story post-story"><h2 id="1-微服务治理"><a href="#1-微服务治理" class="headerlink" title="1.微服务治理"></a>1.微服务治理</h2><h3 id="1-1-认识微服务"><a href="#1-1-认识微服务" class="headerlink" title="1.1 认识微服务"></a>1.1 认识微服务</h3><p><strong>单体架构</strong>：</p><blockquote><p>单体架构：将业务的所有功能集中在一个项目开发，打成一个包部署</p><p>优点：</p><ul><li>架构简单</li><li>部署成本低</li></ul><p>缺点：</p><ul><li>耦合度高</li></ul><p>特点：</p><ul><li>简单方便、高度耦合、拓展性差、适合小型项目</li></ul></blockquote><p><strong>分布式架构</strong>：</p><blockquote><p>分布式架构：根据业务功能对系统进行拆分，每个业务模块作为独立项目开发，称为一个服务</p><p>优点：</p><ul><li>降低服务耦合</li><li>有利于服务升级拓展</li></ul><p>分布式架构所要考虑的问题：</p><ul><li>服务拆分粒度如何？</li><li>服务集群地址如何维护？</li><li>服务之间如何实现远程调用？</li><li>服务健康状态如何感知？</li></ul><p>特点：</p><p>松耦合、拓展性好，但架构复杂、难度大，适合大型互联网项目</p></blockquote><p><strong>微服务特点</strong>：</p><blockquote><p>微服务是一种经过良好架构设计的<strong>分布式</strong>架构</p><p>微服务架构特征：</p><ul><li><p>单一职责：</p><p>微服务拆分粒度更小，每一个服务都对应唯一的业务能力，做到单一职责，避免单一职责，避免重复开发</p></li><li><p>面向服务：</p><p>微服务对外暴露业务接口</p></li><li><p>自治：</p><p>团队独立、技术独立、数据独立、部署独立</p></li><li><p>隔离性强：</p><p>服务调用做好隔离、容错、降级、避免出现级联问题</p></li></ul><p>优点：</p><ul><li>拆分粒度更小、服务更独立、耦合度更低</li></ul><p>缺点：</p><ul><li>架构非常复杂、运维、监控、部署难度更高</li></ul></blockquote><p><strong>微服务技术</strong>：</p><p>微服务这种方案需要技术落地，全球的互联网公司都在积极尝试自己的微服务落地技术</p><p>在国内最知名的就是<strong>SpringCloud</strong>和<strong>阿里巴巴的Dubbo</strong></p><p><strong>微服务技术对比</strong>：</p><table><thead><tr><th align="center"></th><th align="center">Dubbo</th><th align="center">SpringCloud</th><th align="center">SpringCloudAlibaba</th></tr></thead><tbody><tr><td align="center">注册中心</td><td align="center">zookeeper、Redis</td><td align="center">Eureka、Consul</td><td align="center">Nacos、Eureka</td></tr><tr><td align="center">服务远程调用</td><td align="center">Dubbo协议(RFC协议)</td><td align="center">Feign(http协议)</td><td align="center">Dubbo、Feign</td></tr><tr><td align="center">配置中心</td><td align="center">无</td><td align="center">SpringCloudConfig</td><td align="center">SpringCloudConfig、Nacos</td></tr><tr><td align="center">服务网关</td><td align="center">无</td><td align="center">SpringCloudGateway、Zuul</td><td align="center">SpringCloudGatway、Zuul</td></tr><tr><td align="center">服务监控和保护</td><td align="center">dubbo-admin(功能弱)</td><td align="center">Hystrix</td><td align="center">Sentinel</td></tr></tbody></table><p><strong>企业需求</strong>：</p><blockquote><ul><li><p><strong>SpringCloud+Feign</strong></p><ul><li>使用SpringCloud技术栈</li><li>服务接口采用Restful风格</li><li>服务调用采用Feign方式</li></ul></li><li><p><strong>SpringCloudAlibaba+Feign</strong></p><ul><li>使用SpringCloudAlibaba技术栈</li><li>服务接口采用Restful风格</li><li>服务调用采用Feign方式</li></ul></li><li><p><strong>SpringCloudAlibaba+Dubbo</strong></p><ul><li>使用SpringCloudAlibaba技术栈</li><li>服务接口采用Dubbo协议标准</li><li>服务调用采用Dubbo方式</li></ul></li><li><p><strong>Dubbo原始模式</strong></p><ul><li>基于Dubbo老旧技术体系</li><li>服务接口采用Dubbo协议标准</li><li>服务调用采用Dubbo方式</li></ul></li></ul></blockquote><p><strong>SpringCloud</strong>：</p><blockquote><p><a href="https://spring.io/projects/spring-cloud">SpringCloud</a>是目前国内使用最广泛的微服务框架</p><p>SpringCloud集成了各种微服务功能组件，并基于SpringBoot实现了这些组件的<strong>自动装配</strong>，从而提供了良好的开箱即用体验：</p><img src="https://s2.loli.net/2022/08/14/3VfGQYtvF6BMy7w.png" class="lazyload" data-srcset="https://s2.loli.net/2022/08/14/3VfGQYtvF6BMy7w.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220814144726965" style="zoom: 67%;" /><p>SpringCloud与SpringBoot的存在版本兼容关系</p><p><strong>本次学习采用的版本为 Hoxton.SR10，因此对应的SpringBoot版本为2.3.x版本</strong></p></blockquote><h3 id="1-2-分布式服务架构案例"><a href="#1-2-分布式服务架构案例" class="headerlink" title="1.2 分布式服务架构案例"></a>1.2 分布式服务架构案例</h3><p>服务拆分注意事项：</p><blockquote><ol><li>不同微服务，不要重复开发相同业务</li><li>微服务数据独立，不要访问其他微服务的数据库</li><li>微服务可以将自己的业务暴露为接口，供其他的服务调用</li></ol></blockquote><h3 id="1-3-服务拆分"><a href="#1-3-服务拆分" class="headerlink" title="1.3 服务拆分"></a>1.3 服务拆分</h3><p>服务拆分注意事项：</p><blockquote><p>1.不同微服务，不要重复开发相同业务</p><p>2.微服务数据独立，不要访问其它微服务的数据库</p><p>3.微服务可以将自己的业务暴露为接口，供其他微服务调用</p></blockquote><p>案例：根据订单id查询订单功能</p><p>需求：根据订单id查询订单的同时，把订单所属的用户信息一起返回</p><p>查询订单信息：<code>http://localhost:8080/order/101</code></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="number">101</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;price&quot;</span><span class="punctuation">:</span><span class="number">699900</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;Apple 苹果 iPhone 12 &quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;num&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;userId&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;user&quot;</span><span class="punctuation">:</span><span class="keyword">null</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>user信息为<code>null</code>，我们需要在查询订单信息的同时，也可以获得订单所属用户信息</p><p>我们可以调用user服务的接口</p><p>在<code>order-service</code>服务的<code>OrderApplication</code>中注册<code>RestTemplate</code>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@MapperScan(&quot;cn.itcast.order.mapper&quot;)</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderApplication</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(OrderApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//创建RestTemplate对象并注入Spring容器</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> RestTemplate <span class="title function_">restTemplate</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RestTemplate</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>OrderService</code>中添加http请求：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> OrderMapper orderMapper;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RestTemplate restTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Order <span class="title function_">queryOrderById</span><span class="params">(Long orderId)</span> &#123;</span><br><span class="line">        <span class="comment">// 1.查询订单</span></span><br><span class="line">        <span class="type">Order</span> <span class="variable">order</span> <span class="operator">=</span> orderMapper.findById(orderId);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 2.利用restTemplate向user服务发送http请求</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> <span class="string">&quot;http://localhost:8081/user/&quot;</span> + order.getUserId();</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> restTemplate.getForObject(url, User.class);</span><br><span class="line">        order.setUser(user);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3.返回</span></span><br><span class="line">        <span class="keyword">return</span> order;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>重新查询订单信息：<code>http://localhost:8080/order/101</code></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="number">101</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;price&quot;</span><span class="punctuation">:</span><span class="number">699900</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;Apple 苹果 iPhone 12 &quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;num&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;userId&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;user&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;username&quot;</span><span class="punctuation">:</span><span class="string">&quot;柳岩&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;address&quot;</span><span class="punctuation">:</span><span class="string">&quot;湖南省衡阳市&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>成功获得user信息！</p></div><div class="story post-story"><h2 id="3-Eureka"><a href="#3-Eureka" class="headerlink" title="3.Eureka"></a>3.Eureka</h2><h3 id="3-1-提供者与消费者"><a href="#3-1-提供者与消费者" class="headerlink" title="3.1 提供者与消费者"></a>3.1 提供者与消费者</h3><blockquote><ul><li><p>服务提供者：一次业务，被其他微服务调用的服务(提供接口给其他微服务)</p></li><li><p>服务消费者：一次业务，调用其他微服务的服务(调用其他微服务提供的接口)</p></li><li><p>服务A调用了服务B，服务B又调用服务C，服务B属于什么？</p><p>相对于A，就是消费者；相对于C，就是提供者</p></li><li><p>提供者与消费者其实是相对的</p></li></ul></blockquote><h3 id="3-2-Eureka原理分析"><a href="#3-2-Eureka原理分析" class="headerlink" title="3.2 Eureka原理分析"></a>3.2 Eureka原理分析</h3><p>在<code>OrderService</code>中：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> <span class="string">&quot;http://localhost:8081/user/&quot;</span> + order.getUserId();</span><br></pre></td></tr></table></figure><blockquote><p>如果每次更改服务端口，都需要重新修改代码吗？</p><p>如果有多个user服务实例，但是总是调用一个端口，其余的user服务怎么办？</p><p>服务消费者该如何获取服务提供者的地址信息呢？</p><p>如果有多个服务提供者，消费者该如何选择呢？</p><p>消费者如何得到服务提供者的健康状态呢？</p></blockquote><p>Eureka的作用：</p><img src="https://s2.loli.net/2022/09/08/iYx7WsSwfJoT1nd.png" class="lazyload" data-srcset="https://s2.loli.net/2022/09/08/iYx7WsSwfJoT1nd.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220908104127361.png" style="zoom: 67%;" /><blockquote><ul><li>服务消费者该如何获取服务提供者的地址信息呢？</li></ul><p> 服务提供者启动时间向Eureka注册自己的信息</p><p> Eureka保存这些信息</p><p> 消费者根据服务名称向Eureka拉取提供者信息</p><ul><li>如果有多个服务提供者，消费者该如何选择呢？</li></ul><p> 服务消费者利用负载均衡算法，从服务列表中挑选一个</p><ul><li>消费者如何得到服务提供者的健康状态呢？</li></ul><p> 服务提供者会每隔30秒向EurekaServer发送心跳请求，报告健康状况</p><p> Eureka会更新记录服务列表信息，心跳不会正常会被踢出</p><p> 消费者就可以拉取到最新的信息</p></blockquote><p>在Eureka架构中，微服务角色有两类：</p><ul><li>EurekaServer：服务端，注册中心<ul><li>记录服务信息</li><li>心跳监控</li></ul></li><li>EurekaClient： 客户端<ul><li>provider：服务提供省，例如案例中的 user-service<ul><li>注册自己的信息到EurekaServer</li><li>每隔30秒向Eureka Server发送心跳</li></ul></li><li>consumer：服务消费者，例如案例中的 order-service<ul><li>根据服务名称从Eurekaserver拉取服务列表</li><li>基于服务列表做负载均衡，选中一个微服务后发起远程调用</li></ul></li></ul></li></ul><h3 id="3-3-搭建Eureka服务"><a href="#3-3-搭建Eureka服务" class="headerlink" title="3.3 搭建Eureka服务"></a>3.3 搭建Eureka服务</h3><ol><li><p>创建项目，引入<code>spring-cloud-starter-netflix-eureka-server</code>依赖</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-server<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>编写启动类，添加<code>@EnableEurekaServer</code>注解</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableEurekaServer</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EurekaApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(EurekaApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>添加<code>applcation.yaml</code>文件，配置信息：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">10086</span> <span class="comment">#服务端口</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">eurekaserver</span> <span class="comment">#eureka的服务名称</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">service-url:</span> <span class="comment">#eureka的地址信息</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://127.0.0.1:10086/eureka</span></span><br></pre></td></tr></table></figure></li></ol><h3 id="3-4-服务注册"><a href="#3-4-服务注册" class="headerlink" title="3.4 服务注册"></a>3.4 服务注册</h3><p>注册user-service服务注册到EurekaServer：</p><ol><li><p>在user-service项目引入spring-cloud-starter-netflix-eureka-client的依赖</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>在<code>application.yaml</code>文件，添加下面的配置：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">userservice</span></span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://localhost:10086/eureka</span></span><br></pre></td></tr></table></figure></li></ol><p>注册多个<code>user-service</code>服务：</p><p>在idea中，找到user-service服务，右键选择复制配置：</p><img src="https://s2.loli.net/2022/09/08/T7Ox6X4u9IfHiBV.png" class="lazyload" data-srcset="https://s2.loli.net/2022/09/08/T7Ox6X4u9IfHiBV.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="2022-09-08.png" style="zoom: 67%;" /><p>第一个user-service服务的端口为8081，</p><p>我将第二个user-service服务的端口设置为8082(可随意设置，但不要使用占用的端口)</p><img src="https://s2.loli.net/2022/09/08/efqK5jOJ7CDnTH1.png" class="lazyload" data-srcset="https://s2.loli.net/2022/09/08/efqK5jOJ7CDnTH1.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220908223721561.png" style="zoom:50%;" /><h3 id="3-5-服务发现"><a href="#3-5-服务发现" class="headerlink" title="3.5 服务发现"></a>3.5 服务发现</h3><p><strong>在order-service完成服务拉取</strong></p><p>服务拉取基于服务名称获取服务列表，然后在对服务列表做负载均衡</p><ol><li><p>修改OrderService的代码，修改访问的url路径，用服务名替代ip、端口：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> <span class="string">&quot;http://userservice/user/&quot;</span> + order.getUserId();</span><br></pre></td></tr></table></figure><p>完整代码：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> OrderMapper orderMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RestTemplate restTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Order <span class="title function_">queryOrderById</span><span class="params">(Long orderId)</span> &#123;</span><br><span class="line">        <span class="comment">// 1.查询订单</span></span><br><span class="line">        <span class="type">Order</span> <span class="variable">order</span> <span class="operator">=</span> orderMapper.findById(orderId);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//利用restTemplate向user服务发送http请求</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> <span class="string">&quot;http://userservice/user/&quot;</span> + order.getUserId();</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> restTemplate.getForObject(url, User.class);</span><br><span class="line">        order.setUser(user);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4.返回</span></span><br><span class="line">        <span class="keyword">return</span> order;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>在order-service项目的启动类<code>OrderApplication</code>中<code>RestTemplate</code>添加<strong>负载均衡</strong>注解：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@LoadBalanced</span> <span class="comment">//负载均衡注解</span></span><br><span class="line"><span class="keyword">public</span> RestTemplate <span class="title function_">restTemplate</span><span class="params">()</span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RestTemplate</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>完整代码：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@MapperScan(&quot;cn.itcast.order.mapper&quot;)</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderApplication</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(OrderApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@LoadBalanced</span></span><br><span class="line">    <span class="keyword">public</span> RestTemplate <span class="title function_">restTemplate</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RestTemplate</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h3 id="3-6-总结"><a href="#3-6-总结" class="headerlink" title="3.6 总结"></a>3.6 总结</h3><blockquote><ol><li>搭建<code>EurekaServer</code>注册中心<ul><li>引入eureka-server依赖</li><li>添加<code>@EnableEurekaServer</code>注解</li><li>在<code>application.yaml</code>中配置<code>eureka</code>地址</li></ul></li><li>服务注册<ul><li>引入eureka-client依赖</li><li>在<code>application.yaml</code>中添加<code>eureka</code>地址</li></ul></li><li>服务发现<ul><li>引入eureka-client依赖</li><li>在<code>application.yaml</code>中添加<code>eureka</code>地址</li><li>给<code>RestTemplate</code>配置bean中添加<code>@LoadBalanced</code>注解</li><li>用服务提供者在eureka注册的服务名称远程调用</li></ul></li></ol></blockquote></div><div class="story post-story"><h2 id="4-Ribbon"><a href="#4-Ribbon" class="headerlink" title="4.Ribbon"></a>4.Ribbon</h2><h3 id="4-1-负载均衡原理"><a href="#4-1-负载均衡原理" class="headerlink" title="4.1 负载均衡原理"></a>4.1 负载均衡原理</h3><p>负载均衡流程：</p><pre class="mermaid">graph LRA[order-service]B{Ribbon负载均衡}C(eureka-service)D[user-service:8081]E[user-service:8082]A--1.发起请求<br>http://userservice/user/1-->BB--2.拉取<br>userservice-->CC--3.返回服务列表<br>localhost:8081<br>localhost:8082-->BB--4.轮询到8081-->DB-->E</pre><p>负载均衡原理：</p><pre class="mermaid">graph LRA[order-service]B[RibbonLoadBalancerClient]C[DynamicServerListLoadBalancer]D(eureka-service)E[IRule]F[user-service:8081]G[user-service:8082]A--1.发起请求<br>http://userservice/user/1-->BC--3.拉取<br>userservice-->DD--4.返回服务列表<br>localhost:8081<br>localhost:8082-->Csubgraph LoadBalancerInterceptor负载均衡拦截器      B--2.获取url中的服务id<br>userservice-->C    C--5.服务负载均衡<br>localhost:8081<br>localhost:8082-->E    E--6.选择某个服务<br>localhost:8081-->B endsubgraph 请求      B-->F    B-.->G end</pre><h3 id="4-2-负载均衡策略-IRule"><a href="#4-2-负载均衡策略-IRule" class="headerlink" title="4.2 负载均衡策略(IRule)"></a>4.2 负载均衡策略(IRule)</h3><p>Ribbon的负载均衡是一个叫做IRule的接口来定义的，每一个子接口都是一种规则：</p><pre class="mermaid">classDiagram      IRule <|-- AbstractLoadBalancerRule      AbstractLoadBalancerRule <|-- RetryRule      AbstractLoadBalancerRule <|-- ClientConfigEnabledRobinRule      AbstractLoadBalancerRule <|-- RundRobinRule      AbstractLoadBalancerRule <|-- RandomRule      ClientConfigEnabledRobinRule <|-- BestAvailabeRule      ClientConfigEnabledRobinRule <|-- PredicateBaseRule      RundRobinRule <|-- WeightedResponseTimeRule      PredicateBaseRule <|-- AvailablityFilteringRule      PredicateBaseRule <|-- ZoneAvoidanceRule</pre><table><thead><tr><th align="center">内置负载均衡规则类</th><th>规则描述</th></tr></thead><tbody><tr><td align="center">RoundRobinRule</td><td>简单轮询服务列表来选择服务器。它是Ribbon默认的负载均衡规则。</td></tr><tr><td align="center">AvailabilityFilteringRule</td><td>对以下两种服务器进行忽略：<br/>(1) 在默认情况下，这台服务器如果3次连接失败，这台服务器就会被设置为 “短路”状态。短路状态将持续30秒，如果再次连接失败，短路的持续时间就会几何级地增加。<br/>(2) 并发数过高的服务器。如果一个服务器的并发连接数过高，配置了<code>AvailabilityFilteringRule</code>规则的客户端也会将其忽路。并发连接数的上限，可以由客户端的<br/><code>&lt;clientName&gt;.&lt;sclientConfigNamespace&gt;.ActiveConnectionsLimit</code>属性进行配置。</td></tr><tr><td align="center">WeightedResponseTimeRule</td><td>为每一个服务器赋子一个权重值。服务器响应时间越长，这个服务器的权重就越小。这个规则会随机选择服务器，这个权重值会影响服务器的选择。</td></tr><tr><td align="center"><span style="color:red">ZoneAvoidanceRule</span></td><td>以区域可用的服务器为基础进行服务器的选择。使用Zone对服务器进行分类，这个Zone可以理解为机房、一个机架等。而后再对Zone内的多个服务做轮询。</td></tr><tr><td align="center">BestAvailabeRule</td><td>忽略哪些短路的服务器，并选择并发数较低的服务器。</td></tr><tr><td align="center">RandomRule</td><td>随机选择一个可用的服务器。</td></tr><tr><td align="center">RetryRule</td><td>重试机制的选择逻辑。</td></tr></tbody></table><p>修改负载均衡规则：</p><p>通过定义<code>IRule</code>实现可以修改负载均衡规则，有两种方式：</p><ol><li><p>代码方式：在<code>order-service</code>中的<code>OrderApplication</code>类或者新建一个配置类中，定义一个新的<code>IRule</code>：</p><p>此方式是作用全局请求的所有的服务</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> IRule <span class="title function_">randomRule</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RandomRule</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>配置文件方式：在<code>order-service</code>中的application.yaml文件中，添加新的配置信息也可以修改规则：</p><p>此方式可以指定<code>user-service</code>服务的负载均衡规则</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">userservice:</span></span><br><span class="line">  <span class="attr">ribbon:</span></span><br><span class="line">    <span class="attr">NFLoadBalancerRuleClassName:</span> <span class="string">com.netflix.loadbalancer.RondomRule</span> <span class="comment">#负载均衡规则</span></span><br></pre></td></tr></table></figure></li></ol><h3 id="4-3-饥饿加载"><a href="#4-3-饥饿加载" class="headerlink" title="4.3 饥饿加载"></a>4.3 饥饿加载</h3><p>Ribbon默认采用懒加载，即第一次访问才会去创建LoadBalanceClient，请求时间较长</p><p>而饥饿加载会在项目启动时创建，降低第一次访问的耗时</p><p>可以通过下面配置开启饥饿加载：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">ribbon:</span></span><br><span class="line">  <span class="attr">eager-load:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span>        <span class="comment">#开启饥饿加载</span></span><br><span class="line">    <span class="attr">clients:</span> <span class="string">userservice</span> <span class="comment">#指定对userservice这个服务饥饿加载，可以指定多个服务用 -XXXservice </span></span><br></pre></td></tr></table></figure><h3 id="4-4-总结"><a href="#4-4-总结" class="headerlink" title="4.4 总结"></a>4.4 总结</h3><blockquote><ol><li><p>Ribbon负载均衡规则</p><ul><li><p>规则接口是IRule</p></li><li><p>默认实现是ZoneAvoidanceRule，根据zone选择服务列表，然后轮询</p></li></ul></li><li><p>负载均衡自定义方式</p><ul><li>代码方式：配置灵活，但修改时需要重新打包发布</li><li>配置方式：直观，方便，无需重新打包发布，但是无法做全局配置</li></ul></li><li><p>饥饿加载</p><ul><li><p>Ribbon默认采用懒加载</p></li><li><p>开启饥饿加载</p></li><li><p>指定饥饿加载的微服务名称</p></li></ul></li></ol></blockquote></div><div class="story post-story"><h2 id="5-Nacos"><a href="#5-Nacos" class="headerlink" title="5.Nacos"></a>5.Nacos</h2><p><code>Nacos</code>是阿里巴巴的产品，现在是<code>SpringCloud</code>中的一个组件，相比<code>Eureka</code>功能更加丰富，在国内受欢迎程度较高</p><h3 id="5-1-快速入门"><a href="#5-1-快速入门" class="headerlink" title="5.1 快速入门"></a>5.1 快速入门</h3><p>服务注册到Nacos</p><ol><li><p>在cloud-demo父工程添加spring-cloud-alibaba的管理依赖：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-alibaba-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.5.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>注释掉order-service和user-service中的eureka依赖(pom以及配置信息)</p></li><li><p>添加nacos的客户端依赖：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>在application.yaml中配置user-service服务的Nacos信息：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">userservice</span> <span class="comment">#user-service服务名称</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">server-addr:</span> <span class="string">主机地址ip:8848</span> <span class="comment">#nacos服务地址</span></span><br></pre></td></tr></table></figure></li></ol><h3 id="5-2-服务多级存储模型"><a href="#5-2-服务多级存储模型" class="headerlink" title="5.2 服务多级存储模型"></a>5.2 服务多级存储模型</h3><pre class="mermaid">graph TBA[服务]B(集群1)C(集群2)D(集群3)E(实例1)F(实例2)G(实例3)H(实例4)I(实例5)J(实例6)A-.-CA-.-BA-.-Dsubgraph 北京    B-->E    B-->Fendsubgraph 上海<br>例如:实例3userserivce端口为8083<br><br>    C-->G    C-->Hendsubgraph 杭州<br>例如:实例5userserivce端口为8081<br>例如:实例6userserivce端口为8082<br><br><br>    D-->I    D-->Jend</pre><p>服务调用要尽可能选择本地集群的服务，跨集群调用延迟较高</p><p>当本地集群不可访问时，才去访问其他集群</p><p>服务集群属性：</p><ol><li><p>修改appliaction.yaml，添加下面内容：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">cluster-name:</span> <span class="string">HZ</span> <span class="comment">#自定义集群名称，HZ为杭州</span></span><br></pre></td></tr></table></figure></li><li><p>先将启动user-service1和user-service2，注意不要停止运行这两个服务</p><p>再复制一个配置叫做user-service3，将<code>cluster-name</code>属性改为<code>SH</code>(上海)，启动服务</p></li><li><p>在Nacos控制台可以看到集群变化：</p><p>可以看到有两个集群<code>HZ</code>和<code>SH</code></p></li></ol><p>总结：</p><ol><li><p>Nacos服务分级存储模型</p><ul><li>一级为服务，例如userservice</li><li>二级为集群，例如杭州或上海</li><li>三级为实例，例如杭州机房的某台部署了userservice的服务器</li></ul></li><li><p>如何设置实例的集群属性</p><p>修改<code>application.yaml</code>文件中的<code>spring.cloud.discover.cluster-name</code>属性</p></li></ol><h3 id="5-3-NacosRule负载均衡"><a href="#5-3-NacosRule负载均衡" class="headerlink" title="5.3 NacosRule负载均衡"></a>5.3 NacosRule负载均衡</h3><p>根据集群负载均衡：</p><ol><li><p>修改order-service中的application.yaml，设置集群为HZ：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  cloud:</span><br><span class="line">    nacos:</span><br><span class="line">      discovery:</span><br><span class="line">        cluster-name: HZ #自定义集群名称，HZ为杭州</span><br></pre></td></tr></table></figure></li><li><p>在order-service中设置负载均衡的Rule为NacosRule：</p><p>此规则会默认寻找与自己同集群的服务，未找到才寻找其他集群</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">userservice:</span></span><br><span class="line">  <span class="attr">ribbon:</span></span><br><span class="line">    <span class="attr">NFLoadBalancerRuleClassName:</span> <span class="string">com.alibaba.cloud.nacos.ribbon.NacosRule</span> <span class="comment">#负载均衡规则</span></span><br></pre></td></tr></table></figure></li></ol><p>总结：</p><ol><li>NacosRule负载均衡策略<ul><li>优先选择同集群服务实例列表</li><li>未找到本地集群，才会寻找其他集群，并会警告</li><li>确定了可用实例列表后，再采用随机负载均衡挑选实例</li></ul></li></ol><h3 id="5-4-服务实例的权重"><a href="#5-4-服务实例的权重" class="headerlink" title="5.4 服务实例的权重"></a>5.4 服务实例的权重</h3><p>根据权重负载均衡：</p><p>实际部署会出现这样的场景：</p><ul><li>服务设备性能有差异，部分实例所在机器性能较好，而另一些较差，我们希望性能好的机器能承担更多的用户请求</li></ul><p>Nacos提供了权重配置来控制访问频率，权重越大则访问频率越高</p><ol><li><p>在Nacos控制台可以设置实例的权重值，首先选中实例后面的编辑</p><p><img src="https://s2.loli.net/2022/09/11/ykx57jlZXweRUuo.png" class="lazyload" data-srcset="https://s2.loli.net/2022/09/11/ykx57jlZXweRUuo.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220910224808085.png"></p></li><li><p>将权重设置为0.1，测试可以发现8081端口被访问的频率大大降低</p><img src="https://s2.loli.net/2022/09/11/vZKcMo9FOwfYh8a.png" class="lazyload" data-srcset="https://s2.loli.net/2022/09/11/vZKcMo9FOwfYh8a.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220910225118298.png" style="zoom: 50%;" /><p>可用于灰度发布。</p></li></ol><p>总结：</p><ol><li>实例的权重控制<ul><li>Nacos控制台可以设置实例的权重值，区间在0~1之间</li><li>同集群内的多个实例，权重越高被访问的频率越高</li><li>权重设置为0，则完全不会被访问</li></ul></li></ol><h3 id="5-5-环境隔离"><a href="#5-5-环境隔离" class="headerlink" title="5.5 环境隔离"></a>5.5 环境隔离</h3><p>环境隔离——namespace</p><p>Nacos中服务存储和数据存储的最外层都是一个名为namespace的东西，用来做最外层隔离</p><p>层序：</p><p>Namespace( Group ( Service&#x2F;Data ) )</p><ol><li><p>在Nacos控制台选项列表点击<code>命名空间</code>，再点击<code>新建命名空间</code></p><p><img src="https://s2.loli.net/2022/09/11/Yh1KOgpN9RE8WL3.png" class="lazyload" data-srcset="https://s2.loli.net/2022/09/11/Yh1KOgpN9RE8WL3.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220911103047943.png"></p></li><li><p>新建名空间设置：</p></li></ol><img src="https://s2.loli.net/2022/09/11/KJEcZMQuH8pUvSk.png" class="lazyload" data-srcset="https://s2.loli.net/2022/09/11/KJEcZMQuH8pUvSk.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220911103305781.png" style="zoom:67%;" /><ol start="3"><li><p>选择命名空间选项，找到命名空间名称为<code>dev</code>，复制其命名空间id：</p><p><img src="https://s2.loli.net/2022/09/11/aQ7b4wME3SWFIe6.png" class="lazyload" data-srcset="https://s2.loli.net/2022/09/11/aQ7b4wME3SWFIe6.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220911104544560.png"></p></li><li><p>修改服务的命名空间：</p><p>修改<code>order-service</code>的<code>application.yaml</code>，添加namespace并填入上面获取的id：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">orderservice</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">namespace:</span> <span class="string">f2b2f43b-d7bb-4857-8548-5595ef899fd2</span></span><br></pre></td></tr></table></figure></li><li><p>启动order-service服务，会发现出现在了dev中：</p><p><img src="https://s2.loli.net/2022/09/11/sJdbeMr3A5VlKmW.png" class="lazyload" data-srcset="https://s2.loli.net/2022/09/11/sJdbeMr3A5VlKmW.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220911105111829.png"></p></li><li><p>不做任何修改<strong>启动user-service服务</strong>后，</p><p>并访问<code>http://localhost:8080/order/101</code></p><p>order-service服务报错：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">09-<span class="number">11</span> <span class="number">10</span>:<span class="number">55</span>:<span class="number">24</span>:<span class="number">428</span> ERROR <span class="number">8788</span> --- [nio-<span class="number">8080</span>-exec-<span class="number">1</span>] o.a.c.c.C.[.[.[/].[dispatcherServlet]    : Servlet.service() <span class="keyword">for</span> servlet [dispatcherServlet] in context with path [] threw exception [Request processing failed; nested exception is org.mybatis.spring.MyBatisSystemException: nested exception is org.apache.ibatis.exceptions.PersistenceException: </span><br><span class="line">### Error querying database.  Cause: org.springframework.jdbc.CannotGetJdbcConnectionException: Failed to obtain JDBC Connection; nested exception is com.mysql.jdbc.exceptions.jdbc4.CommunicationsException: Communications link failure</span><br></pre></td></tr></table></figure><p>userservice处于<code>public</code>中，orderservice处于<code>dev</code>中；</p><p>orderservice服务没有找到userservie服务，说明userservice服务和orderservice服务，已经被<code>隔离</code>了</p></li></ol><p>总结：</p><ol><li>Nacos环境隔离<ul><li>namespace用来做环境隔离</li><li>每个namespace都有唯一id</li><li>不同namespace下的服务不可见</li></ul></li></ol><h3 id="5-6-非临时实例"><a href="#5-6-非临时实例" class="headerlink" title="5.6 非临时实例*"></a>5.6 非临时实例*</h3><p>Nacos注册中心原理：</p><pre class="mermaid">graph BTA(nacos注册中心)B(服务消费者)C(服务提供者)C--注册服务信息-->AB-.定时拉取服务pull.->AB--远程调用-->CC-.临时实例<br>采用心跳检测.->AA-.非临时实例<br>nacos主动询问.->CA--主动推送变更信息<br>push-->B</pre><p>在nacos里创建的实例默认为临时实例</p><p>服务注册到Nacos时，可以选择注册为临时或非临时实例，通过下面的配置来设置：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">orderservice</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">ephemeral:</span> <span class="literal">false</span> <span class="comment">#flase为非临时实例，默认为true临时实例</span></span><br></pre></td></tr></table></figure><p>总结：</p><ol><li>Nacos与eureka的共同点<ul><li>都支持服务注册和服务拉取</li><li>都支持服务提供者心跳方式做健康检测</li></ul></li><li>Nacos与Eureka的区别<ul><li>Nacos支持服务端<strong>主动检测提供者状态</strong>：<strong>临时实例</strong>采用<strong>心跳模式</strong>，<strong>非临时实例</strong>采用<strong>主动检测模式</strong></li><li>临时实例心跳不正常会被剔除，非临时实例则不会被剔除</li><li>Nacos支持服务列表变更的消息推送模式，服务列表更新更及时</li><li>Nacos集群默认采用AP方式，当集群中存在非临时实例时，采用CP模式；Eureka采用AP方式</li></ul></li></ol></div><div class="story post-story"><h2 id="6-Nacos配置管理"><a href="#6-Nacos配置管理" class="headerlink" title="6.Nacos配置管理"></a>6.Nacos配置管理</h2><h3 id="6-1-Nacos实现配置管理"><a href="#6-1-Nacos实现配置管理" class="headerlink" title="6.1 Nacos实现配置管理"></a>6.1 Nacos实现配置管理</h3><p>统一配置管理</p><ul><li><p>配置更改热更新：</p><img src="C:\Users\26919\AppData\Roaming\Typora\typora-user-images\image-20220911131141255.png" class="lazyload" data-srcset="C:\Users\26919\AppData\Roaming\Typora\typora-user-images\image-20220911131141255.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220911131141255" style="zoom:67%;" /><p>新建配置：</p><p>打开Nacos控制台，点击配置管理-&gt;配置列表，点击右边的<code>+</code> 号</p><p><img src="C:\Users\26919\AppData\Roaming\Typora\typora-user-images\image-20220911131318760.png" class="lazyload" data-srcset="C:\Users\26919\AppData\Roaming\Typora\typora-user-images\image-20220911131318760.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220911131318760"></p><p>填入配置：</p><ul><li>配置文件id名：[服务名称]-[profile].[后缀名]    后缀名与配置格式一致</li><li>分组：默认即可</li><li>配置格式：推荐使用yaml格式</li></ul><p>示例：</p><p><img src="C:\Users\26919\AppData\Roaming\Typora\typora-user-images\image-20220911132734612.png" class="lazyload" data-srcset="C:\Users\26919\AppData\Roaming\Typora\typora-user-images\image-20220911132734612.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220911132734612"></p></li><li><p>获取配置步骤：</p><pre class="mermaid">  graph LRA{项目启动}B(读取本地配置文件<br>application.yaml)C(创建Spring容器)D(加载bean)E(读取nacos中的配置文件)A--naocs地址<br>bootstrap.yaml-->EE-->B-->C-->D</pre><ol><li><p>引入Nacos的配置管理客户端依赖：</p><p>在user-service项目引入依赖：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-config<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>在配置文件同级文件包中新建<code>bootstrap.yaml</code>，并删除<code>application.yaml</code>中的nacos的相关配置</p><p><code>bootstrap.yaml</code>内容如下：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">userservice</span> <span class="comment">#服务名称</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">dev</span> <span class="comment">#环境</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">server-addr:</span> <span class="number">43.142</span><span class="number">.167</span><span class="number">.75</span><span class="string">:8848</span> <span class="comment">#nacos地址</span></span><br><span class="line">      <span class="attr">config:</span></span><br><span class="line">        <span class="attr">file-extension:</span> <span class="string">yaml</span> <span class="comment">#文件后缀为yaml</span></span><br></pre></td></tr></table></figure></li><li><p>在UserController中，测试读取Nacos中的配置：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line">    <span class="comment">//注入nacos中的配置属性</span></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;pattern.dateformat&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String dateformat;</span><br><span class="line"><span class="comment">//通过dateformat的时间格式，返回格式化的时间</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/now&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getDateformat</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> LocalDateTime.now().format(DateTimeFormatter.ofPattern(dateformat));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><p>总结：</p><p>将配置交给Nacos管理的步骤：</p><ol><li>在Nacos中添加配置文件</li><li>在微服务中引入nacos的config依赖</li><li>在微服务中添加bootstrap.yml， 配置nacos地址当前环境、服务名称、文件后缀名。这些决定了程序启动时去nacos读取哪个文件</li></ol></li></ul><h3 id="6-2-配置热更新"><a href="#6-2-配置热更新" class="headerlink" title="6.2 配置热更新"></a>6.2 配置热更新</h3><p>Nacos中都配置文件变更后，微服务无需重启就可以感知。不过需要通过两种配置实现：</p><ul><li><p>方式一：在<code>@Value</code>注入的变量所在类上添加注解<code>@RefreshScope</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/user&quot;)</span></span><br><span class="line"><span class="meta">@RefreshScope</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;pattern.dateformat&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String dateformat;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/now&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getDateformat</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> LocalDateTime.now().format(DateTimeFormatter.ofPattern(dateformat));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>方式二：使用<code>@ConfigurationProperties(prefix = &quot;&quot;)</code>注解</p><p>新建config包，创建<code>PatternProperties</code>类：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Component</span> <span class="comment">//交给spring管理</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;pattern&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PatternProperties</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String dateformat;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在UserController注入PatternProperties：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line">    <span class="comment">//注入PatternProperties</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> PatternProperties patternProperties;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/now&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getDateformat</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> LocalDateTime.now().format(DateTimeFormatter.ofPattern(patternProperties.getDateformat()));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p>总结：</p><p>Nacos配置更改后，微服务可以实现热更新，方式如下：</p><ol><li>通过@value注解注入，结合@Refreshscope来刷新</li><li>通过@ConfiqurationProperties注入，自动刷新</li></ol><p>注意事项：</p><ul><li>不是所有的配置都适合放到配置中心，维护起来比较麻烦</li><li>建议将一些关键参数，需要运行时调整的参数放到nacos配置中心，一般都是自定义配置</li></ul><h3 id="6-3-多环境配置共享"><a href="#6-3-多环境配置共享" class="headerlink" title="6.3 多环境配置共享"></a>6.3 多环境配置共享</h3><p>微服务启动会从nacos读取多个配置文件：</p><ul><li>[spring.application.name]-[spring.profile.active].yaml，例如：userservice-dev.yaml</li><li>[spring.application.name].yaml，例如：userservice.yaml</li></ul><p>无论profile如何变化，[spring.application.name].yaml这个文件一定会加载的，因此可以多环境共享配置可以写入这个文件</p><p><img src="C:\Users\26919\AppData\Roaming\Typora\typora-user-images\image-20220911214926009.png" class="lazyload" data-srcset="C:\Users\26919\AppData\Roaming\Typora\typora-user-images\image-20220911214926009.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220911214926009"></p><p>多配置的优先级：</p><p>服务名-profile.yaml &gt; 服务名.yaml &gt; 本地配置</p><p>总结：</p><p>微服务会从nacos读取的配置文件：</p><ul><li>[服务名]-[spring-profile.active].yaml，环境配置</li><li>[服务名].yaml，默认配置，多环境共享</li></ul><p>优先级</p><ul><li>[服务名]-[环境].yaml &gt; [服务名].yaml＞本地配置</li></ul><h3 id="6-4-Nacos集群搭建"><a href="#6-4-Nacos集群搭建" class="headerlink" title="6.4 Nacos集群搭建"></a>6.4 Nacos集群搭建</h3><p>Nacos生产环境下一定要部署为集群状态</p><pre class="mermaid">graph TBA(Nacos<br>client)B[Nginx]C(Nacos<br>node1)D(Nacos<br>node2)E(Nacos<br>node3)F[(MySQL<br>主)]G[(MySQL<br>从)]H[(MySQL<br>从)]A-->BB-->C-->FB-->D-->FB-->E-->Fsubgraph .    F-.-G    F-.-Hend</pre></div><div class="story post-story"><h2 id="7-Feign"><a href="#7-Feign" class="headerlink" title="7.Feign"></a>7.Feign</h2><h3 id="7-1-远程调用"><a href="#7-1-远程调用" class="headerlink" title="7.1 远程调用"></a>7.1 远程调用</h3><p>RestTemplate方式存在的问题：</p><p>RestTemplate发起远程调用，示例代码：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//利用restTemplate向user服务发送http请求</span></span><br><span class="line"><span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> <span class="string">&quot;http://userservice/user/&quot;</span> + order.getUserId();</span><br><span class="line"><span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> restTemplate.getForObject(url, User.class);</span><br></pre></td></tr></table></figure><p>存在问题：</p><ul><li>代码可读性差，编程体验不统一</li><li>参数复杂，URL难以维护</li><li>不够优雅！！！</li></ul><p><strong>优雅的Feign</strong></p><p>介绍：</p><ul><li><p><a href="https://github.com/OpenFeign/feign">Feign</a>是一个声明式的http客户端。</p></li><li><p>其作用就是帮助我们优雅的实现http请求的发送，解决上面提到的问题。</p></li></ul><p>使用Feign步骤：</p><ol><li><p>引入依赖</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>在order-service的启动管理类添加开启Feign功能的注解<code>@EnableFeignClients</code>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableFeignClients</span></span><br><span class="line"><span class="meta">@MapperScan(&quot;cn.itcast.order.mapper&quot;)</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderApplication</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(OrderApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>新建clients包，包中创建<code>UserClient</code>，来编写Feign客户端：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FeignClient(&quot;userservice&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserClient</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/user/&#123;id&#125;&quot;)</span></span><br><span class="line">    User <span class="title function_">findById</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>使用Feign进行远程调用</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> OrderMapper orderMapper;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserClient userClient;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Order <span class="title function_">queryOrderById</span><span class="params">(Long orderId)</span> &#123;</span><br><span class="line">        <span class="comment">// 1.查询订单</span></span><br><span class="line">        <span class="type">Order</span> <span class="variable">order</span> <span class="operator">=</span> orderMapper.findById(orderId);</span><br><span class="line"><span class="comment">//使用Feign远程调用</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userClient.findById(order.getUserId());</span><br><span class="line">        order.setUser(user);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4.返回</span></span><br><span class="line">        <span class="keyword">return</span> order;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><p>总结：</p><p>Feign的使用步骤：</p><ol><li>引入依赖</li><li>添加<code>@EnableFeignClients</code>注解</li><li>编写FeignClient接口</li><li>使用FiegnClient中定义的方法代替RestTemplate</li></ol><h3 id="7-2-自定义配置"><a href="#7-2-自定义配置" class="headerlink" title="7.2 自定义配置"></a>7.2 自定义配置</h3><p>Feign运行自定义配置来覆盖默认配置，可以修改的配置如下：</p><table><thead><tr><th>类型</th><th>作用</th><th>说明</th></tr></thead><tbody><tr><td><span style="color:red">feign.Logger.Level</span></td><td>修改日志级别</td><td>包含四种不同的级别：NONE、BASIC、HEADERS、FULL</td></tr><tr><td>feign.codec.Decoder</td><td>响应结果的解析器</td><td>http远程调用的结果做解析，例如解析json字符串为java对象</td></tr><tr><td>feign.codec.Encoder</td><td>请求参数编码</td><td>将请求参数编码，便于通过http请求发送</td></tr><tr><td>feign.Contract</td><td>请求参数编码</td><td>默认是SpringMVC的注解</td></tr><tr><td>feign.Retryer</td><td>失败重试机制</td><td>请求失败的重试机制，默认是没有，不过会使用Ribbon的重试</td></tr></tbody></table><p>一般我们需要配置的就是日志级别</p><p>配置Feign日志的两种方式：</p><ul><li><p>方式一：配置文件方式</p><ul><li><p>全局生效：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">feign:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">config:</span> </span><br><span class="line">      <span class="attr">default:</span> <span class="comment">#default就是全局配置，如果写的是服务名称，就是针对此服务的配置</span></span><br><span class="line">        <span class="attr">loggerLevel:</span> <span class="string">FULL</span> <span class="comment">#日志级别</span></span><br></pre></td></tr></table></figure></li><li><p>局部生效</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">feign:</span></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">config:</span></span><br><span class="line">      <span class="attr">userservice:</span> <span class="comment">#default就是全局配置，如果写的是服务名称，就是针对此服务的配置</span></span><br><span class="line">        <span class="attr">loggerLevel:</span> <span class="string">FULL</span> <span class="comment">#日志级别</span></span><br></pre></td></tr></table></figure></li></ul></li><li><p>方式二：注解方式</p><p>先声明一个Bean：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FeignClientConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Logger.Level <span class="title function_">feignLogLevel</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Logger.Level.BASIC;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>全局配置，将bean放到<code>@EnableFeignClients</code>注解中：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableFeignClients(defaultConfiguration = FeignClientConfig.class)</span></span><br></pre></td></tr></table></figure></li><li><p>局部配置，将bean放到<code>@FeignClient</code>注解中：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FeignClient(value = &quot;userservice&quot;, configuration = FeignClientConfig.class)</span></span><br></pre></td></tr></table></figure></li></ul></li></ul><p>总结：</p><p>Feign的日志配置：</p><ol><li>方式一是配置文件，<code>feign.client.config.xxx.loggerLevel</code><ul><li>如果xxx是default则代表全局</li><li>如果xxx是服务名称，例如<code>userservice</code>则代表某服务</li></ul></li><li>方式二是java代码配置<code>Logger.Level</code>这个Bean<ul><li>如果在<code>@EnableFeignClients</code>注解声明则代表全局</li><li>如果在<code>@FeignClient</code>注解中声明则代表某服务</li></ul></li></ol><h3 id="7-3-性能优化"><a href="#7-3-性能优化" class="headerlink" title="7.3 性能优化"></a>7.3 性能优化</h3><p>Feign底层的客户端实现：</p><ul><li>URLConnection：默认实现，不支持连接池</li><li>Apache HttpClient：支持连接池</li><li>OKHttp：支持连接池</li></ul><p>因此优化Feign的性能主要包括：</p><ul><li>使用连接池代替默认的URLConnection</li><li>日志级别，最好为basic或none</li></ul><p>Feign添加HttpClient的支持：</p><ol><li><p>引入依赖</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.github.openfeign<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>feign-httpclient<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>配置连接池：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">feign:</span></span><br><span class="line">  <span class="attr">httpclient:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span> <span class="comment">#开启feign对HttpClient的支持</span></span><br><span class="line">    <span class="attr">max-connections:</span> <span class="number">200</span> <span class="comment">#最大连接数</span></span><br><span class="line">    <span class="attr">max-connections-per-route:</span> <span class="number">50</span> <span class="comment">#每个路径的最大连接数</span></span><br></pre></td></tr></table></figure></li></ol><p>总结：</p><p>Feign的优化：</p><ol><li>日志级别尽量用basic</li><li>使用HttpClient或OKHttp代替URLConnection<ul><li>引入feign-httpclient依赖</li><li>配置文件开启httpClient功能，设置连接池参数</li></ul></li></ol><h3 id="7-4-最佳实践"><a href="#7-4-最佳实践" class="headerlink" title="7.4 最佳实践"></a>7.4 最佳实践</h3><p>Feign的最佳实践</p><p>方式一：继承</p><p>给消费者的FeignClient和提供者的Controller定义统一的父接口作为标准</p></div><div class="story post-story"><h2 id="2-Docker"><a href="#2-Docker" class="headerlink" title="2.Docker"></a>2.Docker</h2><h2 id="3-异步通信"><a href="#3-异步通信" class="headerlink" title="3.异步通信"></a>3.异步通信</h2><h2 id="4-分布式搜索"><a href="#4-分布式搜索" class="headerlink" title="4.分布式搜索"></a>4.分布式搜索</h2><p>0</p></div>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> 框架 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringBoot框架的学习笔记</title>
      <link href="/2022/08/06/Java/SpringBoot%E6%A1%86%E6%9E%B6/"/>
      <url>/2022/08/06/Java/SpringBoot%E6%A1%86%E6%9E%B6/</url>
      
        <content type="html"><![CDATA[<div class="story post-story"><h2 id="1-热部署"><a href="#1-热部署" class="headerlink" title="1.热部署"></a>1.热部署</h2><h2 id="2-配置高级"><a href="#2-配置高级" class="headerlink" title="2.配置高级"></a>2.配置高级</h2><h3 id="2-1-自定义bean属性绑定"><a href="#2-1-自定义bean属性绑定" class="headerlink" title="2.1 自定义bean属性绑定"></a>2.1 自定义bean属性绑定</h3><p>导入<code>lombok</code>坐标：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p><code>application.yaml</code>配置中：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">servers:</span></span><br><span class="line">  <span class="attr">ipAddress:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">2345</span></span><br><span class="line">  <span class="attr">timeout:</span> <span class="number">-1</span></span><br></pre></td></tr></table></figure><p><code>ServerConfig</code>类中：</p><p><code>@ConfigurationProperties</code>注解将<code>application.yaml</code>配置中的属性进行绑定</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;servers&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ServerConfig</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String ipAddress;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> port;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">long</span> timeout;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>测试：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ApplicationTests</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ServerConfig serverConfig;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testGetServer</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(serverConfig);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-2-第三方bean属性绑定"><a href="#2-2-第三方bean属性绑定" class="headerlink" title="2.2 第三方bean属性绑定"></a>2.2 第三方bean属性绑定</h3><p>导入<code>druid</code>坐标：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.alibaba&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;druid&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;<span class="number">1.1</span><span class="number">.16</span>&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure><p><code>application.yaml</code>中：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">dataSource:</span></span><br><span class="line">  <span class="attr">driverClassName:</span> <span class="string">com.mysql.jdbc.driver123</span></span><br></pre></td></tr></table></figure><p>配置<code>bean</code>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DataSourceConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConfigurationProperties(prefix = &quot;datasource&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> DruidDataSource <span class="title function_">dataSource</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">DruidDataSource</span> <span class="variable">dataSource</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DruidDataSource</span>();</span><br><span class="line">        <span class="comment">//使用配置文件中的属性进行注入</span></span><br><span class="line">        <span class="comment">//dataSource.setDriverClassName(&quot;com.mysql.jdbc.driver&quot;);</span></span><br><span class="line">        <span class="keyword">return</span> dataSource;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>测试：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ApplicationTests</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> DruidDataSource dataSource;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testDataSource</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(dataSource.getDriverClassName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>@EnableConfigurationProperties</code>注解：</p><ul><li>开启属性绑定并设置对应的目标</li><li>可以将使用的<code>@ConfigurationProperties</code>注解对应的类加入Spring容器</li><li><code>@EnableConfigurationProperties</code>注解与<code>@Component</code>注解不能同时使用</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(ServerConfig.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DataSourceConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConfigurationProperties(prefix = &quot;datasource&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> DruidDataSource <span class="title function_">dataSource</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">DruidDataSource</span> <span class="variable">dataSource</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DruidDataSource</span>();</span><br><span class="line">        <span class="comment">//dataSource.setDriverClassName(&quot;123456&quot;);</span></span><br><span class="line">        <span class="keyword">return</span> dataSource;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>此时要将<code>ServerConfig</code>中的<code>@Component</code>注释删除：</p><p>如果不删除<code>@Component</code>注释，则会造成bean加载两次，报错</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//@Component</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;servers&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ServerConfig</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String ipAddress;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> port;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">long</span> timeout;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>如果<code>idea</code>出现<span style="color:red">Spring Boot Configuration Annotation Processor not configured</span>问题：</p><p>导入坐标即可：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-configuration-processor<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="2-3-松散绑定"><a href="#2-3-松散绑定" class="headerlink" title="2.3 松散绑定"></a>2.3 松散绑定</h3><p><code>@ConfigurationProperties</code>注解：绑定属性支持属性名宽松绑定</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;servers&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ServerConfig</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String ipAddress;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> port;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">long</span> timeout;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>支持多种格式：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">servers:</span></span><br><span class="line">  <span class="comment">#ipAddress: 127.0.0.1  #驼峰格式</span></span><br><span class="line">  <span class="comment">#ipaddress: 127.0.0.1</span></span><br><span class="line">  <span class="comment">#ip_address: 127.0.0.1  #unline格式</span></span><br><span class="line">  <span class="comment">#IPADDRESS: 127.0.0.1</span></span><br><span class="line">  <span class="comment">#IP_ADDRESS: 127.0.0.1  #常量格式</span></span><br><span class="line">  <span class="comment">#IP_ADD_RE_SS: 127.0.0.1</span></span><br><span class="line">  <span class="attr">ip-address:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>  <span class="comment">#烤肉串格式</span></span><br></pre></td></tr></table></figure><p>注意：宽松绑定不支持<span style="color:red">@value 注解</span>引用单个属性的方式</p><p><code>@ConfigurationProperties</code>注解：绑定属性支持属性名宽松绑定</p><p>绑定前缀规范：</p><ul><li><p>指的是：<code>prefix = &quot;datasource&quot;</code>中的<code>datasource</code></p></li><li><p>仅能用使用小写字母、数字、中划线作为合法字符</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;datasource&quot;)</span></span><br><span class="line"><span class="keyword">public</span> DruidDataSource <span class="title function_">dataSource</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">DruidDataSource</span> <span class="variable">dataSource</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DruidDataSource</span>();</span><br><span class="line">    <span class="comment">//dataSource.setDriverClassName(&quot;123456&quot;);</span></span><br><span class="line">    <span class="keyword">return</span> dataSource;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-4-常用计量单位的应用"><a href="#2-4-常用计量单位的应用" class="headerlink" title="2.4 常用计量单位的应用"></a>2.4 常用计量单位的应用</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">servers:</span></span><br><span class="line">  <span class="attr">ipAddress:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>  <span class="comment">#驼峰格式</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">2345</span></span><br><span class="line">  <span class="attr">timeout:</span> <span class="number">-1</span></span><br><span class="line">  <span class="attr">serverTimeout:</span> <span class="number">3</span></span><br><span class="line">  <span class="attr">dataSize:</span> <span class="number">10</span></span><br></pre></td></tr></table></figure><p>指定单位：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;servers&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ServerConfig</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String ipAddress;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> port;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">long</span> timeout; <span class="comment">//long类型描述时间单位为毫秒</span></span><br><span class="line">    <span class="meta">@DurationUnit(ChronoUnit.HOURS)</span> <span class="comment">//指定描述时间单位为小时</span></span><br><span class="line">    <span class="keyword">private</span> Duration serverTimeout;</span><br><span class="line">    <span class="meta">@DataSizeUnit(DataUnit.MEGABYTES)</span> <span class="comment">//指定内存大小单位为MB</span></span><br><span class="line">    <span class="keyword">private</span> DataSize dataSize;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-4-bean属性校验"><a href="#2-4-bean属性校验" class="headerlink" title="2.4 bean属性校验"></a>2.4 bean属性校验</h3><p>导入<code>JSR303</code>规范接口的坐标：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.validation<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>validation-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>导入使用<code>hibernate</code>框架提供的校验器做实现类的坐标：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.hibernate.validator<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hibernate-validator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p><code>@Validated</code>注解为开启bean的校验功能：</p><ul><li><code>@Min</code>注解为设置最小值，并设置提示信息</li><li><code>@Max</code>注解为设置最大值，并设置提示信息</li><li>等等还有很多…</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;servers&quot;)</span></span><br><span class="line"><span class="meta">@Validated</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ServerConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Min(value = 1000, message = &quot;最小值不能超过1000&quot;)</span></span><br><span class="line">    <span class="meta">@Max(value = 8888, message = &quot;最大值不能超过8888&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> port;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-5-进制数据转换规则"><a href="#2-5-进制数据转换规则" class="headerlink" title="2.5 进制数据转换规则"></a>2.5 进制数据转换规则</h3><p>配置文件的<code>dataSource</code>中的<code>password</code>设置为<code>012345</code>：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">dataSource:</span></span><br><span class="line">  <span class="attr">driverClassName:</span> <span class="string">com.mysql.jdbc.driver123</span></span><br><span class="line">  <span class="attr">password:</span> <span class="number">012345</span></span><br></pre></td></tr></table></figure><p>测试：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ApplicationTests</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> DruidDataSource dataSource;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testDataSource</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(dataSource.getPassword());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>获取的<code>passord</code>为<code>5347</code>，明显与设置的密码不符</p><p>这是因为0开头的密码被当成八进制进行处理了</p><p>将密码用改用字符串形式，用双引号包裹：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">dataSource:</span></span><br><span class="line">  <span class="attr">driverClassName:</span> <span class="string">com.mysql.jdbc.driver123</span></span><br><span class="line">  <span class="attr">password:</span> <span class="string">&quot;012345&quot;</span></span><br></pre></td></tr></table></figure><p><strong>yaml语法规则</strong></p><p>字面值表达方式：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">boolean:</span> <span class="literal">TRUE</span>                           <span class="comment">#TRUE true True FALSE False false均可</span></span><br><span class="line"><span class="attr">float:</span> <span class="number">3.14</span>                             <span class="comment">#支持科学计数法 6.5201314e+5</span></span><br><span class="line"><span class="attr">int:</span> <span class="number">123</span>                                <span class="comment">#支持二进制 八进制 十六进制</span></span><br><span class="line"><span class="attr">null:</span> <span class="string">~</span>                                 <span class="comment">#使用 ~ 表示null</span></span><br><span class="line"><span class="attr">string1:</span> <span class="string">HelloWord</span>                      <span class="comment">#字符串可以直接书写</span></span><br><span class="line"><span class="attr">string2:</span> <span class="string">&quot;Hello Word&quot;</span>                   <span class="comment">#可以使用双引号包裹特殊字符</span></span><br><span class="line"><span class="attr">data:</span> <span class="number">2022-07-27</span>                        <span class="comment">#日期格式必须使用yyyy-MM-dd格式</span></span><br><span class="line"><span class="attr">datatime:</span> <span class="number">2022-07-27T20:37:30+08:00</span>     <span class="comment">#日期与时间之间使用T连接，最后使用+代表时区</span></span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="3-测试"><a href="#3-测试" class="headerlink" title="3.测试"></a>3.测试</h2><h3 id="3-1-加载测试专用属性"><a href="#3-1-加载测试专用属性" class="headerlink" title="3.1 加载测试专用属性"></a>3.1 加载测试专用属性</h3><p><code>application.yaml</code>配置文件中：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">test:</span></span><br><span class="line">  <span class="attr">prop:</span> <span class="string">testVal</span></span><br></pre></td></tr></table></figure><p>测试，读取prop值：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PropertiesAndArgsTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;test.prop&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String val;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testProperties</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(val);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>运行结果：testVal</p></blockquote><p><strong>第一种方式</strong>：<code>properties</code>属性</p><p>可以使用<code>@SpringBootTest</code>注解中：</p><ul><li><p><code>properties</code>属性可以为当前测试用例添加临时的属性配置</p></li><li><p>并且可以覆盖主配置文件的属性配置</p></li><li><p>优点：比多环境开发中的测试环境影响范围更小，仅对当前测试类有效</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest(properties = &#123;&quot;test.prop=test1&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PropertiesAndArgsTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;test.prop&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String val;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testProperties</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(val);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>运行结果：test1</p></blockquote><p><strong>第二种方式</strong>：<code>args</code>属性</p><p>可以使用<code>@SpringBootTest</code>注解中：</p><ul><li><p><code>args</code>属性可以为当前测试用例添加临时命令行参数</p></li><li><p>并且可以覆盖主配置文件的属性配置</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest(args = &#123;&quot;--test.prop=test2&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PropertiesAndArgsTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;test.prop&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String val;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testProperties</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(val);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>运行结果：test2</p></blockquote><p>第三种方式：同时使用<code>properties</code>属性以及<code>args</code>属性</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest(properties = &#123;&quot;test.prop=test1&quot;&#125;, args = &#123;&quot;--test.prop=test2&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PropertiesAndArgsTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;test.prop&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String val;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testProperties</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(val);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>运行结果：test2</p></blockquote><p>所以，优先级为命令行参数<code>args</code>属性 &gt; <code>properties</code>属性  &gt; <code>application.yaml</code>配置文件</p><h3 id="3-2-加载测试专用配置"><a href="#3-2-加载测试专用配置" class="headerlink" title="3.2 加载测试专用配置"></a>3.2 加载测试专用配置</h3><p>在<code>test</code>包下创建<code>MsgConfig</code>配置类：</p><ul><li>仅服务于测试下的，不能定义在<code>main</code>包下，如果定义到<code>main</code>包下就属于源码级别了</li><li>导入第三方bean太麻烦，简单的定义一个bean</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MsgConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">Msg</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;bean msg&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>使用<code>@Import</code>注解加载当前测试类专用的配置：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="meta">@Import(&#123;MsgConfig.class&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConfigTest</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> String Msg;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testGetMsg</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(Msg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-3-测试类启动Web环境"><a href="#3-3-测试类启动Web环境" class="headerlink" title="3.3 测试类启动Web环境"></a>3.3 测试类启动Web环境</h3><p>导入坐标：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure><p>创建一个<code>UserController</code>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/users&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getById</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;getById is running&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;UserId&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>测试：</p><p><code>webEnvironment</code>属性：</p><ul><li><p><code>SpringBootTest.WebEnvironment.NONE</code>为默认关闭web环境</p></li><li><p><code>SpringBootTest.WebEnvironment.DEFINED_PORT</code>为配置文件中定义的端口</p></li><li><p><code>SpringBootTest.WebEnvironment.RANDOM_PORT</code>为随机端口</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MvcTest</span> &#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testRandomPort</span><span class="params">()</span> &#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>虚拟发送请求：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.DEFINED_PORT)</span></span><br><span class="line"><span class="meta">@AutoConfigureMockMvc</span> <span class="comment">//开启虚拟Mvc的调用</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MvcTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="comment">//注入虚拟Mvc调用对象</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testWeb</span><span class="params">(<span class="meta">@Autowired</span> MockMvc mockMvc)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">//创建虚拟请求，当前访问/books，get请求</span></span><br><span class="line">        <span class="type">MockHttpServletRequestBuilder</span> <span class="variable">builder</span> <span class="operator">=</span> MockMvcRequestBuilders.get(<span class="string">&quot;/users&quot;</span>);</span><br><span class="line">        <span class="comment">//执行请求</span></span><br><span class="line">        mockMvc.perform(builder);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-4-虚拟请求匹配响应"><a href="#3-4-虚拟请求匹配响应" class="headerlink" title="3.4 虚拟请求匹配响应"></a>3.4 虚拟请求匹配响应</h3><p><strong>虚拟请求状态匹配</strong>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.DEFINED_PORT)</span></span><br><span class="line"><span class="meta">@AutoConfigureMockMvc</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MvcTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testStatus</span><span class="params">(<span class="meta">@Autowired</span> MockMvc mockMvc)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">MockHttpServletRequestBuilder</span> <span class="variable">builder</span> <span class="operator">=</span> MockMvcRequestBuilders.get(<span class="string">&quot;/users&quot;</span>);</span><br><span class="line">        <span class="type">ResultActions</span> <span class="variable">actions</span> <span class="operator">=</span> mockMvc.perform(builder);</span><br><span class="line">        <span class="comment">//定义本次调用的预期值</span></span><br><span class="line">        <span class="type">StatusResultMatchers</span> <span class="variable">status</span> <span class="operator">=</span> MockMvcResultMatchers.status();</span><br><span class="line">        <span class="comment">//预计本次调用成功，状态为200</span></span><br><span class="line">        <span class="type">ResultMatcher</span> <span class="variable">ok</span> <span class="operator">=</span> status.isOk();</span><br><span class="line">        <span class="comment">//添加预计值到本次调用中进行比较</span></span><br><span class="line">        actions.andExpect(ok);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>虚拟请求体匹配</strong>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.DEFINED_PORT)</span></span><br><span class="line"><span class="meta">@AutoConfigureMockMvc</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MvcTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testBody</span><span class="params">(<span class="meta">@Autowired</span> MockMvc mockMvc)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">MockHttpServletRequestBuilder</span> <span class="variable">builder</span> <span class="operator">=</span> MockMvcRequestBuilders.get(<span class="string">&quot;/users&quot;</span>);</span><br><span class="line">        <span class="type">ResultActions</span> <span class="variable">actions</span> <span class="operator">=</span> mockMvc.perform(builder);</span><br><span class="line">        <span class="comment">//定义本次调用的预期值</span></span><br><span class="line">        <span class="type">ContentResultMatchers</span> <span class="variable">content</span> <span class="operator">=</span> MockMvcResultMatchers.content();</span><br><span class="line">        <span class="comment">//预计本次调用成功，响应值为&quot;UserId&quot;</span></span><br><span class="line">        <span class="type">ResultMatcher</span> <span class="variable">result</span> <span class="operator">=</span> content.string(<span class="string">&quot;UserId&quot;</span>);</span><br><span class="line">        <span class="comment">//添加预计值到本次调用中进行比较</span></span><br><span class="line">        actions.andExpect(result);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>虚拟请求体(Json)匹配</strong>：</p><p>导入坐标：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.hutool<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hutool-all<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>5.7.17<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>创建<code>User</code>实体类：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>UserController</code>中：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/users&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">getById</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;getById is running&quot;</span>);</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">        user.setId(<span class="number">1</span>);</span><br><span class="line">        user.setAge(<span class="number">18</span>);</span><br><span class="line">        user.setName(<span class="string">&quot;大黄&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>测试：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.DEFINED_PORT)</span></span><br><span class="line"><span class="meta">@AutoConfigureMockMvc</span> <span class="comment">//开启虚拟Mvc的调用</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MvcTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testJson</span><span class="params">(<span class="meta">@Autowired</span> MockMvc mockMvc)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">MockHttpServletRequestBuilder</span> <span class="variable">builder</span> <span class="operator">=</span> MockMvcRequestBuilders.get(<span class="string">&quot;/users&quot;</span>);</span><br><span class="line">        <span class="type">ResultActions</span> <span class="variable">actions</span> <span class="operator">=</span> mockMvc.perform(builder);</span><br><span class="line">        <span class="comment">//定义本次调用的预期值</span></span><br><span class="line">        <span class="type">ContentResultMatchers</span> <span class="variable">content</span> <span class="operator">=</span> MockMvcResultMatchers.content();</span><br><span class="line">        <span class="comment">//预计本次调用成功，返回的值</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">        user.setId(<span class="number">1</span>);</span><br><span class="line">        user.setAge(<span class="number">18</span>);</span><br><span class="line">        user.setName(<span class="string">&quot;大黄&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">userJson</span> <span class="operator">=</span> JSONUtil.toJsonStr(user); <span class="comment">//转换成Json</span></span><br><span class="line">        <span class="type">ResultMatcher</span> <span class="variable">result</span> <span class="operator">=</span> content.json(userJson);</span><br><span class="line">        <span class="comment">//添加预计值到本次调用中进行比较</span></span><br><span class="line">        actions.andExpect(result);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>虚拟请求头匹配</strong>：</p><p>测试：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.DEFINED_PORT)</span></span><br><span class="line"><span class="meta">@AutoConfigureMockMvc</span> <span class="comment">//开启虚拟Mvc的调用</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MvcTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testContentType</span><span class="params">(<span class="meta">@Autowired</span> MockMvc mockMvc)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">MockHttpServletRequestBuilder</span> <span class="variable">builder</span> <span class="operator">=</span> MockMvcRequestBuilders.get(<span class="string">&quot;/users&quot;</span>);</span><br><span class="line">        <span class="type">ResultActions</span> <span class="variable">actions</span> <span class="operator">=</span> mockMvc.perform(builder);</span><br><span class="line">        <span class="comment">//定义本次调用的预期值</span></span><br><span class="line">        <span class="type">HeaderResultMatchers</span> <span class="variable">header</span> <span class="operator">=</span> MockMvcResultMatchers.header();</span><br><span class="line">        <span class="comment">//预计本次调用成功，返回的值</span></span><br><span class="line">        <span class="type">ResultMatcher</span> <span class="variable">contentType</span> <span class="operator">=</span> header.string(<span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;application/json&quot;</span>);</span><br><span class="line">        <span class="comment">//添加预计值到本次调用中进行比较</span></span><br><span class="line">        actions.andExpect(contentType);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>通常测试，会写到一起：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.DEFINED_PORT)</span></span><br><span class="line"><span class="meta">@AutoConfigureMockMvc</span> <span class="comment">//开启虚拟Mvc的调用</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MvcTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testGetById</span><span class="params">(<span class="meta">@Autowired</span> MockMvc mockMvc)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">MockHttpServletRequestBuilder</span> <span class="variable">builder</span> <span class="operator">=</span> MockMvcRequestBuilders.get(<span class="string">&quot;/users&quot;</span>);</span><br><span class="line">        <span class="type">ResultActions</span> <span class="variable">actions</span> <span class="operator">=</span> mockMvc.perform(builder);</span><br><span class="line"></span><br><span class="line">        <span class="type">StatusResultMatchers</span> <span class="variable">status</span> <span class="operator">=</span> MockMvcResultMatchers.status();</span><br><span class="line">        <span class="type">ResultMatcher</span> <span class="variable">ok</span> <span class="operator">=</span> status.isOk();</span><br><span class="line">        actions.andExpect(ok);</span><br><span class="line"></span><br><span class="line">        <span class="type">HeaderResultMatchers</span> <span class="variable">header</span> <span class="operator">=</span> MockMvcResultMatchers.header();</span><br><span class="line">        <span class="type">ResultMatcher</span> <span class="variable">contentType</span> <span class="operator">=</span> header.string(<span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;application/json&quot;</span>);</span><br><span class="line">        actions.andExpect(contentType);</span><br><span class="line"></span><br><span class="line">        <span class="type">ContentResultMatchers</span> <span class="variable">content</span> <span class="operator">=</span> MockMvcResultMatchers.content();</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">        user.setId(<span class="number">1</span>);</span><br><span class="line">        user.setAge(<span class="number">18</span>);</span><br><span class="line">        user.setName(<span class="string">&quot;大黄&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">userJson</span> <span class="operator">=</span> JSONUtil.toJsonStr(user); <span class="comment">//转换成Json</span></span><br><span class="line">        <span class="type">ResultMatcher</span> <span class="variable">result</span> <span class="operator">=</span> content.json(userJson);</span><br><span class="line">        actions.andExpect(result);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-5-业务层测试事务回滚"><a href="#3-5-业务层测试事务回滚" class="headerlink" title="3.5 业务层测试事务回滚"></a>3.5 业务层测试事务回滚</h3><p>导入坐标：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.11<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>配置文件：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">druid:</span></span><br><span class="line">      <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">      <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/demo?serverTimezone=UTC</span></span><br><span class="line">      <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">      <span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line"></span><br><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line">  <span class="attr">global-config:</span></span><br><span class="line">    <span class="attr">db-config:</span></span><br><span class="line">      <span class="attr">table-prefix:</span> <span class="string">tbl_</span></span><br><span class="line">      <span class="comment">#将id设为自动增长</span></span><br><span class="line">      <span class="attr">id-type:</span> <span class="string">auto</span></span><br><span class="line">  <span class="attr">configuration:</span></span><br><span class="line">    <span class="comment">#开启日志，标准输出：将数据打印到控制台</span></span><br><span class="line">    <span class="attr">log-impl:</span> <span class="string">org.apache.ibatis.logging.stdout.StdOutImpl</span></span><br></pre></td></tr></table></figure><p>Dao层：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BookDao</span> <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;Book&gt;&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Service层：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BookService</span> <span class="keyword">extends</span> <span class="title class_">IService</span>&lt;Book&gt; &#123;</span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">saveBook</span><span class="params">(Book book)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;BookDao, Book&gt; <span class="keyword">implements</span> <span class="title class_">BookService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">saveBook</span><span class="params">(Book book)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> save(book);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>测试：</p><p><code>@Transactional</code>：为测试用例添加事务，SpringBoot会对测试用例对应的事务提交操作进行回滚<br><code>@Rollback</code>：默认为true(可不写此注释)，改为false为提交事务，不回滚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="meta">@Transactional</span> <span class="comment">//开启SpringBoot事务</span></span><br><span class="line"><span class="meta">@Rollback(value = true)</span> <span class="comment">//默认value值为true，开启回滚(可不写)；value值为false，关闭回滚</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DaoTest</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> BookService bookService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testSave</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Book</span> <span class="variable">book</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Book</span>();</span><br><span class="line">        book.setName(<span class="string">&quot;springboot&quot;</span>);</span><br><span class="line">        book.setType(<span class="string">&quot;java&quot;</span>);</span><br><span class="line">        book.setDescription(<span class="string">&quot;这是书&quot;</span>);</span><br><span class="line"></span><br><span class="line">        bookService.saveBook(book);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-6-测试用例设置随机数据"><a href="#3-6-测试用例设置随机数据" class="headerlink" title="3.6 测试用例设置随机数据"></a>3.6 测试用例设置随机数据</h3><p>在配置文件中添加：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">testcase:</span><br><span class="line">  book:</span><br><span class="line">    id: $&#123;random.<span class="type">int</span>&#125;</span><br><span class="line">    name: 用户$&#123;random.value&#125; #可加前缀</span><br><span class="line">    uuid: $&#123;random.uuid&#125;</span><br><span class="line">    time: $&#123;random.<span class="type">long</span>&#125;</span><br></pre></td></tr></table></figure><p>测试：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testBookCase</span><span class="params">(<span class="meta">@Autowired</span> BookCase bookCase)</span> &#123;</span><br><span class="line">    System.out.println(bookCase);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>多次运行：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BookCase(id=-<span class="number">1723189530</span>, name=用户36fc0553fae0662a1398f194a79d702c, uuid=c4f742bf-85b8-<span class="number">4416</span>-<span class="number">836d</span>-ab656e20c050, time=<span class="number">9037975923279012585</span>)</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BookCase(id=<span class="number">1758479696</span>, name=用户4952f34e3caadde83261a58b5c9a439f, uuid=4a5747f7-80ff-<span class="number">4161</span>-<span class="number">8771</span>-8dfdce6c470a, time=-<span class="number">2080170540354815861</span>)</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BookCase(id=<span class="number">1773052492</span>, name=用户88777f3bd07cb35dfe29b18b4873e7ed, uuid=3bd7d980-d5d6-46f2-bbf3-c190cdfe28ec, time=-<span class="number">4024744750514505719</span>)</span><br></pre></td></tr></table></figure><p>测试通常采用随机值进行测试，使用SpringBoot提供的随机数为其赋值：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">testcase:</span></span><br><span class="line">  <span class="attr">book:</span></span><br><span class="line">    <span class="attr">id:</span> <span class="string">$&#123;random.int&#125;</span>        <span class="comment"># 随机整数</span></span><br><span class="line">    <span class="attr">id2:</span> <span class="string">$&#123;random.int(10)&#125;</span>   <span class="comment"># 10以内的整数</span></span><br><span class="line">    <span class="attr">id3:</span> <span class="string">$&#123;random.int(5,10)&#125;</span> <span class="comment"># 5~10之间的整数 </span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">用户$&#123;random.value&#125;</span> <span class="comment"># 随机字符串，MD5字符串，32位  可加前缀</span></span><br><span class="line">    <span class="attr">uuid:</span> <span class="string">$&#123;random.uuid&#125;</span>     <span class="comment"># 随机uuid</span></span><br><span class="line">    <span class="attr">time:</span> <span class="string">$&#123;random.long&#125;</span>     <span class="comment"># 随机整数，long范围</span></span><br></pre></td></tr></table></figure><p>其中，<code>random.int(5,10)</code>的括号<code>()</code>可以是任意字符，如<code>[]</code>、<code>@@</code>、<code>!!</code>等均可</p></div><div class="story post-story"><h2 id="4-数据层解决方案"><a href="#4-数据层解决方案" class="headerlink" title="4.数据层解决方案"></a>4.数据层解决方案</h2><p>现有数据层解决方案技术选型：</p><p><code>Druid + MyBatis-Plus + MySQL</code></p><ul><li>数据源：<code>DruidDataSource</code></li><li>持久化技术：<code>MyBatis / MyBatis-Plus</code></li><li>数据库：<code>MySQL</code></li></ul><h3 id="4-1-内置数据源"><a href="#4-1-内置数据源" class="headerlink" title="4.1 内置数据源"></a>4.1 内置数据源</h3><p>数据源配置格式：</p><ul><li><p>格式一：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">druid:</span></span><br><span class="line">      <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">      <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/demo?serverTimezone=UTC</span></span><br><span class="line">      <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">      <span class="attr">password:</span> <span class="number">123456</span></span><br></pre></td></tr></table></figure></li><li><p>格式二：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line"><span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/demo?serverTimezone=UTC</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br></pre></td></tr></table></figure></li></ul><p>以上两种格式都指定数据源为<code>druid</code>，</p><p>如果未指定数据源呢？</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line"><span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/demo?serverTimezone=UTC</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">123456</span></span><br></pre></td></tr></table></figure><p>运行后，采用的数据源依旧是<code>druid</code></p><p>因为导入<code>druid-spring-boot-starter</code>的坐标，会自动配置数据源：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.11<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>将<code>druid-spring-boot-starter</code>坐标注释或删除，不提供数据源，</p><p><code>SpringBoot</code>会提供3种内嵌的数据源对象供开发者选择：</p><ul><li>HikariCP：默认内置数据源对象</li><li>Tomcat提供DataSource：HikariCP在不可用的情况下，且在Web环境中，将使用Tomcat服务器配置的数据源对象</li><li>Commons DBCP：HikariCP和Tomcat数据源都不可用，将使用dbcp数据源</li></ul><p><code>HikariCP</code>数据源配置：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/demo?serverTimezone=UTC</span></span><br><span class="line">    <span class="attr">hikari:</span></span><br><span class="line">      <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">      <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">      <span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line">      <span class="attr">maximum-pool-size:</span> <span class="number">8</span></span><br></pre></td></tr></table></figure><h3 id="4-2-JdbcTemplate"><a href="#4-2-JdbcTemplate" class="headerlink" title="4.2 JdbcTemplate"></a>4.2 JdbcTemplate</h3><p><code>SpringBoot</code>内置<code>JdbcTemplate</code>持久化解决方案：</p><p>导入坐标：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>此外，<code>MyaBtis-Plus</code>坐标已经包含了上面的坐标</p><p>测试：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JdbcTest</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> JdbcTemplate jdbcTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testQueryForList</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;select * from tbl_book where id = 1&quot;</span>;</span><br><span class="line">        List&lt;Map&lt;String, Object&gt;&gt; books = jdbcTemplate.queryForList(sql);</span><br><span class="line">        System.out.println(<span class="string">&quot;books = &quot;</span> + books);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testQuery</span><span class="params">()</span> &#123;</span><br><span class="line">        RowMapper&lt;Book&gt; rm = <span class="keyword">new</span> <span class="title class_">RowMapper</span>&lt;Book&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> Book <span class="title function_">mapRow</span><span class="params">(ResultSet resultSet, <span class="type">int</span> i)</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">                <span class="type">Book</span> <span class="variable">book</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Book</span>();</span><br><span class="line">                book.setId(resultSet.getInt(<span class="string">&quot;id&quot;</span>));</span><br><span class="line">                book.setName(resultSet.getString(<span class="string">&quot;name&quot;</span>));</span><br><span class="line">                book.setType(resultSet.getString(<span class="string">&quot;type&quot;</span>));</span><br><span class="line">                book.setDescription(resultSet.getString(<span class="string">&quot;description&quot;</span>));</span><br><span class="line">                <span class="keyword">return</span> book;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;select * from tbl_book&quot;</span>;</span><br><span class="line">        List&lt;Book&gt; books = jdbcTemplate.query(sql, rm);</span><br><span class="line">        System.out.println(<span class="string">&quot;books = &quot;</span> + books);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testSave</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;insert into tbl_book values (null, &#x27;sss&#x27;, &#x27;aaa&#x27;, &#x27;bbb&#x27;)&quot;</span>;</span><br><span class="line">        jdbcTemplate.update(sql);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>JdbcTemplate</code>配置：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">jdbc:</span></span><br><span class="line">    <span class="attr">template:</span></span><br><span class="line">      <span class="attr">fetch-size:</span> <span class="number">-1</span>     <span class="comment"># 缓存行数</span></span><br><span class="line">      <span class="attr">query-timeout:</span> <span class="number">-1</span>  <span class="comment"># 查询超时时间</span></span><br><span class="line">      <span class="attr">max-rows:</span> <span class="number">-1</span>       <span class="comment"># 最大行数</span></span><br></pre></td></tr></table></figure><h3 id="4-3-内嵌数据库"><a href="#4-3-内嵌数据库" class="headerlink" title="4.3 内嵌数据库"></a>4.3 内嵌数据库</h3><p>SpringBoot提供了3种内嵌数据库供开发者选择，提高开发测试效率：</p><ul><li>H2</li><li>HSQL</li><li>Derby</li></ul><p>以H2数据库为例：</p><p>导入坐标：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.h2database<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>h2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-jpa<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>同时还需要Web环境，所以还要导入坐标：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>配置文件：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">h2:</span></span><br><span class="line">    <span class="attr">console:</span></span><br><span class="line">      <span class="attr">path:</span> <span class="string">/h2</span></span><br><span class="line">      <span class="attr">enabled:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><p>访问用户名为<code>sa</code>，默认密码为<code>123456</code></p><p>在浏览器请求链接：<code>http://localhost:8080/h2</code></p><img src="https://s2.loli.net/2022/07/31/2VKuU83cz7Dlpod.png" class="lazyload" data-srcset="https://s2.loli.net/2022/07/31/2VKuU83cz7Dlpod.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220731001302916" style="zoom:67%;" /><p>点击连接，第一次连接会报错，需要初始化添加上面的相关配置</p><p>添加H2数据库配置：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">h2:</span></span><br><span class="line">    <span class="attr">console:</span></span><br><span class="line">      <span class="attr">path:</span> <span class="string">/h2</span></span><br><span class="line">      <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:h2:~/test</span></span><br><span class="line">    <span class="attr">hikari:</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">org.h2.Driver</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">sa</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">123456</span></span><br></pre></td></tr></table></figure><p>连接成功后：</p><img src="C:\Users\26919\AppData\Roaming\Typora\typora-user-images\image-20220731124000749.png" class="lazyload" data-srcset="C:\Users\26919\AppData\Roaming\Typora\typora-user-images\image-20220731124000749.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220731124000749" style="zoom: 33%;" /><p>在上方的空白框中执行下面的语句，创建表：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> tbl_book (id <span class="type">int</span>, type <span class="type">varchar</span>, name <span class="type">varchar</span>, description <span class="type">varchar</span>)</span><br></pre></td></tr></table></figure><p>查询语句：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tbl_book</span><br></pre></td></tr></table></figure><p>需要停止<code>SpringBoot</code>项目服务，才可以进行测试</p><p>测试：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JdbcTest</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> JdbcTemplate jdbcTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testQuery</span><span class="params">()</span> &#123; <span class="comment">//查询所有</span></span><br><span class="line">        RowMapper&lt;Book&gt; rm = <span class="keyword">new</span> <span class="title class_">RowMapper</span>&lt;Book&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> Book <span class="title function_">mapRow</span><span class="params">(ResultSet resultSet, <span class="type">int</span> i)</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">                <span class="type">Book</span> <span class="variable">book</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Book</span>();</span><br><span class="line">                book.setId(resultSet.getInt(<span class="string">&quot;id&quot;</span>));</span><br><span class="line">                book.setName(resultSet.getString(<span class="string">&quot;name&quot;</span>));</span><br><span class="line">                book.setType(resultSet.getString(<span class="string">&quot;type&quot;</span>));</span><br><span class="line">                book.setDescription(resultSet.getString(<span class="string">&quot;description&quot;</span>));</span><br><span class="line"></span><br><span class="line">                <span class="keyword">return</span> book;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;select * from tbl_book&quot;</span>;</span><br><span class="line">        List&lt;Book&gt; books = jdbcTemplate.query(sql, rm);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;books = &quot;</span> + books);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testSave</span><span class="params">()</span> &#123; <span class="comment">//插入</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;insert into tbl_book values (2, &#x27;sss&#x27;, &#x27;aaa&#x27;, &#x27;bbb&#x27;)&quot;</span>;</span><br><span class="line">        jdbcTemplate.update(sql);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>改用<code>MyBatis-Plus</code>技术也是可以的，并且无缝衔接，只需导入<code>MyBatis-Plus</code>坐标：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>添加<code>MyBatis-Plus</code>的配置：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line">  <span class="attr">global-config:</span></span><br><span class="line">    <span class="attr">db-config:</span></span><br><span class="line">      <span class="attr">table-prefix:</span> <span class="string">tbl_</span></span><br><span class="line">      <span class="comment">#将id设为自动增长</span></span><br><span class="line">      <span class="attr">id-type:</span> <span class="string">auto</span></span><br><span class="line">  <span class="attr">configuration:</span></span><br><span class="line">    <span class="comment">#开启日志，标准输出：将数据打印到控制台</span></span><br><span class="line">    <span class="attr">log-impl:</span> <span class="string">org.apache.ibatis.logging.stdout.StdOutImpl</span></span><br></pre></td></tr></table></figure><p>测试：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DaoTest</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> BookService bookService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testSelectAll</span><span class="params">()</span> &#123;</span><br><span class="line">        List&lt;Book&gt; list = bookService.list();</span><br><span class="line">        System.out.println(<span class="string">&quot;list = &quot;</span> + list);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>H2数据库控制台仅用于开发阶段，线上项目请务必关闭控制台功能：</p><p>将<code>enabled</code>改为<code>false</code></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">h2:</span></span><br><span class="line">    <span class="attr">console:</span></span><br><span class="line">      <span class="attr">path:</span> <span class="string">/h2</span></span><br><span class="line">      <span class="attr">enabled:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="5-整合第三方技术"><a href="#5-整合第三方技术" class="headerlink" title="5.整合第三方技术"></a>5.整合第三方技术</h2><h2 id="6-监控"><a href="#6-监控" class="headerlink" title="6.监控"></a>6.监控</h2></div>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> 框架 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Redis的学习笔记</title>
      <link href="/2022/08/06/Java/Redis/"/>
      <url>/2022/08/06/Java/Redis/</url>
      
        <content type="html"><![CDATA[<h1 id="基础篇"><a href="#基础篇" class="headerlink" title="基础篇"></a>基础篇</h1><div class="story post-story"><h2 id="1-初识Redis"><a href="#1-初识Redis" class="headerlink" title="1.初识Redis"></a>1.初识Redis</h2><h3 id="1-1-认识NoSql"><a href="#1-1-认识NoSql" class="headerlink" title="1.1 认识NoSql"></a>1.1 认识NoSql</h3><p>键值数据库是一种NoSql数据库</p><table><thead><tr><th align="center">key</th><th>value</th></tr></thead><tbody><tr><td align="center">1001</td><td>{<br>   “id”:1001,<br>   “name”:”张三”,<br>   “age”:20,<br>}</td></tr></tbody></table><p>SQL：关系型数据库</p><p>NoSQL：非关系型数据库</p><p>SQL与NoSQl的比较：</p><table><thead><tr><th align="center"></th><th>SQL</th><th>NoSQL</th></tr></thead><tbody><tr><td align="center">数据结构</td><td>结构化</td><td>非结构化：<br>1.键值类型(Redis)<br>2.文档类型(MongoDB)<br>3.列类型(HBase)<br>4.Graph类型(Neo4j)</td></tr><tr><td align="center">数据关联</td><td>关联的(数据有关联)</td><td>无关联的</td></tr><tr><td align="center">查询方式</td><td>SQL查询(SQL语法通用)</td><td>非SQL(语法不统一)</td></tr><tr><td align="center">事务特性</td><td>ACID</td><td>BASE</td></tr><tr><td align="center">存储方式</td><td>磁盘</td><td>内存</td></tr><tr><td align="center">扩展性</td><td>垂直</td><td>水平</td></tr><tr><td align="center">使用场景</td><td>1.数据结构固定<br>2.相关业务数据安全性、<br>一致性要求较高</td><td>1.数据结构不固定<br>2.相关业务数据安全性、一致性要求不高<br>3.对性能要求</td></tr></tbody></table><h3 id="1-2-认识Redis"><a href="#1-2-认识Redis" class="headerlink" title="1.2 认识Redis"></a>1.2 认识Redis</h3><p>Redis诞生于2009年全称时Remote Dictionary Server，远程词典服务器，是一个基于内存的键值型NoSQL数据库。</p><p>特征：</p><ul><li><p>键值(key-value)型：value支持多种不同数据结构，功能丰富</p></li><li><p>单线程：每个命令具备原子性</p></li><li><p>低延迟、速度快：基于内存、IO多路复用、良好的编码(C语言开发)</p></li><li><p>支持数据持久化</p></li><li><p>支持主从集群、分片集群</p></li><li><p>支持多语言客户端</p></li></ul><h3 id="1-3-Redis的安装及其配置-不要看这个教程安装，有问题我还要改"><a href="#1-3-Redis的安装及其配置-不要看这个教程安装，有问题我还要改" class="headerlink" title="1.3 Redis的安装及其配置(不要看这个教程安装，有问题我还要改)"></a>1.3 Redis的安装及其配置(<span style="color:red">不要看这个教程安装，有问题我还要改</span>)</h3><p>​大多企业都是基于Linux服务器来部署项目，而且Redis官方也没有提供Windows版本的安装包。因此会使用基于Linux系统来安装Redis。</p><p>Redis官网：<a href="https://redis.io/">Redis</a></p><p>Linux版本为：CentOS7</p><p>注意：下面的安装Redis方法不适用于<strong>Ubuntu</strong></p><p>打开命令行，依次输入一下内容：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">转换成root权限</span></span><br><span class="line">su - </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">输入密码</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">安装gcc依赖</span></span><br><span class="line">yum install -y gcc tcl</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">进入到src目录</span></span><br><span class="line">cd /usr/local/src</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">下载redis-6.2.6.tar.gz</span></span><br><span class="line">wget https://download.redis.io/releases/redis-6.2.6.tar.gz</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">解压redis-6.2.6.tar.gz</span></span><br><span class="line">tar -zxvf redis-6.2.6.tar.gz</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">进入redis-6.2.6</span></span><br><span class="line">cd redis-6.2.6</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">运行编译命令</span></span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure><p>默认安装路径为<code>/usr/local/bin</code>目录下：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ll /usr/local/bin</span><br></pre></td></tr></table></figure><p><img src="C:\Users\26919\AppData\Roaming\Typora\typora-user-images\image-20220707211843362.png" class="lazyload" data-srcset="C:\Users\26919\AppData\Roaming\Typora\typora-user-images\image-20220707211843362.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220707211843362"></p><p>看到这个样子安装基本成功了</p><p>Redis的配置文件：</p><p>重新打开命令行：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">su -</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">输入密码</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">进入到redis-6.2.6目录</span></span><br><span class="line">cd /usr/local/src/redis-6.2.6</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">备份redis.conf</span></span><br><span class="line">cp redis.conf redis.conf.bck</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">打开redis.conf配置文件</span></span><br><span class="line">vi redis.conf</span><br></pre></td></tr></table></figure><p>修改redis.conf文件的一些配置：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#bind 127.0.0.1 -::会导致只能在本地访问，修改为0.0.0.0就可以在任意ip访问，生产环境不要设置为0.0.0.0</span><br><span class="line">bind 0.0.0.0</span><br><span class="line">#守护进程，修改为yes即可后台运行</span><br><span class="line">daemonize yes</span><br><span class="line">#设置密码为123456</span><br><span class="line">requirepass 123456</span><br></pre></td></tr></table></figure><p>查找：<code>/</code>+所要查找的字符串；按<code>n</code>向下查找，按<code>N</code>向上查找</p><p>输入<code>i</code>即可修改数据，修改完成后按<code>ESC</code>退出编辑</p><p><code>:wq</code>为保存并退出</p><p>退出后：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">redis-server redis.conf</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">查看redis进程</span></span><br><span class="line">ps -ef|grep redis </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">杀死进程</span></span><br><span class="line">kill -9 端口号</span><br></pre></td></tr></table></figure><p>接着设置开机自启：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">新建一个系统服务文件</span></span><br><span class="line">vi /etc/systemd/system/redis.service</span><br></pre></td></tr></table></figure><p>将下面内容全部复制到redis.service文件中：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=redis-server</span><br><span class="line">After=network.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=forking</span><br><span class="line">ExecStart=/usr/local/bin/redis-server /usr/local/src/redis-6.2.6/redis.conf</span><br><span class="line">PrivateTmp=true</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure><p>保存退出后，</p><p>接着:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">重载系统服务</span></span><br><span class="line">systemctl daemon-reload</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">启动redis</span></span><br><span class="line">systemctl start redis</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">查看redis状态</span></span><br><span class="line">systemctl status redis</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">停止redis</span></span><br><span class="line">systemctl stop redis</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">redis开机自启</span></span><br><span class="line">systemctl enable redis</span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="2-Redis命令"><a href="#2-Redis命令" class="headerlink" title="2.Redis命令"></a>2.Redis命令</h2><h3 id="2-1-Redis数据结构介绍"><a href="#2-1-Redis数据结构介绍" class="headerlink" title="2.1 Redis数据结构介绍"></a>2.1 Redis数据结构介绍</h3><p>Redis是一个key-value的数据库，key一般是String类型，不过value的类型多种多样：</p><table><thead><tr><th align="center">数据类型</th><th>格式</th></tr></thead><tbody><tr><td align="center"><span style="color:red">String</span></td><td>hello Redis</td></tr><tr><td align="center"><span style="color:red">Hash</span></td><td>{name: “jack”, age: 21}</td></tr><tr><td align="center"><span style="color:red">List</span></td><td>[A -&gt; B -&gt; C -&gt; D]</td></tr><tr><td align="center"><span style="color:red">Set</span></td><td>{A, B, C}</td></tr><tr><td align="center"><span style="color:red">SortSet</span></td><td>{A: 1, B: 2, C: 3}</td></tr><tr><td align="center"><span style="color:red">GEO</span>(地理坐标)</td><td>{A: (120.3, 30.5)}</td></tr><tr><td align="center"><span style="color:red">BitMap</span></td><td>0101001001100101011001000110100101110011</td></tr><tr><td align="center"><span style="color:red">HyperLog</span></td><td>0101001001100101011001000110100101110011</td></tr></tbody></table><p>基本类型：String、Hash、List、Set、SortSet</p><p>特殊类型：GEO、BitMap、HyperLog</p><h3 id="2-2-Redis通用命令"><a href="#2-2-Redis通用命令" class="headerlink" title="2.2 Redis通用命令"></a>2.2 Redis通用命令</h3><table><thead><tr><th>命令</th><th>解释</th><th>举例</th></tr></thead><tbody><tr><td>KEYS</td><td>查看符合模板的所有key，<br>不建议在生产环境设备上使用(效率低)</td><td><code>KEYS *</code>：查看所有key<br><code>KEYS n*</code>：查看所有n开头的key</td></tr><tr><td>DEL</td><td>删除一个指定key</td><td><code>DEL name</code>：删除name</td></tr><tr><td>EXISTS</td><td>判断key是否存在</td><td><code>EXISTS name</code>：存在返回1，否则返回0</td></tr><tr><td>EXPIRE</td><td>给一个key设置有效期，<br>有效期到期key会被自动删除</td><td><code>EXPIRE name 20</code>：设置name的有效期为20秒</td></tr><tr><td>TTL</td><td>查看一个key的剩余有效期</td><td><code>TTL name</code>：查看name的有效期，<br>如果返回-2，则说明到期了<br>如果返回-1，则说明永久有效</td></tr></tbody></table><h3 id="2-3-String类型"><a href="#2-3-String类型" class="headerlink" title="2.3 String类型"></a>2.3 String类型</h3><p>String类型、也就是字符串类型，是Redis中最简单的存储类型</p><p>其value是字符串，不过根据字符串的格式不同，又可以分类为3类：</p><ul><li><p>string：普通字符串</p></li><li><p>int：整数类型，可以做自增、自减操作</p></li><li><p>float：浮点类型，可以做自增、自减操作</p></li></ul><p>不管是哪种格式，底层都是字节数组形式存储，字符串类型的最大空间不能超过512m</p><table><thead><tr><th align="center">Key</th><th align="center">Value</th></tr></thead><tbody><tr><td align="center">msg</td><td align="center">hello Redis</td></tr><tr><td align="center">num</td><td align="center">10</td></tr><tr><td align="center">score</td><td align="center">98.5</td></tr></tbody></table><p>String类型常见命令：</p><table><thead><tr><th align="center">命令</th><th></th><th></th></tr></thead><tbody><tr><td align="center">SET key value</td><td>添加或修改已经存在的一个String类型的键值对</td><td><code>SET name Jerry</code>：把name的value设置为Jerry</td></tr><tr><td align="center">GET key</td><td>根据key获取String类型的value</td><td><code>GET name</code>：获取到value为”Jerry”</td></tr><tr><td align="center">MSET</td><td>批量添加多个String类型的键值对</td><td><code>MSET score 12.5 age 18</code>：添加多个键值对</td></tr><tr><td align="center">MGET</td><td>根据多个key获取多个String类型的value</td><td><code>MGET name score age</code>：得到多个value为”Jreey” “12.5” “18”</td></tr><tr><td align="center">INCR</td><td>让一个整型的key自增1</td><td><code>INCR age</code>：age的value加1，由18变为19</td></tr><tr><td align="center">INCRBY</td><td>让一个整型的key自增并指定步长</td><td><code>INCRBY age 2</code>：age的value加2，由19变为21</td></tr><tr><td align="center">INCRBYFLOAT</td><td>让一个浮点类型的数字自增并指定步长</td><td><code>INCRBYFLOAT score 0.5</code>：score的value加0.5，由12.5变为13.0</td></tr><tr><td align="center">SETNX</td><td>添加一个String类型的键值对，<br>前提是这个<span style="color:red">key</span>不存在，否则不执行(新增效果)</td><td><code>SETNX name Tom</code>：不执行，返回0<br><code>SETNX k1 v1</code>：执行，返回1</td></tr><tr><td align="center">SETEX</td><td>添加一个String类型的键值对，并且指定有效期</td><td><code>SETEX name 10 jerry </code>：添加键值对，并将有效期设置为10秒</td></tr></tbody></table><h3 id="2-4-Key的层级格式"><a href="#2-4-Key的层级格式" class="headerlink" title="2.4 Key的层级格式"></a>2.4 Key的层级格式</h3><p>Redis没有类似于MySQL中的<code>Table</code>表的概念</p><p>Redis的Key允许有多个单词形成层级结构，多个单词之间用<code>:</code>隔开，格式(不固定)如下：</p><p><code>项目名:业务名:类型:id</code></p><p>例如项目名叫<code>demo</code>，有<code>user</code>和<code>book</code>两种不同类型的数据，我们可以这样定义Key：</p><ul><li><p>user相关的Key：<code>demo:user:1</code></p></li><li><p>book相关的Key：<code>demo:book:1</code></p></li></ul><p>如果Value是一个java对象，例如一个User对象，则可以将对象序列化为json字符串后存储：</p><table><thead><tr><th align="center">Key</th><th align="center">Value</th></tr></thead><tbody><tr><td align="center"><code>demo:user:1</code></td><td align="center">{“id”: 1, “name”: “Jerry”, “age”: 18}</td></tr><tr><td align="center"><code>demo:book:1</code></td><td align="center">{“id”: 1, “name”: “BOOK”, “price”: 15}</td></tr></tbody></table><p>插入操作(注意：Value值要加<code>&#39;&#39;</code>)：</p><ul><li><p><code>set demo:user:1 &#39;&#123;&quot;id&quot;: 1, &quot;name&quot;: &quot;Jerry&quot;, &quot;age&quot;: 18&#125;&#39;</code></p></li><li><p><code>set demo:book:1 &#39;&#123;&quot;id&quot;: 1, &quot;name&quot;: &quot;BOOK&quot;, &quot;price&quot;: 15&#125;&#39;</code></p></li></ul><p>打开图形界面客户端查看：</p><p><img src="https://s2.loli.net/2022/07/08/vckFyG2VYdjzhOS.png" class="lazyload" data-srcset="https://s2.loli.net/2022/07/08/vckFyG2VYdjzhOS.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220708185626850"></p><h3 id="2-5-Hash类型"><a href="#2-5-Hash类型" class="headerlink" title="2.5 Hash类型"></a>2.5 Hash类型</h3><p>Hash类型，也叫散列，其value是一个无序字典，类似于java中的HashMap结构</p><p>String结构是将对象序列化为json字符串后存储，当需要修改对象某个字段时很不方便(需要修改整个字符串)：</p><table><thead><tr><th align="center">Key</th><th align="center">Value</th></tr></thead><tbody><tr><td align="center"><code>demo:user:1</code></td><td align="center">{“id”: 1, “name”: “Jerry”, “age”: 18}</td></tr><tr><td align="center"><code>demo:user:2</code></td><td align="center">{“id”: 2, “name”: “Tom”, “price”: 20}</td></tr></tbody></table><p>而Hash结构可以将对象中每个字段独立存储，可以针对单个字段做CRUD：</p><table>    <tr align="center">                 <th rowspan="2">Key</th>                 <th colspan="2">Value</th>    </tr>    <tr align="center">                         <td>field</td>        <td>value</td>    </tr>    <tr align="center">                 <td rowspan="2">demo:user:1</td>                 <td>name</td>        <td>Jerry</td>    </tr>    <tr align="center">                         <td>age</td>        <td>18</td>    </tr>    <tr align="center">                 <td rowspan="2">demo:user:2</td>                 <td>name</td>        <td>Tom</td>    </tr>    <tr align="center">                         <td>age</td>        <td>20</td>    </tr></table><p>Hash类型常见命令：</p><table><thead><tr><th align="center">命令</th><th></th><th></th></tr></thead><tbody><tr><td align="center">HSET key field value</td><td>添加或修改hash类型key的field的值</td><td><code>HSET demo:user:2 name LiHua</code>：把name的value设置为Lihua</td></tr><tr><td align="center">HGET key field</td><td>获取一个hash类型key的field的值</td><td><code>HGET demo:user:2 name</code>：获取到value为”LiHua”</td></tr><tr><td align="center">HMSET</td><td>批量添加多个hash类型key的field的值</td><td><code>HMSET demo:user:3 name LiLei age 22</code>：添加多个field的值</td></tr><tr><td align="center">HMGET</td><td>批量获取根据多个hash类型key的field的值</td><td><code>HMGET demo:user:3 name age</code>：得到多个field的值为”LiLei” “22”</td></tr><tr><td align="center">HGETALL</td><td>获取一个hash类型的key中的所有的field和value</td><td><code>HGETALL demo:user:3</code>：获取到key中所有的field和value</td></tr><tr><td align="center">HKEYS</td><td>获取一个hash类型的key中的所有的field</td><td><code>HKEYS demo:user:3</code>：获取key中所有的field</td></tr><tr><td align="center">HVALS</td><td>获取一个hash类型的key中的所有的value</td><td><code>HVALS demo:user:3</code>：获取key中所有的value</td></tr><tr><td align="center">HINCRBY</td><td>让一个hash类型的key的字段自增并指定步长</td><td><code>HINCRBY demo:user:3 age 2</code>：age的value加2，由22变为24</td></tr><tr><td align="center">HSETNX</td><td>添加一个hash类型的key的field值，<br>前提是这个<span style="color:red">field</span>不存在，否则不执行(新增效果)</td><td><code>HSETNX demo:user:3 name XXX</code>：存在field值不执行，返回0<br><code>HSETNX demo:user:3 sex man</code>：不存在field值执行，返回1</td></tr></tbody></table><h3 id="2-6-List类型"><a href="#2-6-List类型" class="headerlink" title="2.6 List类型"></a>2.6 List类型</h3><p>Redis中的List类型与java中的LinkList类似，可以看作是一个双向链表结构，既可以支持正向检索也可以支持反向检索。</p><p>特征与LinkList也类似：</p><ul><li><p>有序</p></li><li><p>元素可以重复</p></li><li><p>插入和删除快</p></li><li><p>查询速度一般</p></li></ul><p>常用来存储一个有序数据，如：评论列表、点赞列表等</p><p>List类型的常见命令：</p><table><thead><tr><th></th><th></th><th></th></tr></thead><tbody><tr><td>LPUSH key element</td><td>向列表左侧插入一个或多个元素</td><td><code>LPUSH user 1 2 3</code>：<br>表中从第一位依次为 “3” “2” “1”</td></tr><tr><td>LPOP key</td><td>移除并返回列表左侧的第一个元素，没有则返回nil</td><td>LPOP user 1</td></tr><tr><td>RPUSH key element</td><td>向列表右侧插入一个或多个元素</td><td><code>RPUSH user 4 5 6</code>：<br/>表中从第一位依次为 “4” “5” “6”</td></tr><tr><td>RPOP key</td><td>移除并返回列表右侧的第一个元素</td><td></td></tr><tr><td>LRANGE key star end</td><td>返回一段角标范围内的所有元素</td><td><code>LRANGE 1 star 2</code>：从0开始，<br>获取到1~2之间的元素</td></tr><tr><td>BLPOP</td><td>与LPOP类似，<br>只不过在没有元素时等待指定时间，<br>而不是直接返回nil</td><td><code>BLPOP user2 1 100</code>：<br>移除并返回到左侧的第一个元素，<br>没有则等待100秒，超时返回nil</td></tr><tr><td>BRPOP</td><td>与RPOP类似，<br/>只不过在没有元素时等待指定时间，<br/>而不是直接返回nil</td><td></td></tr></tbody></table><p>List结构模拟一个栈</p><ul><li><p>入口和出口在同一边</p></li><li><p>如：<code>LPUSH</code>和<code>LPOP</code>或者 <code>RPUSH</code>和<code>RPOP</code></p></li></ul><p>List结构模拟一个队列</p><ul><li><p>入口和出口不在同一边</p></li><li><p>如：<code>LPUSH</code>和<code>RPOP</code>  或者 <code>RPUSH</code>和<code>LPOP</code></p></li></ul><p>List结构模拟一个阻塞队列</p><ul><li>入口和出口不在同一边</li><li>出队采用<code>BLPOP</code>或者<code>BRPOP</code></li><li>如：<code>LPUSH</code>和<code>BRPOP</code>  或者 <code>RPUSH</code>和<code>BLPOP</code></li></ul><h3 id="2-7-Set类型"><a href="#2-7-Set类型" class="headerlink" title="2.7 Set类型"></a>2.7 Set类型</h3><p>Redis的Set结构与Java中的Hashset类似，可以看做是一个value为null的HashMap。因为也是一个hash表，因此具备与Hashset类似的特征：</p><ul><li>无序</li><li>元素不可重复</li><li>查找快</li><li>支持交集、并集、差集等功能</li></ul><p>Set类型的常见命令：</p><table><thead><tr><th></th><th></th><th></th></tr></thead><tbody><tr><td>SADD key member</td><td>向set中添加一个或多个元素</td><td><code>SADD s1 a b c</code></td></tr><tr><td>SREM key member</td><td>移除set中的指定元素</td><td><code>SREM s1 a</code></td></tr><tr><td>SCARD key</td><td>返回set中元素的个数</td><td><code>SCARD s1</code></td></tr><tr><td>SISMEMBER key member</td><td>判断一个元素是否存在于set中</td><td><code>SISMEMBER s1 a</code></td></tr><tr><td>SMEMBERS</td><td>获取set中的所有元素</td><td><code>SMEMBERS</code></td></tr><tr><td>SINTER key1 key2</td><td>求key1与key2的<span style="color:red">交集</span></td><td></td></tr><tr><td>SDIFF key1 key2</td><td>求key1与key2的<span style="color:red">差集</span></td><td></td></tr><tr><td>SUNION key1 key2</td><td>求key1与key2的<span style="color:red">并集</span></td><td></td></tr></tbody></table><h3 id="2-8-SortedSet类型"><a href="#2-8-SortedSet类型" class="headerlink" title="2.8 SortedSet类型"></a>2.8 SortedSet类型</h3><p>Redis的SortedSet是一个可排序的set集合，与java中的TreeSet有些类似，但底层数据结构却差别很大Sortedset中的每一个元素都带有一个score属性，可以基于score属性对元素排序，底层的实现是一个跳表(SkipList)加hash表。<br>SortedSet具备下列特性：</p><ul><li><p>可排序</p></li><li><p>元素不重复</p></li><li><p>查询速度快</p></li></ul><p>因为Sortedset的可排序特性，经常被用来实现排行榜这样的功能。</p><p>SortedSet类型的常见命令：</p><table><thead><tr><th></th><th></th><th></th></tr></thead><tbody><tr><td>ZADD key score member</td><td>添加一个或多个元素到sorted set，<br>如果已经存在则更新其score值</td><td><code>ZADD SSet 85 Tom 98 Jerry 77 Rose 78 Jack</code>：<br>向SSet中添加元素，并按照升序排列</td></tr><tr><td>ZREM key member</td><td>删除sorted set中的一个指定元素</td><td><code>ZREM SSet Tom</code>：删除Tom</td></tr><tr><td>ZSCORE key member</td><td>获取sorted set中的指定元素的score值</td><td></td></tr><tr><td>ZRANK key member</td><td>获取sorted set 中的指定元素升序的排名</td><td><code>ZRANK SSet Rose</code>：<br>按照升序的序列，从0开始，<br>返回Rose的排名</td></tr><tr><td>Z<span style="color:red">REV</span>RANK key member</td><td>获取sorted set 中的指定元素降序的排名</td><td><code>ZRANK SSet Rose</code>：<br>按照降序的序列，从0开始，<br>返回Rose的排名</td></tr><tr><td>ZCARD key</td><td>获取sorted set中的元素个数</td><td></td></tr><tr><td>ZCOUNT key min max</td><td>统计score值在给定范国内的所有元素的个数</td><td></td></tr><tr><td>ZINCRBY key increment member</td><td>让sorted set中的指定元素自增，<br>步长为指定的increment值</td><td></td></tr><tr><td>ZRANGE key min max</td><td>按照score升序排序后，获取指定排名范围内的元素</td><td><code>ZCOUNT SSet 0 2</code>：按照升序的情况，<br/>获取0~2范围的元素</td></tr><tr><td>Z<span style="color:red">REV</span>RANGE key min max</td><td>按照score的降序排序后，获取指定排名范围内的元素</td><td><code>ZCOUNT SSet 0 2</code>：按照降序的情况，<br>获取0~2范围的元素</td></tr><tr><td>ZRANGEBYSCORE key min  max</td><td>按照score排序后，获取指定score范国内的元素</td><td><code>ZRANGEBYSCORE SSet 0 80</code>：<br>返回0~80分数的元素</td></tr><tr><td>ZDIFF、ZINTER、ZUNION</td><td>求差集、交集、并集</td><td></td></tr></tbody></table><p>注意：所有排名默认都是升序，如果降序则在命令的Z后面添加<span style="color:red">REV</span>即可</p><p>例如：Z<span style="color:red">REV</span>RANK</p></div><div class="story post-story"><h2 id="3-Redis的java客户端"><a href="#3-Redis的java客户端" class="headerlink" title="3.Redis的java客户端"></a>3.Redis的java客户端</h2><p><a href="https://redis.io/docs/clients/">Redis官网</a>中提供了各种语言的客户端</p><p>Java：</p><blockquote><p><code>Jedis</code>：以Redis命令作为方法名称，学习成本低，简单实用但是Jedis实例是线程不安全的，多线程环境下需要基于连接池来使用</p><p><code>Lettuce</code>：基于Netty实现的，支持同步、异步和响应式编程方式，并且是线程安全的。支持Redis的哨兵模式、集群模式和管道模式</p><p><code>Redisson</code>：是一个基于Redis实现的分布式、可伸缩的Java数据结构集合。包含了诸如Map、Queue、LockSemaphore、Atomiclong等强大功能</p><p>其中Spring整合了<code>Jedis</code>和<code>Lettuce</code>，只需导入坐标<code>Spring Data Redis</code></p></blockquote><h3 id="3-1-Jedis快速入门"><a href="#3-1-Jedis快速入门" class="headerlink" title="3.1 Jedis快速入门"></a>3.1 Jedis快速入门</h3><p>Jedis：<a href="https://github.com/redis/jedis">Jedis官网</a></p><p>引入jedis依赖：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>redis.clients<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jedis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>3.7.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>完整依赖：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- jedis依赖 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>redis.clients<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jedis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.7.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 测试依赖 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.junit.jupiter<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit-jupiter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.7.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span>       </span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><p>以下在<code>Test</code>中进行：</p><ol><li>建立连接</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@BeforeEach</span> <span class="comment">//在测试方法执行之前执行的方法</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">setUp</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//建立连接</span></span><br><span class="line">        jedis = <span class="keyword">new</span> <span class="title class_">Jedis</span>(<span class="string">&quot;127.0.0.1&quot;</span>,<span class="number">6379</span>);</span><br><span class="line">        <span class="comment">//设置密码</span></span><br><span class="line">        jedis.auth(<span class="string">&quot;123456&quot;</span>);</span><br><span class="line">        <span class="comment">//选择库</span></span><br><span class="line">        jedis.select(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>测试String类型</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testString</span><span class="params">()</span> &#123;</span><br><span class="line">    jedis.set(<span class="string">&quot;name&quot;</span>,<span class="string">&quot;Tom&quot;</span>);</span><br><span class="line">    System.out.println(jedis.get(<span class="string">&quot;name&quot;</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="3"><li>释放资源</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@AfterEach</span> <span class="comment">//在测试方法执行之后执行的方法</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">tearDown</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (jedis != <span class="literal">null</span>)&#123;</span><br><span class="line">        jedis.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>完整测试：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JedisTest</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Jedis jedis;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@BeforeEach</span> <span class="comment">//在测试方法执行之前执行的方法</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">setUp</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//建立连接</span></span><br><span class="line">        jedis = <span class="keyword">new</span> <span class="title class_">Jedis</span>(<span class="string">&quot;127.0.0.1&quot;</span>,<span class="number">6379</span>);</span><br><span class="line">        <span class="comment">//设置密码</span></span><br><span class="line">        jedis.auth(<span class="string">&quot;123456&quot;</span>);</span><br><span class="line">        <span class="comment">//选择库</span></span><br><span class="line">        jedis.select(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testString</span><span class="params">()</span> &#123;</span><br><span class="line">        jedis.set(<span class="string">&quot;name&quot;</span>,<span class="string">&quot;Tom&quot;</span>);</span><br><span class="line">        System.out.println(jedis.get(<span class="string">&quot;name&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testHash</span><span class="params">()</span> &#123;</span><br><span class="line">        jedis.hset(<span class="string">&quot;demo:user:2&quot;</span>,<span class="string">&quot;name&quot;</span>,<span class="string">&quot;Jerry&quot;</span>);</span><br><span class="line">        jedis.hset(<span class="string">&quot;demo:user:2&quot;</span>,<span class="string">&quot;age&quot;</span>,<span class="string">&quot;18&quot;</span>);</span><br><span class="line">        Map&lt;String, String&gt; map = jedis.hgetAll(<span class="string">&quot;demo:user:2&quot;</span>);</span><br><span class="line">        System.out.println(map);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@AfterEach</span> <span class="comment">//在测试方法执行之后执行的方法</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">tearDown</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (jedis != <span class="literal">null</span>)&#123;</span><br><span class="line">            jedis.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>jedis使用的基本步骤：</p><blockquote><ol><li><p>引入依赖</p></li><li><p>创建jedis对象，建立连接</p></li><li><p>使用jedis的方法名与Redis命令一致</p></li><li><p>释放资源</p></li></ol></blockquote><h3 id="3-2-Jedis的连接池"><a href="#3-2-Jedis的连接池" class="headerlink" title="3.2 Jedis的连接池"></a>3.2 Jedis的连接池</h3><p>Jedis本身线程是不安全的，并且频繁的创建和销毁连接会有性能损耗，因此推荐使用Jedis连接池替代Jedis的直连方法</p><p>创建<code>JedisConnectionFactory</code>工具类：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JedisConnectionFactory</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> JedisPool jedisPool;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="comment">//配置连接池</span></span><br><span class="line">        <span class="type">JedisPoolConfig</span> <span class="variable">jedisPoolConfig</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JedisPoolConfig</span>();</span><br><span class="line">        <span class="comment">//最大连接数</span></span><br><span class="line">        jedisPoolConfig.setMaxTotal(<span class="number">8</span>);</span><br><span class="line">        <span class="comment">//最大空闲连接</span></span><br><span class="line">        jedisPoolConfig.setMaxIdle(<span class="number">8</span>);</span><br><span class="line">        <span class="comment">//最小空闲连接</span></span><br><span class="line">        jedisPoolConfig.setMinIdle(<span class="number">0</span>);</span><br><span class="line">        <span class="comment">//等待时长</span></span><br><span class="line">        jedisPoolConfig.setMaxWaitMillis(<span class="number">1000</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//创建连接池对象</span></span><br><span class="line">        jedisPool = <span class="keyword">new</span> <span class="title class_">JedisPool</span>(jedisPoolConfig, </span><br><span class="line">                <span class="string">&quot;127.0.0.1&quot;</span>,</span><br><span class="line">                <span class="number">6379</span>, </span><br><span class="line">                <span class="number">1000</span>,</span><br><span class="line">                <span class="string">&quot;123456&quot;</span>);</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Jedis <span class="title function_">getJedis</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> jedisPool.getResource();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>测试类中：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JedisTest</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Jedis jedis;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@BeforeEach</span> <span class="comment">//在测试方法执行之前执行的方法</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">setUp</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//建立连接</span></span><br><span class="line">        jedis = JedisConnectionFactory.getJedis();</span><br><span class="line">        <span class="comment">//选择库</span></span><br><span class="line">        jedis.select(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testHash</span><span class="params">()</span> &#123;</span><br><span class="line">        jedis.hset(<span class="string">&quot;demo:user:2&quot;</span>,<span class="string">&quot;name&quot;</span>,<span class="string">&quot;Jerry&quot;</span>);</span><br><span class="line">        jedis.hset(<span class="string">&quot;demo:user:2&quot;</span>,<span class="string">&quot;age&quot;</span>,<span class="string">&quot;18&quot;</span>);</span><br><span class="line">        Map&lt;String, String&gt; map = jedis.hgetAll(<span class="string">&quot;demo:user:2&quot;</span>);</span><br><span class="line">        System.out.println(map);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@AfterEach</span> <span class="comment">//在测试方法执行之后执行的方法</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">tearDown</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (jedis != <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="comment">//close方法当检测到是连接池时，并不是真正的关闭连接，而是将对象归还给连接池</span></span><br><span class="line">            jedis.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-3-初识SpringDataRedis"><a href="#3-3-初识SpringDataRedis" class="headerlink" title="3.3 初识SpringDataRedis"></a>3.3 初识SpringDataRedis</h3><p>SpringData是Spring中数据操作的模块，包含对各种数据库的集成，其中对Redis的集成模块就叫做<a href="https://spring.io/projects/spring-data-redis">SpringDataRedis</a></p><blockquote><ul><li>提供了对不同Redis客户端的整合 （Lettuce和Jedis）</li><li>提供了RedisTemplate统一API来操作Redis</li><li>支持Redis的发布订阅模型</li><li>支持Redis哨兵和Redis集群</li><li>支持基于Lettuce的响应式编程</li><li>支持基于JDK、JSON、字符串、Spring对象的数据序列化及反序列化</li><li>支持基于Redis的JDKCollection实现</li></ul></blockquote><p>SpringDataRedis中提供了RedisTemplate工具类，其中封装了各种对Redis的操作。并且将不同数据类型的操作API封装到了不同的类型中：</p><table><thead><tr><th align="center">API</th><th align="center">返回值类型</th><th align="center">解释</th></tr></thead><tbody><tr><td align="center"><span style="color:red">redisTemplate</span>.opsForValue()</td><td align="center">ValueOperations</td><td align="center">操作String类型数据</td></tr><tr><td align="center"><span style="color:red">redisTemplate</span>.opsForHash()</td><td align="center">HashOperations</td><td align="center">操作Hash类型数据</td></tr><tr><td align="center"><span style="color:red">redisTemplate</span>.opsForList()</td><td align="center">ListOperations</td><td align="center">操作List类型数据</td></tr><tr><td align="center"><span style="color:red">redisTemplate</span>.opsForSet()</td><td align="center">SetOperations</td><td align="center">操作Set类型数据</td></tr><tr><td align="center"><span style="color:red">redisTemplate</span>.opsForZSet()</td><td align="center">ZSetOperations</td><td align="center">操作SortedSet类型数据</td></tr><tr><td align="center"><span style="color:red">redisTemplate</span></td><td align="center"></td><td align="center">通用命令</td></tr></tbody></table><h3 id="3-4-SpringDataRedis快速入门"><a href="#3-4-SpringDataRedis快速入门" class="headerlink" title="3.4 SpringDataRedis快速入门"></a>3.4 SpringDataRedis快速入门</h3><p>SpringBoot已经提供了对SpringDataRedis的支持，其中Spring默认支持<code>Lettuce</code>，如需使用<code>Jedis</code>需要额外导入依赖</p><ol><li>导入依赖</li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Redis依赖 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>            </span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 连接池依赖 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.commons<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-pool2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><ol start="2"><li>配置文件</li></ol><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">6379</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line">    <span class="attr">lettuce:</span></span><br><span class="line">      <span class="attr">pool:</span></span><br><span class="line">        <span class="attr">max-active:</span> <span class="number">8</span> <span class="comment"># 最大连接数</span></span><br><span class="line">        <span class="attr">max-idle:</span> <span class="number">8</span> <span class="comment">#最大空闲连接数</span></span><br><span class="line">        <span class="attr">min-idle:</span> <span class="number">0</span> <span class="comment">#最小空闲连接数</span></span><br><span class="line">        <span class="attr">max-wait:</span> <span class="string">100ms</span> <span class="comment"># 连接等待时间</span></span><br></pre></td></tr></table></figure><ol start="3"><li>注入RedisTemplate，进行测试：</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisTemplateTest</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//插入一条String类型的数据</span></span><br><span class="line">        redisTemplate.opsForValue().set(<span class="string">&quot;name&quot;</span>,<span class="string">&quot;dahuang&quot;</span>);</span><br><span class="line">        <span class="comment">//获取String类型的数据</span></span><br><span class="line">        System.out.println(redisTemplate.opsForValue().get(<span class="string">&quot;name&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>SpringDataRedis的使用步骤：</p><blockquote><ol><li>引入spring-boot-starter-data-redis依赖</li><li>在application.yml配置Redis以及连接池信息</li><li>注入RedisTemplate</li></ol></blockquote><h3 id="3-5-SpringDataRedis的序列化方式"><a href="#3-5-SpringDataRedis的序列化方式" class="headerlink" title="3.5 SpringDataRedis的序列化方式"></a>3.5 SpringDataRedis的序列化方式</h3><p>RedisTemplate可以接收任意Object作为值写入Redis，只不过写入前会把Object序列化为字节形式，默认采用JDK序列化，刚才存入的数据的结果是这样：</p><p><img src="https://s2.loli.net/2022/07/12/YNlFqgBsVf56Qmh.png" class="lazyload" data-srcset="https://s2.loli.net/2022/07/12/YNlFqgBsVf56Qmh.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220712110421745"></p><p>缺点：</p><ul><li><p>可读性差</p></li><li><p>内存占用较大</p></li></ul><p>需要导入jackson依赖：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-databind<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>可以自定义RedisTemplate的序列化方式：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> RedisTemplate&lt;String, Object&gt; <span class="title function_">redisTemplate</span><span class="params">(RedisConnectionFactory redisConnectionFactory)</span>&#123;</span><br><span class="line">        <span class="comment">//创建RedisTemplate</span></span><br><span class="line">        RedisTemplate&lt;String,Object&gt; redisTemplate = <span class="keyword">new</span> <span class="title class_">RedisTemplate</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">//设置连接工厂</span></span><br><span class="line">        redisTemplate.setConnectionFactory(redisConnectionFactory);</span><br><span class="line">        <span class="comment">//设置json序列化</span></span><br><span class="line">        <span class="type">GenericJackson2JsonRedisSerializer</span> <span class="variable">gjjrs</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GenericJackson2JsonRedisSerializer</span>();</span><br><span class="line">        <span class="comment">//设置key的序列化</span></span><br><span class="line">        redisTemplate.setKeySerializer(RedisSerializer.string());</span><br><span class="line">        redisTemplate.setHashKeySerializer(RedisSerializer.string());</span><br><span class="line">        <span class="comment">//设置value的序列化</span></span><br><span class="line">        redisTemplate.setValueSerializer(gjjrs);</span><br><span class="line">        redisTemplate.setHashValueSerializer(gjjrs);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> redisTemplate;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>创建一个实体类：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">public</span> Integer age;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">User</span><span class="params">()</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">User</span><span class="params">(String name, Integer age)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>进行测试：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testString</span><span class="params">()</span> &#123;</span><br><span class="line">redisTemplate.opsForValue().set(<span class="string">&quot;demo:user:3&quot;</span>,<span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;dahuang&quot;</span>,<span class="number">18</span>));</span><br><span class="line"><span class="type">User</span> <span class="variable">u</span> <span class="operator">=</span> (User) redisTemplate.opsForValue().get(<span class="string">&quot;demo:user:3&quot;</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;u = &quot;</span> + u);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>控制台打印：</p><blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">u = User(name=dahuang, age=18)</span><br></pre></td></tr></table></figure></blockquote><p>Redis中的数据：</p><blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;@class&quot;</span><span class="punctuation">:</span> <span class="string">&quot;com.redis.pojo.User&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;dahuang&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;age&quot;</span><span class="punctuation">:</span> <span class="number">18</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></blockquote><h3 id="3-6-StringRedisTemplate"><a href="#3-6-StringRedisTemplate" class="headerlink" title="3.6 StringRedisTemplate"></a>3.6 StringRedisTemplate</h3><blockquote><p>尽管json的序列化方式可以满足需求，但仍然存在一些问题</p><p>为了在反序列化时知道对象的类型，json序列化器会将类的class类型写入json结果中，存入Redis，会带来额外的内存开销</p><p>为了节省空间，并不会使用json序列化器来处理value，而是统一使用String序列化器，要求只能存储String类型的key和value</p><p>当存储java对象时，手动完成对象的序列化和反序列化</p></blockquote><pre class="mermaid">graph LR;实体类 --> |手动序列化|json字符串 --> |插入|RedisRedis -->|获取| json字符串 --> |手动反序列化|实体类</pre><p>Spring默认提供了一个SpringRedisTemplate类，它的key和value的序列化方式默认就是String方式。省去了自定义RedisTemplate的过程：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StringRedisTemplateTest</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> StringRedisTemplate stringRedisTemplate;</span><br><span class="line">    <span class="comment">//json工具</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">ObjectMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testStringTemplate</span><span class="params">()</span> <span class="keyword">throws</span> JsonProcessingException &#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;dahei&quot;</span>, <span class="number">22</span>);</span><br><span class="line">        <span class="comment">//手动序列化</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> mapper.writeValueAsString(user);</span><br><span class="line">        <span class="comment">//插入数据</span></span><br><span class="line">        stringRedisTemplate.opsForValue().set(<span class="string">&quot;demo:user:5&quot;</span>,json);</span><br><span class="line">        <span class="comment">//获取数据</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">val</span> <span class="operator">=</span> stringRedisTemplate.opsForValue().get(<span class="string">&quot;demo:user:5&quot;</span>);</span><br><span class="line">        <span class="comment">//手动反序列化</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">u</span> <span class="operator">=</span> mapper.readValue(val, User.class);</span><br><span class="line">        <span class="comment">//打印user</span></span><br><span class="line">        System.out.println(<span class="string">&quot;u = &quot;</span> + u);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>RedisTemplate的两种序列化实践方案：</p><blockquote><p>方案一：</p><ol><li>自定义RedisTemplate</li><li>修改RedisTemplate的序列化器为<code>GenericJackson2JsonRedisSerializer</code></li></ol><p>方案二：</p><ol><li>使用StringRedisTemplate</li><li>写入Redis时，需手动把对象序列化为json</li><li>读取Redis时，手动把读取到的json反序列化为对象</li></ol></blockquote><h3 id="3-7-RedisTemplate操作Hash类型"><a href="#3-7-RedisTemplate操作Hash类型" class="headerlink" title="3.7 RedisTemplate操作Hash类型"></a>3.7 RedisTemplate操作Hash类型</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testHash</span><span class="params">()</span> &#123;</span><br><span class="line">    stringRedisTemplate.opsForHash().put(<span class="string">&quot;user:6&quot;</span>,<span class="string">&quot;name&quot;</span>,<span class="string">&quot;dahei&quot;</span>);</span><br><span class="line">    stringRedisTemplate.opsForHash().put(<span class="string">&quot;user:6&quot;</span>,<span class="string">&quot;age&quot;</span>,<span class="string">&quot;22&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    Map&lt;Object, Object&gt; entries = stringRedisTemplate.opsForHash().entries(<span class="string">&quot;user:6&quot;</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;entries = &quot;</span> + entries);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="实战篇"><a href="#实战篇" class="headerlink" title="实战篇"></a>实战篇</h1><img src="C:\Users\26919\Documents\Tencent Files\2691936018\FileRecv\MobileFile\2B189D8A28E1E768D7D4394D8AE752F6.png" class="lazyload" data-srcset="C:\Users\26919\Documents\Tencent Files\2691936018\FileRecv\MobileFile\2B189D8A28E1E768D7D4394D8AE752F6.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="2B189D8A28E1E768D7D4394D8AE752F6" style="zoom: 50%;" /><p>此项目为黑马点评，如需请到vx搜索黑马程序员获取资源</p><p>项目结构：</p><img src="C:\Users\26919\AppData\Roaming\Typora\typora-user-images\image-20220715091142486.png" class="lazyload" data-srcset="C:\Users\26919\AppData\Roaming\Typora\typora-user-images\image-20220715091142486.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220715091142486" style="zoom: 67%;" /><p>application.yaml的配置：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8081</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">hmdp</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/hmdp?useSSL=false&amp;serverTimezone=UTC</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">6379</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line">    <span class="attr">lettuce:</span></span><br><span class="line">      <span class="attr">pool:</span></span><br><span class="line">        <span class="attr">max-active:</span> <span class="number">10</span></span><br><span class="line">        <span class="attr">max-idle:</span> <span class="number">10</span></span><br><span class="line">        <span class="attr">min-idle:</span> <span class="number">1</span></span><br><span class="line">        <span class="attr">time-between-eviction-runs:</span> <span class="string">10s</span></span><br><span class="line">  <span class="attr">jackson:</span></span><br><span class="line">    <span class="attr">default-property-inclusion:</span> <span class="string">non_null</span> <span class="comment"># JSON处理时忽略非空字段</span></span><br><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line">  <span class="attr">type-aliases-package:</span> <span class="string">com.hmdp.entity</span> <span class="comment"># 别名扫描包</span></span><br><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">level:</span></span><br><span class="line">    <span class="attr">com.hmdp:</span> <span class="string">debug</span></span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="1-短信登录"><a href="#1-短信登录" class="headerlink" title="1.短信登录"></a>1.短信登录</h2><h3 id="1-1-基于Session实现短信登录流程"><a href="#1-1-基于Session实现短信登录流程" class="headerlink" title="1.1 基于Session实现短信登录流程"></a>1.1 基于Session实现短信登录流程</h3><p>发送短信验证码：</p><div id="flowchart-0" class="flow-chart"></div><p>短信验证码登录、注册：</p><div id="flowchart-1" class="flow-chart"></div><p>校验登录状态：</p><div id="flowchart-2" class="flow-chart"></div><h3 id="1-2-实现发送短信验证码"><a href="#1-2-实现发送短信验证码" class="headerlink" title="1.2 实现发送短信验证码"></a>1.2 实现发送短信验证码</h3><p>IUserService：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IUserService</span> <span class="keyword">extends</span> <span class="title class_">IService</span>&lt;User&gt; &#123;</span><br><span class="line"></span><br><span class="line">    Result <span class="title function_">sendCode</span><span class="params">(String phone, HttpSession session)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>UserServiceImpl中实现<code>sendCode</code>方法：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">sendCode</span><span class="params">(String phone, HttpSession session)</span> &#123;</span><br><span class="line">    <span class="comment">//校验手机号</span></span><br><span class="line">    <span class="keyword">if</span> (RegexUtils.isPhoneInvalid(phone)) &#123;</span><br><span class="line">        <span class="comment">//不符合，返回错误信息</span></span><br><span class="line">        <span class="keyword">return</span> Result.fail(<span class="string">&quot;手机号格式错误&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//符合，生成验证码</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">code</span> <span class="operator">=</span> RandomUtil.randomNumbers(<span class="number">6</span>);</span><br><span class="line">    <span class="comment">//保存验证码到Session</span></span><br><span class="line">    session.setAttribute(<span class="string">&quot;code&quot;</span>,code);</span><br><span class="line">    <span class="comment">//发送验证码，模拟一下</span></span><br><span class="line">    log.debug(<span class="string">&quot;发送验证码成功，验证码为：&quot;</span>+code);</span><br><span class="line">    <span class="comment">//返回OK</span></span><br><span class="line">    <span class="keyword">return</span> Result.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>UserController：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;code&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">sendCode</span><span class="params">(<span class="meta">@RequestParam(&quot;phone&quot;)</span> String phone, HttpSession session)</span> &#123;</span><br><span class="line">    <span class="comment">//发送短信验证码并保存验证码</span></span><br><span class="line">    <span class="keyword">return</span> userService.sendCode(phone, session);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>日志打印：</p><blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">发送验证码成功，验证码为：608824</span><br></pre></td></tr></table></figure></blockquote><h3 id="1-3-实现短信验证登录与注册"><a href="#1-3-实现短信验证登录与注册" class="headerlink" title="1.3 实现短信验证登录与注册"></a>1.3 实现短信验证登录与注册</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IUserService</span> <span class="keyword">extends</span> <span class="title class_">IService</span>&lt;User&gt; &#123;</span><br><span class="line">    Result <span class="title function_">sendCode</span><span class="params">(String phone, HttpSession session)</span>;</span><br><span class="line">    Result <span class="title function_">login</span><span class="params">(LoginFormDTO loginForm, HttpSession session)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">login</span><span class="params">(LoginFormDTO loginForm, HttpSession session)</span> &#123;</span><br><span class="line">    <span class="comment">//校验手机号</span></span><br><span class="line">    <span class="keyword">if</span> (RegexUtils.isPhoneInvalid(loginForm.getPhone())) &#123;</span><br><span class="line">        <span class="comment">//不符合，返回错误信息</span></span><br><span class="line">        <span class="keyword">return</span> Result.fail(<span class="string">&quot;手机号格式错误&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//校验验证码</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">code</span> <span class="operator">=</span> (String) session.getAttribute(<span class="string">&quot;code&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (code == <span class="literal">null</span> || !code.equals(loginForm.getCode())) &#123;</span><br><span class="line">        <span class="comment">//不一致，返回错误信息</span></span><br><span class="line">        <span class="keyword">return</span> Result.fail(<span class="string">&quot;验证码错误&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//一致，查询手机号是否存在</span></span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> query().eq(<span class="string">&quot;phone&quot;</span>, loginForm.getPhone()).one();</span><br><span class="line">    <span class="keyword">if</span> (user == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">//不存在，插入到数据库，完成注册</span></span><br><span class="line">        user = createUserByPhone(loginForm.getPhone());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//保存用户到Session</span></span><br><span class="line">    session.setAttribute(<span class="string">&quot;user&quot;</span>,user);</span><br><span class="line">    <span class="comment">//每个session都有唯一的id，不需要登陆凭证</span></span><br><span class="line">    <span class="keyword">return</span> Result.ok();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> User <span class="title function_">createUserByPhone</span><span class="params">(String phone)</span> &#123;</span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">    user.setPhone(phone);</span><br><span class="line">    user.setNickName(USER_NICK_NAME_PREFIX + RandomUtil.randomNumbers(<span class="number">10</span>));</span><br><span class="line">    save(user);</span><br><span class="line">    <span class="keyword">return</span> user;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/login&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">login</span><span class="params">(<span class="meta">@RequestBody</span> LoginFormDTO loginForm, HttpSession session)</span>&#123;</span><br><span class="line">    <span class="comment">//实现登录功能</span></span><br><span class="line">    <span class="keyword">return</span> userService.login(loginForm,session);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="1-4-实现登录校验拦截器"><a href="#1-4-实现登录校验拦截器" class="headerlink" title="1.4 实现登录校验拦截器"></a>1.4 实现登录校验拦截器</h3><p>调用<code>/user/me</code>接口获取用户信息时，响应中包含了手机号、密码等敏感信息，并且发送的多余信息增加了服务器的压力。所以我们只需要用户昵称、头像和id等的部分信息。</p><p>定义一个UserDto：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDTO</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long id; <span class="comment">//id</span></span><br><span class="line">    <span class="keyword">private</span> String nickName;<span class="comment">//昵称</span></span><br><span class="line">    <span class="keyword">private</span> String icon;<span class="comment">//头像</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>将<code>UserServiceImpl</code>的<code>login</code>方法中存入session的<code>User</code>转换成<code>UserDto</code>类型：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">session.setAttribute(<span class="string">&quot;user&quot;</span>, BeanUtil.copyProperties(user, UserDTO.class));</span><br></pre></td></tr></table></figure><p>新建<code>LoginInterceptor</code>拦截器：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginInterceptor</span> <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">//获取session</span></span><br><span class="line">        <span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> request.getSession();</span><br><span class="line">        <span class="comment">//获取用户信息</span></span><br><span class="line">        <span class="type">UserDTO</span> <span class="variable">user</span> <span class="operator">=</span> (UserDTO) session.getAttribute(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">        <span class="comment">//不存在，拦截</span></span><br><span class="line">        <span class="keyword">if</span> (user == <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="comment">//返回状态码401，未授权</span></span><br><span class="line">            response.setStatus(<span class="number">401</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//存在，保存到TheadLocal</span></span><br><span class="line">        UserHolder.saveUser(user);</span><br><span class="line">        <span class="comment">//放行</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">//移除用户</span></span><br><span class="line">        UserHolder.removeUser();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>新建<code>MvcConfig</code>配置类，添加拦截器并添加排序路径：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MvcConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> &#123;</span><br><span class="line">        registry.addInterceptor(<span class="keyword">new</span> <span class="title class_">LoginInterceptor</span>())</span><br><span class="line">                .excludePathPatterns( <span class="comment">//排除路径</span></span><br><span class="line">                        <span class="string">&quot;/user/login&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;/user/code&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;/shop/**&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;/shop-type/**&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;/blog/hot&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;/upload/**&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;/voucher/**&quot;</span></span><br><span class="line">                );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>UserController</code>中实现获取用户信息：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/me&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">me</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">//获取当前登录的用户并返回</span></span><br><span class="line">    <span class="type">UserDTO</span> <span class="variable">user</span> <span class="operator">=</span> UserHolder.getUser();</span><br><span class="line">    <span class="keyword">return</span> Result.ok(user);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="1-5-Session共享问题分析"><a href="#1-5-Session共享问题分析" class="headerlink" title="1.5 Session共享问题分析"></a>1.5 Session共享问题分析</h3><p><strong>session共享问题</strong>：多台Tomcat不能共享session存储空间，当请求切换到不同的Tomcat服务器时导致数据对是问题</p><p>session的替代方案应该满足：</p><ul><li><p>数据共享</p></li><li><p>内存存储</p></li><li><p>key、value结构</p></li></ul><p>Redis都能解决以上问题，并且延时低</p><h3 id="1-6-基于Redis实现共享Session登录流程"><a href="#1-6-基于Redis实现共享Session登录流程" class="headerlink" title="1.6 基于Redis实现共享Session登录流程"></a>1.6 基于Redis实现共享Session登录流程</h3><p>发送短信验证码：</p><div id="flowchart-3" class="flow-chart"></div><p>可以采用String数据类型存储：</p><table><thead><tr><th align="center">key</th><th align="center">value</th></tr></thead><tbody><tr><td align="center">手机号</td><td align="center">验证码</td></tr></tbody></table><p>短信验证登录、注册：</p><div id="flowchart-4" class="flow-chart"></div><p>保存登录用户信息，可以使用<span style="color:red">String结构</span>，以json字符串来保存，比较直观</p><p><span style="color:red">Hash结构</span>可以将对象中的每一个字段独立存储，可以针对单个字段做CRUD，并且内存占用少(<span style="color:red">推荐</span>)</p><p>保存用户到Redis：</p><table><thead><tr><th align="center">key</th><th align="center">value</th></tr></thead><tbody><tr><td align="center">随机token为key存储用户数据</td><td align="center">{name:Tom}</td></tr></tbody></table><p>校验登录状态：</p><div id="flowchart-5" class="flow-chart"></div><h3 id="1-7-基于Redis实现短信登录"><a href="#1-7-基于Redis实现短信登录" class="headerlink" title="1.7 基于Redis实现短信登录*"></a>1.7 基于Redis实现短信登录*</h3><p>修改<code>UserServiceImpl</code>中的<code>sendCode</code>方法：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Resource</span></span><br><span class="line"><span class="keyword">private</span> StringRedisTemplate stringRedisTemplate;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">sendCode</span><span class="params">(String phone, HttpSession session)</span> &#123;</span><br><span class="line"><span class="comment">//校验手机号</span></span><br><span class="line"><span class="keyword">if</span> (RegexUtils.isPhoneInvalid(phone)) &#123;</span><br><span class="line"><span class="comment">//不符合，返回错误信息</span></span><br><span class="line"><span class="keyword">return</span> Result.fail(<span class="string">&quot;手机号格式错误&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//符合，生成验证码</span></span><br><span class="line"><span class="type">String</span> <span class="variable">code</span> <span class="operator">=</span> RandomUtil.randomNumbers(<span class="number">6</span>);</span><br><span class="line"><span class="comment">//保存验证码到Redis，设置有效期</span></span><br><span class="line">    stringRedisTemplate.opsForValue().set(RedisConstants.LOGIN_CODE_KEY +phone, <span class="comment">//key</span></span><br><span class="line">code, <span class="comment">//value</span></span><br><span class="line">RedisConstants.LOGIN_CODE_TTL, <span class="comment">// 2</span></span><br><span class="line">TimeUnit.MINUTES);<span class="comment">//指定单位为分钟</span></span><br><span class="line"><span class="comment">//发送验证码，模拟一下</span></span><br><span class="line">log.debug(<span class="string">&quot;发送验证码成功，验证码为：&quot;</span>+code);</span><br><span class="line"><span class="comment">//返回OK</span></span><br><span class="line"><span class="keyword">return</span> Result.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>修改<code>UserServiceImpl</code>中的<code>login</code>方法：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Resource</span></span><br><span class="line"><span class="keyword">private</span> StringRedisTemplate stringRedisTemplate;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">login</span><span class="params">(LoginFormDTO loginForm, HttpSession session)</span> &#123;</span><br><span class="line">        <span class="comment">//校验手机号</span></span><br><span class="line">        <span class="keyword">if</span> (RegexUtils.isPhoneInvalid(loginForm.getPhone())) &#123;</span><br><span class="line">            <span class="comment">//不符合，返回错误信息</span></span><br><span class="line">            <span class="keyword">return</span> Result.fail(<span class="string">&quot;手机号格式错误&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//校验验证码</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">code</span> <span class="operator">=</span> stringRedisTemplate.opsForValue().get(RedisConstants.LOGIN_CODE_KEY + loginForm.getPhone());</span><br><span class="line">        <span class="keyword">if</span> (code == <span class="literal">null</span> || !code.equals(loginForm.getCode())) &#123;</span><br><span class="line">            <span class="comment">//不一致，返回错误信息</span></span><br><span class="line">            <span class="keyword">return</span> Result.fail(<span class="string">&quot;验证码错误&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//一致，查询手机号是否存在</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> query().eq(<span class="string">&quot;phone&quot;</span>, loginForm.getPhone()).one();</span><br><span class="line">        <span class="keyword">if</span> (user == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">//不存在，插入到数据库，完成注册</span></span><br><span class="line">            user = createUserByPhone(loginForm.getPhone());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//随机生成登录令牌token，</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> UUID.randomUUID().toString(<span class="literal">true</span>);</span><br><span class="line">        <span class="comment">//将User对象转成UserDto在转换成Map数据类型</span></span><br><span class="line">        <span class="type">UserDTO</span> <span class="variable">userDTO</span> <span class="operator">=</span> BeanUtil.copyProperties(user, UserDTO.class);</span><br><span class="line">        <span class="comment">//map数据类型的键值对都需要是String类型的</span></span><br><span class="line">        Map&lt;String, Object&gt; userMap = BeanUtil.beanToMap(userDTO,</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;(),</span><br><span class="line">                CopyOptions.create().setIgnoreNullValue(<span class="literal">true</span>) <span class="comment">//忽略空的值</span></span><br><span class="line">                        .setFieldValueEditor((fieldName, fieldValue) -&gt; fieldValue.toString()));<span class="comment">//所有value值转换为String</span></span><br><span class="line">        <span class="comment">//保存用户到Redis</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> RedisConstants.LOGIN_USER_KEY + token;</span><br><span class="line">        stringRedisTemplate.opsForHash().putAll(key, userMap);</span><br><span class="line">        <span class="comment">//设置有效期30分钟</span></span><br><span class="line">        stringRedisTemplate.expire(key, <span class="comment">//key</span></span><br><span class="line">                RedisConstants.LOGIN_USER_TTL, <span class="comment">// 30</span></span><br><span class="line">                TimeUnit.MINUTES); <span class="comment">//分钟</span></span><br><span class="line">        <span class="comment">//返回token</span></span><br><span class="line">        <span class="keyword">return</span> Result.ok(token);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p><code>MVcConfig</code>配置类中注入<code>StringRedisTemplate</code>：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MvcConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> StringRedisTemplate stringRedisTemplate;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> &#123;</span><br><span class="line">        registry.addInterceptor(<span class="keyword">new</span> <span class="title class_">LoginInterceptor</span>(stringRedisTemplate))</span><br><span class="line">                .excludePathPatterns( <span class="comment">//排除路径</span></span><br><span class="line">                        <span class="string">&quot;/user/login&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;/user/code&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;/shop/**&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;/shop-type/**&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;/blog/hot&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;/upload/**&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;/voucher/**&quot;</span></span><br><span class="line">                );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>LoginInterceptor</code>中获取Redis中的数据：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginInterceptor</span> <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> StringRedisTemplate stringRedisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">LoginInterceptor</span><span class="params">(StringRedisTemplate stringRedisTemplate)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.stringRedisTemplate = stringRedisTemplate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">//获取token，前端会将token放入到请求头中</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> request.getHeader(<span class="string">&quot;authorization&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (StrUtil.isBlank(token)) &#123;</span><br><span class="line">            <span class="comment">//返回状态码401，未授权</span></span><br><span class="line">            response.setStatus(<span class="number">401</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//获取用户信息</span></span><br><span class="line">        Map&lt;Object, Object&gt; userMap = stringRedisTemplate.opsForHash().entries(RedisConstants.LOGIN_USER_KEY + token);</span><br><span class="line">        <span class="comment">//不存在，拦截</span></span><br><span class="line">        <span class="keyword">if</span> (userMap.isEmpty())&#123;</span><br><span class="line">            <span class="comment">//返回状态码401，未授权</span></span><br><span class="line">            response.setStatus(<span class="number">401</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//将map转换成UserDto</span></span><br><span class="line">        <span class="type">UserDTO</span> <span class="variable">user</span> <span class="operator">=</span> BeanUtil.fillBeanWithMap(userMap,<span class="keyword">new</span> <span class="title class_">UserDTO</span>(),<span class="literal">false</span>);</span><br><span class="line">        <span class="comment">//存在，保存到TheadLocal</span></span><br><span class="line">        UserHolder.saveUser(user);</span><br><span class="line">        <span class="comment">//刷新有效期</span></span><br><span class="line">        stringRedisTemplate.expire(RedisConstants.LOGIN_USER_KEY + token, <span class="comment">//key</span></span><br><span class="line">                RedisConstants.LOGIN_USER_TTL, <span class="comment">// 30</span></span><br><span class="line">                TimeUnit.MINUTES); <span class="comment">//分钟</span></span><br><span class="line">        <span class="comment">//放行</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">//移除用户</span></span><br><span class="line">        UserHolder.removeUser();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="1-8-解决状态登录刷新问题"><a href="#1-8-解决状态登录刷新问题" class="headerlink" title="1.8 解决状态登录刷新问题"></a>1.8 解决状态登录刷新问题</h3><p>拦截器</p><blockquote><ol><li><p>获取token</p></li><li><p>查询Redis的用户信息</p><p>不存在，则拦截</p><p>存在，则继续</p></li><li><p>保存到ThreadLocal</p></li><li><p>刷新token的有效期</p></li><li><p>放行</p></li></ol></blockquote><p>拦截器只会拦截登录的路径，从而刷新token有效期。</p><p>但是其他的一些不需要登录也可以查看的页面，比如首页，则不会刷新token有效期。</p><p>有可能长时间查看其他页面，导致在查看需要登录的路径，token过了有效期，需要重新登录的问题</p><pre class="mermaid">sequenceDiagram        用户-->>拦截器1:发送请求        note over 拦截器1:拦截一切路径<br>1. 获取token<br>2. 查询Redis的用户<br>3. 保存到ThreadLocal<br>4. 刷新token的有效期<br>5. 放行        拦截器1->>拦截器2:进入        note over 拦截器2:拦截需要登录的路径<br>查看token<br>存在，则拦截<br>不存在，则继续        拦截器2->>UserController:进入</pre><p><code>RefreshTokenInterceptor</code>中：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RefreshTokenInterceptor</span> <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> StringRedisTemplate stringRedisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">RefreshTokenInterceptor</span><span class="params">(StringRedisTemplate stringRedisTemplate)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.stringRedisTemplate = stringRedisTemplate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">//获取token</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> request.getHeader(<span class="string">&quot;authorization&quot;</span>);</span><br><span class="line">        <span class="comment">//token不存在，直接放行，不添加到ThreadLocal</span></span><br><span class="line">        <span class="keyword">if</span> (StrUtil.isBlank(token)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//获取用户信息</span></span><br><span class="line">        Map&lt;Object, Object&gt; userMap = stringRedisTemplate.opsForHash().entries(RedisConstants.LOGIN_USER_KEY + token);</span><br><span class="line">        <span class="comment">//用户信息不存在，直接放行，不添加到ThreadLocal</span></span><br><span class="line">        <span class="keyword">if</span> (userMap.isEmpty())&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//将map转换成UserDto</span></span><br><span class="line">        <span class="type">UserDTO</span> <span class="variable">user</span> <span class="operator">=</span> BeanUtil.fillBeanWithMap(userMap,<span class="keyword">new</span> <span class="title class_">UserDTO</span>(),<span class="literal">false</span>);</span><br><span class="line">        <span class="comment">//保存到TheadLocal</span></span><br><span class="line">        UserHolder.saveUser(user);</span><br><span class="line">        <span class="comment">//刷新有效期</span></span><br><span class="line">        stringRedisTemplate.expire(RedisConstants.LOGIN_USER_KEY + token, <span class="comment">//key</span></span><br><span class="line">                RedisConstants.LOGIN_USER_TTL, <span class="comment">// 30</span></span><br><span class="line">                TimeUnit.MINUTES); <span class="comment">//分钟</span></span><br><span class="line">        <span class="comment">//放行</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">//移除用户</span></span><br><span class="line">        UserHolder.removeUser();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>LoginInterceptor</code>中：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginInterceptor</span> <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">//判断ThreadLocal是否存在用户</span></span><br><span class="line">        <span class="keyword">if</span> (UserHolder.getUser() == <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="comment">//没有，拦截，设置状态码</span></span><br><span class="line">            response.setStatus(<span class="number">401</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//有用户放行</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>MvcConfig</code>配置类中：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MvcConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> StringRedisTemplate stringRedisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> &#123;</span><br><span class="line">        <span class="comment">//token刷新拦截器</span></span><br><span class="line">        registry.addInterceptor(<span class="keyword">new</span> <span class="title class_">RefreshTokenInterceptor</span>(stringRedisTemplate))</span><br><span class="line">                .addPathPatterns(<span class="string">&quot;/**&quot;</span>) <span class="comment">//拦截所有路径</span></span><br><span class="line">                .order(<span class="number">0</span>); <span class="comment">// 注册顺序为0</span></span><br><span class="line">        <span class="comment">//登录拦截器</span></span><br><span class="line">        registry.addInterceptor(<span class="keyword">new</span> <span class="title class_">LoginInterceptor</span>())</span><br><span class="line">                .excludePathPatterns( <span class="comment">//排除路径</span></span><br><span class="line">                        <span class="string">&quot;/user/login&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;/user/code&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;/shop/**&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;/shop-type/**&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;/blog/hot&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;/upload/**&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;/voucher/**&quot;</span></span><br><span class="line">                ).order(<span class="number">1</span>); <span class="comment">//注册顺序为1</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="2-商户查询缓存"><a href="#2-商户查询缓存" class="headerlink" title="2.商户查询缓存"></a>2.商户查询缓存</h2><h3 id="2-1-什么是缓存"><a href="#2-1-什么是缓存" class="headerlink" title="2.1 什么是缓存"></a>2.1 什么是缓存</h3><p><strong>缓存</strong>就是数据交换的缓冲区(称作Cache)，是贮存数据的临时地方，一般<strong>读写性能较高</strong></p><pre class="mermaid">graph LR浏览器缓存 --> Tomcat应用层缓存 --> 数据库缓存 --> CPU缓存数据库缓存 --> 磁盘缓存</pre><blockquote><p>缓存的作用</p><ul><li>降低后端的负载</li><li>提高读写效率，降低响应时间</li></ul><p>缓存的成本</p><ul><li>数据一致性成本</li><li>代码维护成本</li><li>运维成本</li></ul></blockquote><h3 id="2-2-添加Redis缓存"><a href="#2-2-添加Redis缓存" class="headerlink" title="2.2 添加Redis缓存"></a>2.2 添加Redis缓存</h3><p>缓存的作用模型：</p><pre class="mermaid">sequenceDiagram        客户端->>Redis:请求        Redis->>客户端:命中(分支1)        Redis->>数据库:未命中(分支2)        数据库->>Redis:写缓存        数据库->>客户端:响应</pre><p>根据id查询商铺缓存的流程：</p><div id="flowchart-6" class="flow-chart"></div><p><code>IShopService</code>创建一个<code>queryById</code>方法：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IShopService</span> <span class="keyword">extends</span> <span class="title class_">IService</span>&lt;Shop&gt; &#123;</span><br><span class="line">    <span class="comment">// ctrl+b转到实现类</span></span><br><span class="line">    Result <span class="title function_">queryById</span><span class="params">(Long id)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在<code>ShopServiceImpl</code>中实现<code>queryById</code>方法，从而实现商铺信息缓存：</p><p>这里选择获取和存储Redis的数据类型为String</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Resource</span></span><br><span class="line"><span class="keyword">private</span> StringRedisTemplate stringRedisTemplate;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">queryById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> RedisConstants.CACHE_SHOP_KEY + id;</span><br><span class="line">    <span class="comment">//从Redis查询商铺缓存，Redis数据类型为String</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">shopJson</span> <span class="operator">=</span> stringRedisTemplate.opsForValue().get(key);</span><br><span class="line">    <span class="comment">//判断是否存在</span></span><br><span class="line">    <span class="keyword">if</span> (StrUtil.isNotBlank(shopJson)) &#123;</span><br><span class="line">        <span class="comment">//存在，返回信息</span></span><br><span class="line">        <span class="type">Shop</span> <span class="variable">shop</span> <span class="operator">=</span> JSONUtil.toBean(shopJson, Shop.class);</span><br><span class="line">        <span class="keyword">return</span> Result.ok(shop);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//不存在，根据id查询</span></span><br><span class="line">    <span class="type">Shop</span> <span class="variable">shop</span> <span class="operator">=</span> getById(id);</span><br><span class="line">    <span class="comment">//id不存在，返回错误信息</span></span><br><span class="line">    <span class="keyword">if</span> (shop == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> Result.fail(<span class="string">&quot;店铺不存在&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//id存在，将数据写入Redis</span></span><br><span class="line">    stringRedisTemplate.opsForValue().set(key, JSONUtil.toJsonStr(shop));</span><br><span class="line">    <span class="comment">//返回商铺信息</span></span><br><span class="line">    <span class="keyword">return</span> Result.ok(shop);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>ShopController</code>中：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">queryShopById</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span> &#123;</span><br><span class="line">    <span class="comment">//通过id获取商铺信息</span></span><br><span class="line">    <span class="keyword">return</span> shopService.queryById(id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这里选择获取和存储Redis的数据类型为Hash</p><h3 id="2-3-缓存更新策略"><a href="#2-3-缓存更新策略" class="headerlink" title="2.3 缓存更新策略"></a>2.3 缓存更新策略</h3><table><thead><tr><th align="center"></th><th align="center">内存淘汰</th><th align="center">超时剔除</th><th>主动更新</th></tr></thead><tbody><tr><td align="center">说明</td><td align="center">不用自己维护，<br>利用Redis的内存淘汰机制，<br>当内存不足时自动淘汰部分数据。<br>下次查询时更新缓存。</td><td align="center">给缓存数据添加TTL时间，<br>到期后自动删除缓存。<br>下次查询时更新缓存。</td><td>编写业务逻辑，<br>在修改数据库的同时，<br>更新缓存。</td></tr><tr><td align="center">一致性</td><td align="center">差</td><td align="center">一般</td><td>好</td></tr><tr><td align="center">维护成本</td><td align="center">无</td><td align="center">低</td><td>高</td></tr></tbody></table><p>业务场景：</p><blockquote><ul><li><p>低一致性需求：</p><p>使用内存淘汰机制。例如：店铺类型的查询缓存</p></li><li><p>高一致性需求：</p><p>主动更新，并以超时剔除为兜底方案。例如：店铺详情查询的缓存</p></li></ul></blockquote><p>主动更新策略：</p><blockquote><ul><li><p>方案一：Cache Aside Pattern(<span style="color:red">可控性高，企业开发常用</span>)</p><p>由缓存的调用者，在更新数据库的同时更新缓存。</p></li><li><p>方案二：Read&#x2F;Write Through Pattern</p><p>缓存与数据库整合为一个服务，由服务来维护一致性。调用者调用该服务，无需关心缓存一致性问题。</p></li><li><p>方案三：Write Behind Caching Pattern</p><p>调用者只操作缓存，由其它线程异步的将缓存数据持久化到数据库，保证最终一致。</p><ul><li><p>说明：</p><p>可以多次修改缓存中的数据，在将缓存的数据一次性更新到数据库中</p><p>如果缓存中的数据未更新到数据库时，出现宕机数据就会完全丢失</p></li></ul></li></ul></blockquote><p>:cherry_blossom:方案一：Cache Aside Pattern</p><blockquote><p>操作缓存和数据库时有三个问题需要考虑：</p><ol><li><p>删除缓存还是更新缓存？</p><ul><li>更新缓存：每次更新数据库都要更新缓存，无效写操作较多:negative_squared_cross_mark:</li><li>删除缓存：更新数据库时让缓存失效，查询时在更新缓存:white_check_mark:</li></ul></li><li><p>如何保证缓存与数据库的操作的同时成功或失败？</p><ul><li>单体系，将缓存与数据库的操作放在一个事务</li><li>分布式系统，利用TTC等分布式事务方案</li></ul></li><li><p>先操作缓存还是先操作数据库？(数据库的数据操作相比Redis的数据操作慢)</p><ul><li><p>先删除缓存，在操作数据库</p><p>异常情况：(<span style="color:red">出现情况高</span>)</p><p><code>线程1</code>删除缓存后，<code>线程2</code>查询缓存未命中，再查询数据库。将数据库中的旧数据又写入了缓存后，<code>线程1</code>才将数据库的数据进行了更新。导致<code>线程2</code>之前拿到的数据库的数据为旧数据。</p></li><li><p>先操作数据库，在删除缓存:cherry_blossom:(胜出)</p><p>异常情况：(<span style="color:red">出现情况低</span>)</p><p><code>线程1</code>查询缓存未命中，再查询数据库获取到旧数据后，<code>线程2</code>这时更新了数据库的数据，删除了缓存后，<code>线程1</code>才开始写入缓存。导致线程1之前拿到的数据库的数据为旧数据。</p></li></ul></li></ol></blockquote><p><span style="color:red">总结</span>：</p><p>缓存更新策略的最佳实践方案</p><blockquote><ol><li><p>低一致性需求：使用Redis自带的内存淘汰机制</p></li><li><p>高一致性需求：主动更新，并以超时剔除为兜底方案</p><ul><li><p>读操作：</p><p>缓存命中直接返回</p><p>缓存未命中则查询数据库，并写入缓存，设置超时时间</p></li><li><p>写操作：</p><p>先写数据库，然后再删除缓存</p><p>要确保数据库与缓存操作的原子性</p></li></ul></li></ol></blockquote><h3 id="2-4-添加缓存更新策略"><a href="#2-4-添加缓存更新策略" class="headerlink" title="2.4 添加缓存更新策略"></a>2.4 添加缓存更新策略</h3><p>给查询商铺的缓存添加<strong>超时剔除</strong>和<strong>主动更新</strong>的策略</p><p>修改ShopController中的业务逻辑，满足一下的需求：</p><blockquote><ol><li>根据id查询店铺时，如果缓存未命中，则查询数据库，将数据库的结果写入缓存，并设置超时时间</li><li>根据id修改店铺时，先修改数据库，在删除缓存</li></ol></blockquote><p>修改<code>ShopServiceImpl</code>中的<code>queryById</code>方法，将写入Redis的数据设置有效期：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Resource</span></span><br><span class="line"><span class="keyword">private</span> StringRedisTemplate stringRedisTemplate;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">queryById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> RedisConstants.CACHE_SHOP_KEY + id;</span><br><span class="line">    <span class="comment">//从Redis查询商铺缓存</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">shopJson</span> <span class="operator">=</span> stringRedisTemplate.opsForValue().get(key);</span><br><span class="line">    <span class="comment">//判断是否存在</span></span><br><span class="line">    <span class="keyword">if</span> (StrUtil.isNotBlank(shopJson)) &#123;</span><br><span class="line">        <span class="comment">//存在，返回信息</span></span><br><span class="line">        <span class="type">Shop</span> <span class="variable">shop</span> <span class="operator">=</span> JSONUtil.toBean(shopJson, Shop.class);</span><br><span class="line">        <span class="keyword">return</span> Result.ok(shop);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//不存在，根据id查询</span></span><br><span class="line">    <span class="type">Shop</span> <span class="variable">shop</span> <span class="operator">=</span> getById(id);</span><br><span class="line">    <span class="comment">//id不存在，返回错误信息</span></span><br><span class="line">    <span class="keyword">if</span> (shop == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> Result.fail(<span class="string">&quot;店铺不存在&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//id存在，将数据写入Redis，设置有效期</span></span><br><span class="line">    stringRedisTemplate.opsForValue().set(key, <span class="comment">//key </span></span><br><span class="line">            JSONUtil.toJsonStr(shop), <span class="comment">// value</span></span><br><span class="line">            RedisConstants.CACHE_SHOP_TTL, <span class="comment">// 30</span></span><br><span class="line">            TimeUnit.MINUTES); <span class="comment">//分钟</span></span><br><span class="line">    <span class="comment">//返回商铺信息</span></span><br><span class="line">    <span class="keyword">return</span> Result.ok(shop);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>IShopService</code>中创建<code>update</code>方法：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IShopService</span> <span class="keyword">extends</span> <span class="title class_">IService</span>&lt;Shop&gt; &#123;</span><br><span class="line">    <span class="comment">// ctrl+b转到实现类</span></span><br><span class="line">    Result <span class="title function_">queryById</span><span class="params">(Long id)</span>;</span><br><span class="line"></span><br><span class="line">    Result <span class="title function_">update</span><span class="params">(Shop shop)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>ShopServiceImpl</code>中,实现<code>update</code>方法：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Resource</span></span><br><span class="line"><span class="keyword">private</span> StringRedisTemplate stringRedisTemplate;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">update</span><span class="params">(Shop shop)</span> &#123;</span><br><span class="line">    <span class="type">Long</span> <span class="variable">id</span> <span class="operator">=</span> shop.getId();</span><br><span class="line">    <span class="comment">//判断商铺是否存在</span></span><br><span class="line">    <span class="keyword">if</span> (id == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">//返回cu</span></span><br><span class="line">        <span class="keyword">return</span> Result.fail(<span class="string">&quot;商铺id不能为空&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//更新数据库</span></span><br><span class="line">    updateById(shop);</span><br><span class="line">    <span class="comment">//删除缓存，下次用再取</span></span><br><span class="line">    stringRedisTemplate.delete(RedisConstants.CACHE_SHOP_KEY + id);</span><br><span class="line"><span class="comment">//返回成功信息</span></span><br><span class="line">    <span class="keyword">return</span> Result.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>ShopController</code>中：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PutMapping</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">updateShop</span><span class="params">(<span class="meta">@RequestBody</span> Shop shop)</span> &#123;</span><br><span class="line">    <span class="comment">//更新数据</span></span><br><span class="line">    <span class="keyword">return</span> shopService.update(shop);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-5-缓存穿透"><a href="#2-5-缓存穿透" class="headerlink" title="2.5 缓存穿透"></a>2.5 缓存穿透</h3><p><strong>缓存穿透</strong>是指客户端请求的数据在缓存中和数据库中都不存在，这样缓存永远不会生效，这些请求到会打到数据库。(多次查询不存在的信息，频繁请求数据库，有可能导致数据库崩溃)</p><p>常见的解决方案有两种：</p><ul><li><p><span style="color:red">缓存空对象</span></p><p>优点：实现简单，维护方便</p><p>缺点：</p><ul><li><p>额外的内存消耗</p></li><li><p>可能造成短期的不一致</p><p>(查询一个id未命中，Redis写入一个空对象，此时数据库插入这个id，导致信息不一致)</p><pre class="mermaid">    sequenceDiagram        客户端->>Redis:请求        note left of Redis:未命中        Redis->>数据库:请求        note left of 数据库:未命中        数据库->>Redis:缓存null<br>设置TTL</pre></li></ul></li><li><p><span style="color:red">布隆过滤</span></p><p>优点：内存占用较少，没有多余的key</p><p>缺点：</p><ul><li><p>实现复杂</p></li><li><p>存在误判可能</p><pre class="mermaid">    sequenceDiagram        客户端->>布隆过滤:请求        布隆过滤->>客户端:拒绝        note left of 布隆过滤:不存在        布隆过滤->>Redis:放行，请求        note left of Redis:存在        Redis->>客户端:返回        note over Redis,客户端:命中        Redis->>数据库:请求        note left of 数据库:未命中        数据库->>Redis:缓存数据        数据库->>客户端:返回数据</pre></li></ul></li></ul><h3 id="2-6-解决缓存穿透问题"><a href="#2-6-解决缓存穿透问题" class="headerlink" title="2.6 解决缓存穿透问题"></a>2.6 解决缓存穿透问题</h3><p>就是将之前判断商铺不存在时，<code>返回404信息</code>改为<code>将空值写入Redis</code></p><div id="flowchart-7" class="flow-chart"></div><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Resource</span></span><br><span class="line"><span class="keyword">private</span> StringRedisTemplate stringRedisTemplate;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">queryById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> RedisConstants.CACHE_SHOP_KEY + id;</span><br><span class="line">    <span class="comment">//从Redis查询商铺缓存</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">shopJson</span> <span class="operator">=</span> stringRedisTemplate.opsForValue().get(key);</span><br><span class="line">    <span class="comment">//判断是否存在</span></span><br><span class="line">    <span class="keyword">if</span> (StrUtil.isNotBlank(shopJson)) &#123;</span><br><span class="line">        <span class="comment">//存在，返回信息</span></span><br><span class="line">        <span class="type">Shop</span> <span class="variable">shop</span> <span class="operator">=</span> JSONUtil.toBean(shopJson, Shop.class);</span><br><span class="line">        <span class="keyword">return</span> Result.ok(shop);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//命中的是否为空字符串</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="string">&quot;&quot;</span>.equals(shopJson)) &#123;</span><br><span class="line">        <span class="comment">//返回错误信息</span></span><br><span class="line">        <span class="keyword">return</span> Result.fail(<span class="string">&quot;店铺不存在&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//不存在，根据id查询</span></span><br><span class="line">    <span class="type">Shop</span> <span class="variable">shop</span> <span class="operator">=</span> getById(id);</span><br><span class="line">    <span class="comment">//id不存在，返回错误信息</span></span><br><span class="line">    <span class="keyword">if</span> (shop == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">//将空值写入Redis</span></span><br><span class="line">        stringRedisTemplate.opsForValue().set(key,<span class="comment">//key</span></span><br><span class="line">                <span class="string">&quot;&quot;</span>, <span class="comment">//空值</span></span><br><span class="line">                RedisConstants.CACHE_NULL_TTL,<span class="comment">// 2</span></span><br><span class="line">                TimeUnit.MINUTES); <span class="comment">//分钟</span></span><br><span class="line">        <span class="comment">//返回错误信息</span></span><br><span class="line">        <span class="keyword">return</span> Result.fail(<span class="string">&quot;店铺不存在&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//id存在，将数据写入Redis，设置有效期</span></span><br><span class="line">    stringRedisTemplate.opsForValue().set(key, <span class="comment">//key</span></span><br><span class="line">            JSONUtil.toJsonStr(shop), <span class="comment">// value</span></span><br><span class="line">            RedisConstants.CACHE_SHOP_TTL, <span class="comment">// 30</span></span><br><span class="line">            TimeUnit.MINUTES); <span class="comment">//分钟</span></span><br><span class="line">    <span class="comment">//返回商铺信息</span></span><br><span class="line">    <span class="keyword">return</span> Result.ok(shop);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>缓存穿透产生的原因是什么？</p><ul><li>用户请求的数据再缓存和数据库中都不存在，不断发起这样的请求，给数据库带来了巨大压力</li></ul><p>缓存穿透的解决方案有哪些？</p><ul><li><p>缓存null值</p></li><li><p>布隆过滤</p></li><li><p>增加id的复杂度，避免被猜到id规律</p></li><li><p>做好数据的基础格式校验</p></li></ul></blockquote><h3 id="2-7-缓存雪崩"><a href="#2-7-缓存雪崩" class="headerlink" title="2.7 缓存雪崩"></a>2.7 缓存雪崩</h3><p><strong>缓存雪崩</strong>是指同一时间<strong>大量的缓存key同时失效</strong>或者<strong>Redis服务宕机</strong>，导致大量请求到达数据库，带来压力。</p><pre class="mermaid">sequenceDiagram        客户端->>Redis:请求        note over Redis:宕机或大量缓存同时失效        Redis->>数据库:大量请求        note left of 数据库:带来巨大压力        数据库->>客户端:返回</pre><p>解决方案：</p><blockquote><ul><li><p>给不同的key的TTL添加随机值</p></li><li><p>利用Redis集群提高服务的可用性</p></li><li><p>给缓存业务添加降级限流策略</p></li><li><p>给业务添加多级缓存</p></li></ul></blockquote><h3 id="2-X-缓存击穿"><a href="#2-X-缓存击穿" class="headerlink" title="2.X 缓存击穿"></a>2.X 缓存击穿</h3><h3 id="2-X-缓存工具封装"><a href="#2-X-缓存工具封装" class="headerlink" title="2.X 缓存工具封装"></a>2.X 缓存工具封装</h3></div><div class="story post-story"><h2 id="3-达人探店"><a href="#3-达人探店" class="headerlink" title="3.达人探店"></a>3.达人探店</h2><h2 id="4-优惠券秒杀"><a href="#4-优惠券秒杀" class="headerlink" title="4.优惠券秒杀"></a>4.优惠券秒杀</h2><h2 id="5-好友关注"><a href="#5-好友关注" class="headerlink" title="5.好友关注"></a>5.好友关注</h2><h2 id="6-附近的商户"><a href="#6-附近的商户" class="headerlink" title="6.附近的商户"></a>6.附近的商户</h2><h2 id="7-用户签到"><a href="#7-用户签到" class="headerlink" title="7.用户签到"></a>7.用户签到</h2><h2 id="8-UV统计"><a href="#8-UV统计" class="headerlink" title="8.UV统计"></a>8.UV统计</h2><h1 id="高级篇"><a href="#高级篇" class="headerlink" title="高级篇"></a>高级篇</h1><h1 id="原理篇"><a href="#原理篇" class="headerlink" title="原理篇"></a>原理篇<script src="https://cdnjs.cloudflare.com/ajax/libs/raphael/2.2.7/raphael.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/flowchart/1.6.5/flowchart.min.js"></script><textarea id="flowchart-0-code" style="display: none">st=>start: 开始op=>operation: 提交手机号cond=>condition: 校验手机号code=>operation: 生成验证码save=>operation: 验证码保存到Sessionsend=>operation: 发送验证码e=>end: 结束st->op->cond(yes)->code->save->send->econd(no)->op</textarea><textarea id="flowchart-0-options" style="display: none">{"scale":1,"line-width":2,"line-length":50,"text-margin":10,"font-size":12}</textarea><script>  var code = document.getElementById("flowchart-0-code").value;  var options = JSON.parse(decodeURIComponent(document.getElementById("flowchart-0-options").value));  var diagram = flowchart.parse(code);  diagram.drawSVG("flowchart-0", options);</script><textarea id="flowchart-1-code" style="display: none">st=>start: 开始op=>operation: 提交手机号和验证码cond1=>condition: 校验验证码code=>operation: 根据手机号查询用户cond2=>condition: 用户是否存在login=>operation: 登录register=>operation: 创建新用户save1=>operation: 保存用户到Sessionsave2=>operation: 保存用户到数据库e=>end: 结束st->op->cond1(yes)->code->cond2(yes)->login->save1->econd1(no)->opcond2(no)->register->save2->save1</textarea><textarea id="flowchart-1-options" style="display: none">{"scale":1,"line-width":2,"line-length":50,"text-margin":10,"font-size":12}</textarea><script>  var code = document.getElementById("flowchart-1-code").value;  var options = JSON.parse(decodeURIComponent(document.getElementById("flowchart-1-options").value));  var diagram = flowchart.parse(code);  diagram.drawSVG("flowchart-1", options);</script><textarea id="flowchart-2-code" style="display: none">st=>start: 开始op=>operation: 请求并携带cookieget=>operation: 从Session获取用户cond=>condition: 判断用户是否存在save=>operation: 保存用户到TreadLocalpass=>operation: 放行intercept=>operation: 拦截e=>end: 结束st->op->get->cond(yes)->save->pass->econd(no)->intercept->e</textarea><textarea id="flowchart-2-options" style="display: none">{"scale":1,"line-width":2,"line-length":50,"text-margin":10,"font-size":12}</textarea><script>  var code = document.getElementById("flowchart-2-code").value;  var options = JSON.parse(decodeURIComponent(document.getElementById("flowchart-2-options").value));  var diagram = flowchart.parse(code);  diagram.drawSVG("flowchart-2", options);</script><textarea id="flowchart-3-code" style="display: none">st=>start: 开始op=>operation: 提交手机号cond=>condition: 校验手机号code=>operation: 生成验证码save=>operation: 验证码保存到Redissend=>operation: 发送验证码e=>end: 结束st->op->cond(yes)->code->save->send->econd(no)->op</textarea><textarea id="flowchart-3-options" style="display: none">{"scale":1,"line-width":2,"line-length":50,"text-margin":10,"font-size":12}</textarea><script>  var code = document.getElementById("flowchart-3-code").value;  var options = JSON.parse(decodeURIComponent(document.getElementById("flowchart-3-options").value));  var diagram = flowchart.parse(code);  diagram.drawSVG("flowchart-3", options);</script><textarea id="flowchart-4-code" style="display: none">st=>start: 开始op=>operation: 提交手机号和验证码cond1=>condition: 校验验证码code=>operation: 根据手机号查询用户cond2=>condition: 用户是否存在login=>operation: 登录register=>operation: 创建新用户save1=>operation: 保存用户到Redissave2=>operation: 保存用户到数据库back=>operation: 返回token给客户端e=>end: 结束st->op->cond1(yes)->code->cond2(yes)->login->save1->back->econd1(no)->opcond2(no)->register->save2->save1</textarea><textarea id="flowchart-4-options" style="display: none">{"scale":1,"line-width":2,"line-length":50,"text-margin":10,"font-size":12}</textarea><script>  var code = document.getElementById("flowchart-4-code").value;  var options = JSON.parse(decodeURIComponent(document.getElementById("flowchart-4-options").value));  var diagram = flowchart.parse(code);  diagram.drawSVG("flowchart-4", options);</script><textarea id="flowchart-5-code" style="display: none">st=>start: 开始op=>operation: 请求并携带tokenget=>operation: 从Redis获取用户cond=>condition: 判断用户是否存在save=>operation: 保存用户到TreadLocalpass=>operation: 放行intercept=>operation: 拦截e=>end: 结束st->op->get->cond(yes)->save->pass->econd(no)->intercept->e</textarea><textarea id="flowchart-5-options" style="display: none">{"scale":1,"line-width":2,"line-length":50,"text-margin":10,"font-size":12}</textarea><script>  var code = document.getElementById("flowchart-5-code").value;  var options = JSON.parse(decodeURIComponent(document.getElementById("flowchart-5-options").value));  var diagram = flowchart.parse(code);  diagram.drawSVG("flowchart-5", options);</script><textarea id="flowchart-6-code" style="display: none">st=>start: 开始op=>operation: 提交商铺idget=>operation: 从Redis查询商铺缓存cond1=>condition: 缓存是否命中resp=>operation: 返回商铺信息select=>operation: 根据id查询数据库cond2=>condition: 判断商铺是否存在exist=>operation: 将商铺数据写入Redisnon-existent=>operation: 返回404e=>end: 结束st->op->get->cond1(yes)->resp->econd1(no)->select->cond2(yes)->exist(left)->respcond2(no)->non-existent->e</textarea><textarea id="flowchart-6-options" style="display: none">{"scale":1,"line-width":2,"line-length":50,"text-margin":10,"font-size":12}</textarea><script>  var code = document.getElementById("flowchart-6-code").value;  var options = JSON.parse(decodeURIComponent(document.getElementById("flowchart-6-options").value));  var diagram = flowchart.parse(code);  diagram.drawSVG("flowchart-6", options);</script><textarea id="flowchart-7-code" style="display: none">st=>start: 开始op=>operation: 提交商铺idget=>operation: 从Redis查询商铺缓存cond1=>condition: 缓存是否命中resp=>operation: 返回商铺信息select=>operation: 根据id查询数据库cond2=>condition: 判断商铺是否存在exist=>operation: 将商铺数据写入Redisnon-existent=>operation: 将空值写入Redise=>end: 结束st->op->get->cond1(yes)->resp->econd1(no)->select->cond2(yes)->exist(left)->respcond2(no)->non-existent->e</textarea><textarea id="flowchart-7-options" style="display: none">{"scale":1,"line-width":2,"line-length":50,"text-margin":10,"font-size":12}</textarea><script>  var code = document.getElementById("flowchart-7-code").value;  var options = JSON.parse(decodeURIComponent(document.getElementById("flowchart-7-options").value));  var diagram = flowchart.parse(code);  diagram.drawSVG("flowchart-7", options);</script></h1></div>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> 数据库 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/06/Java/MyBatis-Plus%E6%A1%86%E6%9E%B6/"/>
      <url>/2022/08/06/Java/MyBatis-Plus%E6%A1%86%E6%9E%B6/</url>
      
        <content type="html"><![CDATA[<hr><hr><div class="story post-story"><h2 id="1-初识MyBatis-Plus"><a href="#1-初识MyBatis-Plus" class="headerlink" title="1.初识MyBatis-Plus"></a>1.初识MyBatis-Plus</h2><p>MyBatis-Plus是MyBatis的增强工具，在MyBatis的基础上<strong>只做增强不做改变</strong>，为了<strong>简化开发</strong>，<strong>提高效率</strong>而生</p><p><strong>官网</strong>：<a href="https://baomidou.com/">MyBatis-Plus</a></p><p><strong>特性</strong>：</p><blockquote><ul><li><p><strong>无入侵</strong>：只做增强不做改变，导入它不会对现有工程产生影响。</p></li><li><p><strong>损耗小</strong>：启动即会自动注入基本CRUD，性能基本不损耗，直接面向对象操作</p></li><li><p><strong>强大的CRUD操作</strong>：内置通用Mapper、通用Service ,仅仅通过少量配置即可实现单表大部分CRUD操作，更有强大的条件构造器，满足各类使用需求</p></li><li><p><strong>支持Lambda形式调用</strong>：通过Lambda表达式，方便的编写各类查询条件，无需再担心字段写错</p></li><li><p><strong>支持多种数据库</strong>：支持MySQL、MariaDB、 Oracle、 DB2、 H2、 HSQL、 SQLite、 Postgre、SQL Server等多种数据库</p></li><li><p><strong>支持主键自动生成</strong>：支持多达4种主键策略(内含分布式唯一ID生成器- Sequence)，可自由配置，完美解决主键问题</p></li><li><p><strong>支持XML热加载</strong>：Mapper对应的XML支持热加载，对于简单的CRUD操作，甚至可以无XML启动</p></li><li><p><strong>支持ActiveRecord模式</strong>：支持ActiveRecord形式调用，实体类只需继承Model类即可进行强大的CRUD操作</p></li><li><p><strong>支持自定义全局通用操作</strong>：支持全局通用方法注入(Write once，use anywhere)</p></li><li><p><strong>支持关键词自动转义</strong>：支持数据库关键词( order、 key…. )自动转义，还可自定义关键词</p></li><li><p><strong>内置代码生成器</strong>：采用代码或者Maven插件可快速生成Mapper、 Model、Service、Controller层代码，支持模板引擎，更有超多自定义配置等您来使用</p></li><li><p><strong>内置分页插件</strong>：基于MyBatis物理分页，开发者无需关心具体操作，配置好插件之后，写分页等同于普通List查询</p></li><li><p><strong>内置性能分析插件</strong>：可输出Sql语句以及其执行时间，建议开发测试时启用该功能，能快速揪出慢查询</p></li><li><p><strong>内置全局拦截插件</strong>：提供全表delete、update 操作智能分析阻断，也可自定义拦截规则，预防误操作</p></li><li><p><strong>内置Sql注入剥离器</strong>：支持Sql注入剥离，有效预防Sql注入攻击</p></li></ul></blockquote></div><div class="story post-story"><h2 id="2-创建数据库"><a href="#2-创建数据库" class="headerlink" title="2.创建数据库"></a>2.创建数据库</h2><p>创建数据库：</p><ul><li><p>数据名：mp</p></li><li><p>字符集：utf-8</p></li></ul><p>创建表：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建测试表</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `tb_user` (</span><br><span class="line">`id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;主键ID&#x27;</span>,</span><br><span class="line">`user_name` <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;用户名&#x27;</span>,</span><br><span class="line">`password` <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;密码&#x27;</span>,</span><br><span class="line">`name` <span class="type">varchar</span>(<span class="number">30</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;姓名&#x27;</span>,</span><br><span class="line">`age` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;年龄&#x27;</span>,</span><br><span class="line">`email` <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;邮箱&#x27;</span>,</span><br><span class="line"><span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB AUTO_INCREMENT<span class="operator">=</span><span class="number">1</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8;</span><br><span class="line"><span class="comment">-- 插入测试数据</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `tb_user` (`id`, `user_name`, `password`, `name`, `age`, `email`) <span class="keyword">VALUES</span></span><br><span class="line">(<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;zhangsan&#x27;</span>, <span class="string">&#x27;123456&#x27;</span>, <span class="string">&#x27;张三&#x27;</span>, <span class="string">&#x27;18&#x27;</span>, <span class="string">&#x27;test1@itcast.cn&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `tb_user` (`id`, `user_name`, `password`, `name`, `age`, `email`) <span class="keyword">VALUES</span></span><br><span class="line">(<span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;lisi&#x27;</span>, <span class="string">&#x27;123456&#x27;</span>, <span class="string">&#x27;李四&#x27;</span>, <span class="string">&#x27;20&#x27;</span>, <span class="string">&#x27;test2@itcast.cn&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `tb_user` (`id`, `user_name`, `password`, `name`, `age`, `email`) <span class="keyword">VALUES</span></span><br><span class="line">(<span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;wangwu&#x27;</span>, <span class="string">&#x27;123456&#x27;</span>, <span class="string">&#x27;王五&#x27;</span>, <span class="string">&#x27;28&#x27;</span>, <span class="string">&#x27;test3@itcast.cn&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `tb_user` (`id`, `user_name`, `password`, `name`, `age`, `email`) <span class="keyword">VALUES</span></span><br><span class="line">(<span class="string">&#x27;4&#x27;</span>, <span class="string">&#x27;zhaoliu&#x27;</span>, <span class="string">&#x27;123456&#x27;</span>, <span class="string">&#x27;赵六&#x27;</span>, <span class="string">&#x27;21&#x27;</span>, <span class="string">&#x27;test4@itcast.cn&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `tb_user` (`id`, `user_name`, `password`, `name`, `age`, `email`) <span class="keyword">VALUES</span></span><br><span class="line">(<span class="string">&#x27;5&#x27;</span>, <span class="string">&#x27;sunqi&#x27;</span>, <span class="string">&#x27;123456&#x27;</span>, <span class="string">&#x27;孙七&#x27;</span>, <span class="string">&#x27;24&#x27;</span>, <span class="string">&#x27;test5@itcast.cn&#x27;</span>);</span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="3-Mybatis-Plus快速入门"><a href="#3-Mybatis-Plus快速入门" class="headerlink" title="3.Mybatis-Plus快速入门"></a>3.Mybatis-Plus快速入门</h2><p>导入所有依赖：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- mybatis-plus插件依赖 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.1.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- mysql --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.47<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 数据库连接池 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.16<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 简化bean代码工具 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.18.24<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 单元测试插件依赖 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 日志插件依赖 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-log4j12<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7.36<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><p><code>resourses</code>资源包中，新建<code>log4j.properties</code>文件：</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">log4j.rootLogger</span>=<span class="string">DEBUG,A1</span></span><br><span class="line"><span class="attr">log4j.appender.A1</span>=<span class="string">org.apache.log4j.ConsoleAppender</span></span><br><span class="line"><span class="attr">log4j.appender.A1.layout</span>=<span class="string">org.apache.log4j.PatternLayout</span></span><br><span class="line"><span class="attr">log4j.appender.A1.layout.ConversionPattern</span>=<span class="string">[%t] [%c]-[%p] %m%n</span></span><br></pre></td></tr></table></figure><p>创建User实体类：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span> <span class="comment">//生成getter和setterd方法</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span> <span class="comment">// 生成无参构造函数</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span> <span class="comment">// 生成有参构造函数</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String userName;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String age;</span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>项目结构：</p><img src="C:\Users\26919\AppData\Roaming\Typora\typora-user-images\image-20220714203703395.png" class="lazyload" data-srcset="C:\Users\26919\AppData\Roaming\Typora\typora-user-images\image-20220714203703395.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220714203703395" style="zoom:67%;" /><h3 id="3-1-Mybatis实现查询"><a href="#3-1-Mybatis实现查询" class="headerlink" title="3.1 Mybatis实现查询"></a>3.1 Mybatis实现查询</h3><p>在<code>resources</code>资源包中，创建<code>mybatis-config.xml</code>文件：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span><br><span class="line">&lt;!DOCTYPE configuration</span><br><span class="line">        PUBLIC <span class="string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span><br><span class="line">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">    &lt;environments <span class="keyword">default</span>=<span class="string">&quot;development&quot;</span>&gt;</span><br><span class="line">        &lt;environment id=<span class="string">&quot;development&quot;</span>&gt;</span><br><span class="line">            &lt;transactionManager type=<span class="string">&quot;JDBC&quot;</span>/&gt;</span><br><span class="line">            &lt;dataSource type=<span class="string">&quot;POOLED&quot;</span>&gt;</span><br><span class="line">                &lt;property name=<span class="string">&quot;driver&quot;</span> value=<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>/&gt;</span><br><span class="line">                &lt;property name=<span class="string">&quot;url&quot;</span> value=<span class="string">&quot;jdbc:mysql://localhost:3306/mp?</span></span><br><span class="line"><span class="string">useUnicode=true&amp;amp;characterEncoding=utf8&amp;amp;autoReconnect=true&amp;amp;allowMultiQuerie</span></span><br><span class="line"><span class="string">s=true&amp;amp;useSSL=false&quot;</span>/&gt;</span><br><span class="line">                &lt;property name=<span class="string">&quot;username&quot;</span> value=<span class="string">&quot;root&quot;</span>/&gt;</span><br><span class="line">                &lt;property name=<span class="string">&quot;password&quot;</span> value=<span class="string">&quot;123456&quot;</span>/&gt;</span><br><span class="line">            &lt;/dataSource&gt;</span><br><span class="line">        &lt;/environment&gt;</span><br><span class="line">    &lt;/environments&gt;</span><br><span class="line">    &lt;mappers&gt;</span><br><span class="line">        &lt;mapper resource=<span class="string">&quot;UserMapper.xml&quot;</span>/&gt;</span><br><span class="line">    &lt;/mappers&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br></pre></td></tr></table></figure><p>创建<code>UserMapper</code>接口：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> &#123;</span><br><span class="line">    </span><br><span class="line">    List&lt;User&gt; <span class="title function_">findAll</span><span class="params">()</span>; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在<code>resources</code>资源包创建<code>UserMapper.xml</code>文件:：</p><ul><li><p><code>namespace</code>为<code>UserMapper</code>接口的位置</p></li><li><p><code>id</code>为<code>UserMapper</code>中的方法名</p></li><li><p><code>resultType</code>为实体类的位置</p></li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.mybatisp.mapper.UserMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findAll&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.mybatisp.pojo.User&quot;</span>&gt;</span></span><br><span class="line">        select * from tb_user</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><p>单元测试：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testFindAll</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="type">InputStream</span> <span class="variable">is</span> <span class="operator">=</span> Resources.getResourceAsStream(<span class="string">&quot;mybatis-config.xml&quot;</span>);</span><br><span class="line">    <span class="type">SqlSessionFactory</span> <span class="variable">sqlSessionFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>().build(is);</span><br><span class="line"></span><br><span class="line">    <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> sqlSessionFactory.openSession();</span><br><span class="line"></span><br><span class="line">    <span class="type">UserMapper</span> <span class="variable">userMapper</span> <span class="operator">=</span> sqlSession.getMapper(UserMapper.class);</span><br><span class="line"></span><br><span class="line">    System.out.println(userMapper.findAll());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>控制台打印：</p><blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[User(id=1, userName=null, password=123456, name=张三, age=18, email=test1@itcast.cn), User(id=2, userName=null, password=123456, name=李四, age=20, email=test2@itcast.cn), User(id=3, userName=null, password=123456, name=王五, age=28, email=test3@itcast.cn), User(id=4, userName=null, password=123456, name=赵六, age=21, email=test4@itcast.cn), User(id=5, userName=null, password=123456, name=孙七, age=24, email=test5@itcast.cn)]</span><br></pre></td></tr></table></figure></blockquote><h3 id="3-2-Mybatis-MP实现查询"><a href="#3-2-Mybatis-MP实现查询" class="headerlink" title="3.2 Mybatis+MP实现查询"></a>3.2 Mybatis+MP实现查询</h3><p>将UserMapper继承BaseMapper，将拥有了BaseMapper中的所有方法：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;User&gt; &#123;</span><br><span class="line"></span><br><span class="line">    List&lt;User&gt; <span class="title function_">findAll</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>单元测试：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testFindAll2</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="type">InputStream</span> <span class="variable">is</span> <span class="operator">=</span> Resources.getResourceAsStream(<span class="string">&quot;mybatis-config.xml&quot;</span>);</span><br><span class="line">    <span class="comment">//这里使用的是MP中的MybatisSqlSessionFactoryBuilder</span></span><br><span class="line">    <span class="type">SqlSessionFactory</span> <span class="variable">sqlSessionFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MybatisSqlSessionFactoryBuilder</span>().build(is);</span><br><span class="line"></span><br><span class="line">    <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> sqlSessionFactory.openSession();</span><br><span class="line">    <span class="type">UserMapper</span> <span class="variable">userMapper</span> <span class="operator">=</span> sqlSession.getMapper(UserMapper.class);</span><br><span class="line"></span><br><span class="line">    System.out.println(userMapper.findAll());</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>运行成功！</p><p>改用BaseMapper中定义的方法查询所有：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testFindAll2</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="type">InputStream</span> <span class="variable">is</span> <span class="operator">=</span> Resources.getResourceAsStream(<span class="string">&quot;mybatis-config.xml&quot;</span>);</span><br><span class="line">    <span class="type">SqlSessionFactory</span> <span class="variable">sqlSessionFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MybatisSqlSessionFactoryBuilder</span>().build(is);</span><br><span class="line"></span><br><span class="line">    <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> sqlSessionFactory.openSession();</span><br><span class="line">    <span class="type">UserMapper</span> <span class="variable">userMapper</span> <span class="operator">=</span> sqlSession.getMapper(UserMapper.class);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//System.out.println(userMapper.findAll());</span></span><br><span class="line">    System.out.println(userMapper.selectList(<span class="literal">null</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>报错：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Cause: com.mysql.jdbc.exceptions.jdbc4.MySQLSyntaxErrorException: Table &#x27;mp.user&#x27; doesn&#x27;t exist</span><br></pre></td></tr></table></figure><p>报错原因是没有找到<code>user</code>表，因为数据库中的表名为<code>tb_user</code>所以导致没有找到该表。需要指定表：</p><p>在User实体类中与数据库中的表进行映射：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span> <span class="comment">//生成getter和setter方法</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span> <span class="comment">// 生成无参构造函数</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span> <span class="comment">// 生成有参构造函数</span></span><br><span class="line"><span class="meta">@TableName(&quot;tb_user&quot;)</span> <span class="comment">//指定为tb_user表</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String userName;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String age;</span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>再次运行，成功！</p><h3 id="3-3-Spring-Mybatis-MP"><a href="#3-3-Spring-Mybatis-MP" class="headerlink" title="3.3 Spring+Mybatis+MP"></a>3.3 Spring+Mybatis+MP</h3><p>新建项目：</p><p>导入依赖：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-webmvc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.2.10.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.2.10.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.2.10.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.1.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.47<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.16<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.18.24<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-log4j12<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7.36<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><p>在<code>resources</code>资源包中创建<code>log4j.properties</code>文件：</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">log4j.rootLogger</span>=<span class="string">DEBUG,A1</span></span><br><span class="line"><span class="attr">log4j.appender.A1</span>=<span class="string">org.apache.log4j.ConsoleAppender</span></span><br><span class="line"><span class="attr">log4j.appender.A1.layout</span>=<span class="string">org.apache.log4j.PatternLayout</span></span><br><span class="line"><span class="attr">log4j.appender.A1.layout.ConversionPattern</span>=<span class="string">[%t] [%c]-[%p] %m%n</span></span><br></pre></td></tr></table></figure><p>在<code>resources</code>资源包中创建<code>jdbc.properties</code>文件：</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">jdbc.driver</span>=<span class="string">com.mysql.jdbc.driver</span></span><br><span class="line"><span class="attr">jdbc.url</span>=<span class="string">jdbc:mysql://localhost:3306/mp?useUnicode=true&amp;characterEncoding=utf8&amp;autoReconnect=true&amp;allowMultiQueries=true&amp;useSSL=false</span></span><br><span class="line"><span class="attr">jdbc.username</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">jdbc.password</span>=<span class="string">123456</span></span><br></pre></td></tr></table></figure><p>在<code>resources</code>资源包中创建<code>applicationContext.xml</code>文件</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">http://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">&quot;classpath*:*.properties&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 定义数据源 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.alibaba.druid.pool.DruidDataSource&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">destroy-method</span>=<span class="string">&quot;close&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.url&#125;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.username&#125;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.password&#125;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClassName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.driver&#125;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxActive&quot;</span> <span class="attr">value</span>=<span class="string">&quot;10&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;minIdle&quot;</span> <span class="attr">value</span>=<span class="string">&quot;5&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--这里使用MP提供的sqlSessionFactory，完成了Spring与MP的整合--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;sqlSessionFactory&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">class</span>=<span class="string">&quot;com.baomidou.mybatisplus.extension.spring.MybatisSqlSessionFactoryBean&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--扫描mapper接口，使用的依然是Mybatis原生的扫描器--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.spring.mapper.MapperScannerConfigurer&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;basePackage&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mybatisp.mapper&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><p>创建User实体类：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span> <span class="comment">//生成getter和setter方法</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span> <span class="comment">// 生成无参构造函数</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span> <span class="comment">// 生成有参构造函数</span></span><br><span class="line"><span class="meta">@TableName(&quot;tb_user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String userName;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String age;</span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>创建UerMapper接口：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;User&gt; &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>单元测试：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith(SpringJUnit4ClassRunner.class)</span></span><br><span class="line"><span class="meta">@ContextConfiguration(locations = &quot;classpath:applicationContext.xml&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MybatisTest</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserMapper userMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelectList</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(userMapper.selectList(<span class="literal">null</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>运行成功！</p><h3 id="3-4-SpringBoot-Mybaits-MP"><a href="#3-4-SpringBoot-Mybaits-MP" class="headerlink" title="3.4 SpringBoot+Mybaits+MP"></a>3.4 SpringBoot+Mybaits+MP</h3><p>xml版</p><p>项目结构：</p><img src="C:\Users\26919\AppData\Roaming\Typora\typora-user-images\image-20220715004613423.png" class="lazyload" data-srcset="C:\Users\26919\AppData\Roaming\Typora\typora-user-images\image-20220715004613423.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220715004613423" style="zoom:67%;" /><p>创建springboot项目自动导入依赖：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.4.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.11<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.junit.vintage<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit-vintage-engine<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring-boot.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.8.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">source</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">encoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">encoding</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.7.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">mainClass</span>&gt;</span>com.mybatisp.SpringbootMpApplication<span class="tag">&lt;/<span class="name">mainClass</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">id</span>&gt;</span>repackage<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">goal</span>&gt;</span>repackage<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure><p>application.yml：</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">druid:</span></span><br><span class="line">      <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">      <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/mp?serverTimezone=UTC</span></span><br><span class="line">      <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">      <span class="attr">password:</span> <span class="number">123456</span></span><br></pre></td></tr></table></figure><p>User实体类：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span> <span class="comment">//生成getter和setter方法</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span> <span class="comment">// 生成无参构造函数</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span> <span class="comment">// 生成有参构造函数</span></span><br><span class="line"><span class="meta">@TableName(&quot;tb_user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String userName;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String age;</span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>UserMapper接口：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;User&gt; &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>单元测试：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserMapperTest</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserMapper userMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">findAll</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(userMapper.selectList(<span class="literal">null</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>运行成功！</p></div><div class="story post-story"><h2 id="9-代码生成器"><a href="#9-代码生成器" class="headerlink" title="9.代码生成器"></a>9.代码生成器</h2><p>创建Springboot项目：</p><p>添加下面的依赖：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-generator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.freemarker<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>freemarker<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.31<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>创建一个测试类：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FastAutoGeneratorTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        FastAutoGenerator.create(<span class="string">&quot;jdbc:mysql://localhost:3306/mp?serverTimezone=UTC&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;root&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;123456&quot;</span>)</span><br><span class="line">                .globalConfig(builder -&gt; &#123;</span><br><span class="line">                    builder.author(<span class="string">&quot;baomidou&quot;</span>) <span class="comment">// 设置作者</span></span><br><span class="line">                            <span class="comment">//.enableSwagger() // 开启 swagger 模式</span></span><br><span class="line">                            .fileOverride() <span class="comment">// 覆盖已生成文件</span></span><br><span class="line">                            .outputDir(<span class="string">&quot;E:\\Java_Web\\Mybatis-p\\mp_04_generator\\src\\main\\java&quot;</span>); <span class="comment">// 指定输出目录</span></span><br><span class="line">                &#125;)</span><br><span class="line">                .packageConfig(builder -&gt; &#123;</span><br><span class="line">                    builder.parent(<span class="string">&quot;com&quot;</span>) <span class="comment">// 设置父包名</span></span><br><span class="line">                            .moduleName(<span class="string">&quot;mybatisp&quot;</span>) <span class="comment">// 设置父包模块名</span></span><br><span class="line">                            .pathInfo(Collections.singletonMap(OutputFile.xml, </span><br><span class="line">                                    <span class="string">&quot;E:\\Java_Web\\Mybatis-p\\mp_04_generator\\src\\main\\resources\\mapper&quot;</span>)); <span class="comment">// 设置mapperXml生成路径</span></span><br><span class="line">                &#125;)</span><br><span class="line">                .strategyConfig(builder -&gt; &#123;</span><br><span class="line">                    builder.addInclude(<span class="string">&quot;tb_user&quot;</span>) <span class="comment">// 设置需要生成的表名</span></span><br><span class="line">                            .addTablePrefix(<span class="string">&quot;tb_&quot;</span>, <span class="string">&quot;c_&quot;</span>); <span class="comment">// 设置过滤表前缀</span></span><br><span class="line">                &#125;)</span><br><span class="line">                .templateEngine(<span class="keyword">new</span> <span class="title class_">FreemarkerTemplateEngine</span>()) <span class="comment">// 使用Freemarker引擎模板，默认的是Velocity引擎模板</span></span><br><span class="line">                .execute();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>控制台打印：</p><blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">08:57:51.095 [main] DEBUG com.baomidou.mybatisplus.generator.AutoGenerator - ==========================准备生成文件...==========================</span><br><span class="line">08:57:51.521 [main] DEBUG com.baomidou.mybatisplus.generator.config.querys.MySqlQuery - 执行SQL:show table status WHERE 1=1  AND NAME IN (&#x27;tb_user&#x27;)</span><br><span class="line">08:57:51.538 [main] DEBUG com.baomidou.mybatisplus.generator.config.querys.MySqlQuery - 返回记录数:1,耗时(ms):16</span><br><span class="line">08:57:51.550 [main] DEBUG com.baomidou.mybatisplus.generator.config.querys.MySqlQuery - 执行SQL:show full fields from `tb_user`</span><br><span class="line">08:57:51.559 [main] DEBUG com.baomidou.mybatisplus.generator.config.querys.MySqlQuery - 返回记录数:6,耗时(ms):9</span><br><span class="line">08:57:51.652 [main] DEBUG com.baomidou.mybatisplus.generator.AutoGenerator - ==========================文件生成完成！！！==========================</span><br></pre></td></tr></table></figure></blockquote><p>以下为生成的文件：</p><img src="C:\Users\26919\AppData\Roaming\Typora\typora-user-images\image-20220715090110049.png" class="lazyload" data-srcset="C:\Users\26919\AppData\Roaming\Typora\typora-user-images\image-20220715090110049.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220715090110049" style="zoom:67%;" /></div>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>MongoDB的学习笔记</title>
      <link href="/2022/08/06/Java/MongoDB/"/>
      <url>/2022/08/06/Java/MongoDB/</url>
      
        <content type="html"><![CDATA[<p>未完待续</p><div class="story post-story"><h2 id="1-MongoDB相关概念"><a href="#1-MongoDB相关概念" class="headerlink" title="1.MongoDB相关概念"></a>1.MongoDB相关概念</h2><p>业务场景</p><p>传统的关系型数据库(如：MySQL)，在数据操作的“三高”需求以及应对Web2.0网站需求面前，显得力不从心。</p><p>“三高”需求：</p><blockquote><ul><li>High performance：对数据库高并发读写的需求</li><li>Huge Storage：对海量数据的高效率存储和访问的需求。</li><li>High Scalability &amp;&amp; High Availability：对数据库的高可扩展性和高可用性的需求。</li></ul></blockquote><p>而MongoDB可应对”三高”需求，貝体的应用场景如：</p><blockquote><ol><li>社交场景：使用MongoDB 存储存储用户信息，以及用户发表的朋友圖信息，通过地理位置素引1实现附近的<br>人、地点等功能。</li><li>游戏场景：使用 MongoDB 存储游戏用户信息，用户的装备、积分等直接以内嵌文档的形式存储，方便查询<br>高效率存储和访问。</li><li>物流场员：使用 MongoDB 存储订单信息，订单状态在运送过程中会不断更新，以MongODB 内嵌数组的开式来存储，一次查询就能将订单所有的变更读取出来。</li><li>物联网场景：使用MongoDB 存储所有接入的智能设备信息，以及设备汇报的日志信息，并对这些信息进行多<br>维度的分析。</li><li>视频直播：使用 MongoDB 存储用户信息、点赞互动信息等。</li></ol></blockquote><p>这些应用场景，对数据操作方面的共同特点是：</p><blockquote><ol><li>数据量大</li><li>写入操作频繁(读写很频繁)</li><li>价值较低的数据，对事务性要求不高(缺点)</li></ol><p>对于这样的数据，我们更适合使用MongoDB来实现数据的存储</p></blockquote><p>何时选择MongoDB？</p><p>在架构选型上，除了上述的三个特点外，如果你还犹豫是否要选择它？可以考忠以下的一些问题：</p><blockquote><ul><li><p>应用不需要車务及复杂 ioin 支持</p></li><li><p>新应用，需求会变，数据模型无法确定，想快速迭代开发</p></li><li><p>应用需要2000-3000以上的读写OPS（更高也可以）</p></li><li><p>应用需要TB甚至 PB级别数据存储</p></li><li><p>应用发展迅速，需要能快速水平扩展</p></li><li><p>应用要求存储的数据不天失</p></li><li><p>应用需要99.999%高可用</p></li><li><p>应用需要大量的地理位置查询、文本查询</p></li></ul><p>如果上述有1个符合，可以考虑MongoDB， 2个及以上的符合，选择MongoDB 绝不会后悔。</p></blockquote><p>数据库：articledb</p><p>专栏文章评论(表)：comment</p><table><thead><tr><th>字段名称</th><th>字段含义</th><th>字段类型</th><th>备注</th></tr></thead><tbody><tr><td>_id</td><td>ID</td><td>ObjectId或String</td><td>Mongo的主键的字段</td></tr><tr><td>articleid</td><td>文章ID</td><td>String</td><td></td></tr><tr><td>content</td><td>评论内容</td><td>String</td><td></td></tr><tr><td>userid</td><td>评论人ID</td><td>String</td><td></td></tr><tr><td>nickname</td><td>评论人昵称</td><td>String</td><td></td></tr><tr><td>createdatetime</td><td>评论的日期时间</td><td>Date</td><td></td></tr><tr><td>likenum</td><td>点赞数</td><td>Int32</td><td></td></tr><tr><td>replynum</td><td>回复数</td><td>Int32</td><td></td></tr><tr><td>state</td><td>状态</td><td>String</td><td>0：不可见<br/>1：可见</td></tr><tr><td>parentid</td><td>上级ID</td><td>String</td><td>如果为0表示文章的顶级评论</td></tr></tbody></table></div><div class="story post-story"><h2 id="2-MongoDB的相关命令"><a href="#2-MongoDB的相关命令" class="headerlink" title="2.MongoDB的相关命令"></a>2.MongoDB的相关命令</h2><h3 id="2-1-数据库的创建与删除"><a href="#2-1-数据库的创建与删除" class="headerlink" title="2.1 数据库的创建与删除"></a>2.1 数据库的创建与删除</h3><table><thead><tr><th align="center">命令</th><th>解释</th><th>例子</th></tr></thead><tbody><tr><td align="center">use <code>数据库名</code></td><td>选择数据库，如果不存在则创建</td><td>use articledb</td></tr><tr><td align="center">show dbs或<br>show databases</td><td>查看所有数据库</td><td></td></tr><tr><td align="center">db</td><td>查看当前正在使用的数据库</td><td></td></tr><tr><td align="center">db.dropDatabase()</td><td>删除当前正在的使用的数据库</td><td></td></tr><tr><td align="center">db.createCollection(<code>name</code>)<br><code>name</code>: 要创建的集合名称</td><td>显示创建集合(了解)</td><td>db.createCollection(“mycollection”)</td></tr><tr><td align="center">show collections或<br>show tables</td><td>查看当前数据库中的表</td><td></td></tr><tr><td align="center">db.<code>集合</code>.drop()</td><td>删除当前正在的使用的数据库中的集合</td><td>db.mycollection.drop()</td></tr></tbody></table><p>文档(document)的数据结构与JSON基本一致，所有存储在集合中的数据都是BSON格式</p><h3 id="2-2-文档的插入"><a href="#2-2-文档的插入" class="headerlink" title="2.2 文档的插入"></a>2.2 文档的插入</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">db.collection.insert(</span><br><span class="line">&lt;document or array of documents&gt;<span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">writeConcern<span class="punctuation">:</span> &lt;document&gt;<span class="punctuation">,</span></span><br><span class="line">ordered<span class="punctuation">:</span> &lt;boolean&gt;</span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><p><strong>单个文档插入</strong>：</p><p>使用insert()或save()方法插入：</p><blockquote><p>db.<code>collection</code>.insert(<code>document</code>)</p></blockquote><p>示例：</p><p>向comment集合中插入一条数据：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">db.comment.insert(<span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;articleid&quot;</span><span class="punctuation">:</span><span class="string">&quot;100000&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;content&quot;</span><span class="punctuation">:</span><span class="string">&quot;今天天气真好，阳光明媚&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;userid&quot;</span><span class="punctuation">:</span><span class="string">&quot;1001&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;nickname&quot;</span><span class="punctuation">:</span><span class="string">&quot;Tom&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;createdatetime&quot;</span><span class="punctuation">:</span>new Date()<span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;likenum&quot;</span><span class="punctuation">:</span>NumberInt(<span class="number">10</span>)<span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;state&quot;</span><span class="punctuation">:</span><span class="keyword">null</span><span class="punctuation">&#125;</span>)</span><br></pre></td></tr></table></figure><blockquote><ol><li>comment集合如果不存在，则会隐式创建 。</li><li>mongo中的数字，默认情况下是double类型，如果要存整型，必须使用函数NumberInt(整型数字)，否则取出来就有问题了。</li><li>插入当前日期使用 new Date()</li><li>插入的数据没有指定 _id ，会自动生成主键值</li><li>如果某字段没值，可以赋值为null，或不写该字段。</li></ol></blockquote><p>如果出现：<code>WriteResult(&#123; &quot;nInserted&quot; : 1 &#125;)</code>，说明插入成功。</p><p><strong>多条文档插入</strong>：</p><blockquote><p>db.comment.insertMany([<code>document1</code>,<code>document2</code>,…])</p></blockquote><p>示例：</p><p>向comment集合中插入多条数据：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">db.comment.insertMany(<span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span><span class="attr">&quot;_id&quot;</span><span class="punctuation">:</span><span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">     <span class="attr">&quot;articleid&quot;</span><span class="punctuation">:</span><span class="string">&quot;100001&quot;</span><span class="punctuation">,</span></span><br><span class="line">     <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span><span class="string">&quot;我们不应该把清晨浪费在手机上，健康很重要，一杯温水幸福你我他。&quot;</span><span class="punctuation">,</span></span><br><span class="line">     <span class="attr">&quot;userid&quot;</span><span class="punctuation">:</span><span class="string">&quot;1002&quot;</span><span class="punctuation">,</span></span><br><span class="line">     <span class="attr">&quot;nickname&quot;</span><span class="punctuation">:</span><span class="string">&quot;相忘于江湖&quot;</span><span class="punctuation">,</span></span><br><span class="line">     <span class="attr">&quot;createdatetime&quot;</span><span class="punctuation">:</span>new Date(<span class="string">&quot;2019-08-05T22:08:15.522Z&quot;</span>)<span class="punctuation">,</span></span><br><span class="line">     <span class="attr">&quot;likenum&quot;</span><span class="punctuation">:</span>NumberInt(<span class="number">1000</span>)<span class="punctuation">,</span></span><br><span class="line">     <span class="attr">&quot;state&quot;</span><span class="punctuation">:</span><span class="string">&quot;1&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span><span class="attr">&quot;_id&quot;</span><span class="punctuation">:</span><span class="string">&quot;2&quot;</span><span class="punctuation">,</span></span><br><span class="line">     <span class="attr">&quot;articleid&quot;</span><span class="punctuation">:</span><span class="string">&quot;100001&quot;</span><span class="punctuation">,</span></span><br><span class="line">     <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span><span class="string">&quot;我夏天空腹喝凉开水，冬天喝温开水&quot;</span><span class="punctuation">,</span></span><br><span class="line">     <span class="attr">&quot;userid&quot;</span><span class="punctuation">:</span><span class="string">&quot;1005&quot;</span><span class="punctuation">,</span></span><br><span class="line">     <span class="attr">&quot;nickname&quot;</span><span class="punctuation">:</span><span class="string">&quot;伊人憔悴&quot;</span><span class="punctuation">,</span></span><br><span class="line">     <span class="attr">&quot;createdatetime&quot;</span><span class="punctuation">:</span>new Date(<span class="string">&quot;2019-08-05T23:58:51.485Z&quot;</span>)<span class="punctuation">,</span></span><br><span class="line">     <span class="attr">&quot;likenum&quot;</span><span class="punctuation">:</span>NumberInt(<span class="number">888</span>)<span class="punctuation">,</span></span><br><span class="line">     <span class="attr">&quot;state&quot;</span><span class="punctuation">:</span><span class="string">&quot;1&quot;</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">]</span>)</span><br></pre></td></tr></table></figure><blockquote><p>插入时指定了 _id ，则主键就是该值。 </p><p>如果某条数据插入失败，将会终止插入，但已经插入成功的数据不会回滚掉。 </p></blockquote><p>批量插入由于数据较多容易出现失败，因此，可以使用try catch进行异常捕捉处理，测试的时候可以不处理。如（了解）：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">try <span class="punctuation">&#123;</span></span><br><span class="line">db.comment.insertMany(<span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span><span class="attr">&quot;_id&quot;</span><span class="punctuation">:</span><span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">     <span class="attr">&quot;articleid&quot;</span><span class="punctuation">:</span><span class="string">&quot;100001&quot;</span><span class="punctuation">,</span></span><br><span class="line">     <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span><span class="string">&quot;我们不应该把清晨浪费在手机上，健康很重要，一杯温水幸福你我他。&quot;</span><span class="punctuation">,</span></span><br><span class="line">     <span class="attr">&quot;userid&quot;</span><span class="punctuation">:</span><span class="string">&quot;1002&quot;</span><span class="punctuation">,</span></span><br><span class="line">     <span class="attr">&quot;nickname&quot;</span><span class="punctuation">:</span><span class="string">&quot;相忘于江湖&quot;</span><span class="punctuation">,</span></span><br><span class="line">     <span class="attr">&quot;createdatetime&quot;</span><span class="punctuation">:</span>new Date(<span class="string">&quot;2019-08-05T22:08:15.522Z&quot;</span>)<span class="punctuation">,</span></span><br><span class="line">     <span class="attr">&quot;likenum&quot;</span><span class="punctuation">:</span>NumberInt(<span class="number">1000</span>)<span class="punctuation">,</span></span><br><span class="line">     <span class="attr">&quot;state&quot;</span><span class="punctuation">:</span><span class="string">&quot;1&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span><span class="attr">&quot;_id&quot;</span><span class="punctuation">:</span><span class="string">&quot;2&quot;</span><span class="punctuation">,</span></span><br><span class="line">     <span class="attr">&quot;articleid&quot;</span><span class="punctuation">:</span><span class="string">&quot;100001&quot;</span><span class="punctuation">,</span></span><br><span class="line">     <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span><span class="string">&quot;我夏天空腹喝凉开水，冬天喝温开水&quot;</span><span class="punctuation">,</span></span><br><span class="line">     <span class="attr">&quot;userid&quot;</span><span class="punctuation">:</span><span class="string">&quot;1005&quot;</span><span class="punctuation">,</span></span><br><span class="line">     <span class="attr">&quot;nickname&quot;</span><span class="punctuation">:</span><span class="string">&quot;伊人憔悴&quot;</span><span class="punctuation">,</span></span><br><span class="line">     <span class="attr">&quot;createdatetime&quot;</span><span class="punctuation">:</span>new Date(<span class="string">&quot;2019-08-05T23:58:51.485Z&quot;</span>)<span class="punctuation">,</span></span><br><span class="line">     <span class="attr">&quot;likenum&quot;</span><span class="punctuation">:</span>NumberInt(<span class="number">888</span>)<span class="punctuation">,</span></span><br><span class="line">     <span class="attr">&quot;state&quot;</span><span class="punctuation">:</span><span class="string">&quot;1&quot;</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">]</span>)</span><br><span class="line"><span class="punctuation">&#125;</span> catch (e) <span class="punctuation">&#123;</span></span><br><span class="line">print (e);</span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="2-3-文档的查询"><a href="#2-3-文档的查询" class="headerlink" title="2.3 文档的查询"></a>2.3 文档的查询</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.collection.find(&lt;query&gt;<span class="punctuation">,</span> <span class="punctuation">[</span>projection<span class="punctuation">]</span>)</span><br></pre></td></tr></table></figure><p><strong>查询所有</strong>：</p><p>查询comment集合的所有文档</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">db.comment.find() 或 </span><br><span class="line">db.comment.find(<span class="punctuation">&#123;</span><span class="punctuation">&#125;</span>)</span><br></pre></td></tr></table></figure><p><strong>条件查询</strong>：</p><p>查询询userid为1003的记录</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.comment.find(<span class="punctuation">&#123;</span>userid<span class="punctuation">:</span>&#x27;<span class="number">1003</span>&#x27;<span class="punctuation">&#125;</span>)</span><br></pre></td></tr></table></figure><p>如果只需要返回第一条数据</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.comment.findOne(<span class="punctuation">&#123;</span>userid<span class="punctuation">:</span>&#x27;<span class="number">1003</span>&#x27;<span class="punctuation">&#125;</span>)</span><br></pre></td></tr></table></figure><p><strong>投影查询</strong>：查询结果返回部分字段</p><p>查询结果显示userid和nickname：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.comment.find(<span class="punctuation">&#123;</span>userid<span class="punctuation">:</span><span class="string">&quot;1003&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span>userid<span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span>nickname<span class="punctuation">:</span><span class="number">1</span><span class="punctuation">&#125;</span>)</span><br></pre></td></tr></table></figure><p>结果：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;4&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;userid&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;1003&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;nickname&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;凯撒&quot;</span> <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;5&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;userid&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;1003&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;nickname&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;凯撒&quot;</span> <span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>默认 _id 会显示。</p><p>查询结果只显示userid和nickname，不显示_id：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.comment.find(<span class="punctuation">&#123;</span>userid<span class="punctuation">:</span><span class="string">&quot;1003&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span>userid<span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span>nickname<span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span>_id<span class="punctuation">:</span><span class="number">0</span><span class="punctuation">&#125;</span>)</span><br></pre></td></tr></table></figure><p>结果：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;userid&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;1003&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;nickname&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;凯撒&quot;</span> <span class="punctuation">&#125;</span> </span><br><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;userid&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;1003&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;nickname&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;凯撒&quot;</span> <span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="2-4-文档的更新"><a href="#2-4-文档的更新" class="headerlink" title="2.4 文档的更新"></a>2.4 文档的更新</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">db.collection.update(query<span class="punctuation">,</span> update<span class="punctuation">,</span> options)</span><br><span class="line">或</span><br><span class="line">db.collection.update(</span><br><span class="line">&lt;query&gt;<span class="punctuation">,</span></span><br><span class="line">&lt;update&gt;<span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">upsert<span class="punctuation">:</span> &lt;boolean&gt;<span class="punctuation">,</span></span><br><span class="line">multi<span class="punctuation">:</span> &lt;boolean&gt;<span class="punctuation">,</span></span><br><span class="line">writeConcern<span class="punctuation">:</span> &lt;document&gt;<span class="punctuation">,</span></span><br><span class="line">collation<span class="punctuation">:</span> &lt;document&gt;<span class="punctuation">,</span></span><br><span class="line">arrayFilters<span class="punctuation">:</span> <span class="punctuation">[</span> &lt;filterdocument1&gt;<span class="punctuation">,</span> ... <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">hint<span class="punctuation">:</span> &lt;document|string&gt; <span class="comment">// Available starting in MongoDB 4.2</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><p><strong>覆盖修改</strong>：</p><p>修改_id为1的记录，点赞量为1001</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.comment.update(<span class="punctuation">&#123;</span>_id<span class="punctuation">:</span><span class="string">&quot;1&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span>likenum<span class="punctuation">:</span>NumberInt(<span class="number">1001</span>)<span class="punctuation">&#125;</span>)</span><br></pre></td></tr></table></figure><p>执行后，这条文档除了<code>likenum</code>字段其它字段都不见了</p><p><strong>局部修改</strong>：们需要使用修改器<code>$set</code>来实现</p><p>修改_id为2的记录，点赞量为889</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.comment.update(<span class="punctuation">&#123;</span>_id<span class="punctuation">:</span><span class="string">&quot;2&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span>$set<span class="punctuation">:</span><span class="punctuation">&#123;</span>likenum<span class="punctuation">:</span>NumberInt(<span class="number">889</span>)<span class="punctuation">&#125;</span><span class="punctuation">&#125;</span>)</span><br></pre></td></tr></table></figure><p><strong>批量修改</strong>：</p><p>更新用户id为<code>1003</code>的用户的昵称为<code>大黄</code> </p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//默认只修改第一条数据</span></span><br><span class="line">db.comment.update(<span class="punctuation">&#123;</span>userid<span class="punctuation">:</span><span class="string">&quot;1003&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span>$set<span class="punctuation">:</span><span class="punctuation">&#123;</span>nickname<span class="punctuation">:</span><span class="string">&quot;大黄&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span>)</span><br><span class="line"><span class="comment">//修改所有符合条件的数据</span></span><br><span class="line">db.comment.update(<span class="punctuation">&#123;</span>userid<span class="punctuation">:</span><span class="string">&quot;1003&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span>$set<span class="punctuation">:</span><span class="punctuation">&#123;</span>nickname<span class="punctuation">:</span><span class="string">&quot;大黄&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span>multi<span class="punctuation">:</span><span class="keyword">true</span><span class="punctuation">&#125;</span>)</span><br></pre></td></tr></table></figure><p>列值增长修改：使用<code>$inc</code>运算符来实现对某列值在原有值的基础上进行增加或减少</p><p>对3号数据的点赞数，每次递增1</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.comment.update(<span class="punctuation">&#123;</span>_id<span class="punctuation">:</span><span class="string">&quot;3&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span>$inc<span class="punctuation">:</span><span class="punctuation">&#123;</span>likenum<span class="punctuation">:</span>NumberInt(<span class="number">1</span>)<span class="punctuation">&#125;</span><span class="punctuation">&#125;</span>)</span><br></pre></td></tr></table></figure><h3 id="2-5-文档的删除"><a href="#2-5-文档的删除" class="headerlink" title="2.5 文档的删除"></a>2.5 文档的删除</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.集合名称.remove(条件)</span><br></pre></td></tr></table></figure><p>将数据全部删除：(谨慎使用)</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.comment.remove(<span class="punctuation">&#123;</span><span class="punctuation">&#125;</span>)</span><br></pre></td></tr></table></figure><p>删除_id&#x3D;1的记录：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.comment.remove(<span class="punctuation">&#123;</span>_id<span class="punctuation">:</span><span class="string">&quot;1&quot;</span><span class="punctuation">&#125;</span>)</span><br></pre></td></tr></table></figure><h3 id="2-6-文档的分页查询"><a href="#2-6-文档的分页查询" class="headerlink" title="2.6 文档的分页查询"></a>2.6 文档的分页查询</h3><p><strong>统计查询</strong>：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.collection.count(query<span class="punctuation">,</span> options)</span><br></pre></td></tr></table></figure><p>统计所有记录数：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.comment.count()</span><br></pre></td></tr></table></figure><p>按条件统计记录数：</p><p>统计userid为1003的记录条数</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.comment.count(<span class="punctuation">&#123;</span>userid<span class="punctuation">:</span><span class="string">&quot;1003&quot;</span><span class="punctuation">&#125;</span>)</span><br></pre></td></tr></table></figure><p> <strong>分页列表查询</strong>：使用<code>limit()</code>方法来读取指定数量的数据，使用<code>skip()</code>方法来跳过指定数量的数据。</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.COLLECTION_NAME.find().limit(NUMBER).skip(NUMBER)</span><br></pre></td></tr></table></figure><p>返回指定条数的记录，可以在find方法后调用limit来返回结果(TopN)，默认值20</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.comment.find().limit(<span class="number">3</span>)</span><br></pre></td></tr></table></figure><p>skip方法同样接受一个数字参数作为跳过的记录条数。（前N个不要）,默认值是0</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.comment.find().skip(<span class="number">3</span>)</span><br></pre></td></tr></table></figure><p><strong>分页查询</strong>：需求：每页2个，第二页开始：跳过前两条数据，接着值显示3和4条数据</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//第一页</span></span><br><span class="line">db.comment.find().skip(<span class="number">0</span>).limit(<span class="number">2</span>)</span><br><span class="line"><span class="comment">//第二页</span></span><br><span class="line">db.comment.find().skip(<span class="number">2</span>).limit(<span class="number">2</span>)</span><br><span class="line"><span class="comment">//第三页</span></span><br><span class="line">db.comment.find().skip(<span class="number">4</span>).limit(<span class="number">2</span>)</span><br></pre></td></tr></table></figure><p><strong>排序查询</strong>：</p><p><code>sort()</code> 方法对数据进行排序，<code>sort()</code> 方法可以通过参数指定排序的字段，</p><p>并使用 <code>1</code> 和 <code>-1</code> 来指定排序的方式，其中 1 为升序排列，而 -1 是用 于降序排列。</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">db.COLLECTION_NAME.find().sort(<span class="punctuation">&#123;</span>KEY<span class="punctuation">:</span><span class="number">1</span><span class="punctuation">&#125;</span>)</span><br><span class="line">或</span><br><span class="line">db.集合名称.find().sort(排序方式)</span><br></pre></td></tr></table></figure><p>对userid降序排列，并对访问量进行升序排列</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.comment.find().sort(<span class="punctuation">&#123;</span>userid<span class="punctuation">:</span><span class="number">-1</span><span class="punctuation">,</span>likenum<span class="punctuation">:</span><span class="number">1</span><span class="punctuation">&#125;</span>)</span><br></pre></td></tr></table></figure><blockquote><p><code>skip()</code>, <code>limilt()</code>, <code>sort()</code>三个放在一起执行的时候，</p><p>执行的顺序：<code>sort()</code>&#x3D;&gt;<code>skip()</code>&#x3D;&gt;<code>limit()</code>，和命令编写顺序无关</p></blockquote><h3 id="2-7-文档的更多查询"><a href="#2-7-文档的更多查询" class="headerlink" title="2.7 文档的更多查询"></a>2.7 文档的更多查询</h3><p><strong>正则的复杂条件查询</strong>：</p><p>正则表达式是<code>js</code>的语法，直接量的写法。</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">db.collection.find(<span class="punctuation">&#123;</span>field<span class="punctuation">:</span>/正则表达式/<span class="punctuation">&#125;</span>)</span><br><span class="line">或</span><br><span class="line">db.集合.find(<span class="punctuation">&#123;</span>字段<span class="punctuation">:</span>/正则表达式/<span class="punctuation">&#125;</span>)</span><br></pre></td></tr></table></figure><p>查询评论内容包含“开水”的所有文档</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.comment.find(<span class="punctuation">&#123;</span>content<span class="punctuation">:</span>/开水/<span class="punctuation">&#125;</span>)</span><br></pre></td></tr></table></figure><p>查询评论的内容中以“专家”开头的</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.comment.find(<span class="punctuation">&#123;</span>content<span class="punctuation">:</span>/^专家/<span class="punctuation">&#125;</span>)</span><br></pre></td></tr></table></figure><p><strong>比较查询</strong>：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">db.集合名称.find(<span class="punctuation">&#123;</span> <span class="attr">&quot;field&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span> $gt<span class="punctuation">:</span> value <span class="punctuation">&#125;</span><span class="punctuation">&#125;</span>) <span class="comment">// 大于: field &gt; value</span></span><br><span class="line">db.集合名称.find(<span class="punctuation">&#123;</span> <span class="attr">&quot;field&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span> $lt<span class="punctuation">:</span> value <span class="punctuation">&#125;</span><span class="punctuation">&#125;</span>) <span class="comment">// 小于: field &lt; value</span></span><br><span class="line">db.集合名称.find(<span class="punctuation">&#123;</span> <span class="attr">&quot;field&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span> $gte<span class="punctuation">:</span> value <span class="punctuation">&#125;</span><span class="punctuation">&#125;</span>) <span class="comment">// 大于等于: field &gt;= value</span></span><br><span class="line">db.集合名称.find(<span class="punctuation">&#123;</span> <span class="attr">&quot;field&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span> $lte<span class="punctuation">:</span> value <span class="punctuation">&#125;</span><span class="punctuation">&#125;</span>) <span class="comment">// 小于等于: field &lt;= value</span></span><br><span class="line">db.集合名称.find(<span class="punctuation">&#123;</span> <span class="attr">&quot;field&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span> $ne<span class="punctuation">:</span> value <span class="punctuation">&#125;</span><span class="punctuation">&#125;</span>) <span class="comment">// 不等于: field != value、</span></span><br></pre></td></tr></table></figure><p>查询评论点赞数量大于700的记录</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.comment.find(<span class="punctuation">&#123;</span>likenum<span class="punctuation">:</span><span class="punctuation">&#123;</span>$gt<span class="punctuation">:</span>NumberInt(<span class="number">700</span>)<span class="punctuation">&#125;</span><span class="punctuation">&#125;</span>)</span><br></pre></td></tr></table></figure><p><strong>包含查询</strong>：包含使用<code>$in</code>操作符，不包含使用<code>$nin</code>操作符</p><p>查询评论集合中<code>userid</code>字段包含1003或1004的文档</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.comment.find(<span class="punctuation">&#123;</span>userid<span class="punctuation">:</span><span class="punctuation">&#123;</span>$in<span class="punctuation">:</span><span class="punctuation">[</span><span class="string">&quot;1003&quot;</span><span class="punctuation">,</span><span class="string">&quot;1004&quot;</span><span class="punctuation">]</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span>)</span><br></pre></td></tr></table></figure><p>查询评论集合中<code>userid</code>字段不包含1003和1004的文档</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.comment.find(<span class="punctuation">&#123;</span>userid<span class="punctuation">:</span><span class="punctuation">&#123;</span>$nin<span class="punctuation">:</span><span class="punctuation">[</span><span class="string">&quot;1003&quot;</span><span class="punctuation">,</span><span class="string">&quot;1004&quot;</span><span class="punctuation">]</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span>)</span><br></pre></td></tr></table></figure><p><strong>条件连接查询</strong>：</p><p>查询同时满足两个以上条件，需要使用<code>$and</code>操作符将条件进行关联</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$and<span class="punctuation">:</span><span class="punctuation">[</span> <span class="punctuation">&#123;</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span> <span class="punctuation">&#125;</span> <span class="punctuation">]</span></span><br></pre></td></tr></table></figure><p>查询评论集合中<code>likenum</code>大于等于700 并且小于2000的文档</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.comment.find(<span class="punctuation">&#123;</span>$and<span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">&#123;</span>likenum<span class="punctuation">:</span><span class="punctuation">&#123;</span>$gte<span class="punctuation">:</span>NumberInt(<span class="number">700</span>)<span class="punctuation">&#125;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span>likenum<span class="punctuation">:</span><span class="punctuation">&#123;</span>$lt<span class="punctuation">:</span>NumberInt(<span class="number">2000</span>)<span class="punctuation">&#125;</span><span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">&#125;</span>)</span><br></pre></td></tr></table></figure><p>两个以上条件之间是或者的关系，我们使用 <code>$or</code> 操作符进行关联</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$or<span class="punctuation">:</span><span class="punctuation">[</span> <span class="punctuation">&#123;</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span> <span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span> <span class="punctuation">&#125;</span> <span class="punctuation">]</span></span><br></pre></td></tr></table></figure><p>查询评论集合中<code>userid</code>为1003，或者点赞数小于1000的文档记录</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.comment.find(<span class="punctuation">&#123;</span>$or<span class="punctuation">:</span><span class="punctuation">[</span> <span class="punctuation">&#123;</span>userid<span class="punctuation">:</span><span class="string">&quot;1003&quot;</span><span class="punctuation">&#125;</span> <span class="punctuation">,</span><span class="punctuation">&#123;</span>likenum<span class="punctuation">:</span><span class="punctuation">&#123;</span>$lt<span class="punctuation">:</span><span class="number">1000</span><span class="punctuation">&#125;</span> <span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">&#125;</span>)</span><br></pre></td></tr></table></figure><h3 id="2-8-常用命令小结"><a href="#2-8-常用命令小结" class="headerlink" title="2.8 常用命令小结*"></a>2.8 常用命令小结*</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//选择切换数据库：</span></span><br><span class="line">use articledb</span><br><span class="line"><span class="comment">//插入数据：</span></span><br><span class="line">db.comment.insert(<span class="punctuation">&#123;</span>bson数据<span class="punctuation">&#125;</span>)</span><br><span class="line"><span class="comment">//查询所有数据：</span></span><br><span class="line">db.comment.find();</span><br><span class="line"><span class="comment">//条件查询数据：</span></span><br><span class="line">db.comment.find(<span class="punctuation">&#123;</span>条件<span class="punctuation">&#125;</span>)</span><br><span class="line"><span class="comment">//查询符合条件的第一条记录：</span></span><br><span class="line">db.comment.findOne(<span class="punctuation">&#123;</span>条件<span class="punctuation">&#125;</span>)</span><br><span class="line"><span class="comment">//查询符合条件的前几条记录：</span></span><br><span class="line">db.comment.find(<span class="punctuation">&#123;</span>条件<span class="punctuation">&#125;</span>).limit(条数)</span><br><span class="line"><span class="comment">//查询符合条件的跳过的记录：</span></span><br><span class="line">db.comment.find(<span class="punctuation">&#123;</span>条件<span class="punctuation">&#125;</span>).skip(条数)</span><br><span class="line"><span class="comment">//修改数据：</span></span><br><span class="line">db.comment.update(<span class="punctuation">&#123;</span>条件<span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span>修改后的数据<span class="punctuation">&#125;</span>) </span><br><span class="line">或</span><br><span class="line">db.comment.update(<span class="punctuation">&#123;</span>条件<span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span>$set<span class="punctuation">:</span><span class="punctuation">&#123;</span>要修改部分的字段<span class="punctuation">:</span>数据<span class="punctuation">&#125;</span>)</span><br><span class="line"><span class="comment">//修改数据并自增某字段值：</span></span><br><span class="line">db.comment.update(<span class="punctuation">&#123;</span>条件<span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span>$inc<span class="punctuation">:</span><span class="punctuation">&#123;</span>自增的字段<span class="punctuation">:</span>步进值<span class="punctuation">&#125;</span><span class="punctuation">&#125;</span>)</span><br><span class="line"><span class="comment">//删除数据：</span></span><br><span class="line">db.comment.remove(<span class="punctuation">&#123;</span>条件<span class="punctuation">&#125;</span>)</span><br><span class="line"><span class="comment">//统计查询：</span></span><br><span class="line">db.comment.count(<span class="punctuation">&#123;</span>条件<span class="punctuation">&#125;</span>)</span><br><span class="line"><span class="comment">//模糊查询：</span></span><br><span class="line">db.comment.find(<span class="punctuation">&#123;</span>字段名<span class="punctuation">:</span>/正则表达式/<span class="punctuation">&#125;</span>)</span><br><span class="line"><span class="comment">//条件比较运算：</span></span><br><span class="line">db.comment.find(<span class="punctuation">&#123;</span>字段名<span class="punctuation">:</span><span class="punctuation">&#123;</span>$gt<span class="punctuation">:</span>值<span class="punctuation">&#125;</span><span class="punctuation">&#125;</span>)</span><br><span class="line"><span class="comment">//包含查询：</span></span><br><span class="line">db.comment.find(<span class="punctuation">&#123;</span>字段名<span class="punctuation">:</span><span class="punctuation">&#123;</span>$in<span class="punctuation">:</span><span class="punctuation">[</span>值<span class="number">1</span>，值<span class="number">2</span><span class="punctuation">]</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span>)或db.comment.find(<span class="punctuation">&#123;</span>字段名<span class="punctuation">:</span><span class="punctuation">&#123;</span>$nin<span class="punctuation">:</span><span class="punctuation">[</span>值<span class="number">1</span>，值<span class="number">2</span><span class="punctuation">]</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span>)</span><br><span class="line"><span class="comment">//条件连接查询：</span></span><br><span class="line">db.comment.find(<span class="punctuation">&#123;</span>$and<span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">&#123;</span>条件<span class="number">1</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span>条件<span class="number">2</span><span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">&#125;</span>)或db.comment.find(<span class="punctuation">&#123;</span>$or<span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">&#123;</span>条件<span class="number">1</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span>条件<span class="number">2</span><span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">&#125;</span>)</span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="3-索引"><a href="#3-索引" class="headerlink" title="3.索引"></a>3.索引</h2><p>索引支持在MongoDB中高效地执行查询。</p><p>如果没有索引，MongoDB必须执行全集合扫描，即扫描集合中的每个文档，以选择与查询语句匹配的文档。</p><p>这种扫描全集合的查询效率是非常低的，特别在处理大量的数据时，查询可以要花费几十秒甚至几分钟，这对网站的性能是非常致命的。</p><p>索引是特殊的数据结构，它以易于遍历的形式存储集合数据集的一小部分。</p><p>索引存储特定字段或一组字段的值，按字段值排序。</p><p>索引项的排序支持有效的相等匹配和基于范围的查询操作。</p><p>此外，MongoDB还可以使用索引中的排序返回排序结果。</p><p>MongoDB索引使用B树数据结构（确切的说是B-Tree，MySQL是B+Tree）</p><h3 id="3-1-索引的类型"><a href="#3-1-索引的类型" class="headerlink" title="3.1 索引的类型"></a>3.1 索引的类型</h3><p><strong>单字段索引</strong>：</p><p>MongoDB支持在文档的单个字段上创建用户定义的升序&#x2F;降序索引，称为单字段索引(Single Field Index)</p><p>对于单个字段索引和排序操作，索引键的排序顺序(即升序或降序)并不重要，因为MongoDB可以在任何方向上遍历索引</p><p><strong>复合索引</strong>：</p><p>MongoDB还支持多个字段的用户定义索引，即复合索引(Compound Index)</p><p>复合索引中列出的字段顺序具有重要意义。</p><p>例如，如果复合索引由 { userid: 1, score: -1 } 组成，则索引首先按userid正序排序，然后 在每个userid的值内，再在按score倒序排序。</p><p><strong>其他索引</strong>：</p><p>地理空间索引(Geospatial Index)、文本索引(Text Indexes)、哈希索引(Hashed Indexes)。 </p><ul><li><p>地理空间索引(Geospatial Index)：</p><p>为了支持对地理空间坐标数据的有效查询，MongoDB提供了两种特殊的索引：返回结果时使用平面几何的二维索引和返回结果时使用球面 几何的二维球面索引。 </p></li><li><p>文本索引(Text Indexes)：</p><p>MongoDB提供了一种文本索引类型，支持在集合中搜索字符串内容。这些文本索引不存储特定于语言的停止词（例如“the”、“a”、“or”）， 而将集合中的词作为词干，只存储根词。 </p></li><li><p>哈希索引(Hashed Indexes)：</p><p>为了支持基于散列的分片，MongoDB提供了散列索引类型，它对字段值的散列进行索引。这些索引在其范围内的值分布更加随机，但只支 持相等匹配，不支持基于范围的查询。</p></li></ul><h3 id="3-2-索引的管理操作"><a href="#3-2-索引的管理操作" class="headerlink" title="3.2 索引的管理操作"></a>3.2 索引的管理操作</h3><p><strong>索引的查看</strong>：返回一个集合中的所有索引的数组</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.collection.getIndexes() <span class="comment">//该语法命令运行要求是MongoDB 3.0+</span></span><br></pre></td></tr></table></figure><p>例：查看comment集合中所有的索引情况</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.comment.getIndexes()</span><br></pre></td></tr></table></figure><p>结果：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">[</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;v&quot;</span> <span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;key&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="number">1</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;name&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;_id_&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;ns&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;articledb.comment&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">]</span></span><br></pre></td></tr></table></figure><p>默认<code>_id</code>索引：</p><p>MongoDB在创建集合的过程中，在 <code>_id</code> 字段上创建一个唯一的索引，默认名字为 <code>_id_</code> ，该索引可防止客户端插入两个具有相同值的文 档，不能在<code>_id</code>字段上删除此索引。 </p><p>注意：该索引是唯一索引，因此值不能重复，即 <code>_id</code> 值不能重复的。在分片集群中，通常使用 <code>_id</code> 作为片键。</p><p><strong>索引的创建</strong>：在集合上创建索引</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.collection.createIndex(keys<span class="punctuation">,</span> options)</span><br></pre></td></tr></table></figure><p>在3.0.0版本前创建索引方法为<code>db.collection.ensureIndex()</code>，之后的版本使用了 <code>db.collection.createIndex()</code>方法，<code>ensureIndex()</code>还能用，但只是<code>createIndex()</code>的别名</p><p>单字段索引示例：对 userid 字段建立索引</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.comment.createIndex(<span class="punctuation">&#123;</span>userid<span class="punctuation">:</span><span class="number">1</span><span class="punctuation">&#125;</span>)</span><br></pre></td></tr></table></figure><p>结果：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;createdCollectionAutomatically&quot;</span> <span class="punctuation">:</span> <span class="keyword">false</span><span class="punctuation">,</span> <span class="comment">//按升序创建索引</span></span><br><span class="line"><span class="attr">&quot;numIndexesBefore&quot;</span> <span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;numIndexesAfter&quot;</span> <span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;ok&quot;</span> <span class="punctuation">:</span> <span class="number">1</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>查看索引：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.comment.getIndexes()</span><br></pre></td></tr></table></figure><p>结果：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">[</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;v&quot;</span> <span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;key&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="number">1</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;name&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;_id_&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;ns&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;articledb.comment&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;v&quot;</span> <span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;key&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;userid&quot;</span> <span class="punctuation">:</span> <span class="number">1</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;name&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;userid_1&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;ns&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;articledb.comment&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">]</span></span><br></pre></td></tr></table></figure><p><strong>索引的移除</strong>：可以移除指定的索引，或移除所有索引</p><p>指定索引的移除：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.collection.dropIndex(index)</span><br></pre></td></tr></table></figure><p>例：删除 <code>comment</code> 集合中 <code>userid</code> 字段上的升序索引</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.comment.dropIndex(<span class="punctuation">&#123;</span>userid<span class="punctuation">:</span><span class="number">1</span><span class="punctuation">&#125;</span>)</span><br></pre></td></tr></table></figure><p>所有索引的移除：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.collection.dropIndexes()</span><br></pre></td></tr></table></figure><p>例：删除集合中所有索引</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.comment.dropIndexes() <span class="comment">//_id的字段的索引是无法删除的，只能删除非_id字段的索引</span></span><br></pre></td></tr></table></figure><p>结果：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;nIndexesWas&quot;</span> <span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;msg&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;non-_id indexes dropped for collection&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;ok&quot;</span> <span class="punctuation">:</span> <span class="number">1</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="3-3-索引的使用"><a href="#3-3-索引的使用" class="headerlink" title="3.3 索引的使用"></a>3.3 索引的使用</h3><p><strong>执行计划</strong>：</p><p>分析查询性能（Analyze Query Performance）通常使用执行计划（解释计划、Explain Plan）来查看查询的情况，如：查询耗费的时间、是 否基于索引查询等。 </p><p>建立的索引是否有效，效果如何，都需要通过执行计划查看：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.collection.find(query<span class="punctuation">,</span>options).explain(options)</span><br></pre></td></tr></table></figure><p>例：查看根据<code>userid</code>查询数据的情况</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.comment.find(<span class="punctuation">&#123;</span>userid<span class="punctuation">:</span><span class="string">&quot;1003&quot;</span><span class="punctuation">&#125;</span>).explain()</span><br></pre></td></tr></table></figure><p>结果：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;queryPlanner&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;plannerVersion&quot;</span> <span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;namespace&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;articledb.comment&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;indexFilterSet&quot;</span> <span class="punctuation">:</span> <span class="keyword">false</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;parsedQuery&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;userid&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;$eq&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;1003&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;winningPlan&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;stage&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;COLLSCAN&quot;</span><span class="punctuation">,</span> <span class="comment">//表示全集合扫描</span></span><br><span class="line"><span class="attr">&quot;filter&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;userid&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;$eq&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;1003&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;direction&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;forward&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;rejectedPlans&quot;</span> <span class="punctuation">:</span> <span class="punctuation">[</span> <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;serverInfo&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;host&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;9ef3740277ad&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;port&quot;</span> <span class="punctuation">:</span> <span class="number">27017</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;version&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;4.0.10&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;gitVersion&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;c389e7f69f637f7a1ac3cc9fae843b635f20b766&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;ok&quot;</span> <span class="punctuation">:</span> <span class="number">1</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>例：对<code>userid</code>建立索引</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.comment.createIndex(<span class="punctuation">&#123;</span>userid<span class="punctuation">:</span><span class="number">1</span><span class="punctuation">&#125;</span>)</span><br></pre></td></tr></table></figure><p>结果：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;createdCollectionAutomatically&quot;</span> <span class="punctuation">:</span> <span class="keyword">false</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;numIndexesBefore&quot;</span> <span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;numIndexesAfter&quot;</span> <span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;ok&quot;</span> <span class="punctuation">:</span> <span class="number">1</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>再次查看执行计划：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.comment.find(<span class="punctuation">&#123;</span>userid<span class="punctuation">:</span><span class="string">&quot;1013&quot;</span><span class="punctuation">&#125;</span>).explain()</span><br></pre></td></tr></table></figure><p>结果·：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;queryPlanner&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;plannerVersion&quot;</span> <span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;namespace&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;articledb.comment&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;indexFilterSet&quot;</span> <span class="punctuation">:</span> <span class="keyword">false</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;parsedQuery&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;userid&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;$eq&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;1013&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;winningPlan&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;stage&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;FETCH&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;inputStage&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;stage&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;IXSCAN&quot;</span><span class="punctuation">,</span> <span class="comment">//基于索引的扫描</span></span><br><span class="line"><span class="attr">&quot;keyPattern&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;userid&quot;</span> <span class="punctuation">:</span> <span class="number">1</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;indexName&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;userid_1&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;isMultiKey&quot;</span> <span class="punctuation">:</span> <span class="keyword">false</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;multiKeyPaths&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;userid&quot;</span> <span class="punctuation">:</span> <span class="punctuation">[</span> <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;isUnique&quot;</span> <span class="punctuation">:</span> <span class="keyword">false</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;isSparse&quot;</span> <span class="punctuation">:</span> <span class="keyword">false</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;isPartial&quot;</span> <span class="punctuation">:</span> <span class="keyword">false</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;indexVersion&quot;</span> <span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;direction&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;forward&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;indexBounds&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;userid&quot;</span> <span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line"><span class="string">&quot;[\&quot;1013\&quot;, \&quot;1013\&quot;]&quot;</span></span><br><span class="line"><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;rejectedPlans&quot;</span> <span class="punctuation">:</span> <span class="punctuation">[</span> <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;serverInfo&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;host&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;9ef3740277ad&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;port&quot;</span> <span class="punctuation">:</span> <span class="number">27017</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;version&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;4.0.10&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;gitVersion&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;c389e7f69f637f7a1ac3cc9fae843b635f20b766&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;ok&quot;</span> <span class="punctuation">:</span> <span class="number">1</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p><strong>涵盖的查询</strong>：</p><p>当查询条件和查询的投影仅包含索引字段时，MongoDB直接从索引返回结果，而不扫描任何文档或将文档带入内存。 这些覆盖的查询可以非常有效</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.comment.find(<span class="punctuation">&#123;</span>userid<span class="punctuation">:</span><span class="string">&quot;1003&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span>userid<span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span>_id<span class="punctuation">:</span><span class="number">0</span><span class="punctuation">&#125;</span>)</span><br></pre></td></tr></table></figure><p>结果：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;userid&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;1003&quot;</span> <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;userid&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;1003&quot;</span> <span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.comment.find(<span class="punctuation">&#123;</span>userid<span class="punctuation">:</span><span class="string">&quot;1003&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span>userid<span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span>_id<span class="punctuation">:</span><span class="number">0</span><span class="punctuation">&#125;</span>).explain()</span><br></pre></td></tr></table></figure><p>结果：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;queryPlanner&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;plannerVersion&quot;</span> <span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;namespace&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;articledb.comment&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;indexFilterSet&quot;</span> <span class="punctuation">:</span> <span class="keyword">false</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;parsedQuery&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;userid&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;$eq&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;1003&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;winningPlan&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;stage&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;PROJECTION&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;transformBy&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;userid&quot;</span> <span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;inputStage&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;stage&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;IXSCAN&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;keyPattern&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;userid&quot;</span> <span class="punctuation">:</span> <span class="number">1</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;indexName&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;userid_1&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;isMultiKey&quot;</span> <span class="punctuation">:</span> <span class="keyword">false</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;multiKeyPaths&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;userid&quot;</span> <span class="punctuation">:</span> <span class="punctuation">[</span> <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;isUnique&quot;</span> <span class="punctuation">:</span> <span class="keyword">false</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;isSparse&quot;</span> <span class="punctuation">:</span> <span class="keyword">false</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;isPartial&quot;</span> <span class="punctuation">:</span> <span class="keyword">false</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;indexVersion&quot;</span> <span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;direction&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;forward&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;indexBounds&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;userid&quot;</span> <span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line"><span class="string">&quot;[\&quot;1003\&quot;, \&quot;1003\&quot;]&quot;</span></span><br><span class="line"><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;rejectedPlans&quot;</span> <span class="punctuation">:</span> <span class="punctuation">[</span> <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;serverInfo&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;host&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;bobohost.localdomain&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;port&quot;</span> <span class="punctuation">:</span> <span class="number">27017</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;version&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;4.0.10&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;gitVersion&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;c389e7f69f637f7a1ac3cc9fae843b635f20b766&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;ok&quot;</span> <span class="punctuation">:</span> <span class="number">1</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="4-文章评论"><a href="#4-文章评论" class="headerlink" title="4.文章评论"></a>4.文章评论</h2><h3 id="4-1-案例分析"><a href="#4-1-案例分析" class="headerlink" title="4.1 案例分析"></a>4.1 案例分析</h3><p>案例：实现某头条的文章评论</p><p>需要实现一下功能：</p><blockquote><ol><li>基本的增删改查API</li><li>根据文章id查询评论</li><li>评论点赞</li></ol></blockquote><p>数据库：articledb</p><p>专栏文章评论(表)：comment</p><table><thead><tr><th>字段名称</th><th>字段含义</th><th>字段类型</th><th>备注</th></tr></thead><tbody><tr><td>_id</td><td>ID</td><td>ObjectId或String</td><td>Mongo的主键的字段</td></tr><tr><td>articleid</td><td>文章ID</td><td>String</td><td></td></tr><tr><td>content</td><td>评论内容</td><td>String</td><td></td></tr><tr><td>userid</td><td>评论人ID</td><td>String</td><td></td></tr><tr><td>nickname</td><td>评论人昵称</td><td>String</td><td></td></tr><tr><td>createdatetime</td><td>评论的日期时间</td><td>Date</td><td></td></tr><tr><td>likenum</td><td>点赞数</td><td>Int32</td><td></td></tr><tr><td>replynum</td><td>回复数</td><td>Int32</td><td></td></tr><tr><td>state</td><td>状态</td><td>String</td><td>0：不可见<br/>1：可见</td></tr><tr><td>parentid</td><td>上级ID</td><td>String</td><td>如果为0表示文章的顶级评论</td></tr></tbody></table><p>技术选型：</p><blockquote><ul><li><p>mongodb-driver(了解)</p><p>mongodb-driver是mongo官方推出的java连接mongoDB的驱动包，相当于JDBC驱动</p></li><li><p>SpringDataMongoDB</p><p>SpringData家族成员之一，用于操作MongoDB的持久层框架，封装了底层的mongodb-driver。</p></li></ul></blockquote><p>项目结构：</p><img src="https://s2.loli.net/2022/07/25/b3wpiTWvNY9aGn4.png" class="lazyload" data-srcset="https://s2.loli.net/2022/07/25/b3wpiTWvNY9aGn4.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20220725105709041" style="zoom: 67%;" /><h3 id="4-2-文章微服务模块搭建"><a href="#4-2-文章微服务模块搭建" class="headerlink" title="4.2 文章微服务模块搭建"></a>4.2 文章微服务模块搭建</h3><p>导入坐标：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-mongodb<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aliyun-rds-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.junit.vintage<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit-vintage-engine<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><p>在<code>application.yml</code>中：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="comment">#数据源配置</span></span><br><span class="line">  <span class="attr">data:</span></span><br><span class="line">    <span class="attr">mongodb:</span></span><br><span class="line">      <span class="attr">host:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> <span class="comment">#默认主机地址</span></span><br><span class="line">      <span class="attr">database:</span> <span class="string">articledb</span></span><br><span class="line">      <span class="attr">port:</span> <span class="number">27017</span> <span class="comment">#默认端口27017</span></span><br><span class="line">      <span class="comment">#也可以使用uri连接</span></span><br><span class="line">      <span class="comment">#uri: mongodb://localhost:27017/articledb</span></span><br></pre></td></tr></table></figure><h3 id="4-3-文章评论基本的CRUD"><a href="#4-3-文章评论基本的CRUD" class="headerlink" title="4.3 文章评论基本的CRUD"></a>4.3 文章评论基本的CRUD</h3><p><code>Comment</code>实体类中：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">把一个java类声明为mongodb的文档，可以通过collection参数指定这个类对应的文档。</span></span><br><span class="line"><span class="comment">@Document(collection=&quot;mongodb 对应 collection 名&quot;)</span></span><br><span class="line"><span class="comment">    若未加 @Document ，该 bean save 到 mongo 的 comment collection</span></span><br><span class="line"><span class="comment">    若添加 @Document ，则 save 到 comment collection</span></span><br><span class="line"><span class="comment">复合索引</span></span><br><span class="line"><span class="comment">@CompoundIndex( def = &quot;&#123;&#x27;userid&#x27;: 1, &#x27;nickname&#x27;: -1&#125;&quot;)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Document(collection=&quot;comment&quot;)</span><span class="comment">//可以省略，如果省略，则默认使用类名小写映射集合</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Comment</span> &#123;</span><br><span class="line">    <span class="meta">@Id</span> <span class="comment">//主键标识，该属性的值会自动对应mongodb的主键字段&quot;_id&quot;，如果该属性名就叫“id”,则该注解可以省略，否则必须写</span></span><br><span class="line">    <span class="keyword">private</span> String id;<span class="comment">//主键</span></span><br><span class="line">    <span class="meta">@Field(&quot;content&quot;)</span>     <span class="comment">//该属性对应mongodb的字段的名字，如果一致，则无需该注解</span></span><br><span class="line">    <span class="keyword">private</span> String content;<span class="comment">//吐槽内容</span></span><br><span class="line">    <span class="keyword">private</span> Date publishtime;<span class="comment">//发布日期</span></span><br><span class="line">    <span class="meta">@Indexed</span> <span class="comment">//添加了一个单字段的索引</span></span><br><span class="line">    <span class="keyword">private</span> String userid;<span class="comment">//发布人ID</span></span><br><span class="line">    <span class="keyword">private</span> String nickname;<span class="comment">//昵称</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime createdatetime;<span class="comment">//评论的日期时间</span></span><br><span class="line">    <span class="keyword">private</span> Integer likenum;<span class="comment">//点赞数</span></span><br><span class="line">    <span class="keyword">private</span> Integer replynum;<span class="comment">//回复数</span></span><br><span class="line">    <span class="keyword">private</span> String state;<span class="comment">//状态</span></span><br><span class="line">    <span class="keyword">private</span> String parentid;<span class="comment">//上级ID</span></span><br><span class="line">    <span class="keyword">private</span> String articleid;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>CommentRepository</code>中：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">CommentRepository</span> <span class="keyword">extends</span> <span class="title class_">MongoRepository</span>&lt;Comment,String&gt; &#123;</span><br><span class="line">    Page&lt;Comment&gt; <span class="title function_">findByParentid</span><span class="params">(String parentid, Pageable pageable)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>CommentService</code>中：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">CommentService</span> &#123;</span><br><span class="line">    <span class="comment">//保存一个评论</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">saveComment</span><span class="params">(Comment comment)</span>;</span><br><span class="line">    <span class="comment">//更新评论</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">updateComment</span><span class="params">(Comment comment)</span>;</span><br><span class="line">    <span class="comment">//根据id删除评论</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">deleteCommentById</span><span class="params">(String id)</span>;</span><br><span class="line">    <span class="comment">//查询所有评论</span></span><br><span class="line">    List&lt;Comment&gt; <span class="title function_">findCommentList</span><span class="params">()</span>;</span><br><span class="line">    <span class="comment">//根据id查询评论</span></span><br><span class="line">    Comment <span class="title function_">findCommentById</span><span class="params">(String id)</span>;</span><br><span class="line">    <span class="comment">//根据父id，查询子评论的分页列表</span></span><br><span class="line">    Page&lt;Comment&gt; <span class="title function_">findCommentListPageByParentid</span><span class="params">(String parentid, <span class="type">int</span> page, <span class="type">int</span> size)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>CommentServiceImpl</code>中：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CommentServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">CommentService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> CommentRepository commentRepository;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveComment</span><span class="params">(Comment comment)</span> &#123;</span><br><span class="line">        commentRepository.save(comment);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateComment</span><span class="params">(Comment comment)</span> &#123;</span><br><span class="line">        commentRepository.save(comment);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteCommentById</span><span class="params">(String id)</span> &#123;</span><br><span class="line">        commentRepository.deleteById(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Comment&gt; <span class="title function_">findCommentList</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> commentRepository.findAll();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Comment <span class="title function_">findCommentById</span><span class="params">(String id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> commentRepository.findById(id).get();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Page&lt;Comment&gt; <span class="title function_">findCommentListPageByParentid</span><span class="params">(String parentid, <span class="type">int</span> page, <span class="type">int</span> size)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> commentRepository.findByParentid(parentid, PageRequest.of(page-<span class="number">1</span>,size));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>测试：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CommentServiceTest</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> CommentService commentService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testSave</span><span class="params">()</span> &#123;</span><br><span class="line">        Comment comment=<span class="keyword">new</span> <span class="title class_">Comment</span>();</span><br><span class="line">        comment.setArticleid(<span class="string">&quot;100001&quot;</span>);</span><br><span class="line">        comment.setContent(<span class="string">&quot;不要吃我&quot;</span>);</span><br><span class="line">        comment.setCreatedatetime(LocalDateTime.now());</span><br><span class="line">        comment.setUserid(<span class="string">&quot;1004&quot;</span>);</span><br><span class="line">        comment.setNickname(<span class="string">&quot;Jerry&quot;</span>);</span><br><span class="line">        comment.setState(<span class="string">&quot;1&quot;</span>);</span><br><span class="line">        comment.setParentid(<span class="string">&quot;62ddfe4c2f8d0c6ca75ba67f&quot;</span>); <span class="comment">//父评论id</span></span><br><span class="line">        comment.setLikenum(<span class="number">0</span>);</span><br><span class="line">        comment.setReplynum(<span class="number">0</span>);</span><br><span class="line">        commentService.saveComment(comment);</span><br><span class="line"></span><br><span class="line">        commentService.saveComment(comment);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testFindById</span><span class="params">()</span> &#123;<span class="comment">//id查找</span></span><br><span class="line">        System.out.println(commentService.findCommentById(<span class="string">&quot;62ddfe4c2f8d0c6ca75ba67f&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testDeleteById</span><span class="params">()</span> &#123;<span class="comment">//删除</span></span><br><span class="line">        commentService.deleteCommentById(<span class="string">&quot;666&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testFindAll</span><span class="params">()</span> &#123;<span class="comment">//查找所有</span></span><br><span class="line">        System.out.println(commentService.findCommentList());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testUpdate</span><span class="params">()</span> &#123; <span class="comment">//更新</span></span><br><span class="line">        <span class="type">Comment</span> <span class="variable">comment</span> <span class="operator">=</span> commentService.findCommentById(<span class="string">&quot;62ddfe4c2f8d0c6ca75ba67f&quot;</span>);</span><br><span class="line">        comment.setLikenum(<span class="number">666</span>);</span><br><span class="line"></span><br><span class="line">        commentService.updateComment(comment);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testFindCommentListByParentid</span><span class="params">()</span> &#123; <span class="comment">//分页查找</span></span><br><span class="line">        Page&lt;Comment&gt; commentPage = commentService.findCommentListPageByParentid(<span class="string">&quot;62ddfe4c2f8d0c6ca75ba67f&quot;</span>, <span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;----总记录数：&quot;</span>+commentPage.getTotalElements());</span><br><span class="line">        System.out.println(<span class="string">&quot;----当前页数据：&quot;</span>+commentPage.getContent());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-4-MongoTemplate实现评论点赞"><a href="#4-4-MongoTemplate实现评论点赞" class="headerlink" title="4.4 MongoTemplate实现评论点赞"></a>4.4 MongoTemplate实现评论点赞</h3><p>以下为点赞的临时示例代码：</p><p> <code>CommentService</code> 新增<code>updateThumbup</code>方法</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateCommentThumbupToIncrementingOld</span><span class="params">(String id)</span>&#123;</span><br><span class="line"><span class="type">Comment</span> <span class="variable">comment</span> <span class="operator">=</span> CommentRepository.findById(id).get();</span><br><span class="line">comment.setLikenum(comment.getLikenum()+<span class="number">1</span>);</span><br><span class="line">CommentRepository.save(comment);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>以上方法虽然实现起来比较简单，但是执行效率并不高</p><p>我只需要将点赞数加1就可以了，没必要查询出所有字段修改后再更新所有字段。</p></blockquote><p>可以使用MongoTemplate类来实现对某列的操作。</p><p>在<code>CommentService</code>声明一个<code>updateCommentLikenum</code>方法：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">CommentService</span> &#123;</span><br><span class="line">    <span class="comment">//点赞数+1</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">updateCommentLikenum</span><span class="params">(String id)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>CommentServiceImpl</code>中实现<code>updateCommentLikenum</code>方法：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> MongoTemplate mongoTemplate;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateCommentLikenum</span><span class="params">(String id)</span>&#123;</span><br><span class="line">    <span class="comment">//查询对象</span></span><br><span class="line">    <span class="type">Query</span> <span class="variable">query</span> <span class="operator">=</span> Query.query(Criteria.where(<span class="string">&quot;_id&quot;</span>).is(id));</span><br><span class="line">    <span class="comment">//更新对象</span></span><br><span class="line">    <span class="type">Update</span> <span class="variable">update</span> <span class="operator">=</span><span class="keyword">new</span> <span class="title class_">Update</span>();</span><br><span class="line">    <span class="comment">//局部更新，相当于$set update.set(key,value)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//递增$inc  update.inc(&quot;likenum&quot;,1) 默认增加1</span></span><br><span class="line">    update.inc(<span class="string">&quot;likenum&quot;</span>);</span><br><span class="line">    <span class="comment">//参数1：查询对象 参数2：更新对象 参数3：集合的名字或实体类的类型Comment.class</span></span><br><span class="line">    mongoTemplate.updateFirst(query,update,<span class="string">&quot;comment&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>测试：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testUpdateLikenum</span><span class="params">()</span> &#123; <span class="comment">//点赞加1</span></span><br><span class="line">    commentService.updateCommentLikenum(<span class="string">&quot;62ddfe4c2f8d0c6ca75ba67f&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> 数据库 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/06/Java/ELK%E6%90%9C%E7%B4%A2/"/>
      <url>/2022/08/06/Java/ELK%E6%90%9C%E7%B4%A2/</url>
      
        <content type="html"><![CDATA[<hr><hr><div class="story post-story"><h2 id="1-ELK简介"><a href="#1-ELK简介" class="headerlink" title="1.ELK简介"></a>1.ELK简介</h2><p><a href="https://www.elastic.co/cn/">ELK</a>是包含但不限于<code>Elasticsearch(简称ES)</code>、<code>Logstash</code>、<code>Kibana</code>三个开源软件的组成的一个整体，这三个软件合成ELK。</p><p>本课程从分别对三个组件经行详细介绍：</p><blockquote><ul><li><p>Elasticsearch：因为它是elk的核心。本课程从es底层对文档、索引、 搜索、聚合、集群经行介绍，从搜索和聚合分析实例来展现es的魅力。</p></li><li><p>Logstash：从内部如何采集数据到指定地方来展现它数据采集的功能。</p></li><li><p>Kibana：从数据绘图展现数据可视化的功能。</p></li></ul></blockquote></div><div class="story post-story"><h2 id="2-Elastic-Stack概念"><a href="#2-Elastic-Stack概念" class="headerlink" title="2.Elastic Stack概念"></a>2.Elastic Stack概念</h2><p>随着ELK的发展，又有新成员Beats、elastic cloud的加入，所以就形成了Elastic Stack。 所以说，ELK是旧的称呼，Elastic Stack是新的名字</p><h3 id="2-1-Elastic-Stack特色"><a href="#2-1-Elastic-Stack特色" class="headerlink" title="2.1 Elastic Stack特色"></a>2.1 Elastic Stack特色</h3><blockquote><ul><li>处理方式灵活：Elasticsearch是目前最流行的准实时全文检索引擎，具有高速检索大数据的能力</li><li>配置简单：安装ELK的每个组件，仅需配置每个组件的一个配置文件即可，修改处不多，因为大量参数已经默认配在系统中，修改想要修改的选项即可</li><li>接口简单：采用json形式RESTFUL APl接受数据并响应，无关语言</li><li>性能高效：Elasticsearch基于优秀的全文搜索技术<strong>Lucene</strong>，采用倒排索引，可以轻易地在百亿级别数据下，搜索出想要的内容，并且是秒级响应</li><li>灵活扩展：Elasticsearch和Logstash都可以根据集群规模线性拓展，Elasticsearch内部自动实现集群协作</li><li>数据展现华丽：Kibana作为前端展现工具，图表华丽，配置简单</li></ul></blockquote><h3 id="2-2-Elastic-Stack组件"><a href="#2-2-Elastic-Stack组件" class="headerlink" title="2.2 Elastic Stack组件"></a>2.2 Elastic Stack组件</h3><ul><li><p><strong>Elasticsearch</strong>：</p><p>Elasticsearch 是使用java开发，基于Lucene分布式、通过Restful方式进行交互的近实时搜泰平台框架。它的特点有：分布式，零配置，自动发现，索引自动分片，索引副本机制，restful风格接口，多数据源，自动搜索负载等。</p></li><li><p><strong>Logstash</strong>：</p><p>Logstash 基于java开发，是一个数据抽取转化工具。一般工作方式为C&#x2F;S架构，client端安装在需要收集信息的主机上，server端负责将收到的各节点日志进行过滤、 修改等操作在一并发往Elasticsearch或其他组件去。</p></li><li><p><strong>Kibana</strong>：</p><p>Kibana 基于nodejs，也是一个开源和免费的可视化工具，Kibana可以为Logstash和Elasticsearch 提供的日志分析友好的web界面，可以汇总、分析和搜索重要数据日志。</p></li><li><p><strong>Beats</strong>：</p><p>Beats平台集合了多种单一用途数据采集器。它们从成百上千或成千上万台机器和系统向Logstash或Elasticsearch发送数据。</p><p>Beats由如下组成：</p><ul><li><p><strong>Packetbeat</strong>：</p><p><strong>轻量型网络数据采集器</strong>，用于深挖网线上传输的数据，了解应用程序动态。Packetbeat 是一款轻量型网络数据包分析器，能够多将数据发送至Logstash 或 Elasticsearch。其支持ICMP (V4 and v6)、DNS、HTTP、MySQL、PostgreSQL、Redis、MongoDB、Memcache等协议。</p></li><li><p><strong>Filebeat</strong>：</p><p><strong>轻量型日志采集器</strong>， 当您要面对成百上千其至成千上万的的服务器、虚拟机和容器生成的志时，请告别 SSH 吧。Filebeat 将为您提供一种轻量型方法，用于转发和汇总日志与文件，让简单的事情不再繁杂。</p></li><li><p><strong>Metricbeat</strong>：</p><p><strong>轻量型指标采集器</strong>。Metricbeat 能够多以一种轻量型的方式输送各种系统和服务统计数据，从CPU到内存，从 Redis 到Nginx，不一而足。可定期获取外部系统的监控指标信息，其可以监控、收集 Apache、http、HAProxy、MongoDB、MySQL、Nginx、PostgreSQL、Redis、System、Zookeeper等服务。</p></li><li><p><strong>Winlogbeat</strong>：</p><p><strong>轻量型 Windows 事件日志采集器</strong>。用于密切监控基于Windows 的基础设施上发生的事件。Winlogbeat 能够多以一种轻量型的方式，将Windows 事件日志实时地流式传输至 Elasticsearch 和 Logstash。</p></li><li><p><strong>Auditbeat</strong>：</p><p><strong>轻量型申计日志采集器</strong>。收集您 Linux 审计框架的数据，监控文件完整性。Auditbeat 实时采集这些事件，然后发送到 Elastic Stack 其他部分做进一步分析。</p></li><li><p><strong>Heartbeat</strong>：</p><p><strong>面向运行状态监测的轻量型采集器</strong>。通过主动探测来监测服务的可用性。通过给定 URL列表，Heartbeat 仅仅询问：<code>网站运行正常吗？</code>Heartbeat 会将此信息和响应时间发送至 Elastic 的其他部分，以进行进一步分析。</p></li></ul></li><li><p><strong>Elastic cloud</strong>：</p><p>基于 Elasticsearch 的软件即服务(SaaS)解决方案。通过 Elastic 的官方合作伙伴使用托管的 Elasticsearch 服务。</p></li></ul></div><div class="story post-story"><h2 id="3-Elasticsearch概念"><a href="#3-Elasticsearch概念" class="headerlink" title="3.Elasticsearch概念"></a>3.Elasticsearch概念</h2><h3 id="3-1-搜索是什么"><a href="#3-1-搜索是什么" class="headerlink" title="3.1 搜索是什么"></a>3.1 搜索是什么</h3><p>概念：用户输入想要的关键词，返回含有该关键词的所有信息</p><p>场景：</p><ul><li>互联网搜索：谷歌、百度</li><li>站内搜索(垂直搜索)：搜索商品(淘宝、京东)</li></ul><h3 id="3-2-数据库搜索"><a href="#3-2-数据库搜索" class="headerlink" title="3.2 数据库搜索"></a>3.2 数据库搜索</h3><p><strong>站内搜索</strong>(垂直搜索)：</p><blockquote><ul><li><p>数据量小、简单搜索，可以使用数据库</p></li><li><p>存在问题：</p><ul><li>存储问题。电商网站商品上亿条时，涉及到单表数据过大必须拆分表，数据磁盘占用过大必须分库(mycat)。</li><li>性能问题：解决上面问题后，查询”笔记本电脑”等关键词时，上亿条数据的商品名字段逐行扫描，性能跟不上。</li><li>不能分词：如搜索<code>&quot;笔记本电脑&quot;</code>，只能搜索完全和关键词一样的数据，那么数据量小时，如果搜索<code>&quot;笔记电脑&quot;</code>，<code>&quot;电脑&quot;</code>数据要不要给用户。</li></ul></li></ul></blockquote><p><strong>互联网搜索</strong>：数据量过大(PB级)，不会使用数据库。</p><h3 id="3-3-全文检索"><a href="#3-3-全文检索" class="headerlink" title="3.3 全文检索"></a>3.3 全文检索</h3><p><strong>倒排索引</strong>：</p><blockquote><ul><li><p>数据存储时 ，经行分词建立term索引库。</p></li><li><p>倒排索引：源于实际应用中需要根据属性的值来查找记录。这种索引表中的每项都包括一个属性值和具有该属性值的各记录的地址。由于不是由记录来确定属性值，而是由属性值来确定记录的位置，因而称为倒排索引(inverted index)。带有倒排索引的文件我们称为倒排索引文任，简称倒排文任(inverted file)。</p></li></ul></blockquote><p><strong>Lucene</strong>：</p><blockquote><ul><li>就是一个jar包，里面封装了全文检索的引擎、搜索的算法代码。</li><li>开发时，引入Lucene的jar包，通过api开发搜索相关业务。底层会在磁盘建立索引库。</li></ul></blockquote><h3 id="3-4-初识Elasticsearch"><a href="#3-4-初识Elasticsearch" class="headerlink" title="3.4 初识Elasticsearch"></a>3.4 初识Elasticsearch</h3><p><a href="https://www.elastic.co/cn/elasticsearch/">Elasticsearch</a>是一个基于Luncene的搜索服务器，并且是一个分布式、RESTful 风格的搜索和数据分析引擎</p><p><strong>功能介绍</strong>：</p><blockquote><ul><li><p><strong>分布式的搜索引擎和数据分析引擎</strong></p><ul><li>搜索：互联网搜索、电商网站站内搜索、OA系统查询</li><li>数据分析：电商网站查询近—周哪些品类的图书销售前十，新国网站，最近3天阅读量最高的十个关键词，舆情分析</li></ul></li><li><p><strong>全文检索，结构化检索，数据分析</strong></p><ul><li><p>全文检索：</p><p>搜索商品名称包含java的图书</p><p><code>select * from books where book_name like &quot;%java%&quot;</code></p></li><li><p>结构化检索：</p><p>搜索商品分类为spring的图书都有哪些</p><p><code>select * from books where category _id=&#39;spring&#39;</code></p></li><li><p>数据分析：</p><p>分析每一个分类下有多少种图书</p><p><code>select category _id,count(*) from books group by category_id</code></p></li></ul></li><li><p><strong>对海量数据进行近实时的处理</strong></p><ul><li>分布式：ES自动可以将海量数据分散到多台服务器上去存储和检索,经行并行查<br>询，提高搜索效率。相对的，Lucene是单机应用。</li><li>近实时：数据库上亿条数据查询，搜索一次耗时几个小时，是批处理(batch-<br>processing）。而ES只需秒级即可查询海量数据，所以叫近实时，秒级。</li></ul></li></ul></blockquote><p><strong>使用场景</strong>：</p><blockquote><ul><li>维基百科：全文搜索、高亮、搜索推荐</li><li>GitHub：搜索上千行代码</li><li>电商网站：检索商品、搜索推荐</li><li>日志数据分析：Logstash采集日志，ES进行复杂的数据分析，Kibana数据可视化</li><li>百度搜索：第一次查询使用es</li><li>OA、ERP系统站内搜索</li></ul></blockquote><p><strong>特点</strong>：</p><blockquote><ul><li>可拓展性高：</li></ul><p> 大型分布式集群（数百台服务器）技术，处理PB级数据，大公司可以使用。小公司数据量小，也可以部署在单机。大数据领域使用广泛。</p><ul><li>技术整合：</li></ul><p> 将全文检索、数据分析、分布式相关技术整合在一起<code>lucene(全文检索)、商用的数据分析软件(BI软件)、分布式数据库(mycat)</code></p><ul><li>部署简单：</li></ul><p> 开箱即用，很多默认配置不需关心，解压完成直接运行即可，拓展时，只需多部署几个实例即可，负载均衡、分片迁移集群内部自己实施。</p><ul><li>接口简单：</li></ul><p> 使用restful api经行交互，跨语言。</p><ul><li>功能强大：</li></ul><p> Elasticsearch作为传统数据库的一个补充，提供了数据库所不不能提供的很多功能，如全文检索、同义词处理、相关度排名。</p></blockquote><p><strong>Lucene与Elasticsearch的关系</strong>：</p><blockquote><ul><li><p><strong>Luncene</strong>：</p><p>最先进、功能最强大的搜索库，直接基于lucene开发，非常复杂，api复杂</p></li><li><p><strong>Elasticsearch</strong>：</p><p>基于lucene，封装了许多lucene底层功能，提供简单易用的restful api接口和许多语言的客户端，如java的高级客户端(Java High Level REST Client)和底层客户端(Java Low Level REST Client )</p></li></ul></blockquote><h3 id="3-5-Elasticsearch核心概念"><a href="#3-5-Elasticsearch核心概念" class="headerlink" title="3.5 Elasticsearch核心概念"></a>3.5 Elasticsearch核心概念</h3><ol><li><p><strong>NRT(Near Realtime)：进实时</strong></p><ul><li><p>写入数据时，过1秒才会被搜索到，因为内部在分词、录入索引。</p></li><li><p>es搜索时：搜索和分析数据需要秒级出结果。</p></li></ul></li><li><p><strong>Cluster：集群</strong></p><p>包含一个或多个启动着es实例的机器群。通常一台机器起一个es实例。同一网络下，集名一样的多个es实例自动组成集群，自动均衡分片等行为。默认集群名为“elasticsearch”。</p></li><li><p><strong>Node：节点</strong></p><p>每个es实例称为一个节点。节点名自动分配，也可以手动配置。</p></li><li><p><strong>Index：索引</strong></p><p>包含一堆有相似结构的文档数据。</p><p>索引创建规则：</p><ul><li><p>仅限小写字母</p></li><li><p>不能包含<code>\ / * ? &quot; &lt; &gt; | #</code>以及空格符等特殊符号</p></li><li><p>从7.0版本开始不再包含冒号</p></li><li><p>不能以<code>- _ +</code>开头</p></li><li><p>不能超过255个字节（注意它是字节，因此多字节字符将计入255个限制）</p></li></ul></li><li><p><strong>Document：文档</strong></p><p>es中的最小数据单元。一个document就像数据库中的一条记录。通常以json格式显示。多个document存储于一个索引（Index）中。</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">book document</span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;book_id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;book_name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;java编程思想&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;book_desc&quot;</span><span class="punctuation">:</span> <span class="string">&quot;从Java的基础语法到最高级特性（深入的[面向对象](https://baike.baidu.com/item/面向对象)概念、多线程、自动项目构建、单元测试和调试等），本书都能逐步指导你轻松掌握。&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;category_id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;category_name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;java&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></li><li><p><strong>Field：字段</strong></p><p>就像数据库中的列（Columns），定义每个document应该有的字段。</p></li><li><p><strong>Type：类型</strong></p><p>每个索引里都可以有一个或多个type，type是index中的一个逻辑数据分类，一个type下的document，都有相同的field。</p><p><strong>注意</strong>：6.0之前的版本有type（类型）概念，type相当于关系数据库的表，ES官方将在ES9.0版本中彻底删除type。本教程type都为_doc。</p></li><li><p><strong>Shard：分片</strong></p><p>index数据过大时，将index里面的数据，分为多个shard，分布式的存储在各个服务器上面。可以支持海量数据和高并发，提升性能和吞吐量，充分利用多台机器的cpu。</p></li><li><p><strong>Replica：副本</strong></p><p>在分布式环境下，任何一台机器都会随时宕机，如果宕机，index的一个分片没有，导致此index不能搜索。所以，为了保证数据的安全，我们会将每个index的分片经行备份，存储在另外的机器上。保证少数机器宕机es集群仍可以搜索。</p><p>能正常提供查询和插入的分片我们叫做主分片(primary shard)，其余的我们就管他们叫做备份的分片 (replica shard)。</p><p>es6默认新建索引时，5分片，2副本，也就是一主一备，共10个分片。所以，es集群最小规模为两台。</p></li></ol><p><strong>Elasticsearch与数据库比较：</strong></p><table><thead><tr><th align="center">关系型数据库(MySQL)</th><th align="center">非关系型数据库(Elasticsearch)</th></tr></thead><tbody><tr><td align="center">数据库Database</td><td align="center">索引Index</td></tr><tr><td align="center">表Table</td><td align="center">索引Index(原为Type)</td></tr><tr><td align="center">数据行Row</td><td align="center">文档Document</td></tr><tr><td align="center">数据列Column</td><td align="center">字段Field</td></tr><tr><td align="center">约束 Schema</td><td align="center">约束 Schema</td></tr></tbody></table></div><div class="story post-story"><h2 id="4-ES快速入门"><a href="#4-ES快速入门" class="headerlink" title="4.ES快速入门"></a>4.ES快速入门</h2><h3 id="4-1-文档-document-的数据格式"><a href="#4-1-文档-document-的数据格式" class="headerlink" title="4.1 文档(document)的数据格式"></a>4.1 文档(document)的数据格式</h3><ol><li>应用系统的数据结构都是面向对象的，具有复杂的数据结构</li><li>对象存储到数据库，需要将关联的复杂对象属性插到另一张表，查询时再拼接起来。</li><li>ES面向文档，文档中存储的数据结构，与对象一致。所以一个对象可以直接存成一个文档。</li><li>ES的document用<strong>json数据格式</strong>来表达。</li></ol><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;张三&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;last_name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;zhang&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;classInfo&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;className&quot;</span><span class="punctuation">:</span> <span class="string">&quot;三年二班&quot;</span><span class="punctuation">,</span>     </span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="4-2-简单的集群管理"><a href="#4-2-简单的集群管理" class="headerlink" title="4.2 简单的集群管理"></a>4.2 简单的集群管理</h3><p>使用kibana的控制台，浏览器访问：<code>http://主机地址:5601/app/dev_tools#/console</code></p><p><strong>检查集群的健康状况</strong>：</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /_cat/health?v</span><br></pre></td></tr></table></figure><p>响应结果：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">epoch      timestamp cluster        status node.total node.data shards pri relo init unassign pending_tasks max_task_wait_time active_shards_percent</span><br><span class="line">1660972717 05:18:37  docker-cluster green           1         1     11  11    0    0        0             0                  -                100.0%</span><br></pre></td></tr></table></figure><p>健康状况的三种情况：</p><ul><li><p>green：每个索引的primary shard和replica shard都是active状态的</p></li><li><p>yellow：每个索引的primary shard都是active状态的，但是部分replica shard不是active状态，处于不可用的状态</p></li><li><p>red：不是所有索引的primary shard都是active状态的，部分索引有数据丢失了</p></li></ul><p><strong>查看集群中的索引</strong>：</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /_cat/indexes?v</span><br></pre></td></tr></table></figure><p>响应结果：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">health status index                           uuid                   pri rep docs.count docs.deleted store.size pri.store.size</span><br><span class="line">green  open   .geoip_databases                dGx7TrfoTCuOqVS7y6CTRA   1   0         41            0     38.9mb         38.9mb</span><br><span class="line">green  open   .kibana_7.17.5_001              JGFQAr7hRWqaoIfIpo_Liw   1   0        438            2      6.7mb          6.7mb</span><br><span class="line">green  open   .apm-custom-link                f8HqzrG-TWipwqbNoGLQEA   1   0          0            0       226b           226b</span><br><span class="line">green  open   kibana_sample_data_ecommerce    -WV4YJoiTaWtfACqobRV9g   1   0       4675            0      4.2mb          4.2mb</span><br><span class="line">green  open   .apm-agent-configuration        hoLYS7CRRTCooCP3ndNt6Q   1   0          0            0       226b           226b</span><br><span class="line">green  open   .kibana_task_manager_7.17.5_001 lSfnkGiSSzKTvesWhYZgaQ   1   0         17        77315      8.2mb          8.2mb</span><br><span class="line">green  open   .async-search                   _bMoH_6WQkKhHkGAcpl1MA   1   0          0            0       249b           249b</span><br><span class="line">green  open   .tasks                          jBJ9hH7TTn2TXtFwmYDjVw   1   0          6            0       23kb           23kb</span><br></pre></td></tr></table></figure><p><strong>简单的索引操作</strong>：</p><p>创建索引：</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PUT /demo_index</span><br></pre></td></tr></table></figure><p>响应结果：</p><blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;acknowledged&quot;</span> <span class="punctuation">:</span> <span class="keyword">true</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;shards_acknowledged&quot;</span> <span class="punctuation">:</span> <span class="keyword">true</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;index&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;demo_index&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></blockquote><p>删除索引：</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DELETE /demo_index</span><br></pre></td></tr></table></figure><p>响应结果：</p><blockquote><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;acknowledged&quot;</span> <span class="punctuation">:</span> <span class="keyword">true</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></blockquote><h3 id="4-3-案例介绍"><a href="#4-3-案例介绍" class="headerlink" title="4.3 案例介绍"></a>4.3 案例介绍</h3><p>有一个售卖图书的网站，需要为其基于ES构建一个后台系统，提供以下功能：</p><blockquote><ol><li>对商品信息进行CRUD（增删改查）操作</li><li>执行简单的结构化查询</li><li>可以执行简单的全文检索，以及复杂的phrase（短语）检索</li><li>对于全文检索的结果，可以进行高亮显示</li><li>对数据进行简单的聚合分析</li></ol></blockquote><h3 id="4-4-商品的CRUD操作"><a href="#4-4-商品的CRUD操作" class="headerlink" title="4.4 商品的CRUD操作"></a>4.4 商品的CRUD操作</h3><p>document的CRUD操作</p><p>**新建图书索引<code>book</code>**：<code>PUT /index</code></p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PUT /book</span><br></pre></td></tr></table></figure><p>**新增图书(文档)**：<code>PUT /index/type/id</code></p><p>新增图书1：</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">PUT /book/_doc/1</span><br><span class="line">&#123;</span><br><span class="line">&quot;name&quot;: &quot;Bootstrap开发&quot;,</span><br><span class="line">&quot;description&quot;: &quot;Bootstrap是由Twitter推出的一个前台页面开发css框架，是一个非常流行的开发框架，此框架集成了多种页面效果。此开发框架包含了大量的CSS、JS程序代码，可以帮助开发者（尤其是不擅长css页面开发的程序人员）轻松的实现一个css，不受浏览器限制的精美界面css效果。&quot;,</span><br><span class="line">&quot;studymodel&quot;: &quot;201002&quot;,</span><br><span class="line">&quot;price&quot;:38.6,</span><br><span class="line">&quot;timestamp&quot;:&quot;2019-08-25 19:11:35&quot;,</span><br><span class="line">&quot;pic&quot;:&quot;group1/M00/00/00/wKhlQFs6RCeAY0pHAAJx5ZjNDEM428.jpg&quot;,</span><br><span class="line">&quot;tags&quot;: [ &quot;bootstrap&quot;, &quot;dev&quot;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>新增图书1：</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">PUT /book/_doc/2</span><br><span class="line">&#123;</span><br><span class="line">&quot;name&quot;: &quot;java编程思想&quot;,</span><br><span class="line">&quot;description&quot;: &quot;java语言是世界第一编程语言，在软件开发领域使用人数最多。&quot;,</span><br><span class="line">&quot;studymodel&quot;: &quot;201001&quot;,</span><br><span class="line">&quot;price&quot;:68.6,</span><br><span class="line">&quot;timestamp&quot;:&quot;2019-08-25 19:11:35&quot;,</span><br><span class="line">&quot;pic&quot;:&quot;group1/M00/00/00/wKhlQFs6RCeAY0pHAAJx5ZjNDEM428.jpg&quot;,</span><br><span class="line">&quot;tags&quot;: [ &quot;java&quot;, &quot;dev&quot;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>查看所有图书：<code>GET /index/_search</code></p><p>**查询图书(检索文档)**：<code>GET /index/type/id</code></p><p>查看图书1</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /book/_doc/1</span><br></pre></td></tr></table></figure><p>响应结果：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;_index&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;book&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_type&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;_doc&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_version&quot;</span> <span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_seq_no&quot;</span> <span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_primary_term&quot;</span> <span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;found&quot;</span> <span class="punctuation">:</span> <span class="keyword">true</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_source&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;Bootstrap开发&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;description&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;Bootstrap是由Twitter推出的一个前台页面开发css框架，是一个非常流行的开发框架，此框架集成了多种页面效果。此开发框架包含了大量的CSS、JS程序代码，可以帮助开发者（尤其是不擅长css页面开发的程序人员）轻松的实现一个css，不受浏览器限制的精美界面css效果。&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;studymodel&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;201002&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;price&quot;</span> <span class="punctuation">:</span> <span class="number">38.6</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;timestamp&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;2019-08-25 19:11:35&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;pic&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;group1/M00/00/00/wKhlQFs6RCeAY0pHAAJx5ZjNDEM428.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;tags&quot;</span> <span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="string">&quot;bootstrap&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="string">&quot;dev&quot;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p><strong>修改图书</strong>：</p><ul><li>全局替换：</li></ul><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">PUT /book/_doc/1</span><br><span class="line">&#123;</span><br><span class="line">    &quot;name&quot;: &quot;Bootstrap开发教程&quot;,</span><br><span class="line">    &quot;description&quot;: &quot;Bootstrap是由Twitter推出的一个前台页面开发css框架，是一个非常流行的开发框架，此框架集成了多种页面效果。此开发框架包含了大量的CSS、JS程序代码，可以帮助开发者（尤其是不擅长css页面开发的程序人员）轻松的实现一个css，不受浏览器限制的精美界面css效果。&quot;,</span><br><span class="line">    &quot;studymodel&quot;: &quot;201002&quot;,</span><br><span class="line">    &quot;price&quot;:38.6,</span><br><span class="line">    &quot;timestamp&quot;:&quot;2019-08-25 19:11:35&quot;,</span><br><span class="line">    &quot;pic&quot;:&quot;group1/M00/00/00/wKhlQFs6RCeAY0pHAAJx5ZjNDEM428.jpg&quot;,</span><br><span class="line">    &quot;tags&quot;: [ &quot;bootstrap&quot;, &quot;开发&quot;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>替换操作是整体覆盖，要带上所有信息。</p><p>每次执行后，返回结果中版本号<code>_version</code>在不断增加，此过程为全量替换。</p><p>实质：旧文档的内容不会立即删除，只是标记为<code>deleted</code>。适当的时机，集群会将这些文档删除。</p><ul><li><p>局部替换：</p><p><code>POST /index/_update/id</code>或</p><p><code>POST /index/type/id/_update</code></p></li></ul><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">POST /book/_update/1</span><br><span class="line">&#123;</span><br><span class="line">  &quot;doc&quot;: &#123;</span><br><span class="line">   &quot;name&quot;: &quot; Bootstrap开发教程高级&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>内部与全量替换是一样的，旧文档标记为删除，新建一个文档。</p><p>优点：</p><ul><li>大大减少网络传输次数和流量，提升性能</li><li>减少并发冲突发生的概率</li></ul><p>**删除图书(删除文档)**：<code>DELETE /index/type/id</code></p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DELETE /book/_doc/1</span><br></pre></td></tr></table></figure><p>实质：<strong>旧文档的内容不会立即删除</strong>，只是标记为deleted。适当的时机，集群会将这些文档删除。</p></div><div class="story post-story"><h2 id="5-文档document入门"><a href="#5-文档document入门" class="headerlink" title="5.文档document入门"></a>5.文档document入门</h2><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /book/_doc/1</span><br></pre></td></tr></table></figure><p>响应结果：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;_index&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;book&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_type&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;_doc&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_version&quot;</span> <span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_seq_no&quot;</span> <span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_primary_term&quot;</span> <span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;found&quot;</span> <span class="punctuation">:</span> <span class="keyword">true</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_source&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;Bootstrap开发&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;description&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;Bootstrap是由Twitter推出的一个前台页面开发css框架，是一个非常流行的开发框架，此框架集成了多种页面效果。此开发框架包含了大量的CSS、JS程序代码，可以帮助开发者（尤其是不擅长css页面开发的程序人员）轻松的实现一个css，不受浏览器限制的精美界面css效果。&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;studymodel&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;201002&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;price&quot;</span> <span class="punctuation">:</span> <span class="number">38.6</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;timestamp&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;2019-08-25 19:11:35&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;pic&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;group1/M00/00/00/wKhlQFs6RCeAY0pHAAJx5ZjNDEM428.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;tags&quot;</span> <span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="string">&quot;bootstrap&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="string">&quot;dev&quot;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="5-1-字段解析"><a href="#5-1-字段解析" class="headerlink" title="5.1 字段解析"></a>5.1 字段解析</h3><ol><li><p><strong>_index</strong></p><ul><li>含义：此文档属于哪个索引</li><li>原则：类似数据放在一个索引中。数据库中表的定义规则。如图书信息放在book索引中，员工信息放在employee索引中。各个索引存储和搜索时互不影响。</li><li>定义规则：英文小写。尽量不要使用特殊字符。order user</li></ul></li><li><p><strong>_type</strong></p><ul><li>含义：类别。book java node</li><li>注意：以后的es9将彻底删除此字段，所以当前版本在不断弱化type。不需要关注。见到<code>_type</code>都为<code>_doc</code>。</li></ul></li><li><p><strong>_id</strong></p><ul><li>含义：文档的唯一标识。就像表的id主键。结合索引可以标识和定义一个文档。</li><li>生成：手动（put &#x2F;index&#x2F;_doc&#x2F;id）、自动</li></ul></li></ol><h3 id="5-2-自动生成文档id"><a href="#5-2-自动生成文档id" class="headerlink" title="5.2 自动生成文档id"></a>5.2 自动生成文档id</h3><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">POST /book/_doc</span><br><span class="line">&#123;</span><br><span class="line">  &quot;name&quot;:&quot;ELK&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>响应结果：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;_index&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;book&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_type&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;_doc&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;FrnSuoIB-YsVyRxk4XeZ&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_version&quot;</span> <span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;result&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;created&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_shards&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;total&quot;</span> <span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;successful&quot;</span> <span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;failed&quot;</span> <span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_seq_no&quot;</span> <span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_primary_term&quot;</span> <span class="punctuation">:</span> <span class="number">1</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>自动生成的id就为<code>FrnSuoIB-YsVyRxk4XeZ</code></p><p>特点：长度为20个字符，URL安全，base64编码，GUID，分布式生成不冲突 </p><h3 id="5-3-定制返回字段"><a href="#5-3-定制返回字段" class="headerlink" title="5.3 定制返回字段"></a>5.3 定制返回字段</h3><p>就像sql一样不是查询所有<code>select * from book</code>，而是<code>select name, price from book</code></p><p>查询id为1的<strong>书名</strong>以及<strong>价格</strong>：</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET  /book/_doc/1?_source_includes=name,price</span><br></pre></td></tr></table></figure><p>注意：name与price中间只有<code>,</code>不能有空格<code> </code></p><p>响应结果：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;_index&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;book&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_type&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;_doc&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_version&quot;</span> <span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_seq_no&quot;</span> <span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_primary_term&quot;</span> <span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;found&quot;</span> <span class="punctuation">:</span> <span class="keyword">true</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_source&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;price&quot;</span> <span class="punctuation">:</span> <span class="number">38.6</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span> <span class="punctuation">:</span> <span class="string">&quot; Bootstrap开发教程高级&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="5-4-文档的强制替换"><a href="#5-4-文档的强制替换" class="headerlink" title="5.4 文档的强制替换"></a>5.4 文档的强制替换</h3><p>强制创建：<code>PUT /index/ _doc/id/_create</code></p><p><strong>为防止覆盖原有数据</strong>，我们在新增时，设置为强制创建，不会覆盖原有文档。</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">POST /book/_doc/1/_create</span><br><span class="line">&#123;</span><br><span class="line">  &quot;doc&quot;: &#123;</span><br><span class="line">   &quot;name&quot;: &quot; Bootstrap开发教程高级666&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>响应结果：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;error&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;root_cause&quot;</span> <span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;version_conflict_engine_exception&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;reason&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;[1]: version conflict, document already exists (current version [4])&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;index_uuid&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;_GEFBf0rSxG9GxzJtG8w5A&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;shard&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;index&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;book&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;type&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;version_conflict_engine_exception&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;reason&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;[1]: version conflict, document already exists (current version [4])&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;index_uuid&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;_GEFBf0rSxG9GxzJtG8w5A&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;shard&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;index&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;book&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;status&quot;</span> <span class="punctuation">:</span> <span class="number">409</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="5-5-脚本更新"><a href="#5-5-脚本更新" class="headerlink" title="5.5 脚本更新"></a>5.5 脚本更新</h3><p>es可以内置脚本执行复杂操作。例如<strong>painless</strong>脚本。</p><p>注意：groovy脚本在es6以后就不支持了。原因是耗内存，不安全远程注入漏洞。</p><p><strong>内置脚本</strong></p><ul><li><p>需求1：修改文档1的num字段+1。</p><p>插入数据：</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">PUT /test/_doc/1</span><br><span class="line">&#123;</span><br><span class="line">  &quot;num&quot;: 0</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>执行脚本：</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">POST /test/_update/1</span><br><span class="line">&#123;</span><br><span class="line">   &quot;script&quot; : &quot;ctx._source.num+=1&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>查询文档1：</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /test/_doc/1</span><br></pre></td></tr></table></figure><p>响应数据：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;_index&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;test&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_type&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;_doc&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_version&quot;</span> <span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_seq_no&quot;</span> <span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_primary_term&quot;</span> <span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;found&quot;</span> <span class="punctuation">:</span> <span class="keyword">true</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_source&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;num&quot;</span> <span class="punctuation">:</span> <span class="number">1</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></li><li><p>需求2：搜索所有文档，将num字段乘以2输出</p><p>插入数据：</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">PUT /test/_doc/2</span><br><span class="line">&#123;</span><br><span class="line">  &quot;num&quot;: 5</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>查询所有将<code>num x 2</code>：</p><p>注意：<strong>源数据不变</strong>，只是将查询的数据 x 2 </p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">GET /test/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;script_fields&quot;: &#123;</span><br><span class="line">    &quot;my_doubled_field&quot;: &#123;</span><br><span class="line">      &quot;script&quot;: &#123;</span><br><span class="line">       &quot;lang&quot;: &quot;expression&quot;,</span><br><span class="line">        &quot;source&quot;: &quot;doc[&#x27;num&#x27;] * mul&quot;,</span><br><span class="line">        &quot;params&quot;: &#123;</span><br><span class="line">          &quot;mul&quot;: 2</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>响应结果：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;took&quot;</span> <span class="punctuation">:</span> <span class="number">364</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;timed_out&quot;</span> <span class="punctuation">:</span> <span class="keyword">false</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_shards&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;total&quot;</span> <span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;successful&quot;</span> <span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;skipped&quot;</span> <span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;failed&quot;</span> <span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;hits&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;total&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;value&quot;</span> <span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;relation&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;eq&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;max_score&quot;</span> <span class="punctuation">:</span> <span class="number">1.0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;hits&quot;</span> <span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;_index&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;test&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;_type&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;_doc&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;_score&quot;</span> <span class="punctuation">:</span> <span class="number">1.0</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;fields&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;my_doubled_field&quot;</span> <span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">            <span class="number">2.0</span> #由<span class="number">1</span>变成<span class="number">2</span></span><br><span class="line">          <span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;_index&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;test&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;_type&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;_doc&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;2&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;_score&quot;</span> <span class="punctuation">:</span> <span class="number">1.0</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;fields&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;my_doubled_field&quot;</span> <span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">            <span class="number">10.0</span> #由<span class="number">5</span>变成<span class="number">10</span></span><br><span class="line">          <span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></li></ul><p><strong>外部脚本</strong>：</p><p>注意：脚本性能低下，且容易发生注入，本教程忽略</p><p>自行了解：<a href="">官方文档</a></p></div><div class="story post-story"><h2 id="6-ES的并发问题"><a href="#6-ES的并发问题" class="headerlink" title="6.ES的并发问题"></a>6.ES的并发问题</h2><p>如同秒杀，多线程情况下，es同样会出现并发冲突问题。</p><h3 id="6-1-乐观锁与悲观锁"><a href="#6-1-乐观锁与悲观锁" class="headerlink" title="6.1 乐观锁与悲观锁"></a>6.1 乐观锁与悲观锁</h3><p>为控制并发问题，我们通常采用锁机制。</p><p>分为悲观锁和乐观锁两种机制：</p><blockquote><ul><li><p>悲观锁：<strong>很悲观，所有情况都上锁</strong>。此时只有一个线程可以操作数据。具体例子为数据库中的行级锁、表级锁、读锁、写锁等。</p><p>特点：优点是方便，直接加锁，对程序透明。缺点是效率低。</p></li><li><p>乐观锁：<strong>很乐观，对数据本身不加锁</strong>。提交数据时，通过一种机制验证是否存在冲突，如es中通过版本号验证。</p><p>特点：优点是并发能力高。缺点是操作繁琐，在提交数据时，可能反复重试多次。</p></li></ul></blockquote><h3 id="6-2-基于-version乐观锁控制"><a href="#6-2-基于-version乐观锁控制" class="headerlink" title="6.2 基于_version乐观锁控制"></a>6.2 基于_version乐观锁控制</h3></div>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>爬取某易云的免费音乐</title>
      <link href="/2022/08/06/Python/%E7%88%AC%E8%99%AB/%E7%88%AC%E5%8F%96%E6%9F%90%E6%98%93%E4%BA%91%E9%9F%B3%E4%B9%90/"/>
      <url>/2022/08/06/Python/%E7%88%AC%E8%99%AB/%E7%88%AC%E5%8F%96%E6%9F%90%E6%98%93%E4%BA%91%E9%9F%B3%E4%B9%90/</url>
      
        <content type="html"><![CDATA[<p>获取加密的字符串：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> b64encode</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"></span><br><span class="line"><span class="comment"># 前端自定义的字符串常量</span></span><br><span class="line">_g = <span class="string">&quot;0CoJUm6Qyw8W8jud&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 16位随机数</span></span><br><span class="line"><span class="comment"># 必须要自己手动固定</span></span><br><span class="line"><span class="comment"># 因为data中的params和encSecKey到了服务器解析后会对比随机数是否相同</span></span><br><span class="line"><span class="comment"># 获取encSecKey过程中唯一的变量就是这个随机数，固定了随机数就是固定了encSecKey</span></span><br><span class="line"><span class="comment"># 这样就只需要获取params了</span></span><br><span class="line">_i = <span class="string">&quot;Zrv1r2M2VOINoxIJ&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 加密工具：转化为16的倍数</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">_to_16</span>(<span class="params">data</span>):</span><br><span class="line">    pad = <span class="number">16</span> - <span class="built_in">len</span>(data) % <span class="number">16</span></span><br><span class="line">    data += <span class="built_in">chr</span>(pad) * pad</span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取加密的params</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">_get_aes</span>(<span class="params">a, b</span>):</span><br><span class="line">    key = b.encode(<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line">    iv = <span class="string">&quot;0102030405060708&quot;</span>.encode(<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line">    aes = AES.new(key=key, IV=iv, mode=AES.MODE_CBC)  <span class="comment"># 创造加密器</span></span><br><span class="line">    a = _to_16(a)</span><br><span class="line">    bs = aes.encrypt(a.encode(<span class="string">&quot;utf-8&quot;</span>))  <span class="comment"># 加密,加密内容长度必须是16的倍数，</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">str</span>(b64encode(bs), <span class="string">&quot;utf-8&quot;</span>)  <span class="comment"># 转化为字符串返回，</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取encSecKey</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">_get_encSecKey</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;d6b3977cdc2bf7c55093043afcc1037c7c9a52e0ee558aaa9afb4b6af&quot;</span> \</span><br><span class="line">           <span class="string">&quot;0078171aacc26f75e38da3cc754ac9e7c55b835f6a52496f0c7507445&quot;</span> \</span><br><span class="line">           <span class="string">&quot;8de571d3d5fa1c1d4ed2e8e91b95797030da6904e0a0b379fd1722665&quot;</span> \</span><br><span class="line">           <span class="string">&quot;29fab6d9ce2f10ead2880567491406334d7d4a90a39698eae9f886a22&quot;</span> \</span><br><span class="line">           <span class="string">&quot;7cdd18399533760d314d13281d3b&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取加密参数</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_data</span>(<span class="params">data</span>):</span><br><span class="line">    data = json.dumps(data)</span><br><span class="line">    params = _get_aes(data, _g)</span><br><span class="line">    params = _get_aes(params, _i)</span><br><span class="line">    encSecKey = _get_encSecKey()</span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&quot;params&quot;</span>: params,</span><br><span class="line">        <span class="string">&quot;encSecKey&quot;</span>: encSecKey</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> data</span><br></pre></td></tr></table></figure><p>获取歌曲列表：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> GetData</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">_search</span>(<span class="params">content</span>):</span><br><span class="line">    data = &#123;<span class="string">&quot;hlposttag&quot;</span>: <span class="string">&quot;&lt;/span&gt;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;hlpretag&quot;</span>: <span class="string">&#x27;&lt;span class=&quot;s-fc7&quot;&gt;&#x27;</span>,</span><br><span class="line">            <span class="string">&quot;limit&quot;</span>: <span class="number">30</span>,</span><br><span class="line">            <span class="string">&quot;offset&quot;</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="string">&quot;s&quot;</span>: <span class="string">f&quot;<span class="subst">&#123;content&#125;</span>&quot;</span>,</span><br><span class="line">            <span class="string">&quot;total&quot;</span>: <span class="literal">True</span>,</span><br><span class="line">            <span class="string">&quot;type&quot;</span>: <span class="string">&quot;1&quot;</span>&#125;</span><br><span class="line">    url = <span class="string">&quot;https://music.163.com/weapi/cloudsearch/get/web?csrf_token=&quot;</span></span><br><span class="line">    data = GetData.get_data(data)</span><br><span class="line">    resp = requests.post(url=url, data=data)</span><br><span class="line">    <span class="keyword">return</span> resp.json()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show_list</span>(<span class="params">content</span>):</span><br><span class="line">    search_list = _search(content)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;----------------------------------------------------------&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;序号     songId           歌手                   歌曲       &quot;</span>)</span><br><span class="line">    index = <span class="number">1</span></span><br><span class="line">    <span class="built_in">list</span> = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> search_list[<span class="string">&quot;result&quot;</span>][<span class="string">&quot;songs&quot;</span>]:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;index&#125;</span>      <span class="subst">&#123;i[<span class="string">&#x27;id&#x27;</span>]&#125;</span>        <span class="subst">&#123;i[<span class="string">&#x27;ar&#x27;</span>][<span class="number">0</span>][<span class="string">&#x27;name&#x27;</span>]&#125;</span>                 <span class="subst">&#123;i[<span class="string">&#x27;name&#x27;</span>]&#125;</span>&quot;</span>)</span><br><span class="line">        index += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        temp = &#123;</span><br><span class="line">            <span class="string">&quot;id&quot;</span>: i[<span class="string">&quot;id&quot;</span>],</span><br><span class="line">            <span class="string">&quot;song_name&quot;</span>: i[<span class="string">&quot;name&quot;</span>],</span><br><span class="line">            <span class="string">&quot;singer&quot;</span>:i[<span class="string">&quot;ar&quot;</span>][<span class="number">0</span>][<span class="string">&quot;name&quot;</span>]</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">list</span>.append(temp)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;----------------------------------------------------------&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">list</span></span><br></pre></td></tr></table></figure><p>下载歌曲：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> GetData</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">_download_song</span>(<span class="params">url, name</span>):</span><br><span class="line">    song_name = name + <span class="string">&quot;.m4a&quot;</span></span><br><span class="line"></span><br><span class="line">    resp = requests.get(url=url)</span><br><span class="line"></span><br><span class="line">    f = <span class="built_in">open</span>(<span class="string">&quot;./&quot;</span> + song_name, <span class="string">&quot;wb&quot;</span>)</span><br><span class="line">    f.write(resp.content)</span><br><span class="line">    f.close()</span><br><span class="line">    <span class="built_in">print</span>(name + <span class="string">&quot;下载成功&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_song_url</span>(<span class="params">dic</span>):</span><br><span class="line">    data = &#123;<span class="string">&quot;csrf_token&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;encodeType&quot;</span>: <span class="string">&quot;aac&quot;</span>,</span><br><span class="line">            <span class="string">&quot;ids&quot;</span>: <span class="string">f&quot;[<span class="subst">&#123;dic[<span class="string">&#x27;id&#x27;</span>]&#125;</span>]&quot;</span>,</span><br><span class="line">            <span class="string">&quot;level&quot;</span>: <span class="string">&quot;standard&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">    data = GetData.get_data(data)</span><br><span class="line">    url = <span class="string">&quot;https://music.163.com/weapi/song/enhance/player/url/v1?csrf_token=&quot;</span></span><br><span class="line">    resp = requests.post(url=url, data=data)</span><br><span class="line"></span><br><span class="line">    song_url = resp.json()[<span class="string">&quot;data&quot;</span>][<span class="number">0</span>][<span class="string">&quot;url&quot;</span>]</span><br><span class="line"></span><br><span class="line">    _download_song(song_url, dic[<span class="string">&quot;song_name&quot;</span>] + <span class="string">&quot;_&quot;</span> + dic[<span class="string">&quot;singer&quot;</span>])</span><br></pre></td></tr></table></figure><p>主函数调用：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;仅供学习交流，严禁用于商业用途，请于24小时内删除！&quot;</span>)</span><br><span class="line"></span><br><span class="line">    search = <span class="built_in">input</span>(<span class="string">&quot;请输入要搜索的歌曲或歌手&quot;</span>)</span><br><span class="line">    <span class="built_in">list</span> = GetSongId.show_list(search)</span><br><span class="line"></span><br><span class="line">    index = <span class="built_in">input</span>(<span class="string">&quot;请选择以上的序号(-1取消)&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> index != -<span class="number">1</span>:</span><br><span class="line">        Download.get_song_url(<span class="built_in">list</span>[<span class="built_in">int</span>(index)-<span class="number">1</span>])</span><br></pre></td></tr></table></figure><p>目前2022&#x2F;8&#x2F;6为止，使用正常</p>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
          <category> 爬虫 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 爬虫 </tag>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>(每日LeetCode)1408. 数组中的字符串匹配</title>
      <link href="/2022/08/06/%E6%AF%8F%E6%97%A5LeetCode/2022-8/1408%20%E6%95%B0%E7%BB%84%E4%B8%AD%E7%9A%84%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%8C%B9%E9%85%8D/"/>
      <url>/2022/08/06/%E6%AF%8F%E6%97%A5LeetCode/2022-8/1408%20%E6%95%B0%E7%BB%84%E4%B8%AD%E7%9A%84%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%8C%B9%E9%85%8D/</url>
      
        <content type="html"><![CDATA[<div class="story post-story"><h2 id="题目："><a href="#题目：" class="headerlink" title="题目："></a>题目：</h2><p>给你一个字符串数组 <code>words</code> ，数组中的每个字符串都可以看作是一个单词。请你按 任意 顺序返回 <code>words</code> 中是其他单词的子字符串的所有单词。</p><p>如果你可以删除 <code>words[j]</code> 最左侧和&#x2F;或最右侧的若干字符得到 <code>word[i]</code> ，那么字符串 <code>words[i]</code> 就是 <code>words[j]</code> 的一个子字符串。</p></div><div class="story post-story"><h2 id="示例："><a href="#示例：" class="headerlink" title="示例："></a>示例：</h2><blockquote><p>输入：words &#x3D; [“mass”,”as”,”hero”,”superhero”]<br>输出：[“as”,”hero”]<br>解释：”as” 是 “mass” 的子字符串，”hero” 是 “superhero” 的子字符串。<br>[“hero”,”as”] 也是有效的答案</p></blockquote></div><div class="story post-story"><h2 id="思路：暴力枚举"><a href="#思路：暴力枚举" class="headerlink" title="思路：暴力枚举"></a>思路：暴力枚举</h2><p>与每个字符串进行匹配</p></div><div class="story post-story"><h2 id="代码-cpp-："><a href="#代码-cpp-：" class="headerlink" title="代码(cpp)："></a>代码(cpp)：</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">vector&lt;string&gt; <span class="title">stringMatching</span><span class="params">(vector&lt;string&gt;&amp; words)</span> </span>&#123;</span><br><span class="line">        vector&lt;string&gt; ans;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; words.<span class="built_in">size</span>(); i++)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>; j &lt; words.<span class="built_in">size</span>(); j++)&#123;</span><br><span class="line">                <span class="keyword">if</span>(i != j &amp;&amp; words[j].<span class="built_in">find</span>(words[i]) != string::npos)&#123;</span><br><span class="line">                    ans.<span class="built_in">emplace_back</span>(words[i]);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="复杂对分析："><a href="#复杂对分析：" class="headerlink" title="复杂对分析："></a>复杂对分析：</h2><ul><li><p>时间复杂度：O(n^2 x L^2)，其中 n 是字符串数组的长度，L 是字符串数组中最长字符串的长度。使用 KMP 字符串匹配算法可以将时间复杂度优化到 O(n^2 × T)，其中 T 是字符串数组中所有字符串的平均长度。</p></li><li><p>空间复杂度：O(1)。返回值不计入空间复杂度。如果使用 KMP 字符串匹配算法，那么对应的空间复杂度为 O(T)。</p></li></ul></div>]]></content>
      
      
      <categories>
          
          <category> 每日LeetCode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
            <tag> LeetCode </tag>
            
            <tag> 数据结构 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>(每日LeetCode)623. 在二叉树中增加一行</title>
      <link href="/2022/08/05/%E6%AF%8F%E6%97%A5LeetCode/2022-8/623%20%E5%9C%A8%E4%BA%8C%E5%8F%89%E6%A0%91%E4%B8%AD%E5%A2%9E%E5%8A%A0%E4%B8%80%E8%A1%8C/"/>
      <url>/2022/08/05/%E6%AF%8F%E6%97%A5LeetCode/2022-8/623%20%E5%9C%A8%E4%BA%8C%E5%8F%89%E6%A0%91%E4%B8%AD%E5%A2%9E%E5%8A%A0%E4%B8%80%E8%A1%8C/</url>
      
        <content type="html"><![CDATA[<div class="story post-story"><h2 id="题目："><a href="#题目：" class="headerlink" title="题目："></a>题目：</h2><p>给定一个二叉树的根 <code>root</code> 和两个整数 <code>val</code> 和 <code>depth</code> ，在给定的深度 depth 处添加一个值为 val 的节点行。</p><p>注意，根节点 <code>root</code> 位于深度 1 。</p><p>加法规则如下:</p><ul><li>给定整数 <code>depth</code>，对于深度为 <code>depth - 1</code> 的每个非空树节点 <code>cur</code> ，创建两个值为 <code>val</code> 的树节点作为 <code>cur</code> 的左子树根和右子树根。</li><li><code>cur</code> 原来的左子树应该是新的左子树根的左子树。</li><li><code>cur</code> 原来的右子树应该是新的右子树根的右子树。</li><li>如果 <code>depth == 1</code> 意味着 <code>depth - 1</code> 根本没有深度，那么创建一个树节点，值 <code>val</code> 作为整个原始树的新根，而原始树就是新根的左子树。</li></ul></div><div class="story post-story"><h2 id="示例："><a href="#示例：" class="headerlink" title="示例："></a>示例：</h2><img src="https://assets.leetcode.com/uploads/2021/03/15/addrow-tree.jpg" class="lazyload" data-srcset="https://assets.leetcode.com/uploads/2021/03/15/addrow-tree.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img" style="zoom: 50%;" /><blockquote><p>输入: root &#x3D; [4,2,6,3,1,5], val &#x3D; 1, depth &#x3D; 2<br>输出: [4,1,1,2,null,null,6,3,1,5]</p></blockquote><p>我自己写的递归很烂，不如官方的的规范、整洁！但是效率基本差不多！</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">TreeNode* <span class="title">def</span><span class="params">(TreeNode* root, <span class="type">int</span>&amp; val, <span class="type">int</span> curDepth, <span class="type">int</span>&amp; depth, <span class="type">int</span> choice)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(curDepth == depth - <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span>(choice == <span class="number">1</span>)</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">TreeNode</span>(val, root, <span class="literal">nullptr</span>);</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">TreeNode</span>(val, <span class="literal">nullptr</span>, root);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(root == <span class="literal">nullptr</span>) <span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line"></span><br><span class="line">        root-&gt;left = <span class="built_in">def</span>(root-&gt;left, val, curDepth + <span class="number">1</span>, depth, <span class="number">1</span>);</span><br><span class="line">        root-&gt;right = <span class="built_in">def</span>(root-&gt;right, val, curDepth + <span class="number">1</span>, depth, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> root;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">TreeNode* <span class="title">addOneRow</span><span class="params">(TreeNode* root, <span class="type">int</span> val, <span class="type">int</span> depth)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">def</span>(root, val, <span class="number">0</span>, depth, <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>下面是官方的递归思路！</p></div><div class="story post-story"><h2 id="思路：递归"><a href="#思路：递归" class="headerlink" title="思路：递归"></a>思路：递归</h2><p>以示例中图片<strong>输出后</strong>的二叉树为例：<code>[4,1,1,2,null,null,6,3,1,5]</code></p><p>如果要在深度<code>depth</code>为3的位置插入新元素：</p><p>第一次递归：这层元素由<code>4</code> 变成了元素<code>4</code>的左右节点<code>1</code>和<code>1</code>，深度<code>depth</code>减一变为2</p><p><strong>如果深度<code>depth</code>为2的情况下</strong>，这层的节点的<strong>子节点</strong>就是要插入新元素的位置，</p><p>以这层左节点元素为例，元素<code>1</code>。创建新节点，新节点的左节点指向元素<code>1</code>的左节点，元素<code>1</code>的左节点变为新节点。这层右节点同理。到达深度为2的情况，直接返回不会到达深度为1的情况。</p><p><strong>只有在初始化深度<code>depth</code>为1的情况下</strong>，说明要在根节点<code>root</code>处插入新元素，创建新节点，新节点的左节点为根节点<code>root</code>，将根节点<code>root</code>指向为新节点，完成插入。</p><p>并且深度为n(除了深度为1的情况)，<strong>只要递归到深度depth变为2就可以插入新元素</strong>。</p></div><div class="story post-story"><h2 id="代码-cpp-："><a href="#代码-cpp-：" class="headerlink" title="代码(cpp)："></a>代码(cpp)：</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">TreeNode* <span class="title">addOneRow</span><span class="params">(TreeNode* root, <span class="type">int</span> val, <span class="type">int</span> depth)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(root == <span class="literal">nullptr</span>) <span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">        <span class="comment">//深度为1的情况，新节点的左节点指向根节点，根节点变为新节点</span></span><br><span class="line">        <span class="keyword">if</span>(depth == <span class="number">1</span>) <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">TreeNode</span>(val, root, <span class="literal">nullptr</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(depth == <span class="number">2</span>) &#123; <span class="comment">//深度为2的情况</span></span><br><span class="line">            <span class="comment">//新节点指向该节点的左节点，该节点的左节点指向新节点</span></span><br><span class="line">            root-&gt;left = <span class="keyword">new</span> <span class="built_in">TreeNode</span>(val, root-&gt;left, <span class="literal">nullptr</span>);</span><br><span class="line">            <span class="comment">//新节点指向该节点的右节点，该节点的右节点指向新节点</span></span><br><span class="line">            root-&gt;right = <span class="keyword">new</span> <span class="built_in">TreeNode</span>(val, <span class="literal">nullptr</span>, root-&gt;right);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">//递归到该节点的左节点，深度减一</span></span><br><span class="line">            root-&gt;left = <span class="built_in">addOneRow</span>(root-&gt;left, val, depth - <span class="number">1</span>);</span><br><span class="line">            <span class="comment">//递归到该节点的右节点，深度减一</span></span><br><span class="line">            root-&gt;right = <span class="built_in">addOneRow</span>(root-&gt;right, val, depth - <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> root;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="复杂度分析："><a href="#复杂度分析：" class="headerlink" title="复杂度分析："></a>复杂度分析：</h2><ul><li><p>时间复杂度：O(n)，其中 n 为输入的树的节点数。最坏情况下，需要遍历整棵树。</p></li><li><p>空间复杂度：O(n)，递归的深度最多为 O(n)。</p></li></ul></div>]]></content>
      
      
      <categories>
          
          <category> 每日LeetCode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
            <tag> LeetCode </tag>
            
            <tag> 数据结构 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>(每日LeetCode)1403. 非递增顺序的最小子序列</title>
      <link href="/2022/08/04/%E6%AF%8F%E6%97%A5LeetCode/2022-8/1403%20%E9%9D%9E%E9%80%92%E5%A2%9E%E9%A1%BA%E5%BA%8F%E7%9A%84%E6%9C%80%E5%B0%8F%E5%AD%90%E5%BA%8F%E5%88%97/"/>
      <url>/2022/08/04/%E6%AF%8F%E6%97%A5LeetCode/2022-8/1403%20%E9%9D%9E%E9%80%92%E5%A2%9E%E9%A1%BA%E5%BA%8F%E7%9A%84%E6%9C%80%E5%B0%8F%E5%AD%90%E5%BA%8F%E5%88%97/</url>
      
        <content type="html"><![CDATA[<div class="story post-story"><h2 id="题目："><a href="#题目：" class="headerlink" title="题目："></a>题目：</h2><p>给你一个数组 <code>nums</code>，请你从中抽取一个子序列，满足该子序列的元素之和 严格 大于未包含在该子序列中的各元素之和。</p><p>如果存在多个解决方案，只需返回 长度最小 的子序列。如果仍然有多个解决方案，则返回 元素之和最大 的子序列。</p><p>与子数组不同的地方在于，「数组的子序列」不强调元素在原数组中的连续性，也就是说，它可以通过从数组中分离一些（也可能不分离）元素得到。</p><p>注意，题目数据保证满足所有约束条件的解决方案是 唯一 的。同时，返回的答案应当按 非递增顺序 排列。</p></div><div class="story post-story"><h2 id="示例："><a href="#示例：" class="headerlink" title="示例："></a>示例：</h2><blockquote><p>输入：nums &#x3D; [4,4,7,6,7]<br>输出：[7,7,6]<br>解释：子序列 [7,7] 的和为 14 ，不严格大于剩下的其他元素之和（14 &#x3D; 4 + 4 + 6）。因此，[7,6,7] 是满足题意的最小子序列。注意，元素按非递增顺序返回。 </p></blockquote><p>我自己的思路：双指针</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">minSubsequence</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">sort</span>(nums.<span class="built_in">begin</span>(), nums.<span class="built_in">end</span>());</span><br><span class="line">        <span class="type">int</span> right = nums.<span class="built_in">size</span>() - <span class="number">1</span>;</span><br><span class="line">        vector&lt;<span class="type">int</span>&gt; ans;</span><br><span class="line">        <span class="type">int</span> left = <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> ans_sum = <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> temp = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(left &lt;= right)&#123;</span><br><span class="line">            ans.<span class="built_in">push_back</span>(nums[right]);</span><br><span class="line">            ans_sum += nums[right];</span><br><span class="line">            right--;</span><br><span class="line">            <span class="keyword">while</span>(temp &lt; ans_sum &amp;&amp; left &lt;= right)&#123;</span><br><span class="line">                temp += nums[left];</span><br><span class="line">                left++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(ans_sum &lt;= temp)&#123;</span><br><span class="line">            ans.<span class="built_in">push_back</span>(nums[right]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>可以通过但是效率很低！下面是官方思路！</p></div><div class="story post-story"><h2 id="思路：贪心"><a href="#思路：贪心" class="headerlink" title="思路：贪心"></a>思路：贪心</h2><p>先计算出数组中各个元素加起来的总合<code>sum</code></p><p>再进行从大到小的遍历元素加起来的合<code>cur</code>，直到<strong>该子序列的元素之和</strong><code>cur</code>大于<strong>未包含在该子序列中的各元素之和</strong><code>sum-cur</code>停止。</p></div><div class="story post-story"><h2 id="代码-cpp-："><a href="#代码-cpp-：" class="headerlink" title="代码(cpp)："></a>代码(cpp)：</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">minSubsequence</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> sum = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> num : nums)&#123; <span class="comment">//计算总和</span></span><br><span class="line">            sum += num;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">sort</span>(nums.<span class="built_in">begin</span>(), nums.<span class="built_in">end</span>()); <span class="comment">//排序</span></span><br><span class="line">        vector&lt;<span class="type">int</span>&gt; ans;</span><br><span class="line">        <span class="type">int</span> cur = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = nums.<span class="built_in">size</span>() - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--)&#123;</span><br><span class="line">            ans.<span class="built_in">emplace_back</span>(nums[i]); <span class="comment">//尾部插入</span></span><br><span class="line">            cur += nums[i]; <span class="comment">//计算cur</span></span><br><span class="line">            <span class="keyword">if</span>(sum - cur &lt; cur)&#123; <span class="comment">//如果该子序列合 大于 未在子序列中的合</span></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="复杂度分析："><a href="#复杂度分析：" class="headerlink" title="复杂度分析："></a>复杂度分析：</h2><ul><li><p>时间复杂度：O(nlogn)，其中 n 为数组的长度。需要对数组进行排序，因此时间复杂度 O(nlogn)。</p></li><li><p>空间复杂度：O(logn)，其中 n 为数组的长度。排序需要的栈空间为 O(logn)。</p></li></ul></div>]]></content>
      
      
      <categories>
          
          <category> 每日LeetCode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
            <tag> LeetCode </tag>
            
            <tag> 数据结构 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>(每日LeetCode)899. 有序队列</title>
      <link href="/2022/08/03/%E6%AF%8F%E6%97%A5LeetCode/2022-8/899%20%E6%9C%89%E5%BA%8F%E9%98%9F%E5%88%97/"/>
      <url>/2022/08/03/%E6%AF%8F%E6%97%A5LeetCode/2022-8/899%20%E6%9C%89%E5%BA%8F%E9%98%9F%E5%88%97/</url>
      
        <content type="html"><![CDATA[<div class="story post-story"><h2 id="题目："><a href="#题目：" class="headerlink" title="题目："></a>题目：</h2><p>给定一个字符串 <code>s</code> 和一个整数 <code>k</code> 。你可以从 <code>s</code> 的前 <code>k</code> 个字母中选择一个，并把它加到字符串的末尾。</p><p>返回 在应用上述步骤的任意数量的移动后，字典上最小的字符串 。</p></div><div class="story post-story"><h2 id="示例："><a href="#示例：" class="headerlink" title="示例："></a>示例：</h2><blockquote><p>输入：s &#x3D; “cba”, k &#x3D; 1<br>输出：”acb”<br>解释：<br>在第一步中，我们将第一个字符（“c”）移动到最后，获得字符串 “bac”。<br>在第二步中，我们将第一个字符（“b”）移动到最后，获得最终结果 “acb”。</p></blockquote></div><div class="story post-story"><h2 id="思路：脑筋急转弯"><a href="#思路：脑筋急转弯" class="headerlink" title="思路：脑筋急转弯"></a>思路：脑筋急转弯</h2><p>以s &#x3D; “cba”为例：</p><p>当k &#x3D; 1时，无论经过多少次移动，最小的字符串为”acb”，并不是”最终”最小的字符产”abc”</p><p>所以要依次遍历所有可能，找出最小的字符串</p><p>当k &gt; 1时，无论经历多少次移动，最终最小的一定是”abc”</p><p>只需对s进行排序</p></div><div class="story post-story"><h2 id="代码-cpp-："><a href="#代码-cpp-：" class="headerlink" title="代码(cpp)："></a>代码(cpp)：</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">string <span class="title">orderlyQueue</span><span class="params">(string s, <span class="type">int</span> k)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(k == <span class="number">1</span>)&#123; <span class="comment">//k=1时</span></span><br><span class="line">            string min_s = s; <span class="comment">//初始化最小的字符串</span></span><br><span class="line">            <span class="type">int</span> size = s.<span class="built_in">size</span>(); <span class="comment">// 获取字符串长度</span></span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; size; i++)&#123;</span><br><span class="line">                <span class="type">char</span> temp = s[<span class="number">0</span>]; <span class="comment">//获取第一个字符</span></span><br><span class="line">                s = s.<span class="built_in">substr</span>(<span class="number">1</span>); <span class="comment">//截取除第一个字符，剩下的字符串</span></span><br><span class="line">                s.<span class="built_in">push_back</span>(temp); <span class="comment">//将第一个字符，加到字符串的后面</span></span><br><span class="line">                <span class="keyword">if</span>(min_s &gt; s)&#123; <span class="comment">//进行比较</span></span><br><span class="line">                    min_s = s;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> min_s;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123; <span class="comment">//k&gt;1时</span></span><br><span class="line">            <span class="built_in">sort</span>(s.<span class="built_in">begin</span>(), s.<span class="built_in">end</span>()); <span class="comment">//排序</span></span><br><span class="line">            <span class="keyword">return</span> s;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="复杂度分析："><a href="#复杂度分析：" class="headerlink" title="复杂度分析："></a>复杂度分析：</h2><ul><li><p>时间复杂度：O(n^2)，其中 n 是字符串 s 的长度。当 k &#x3D; 1 时需要遍历 n 个可能的字符串，每个字符串需要 O(n) 的时间生成和判断是否字典序最小，时间复杂度是 O(n^2)；当 k &gt; 1 时需要对字符串排序，时间复杂度是 O(nlogn)。最坏情况下时间复杂度是 O(n^2)。</p></li><li><p>空间复杂度：O(n) 或 O(logn)，其中 n 是字符串 s 的长度。空间复杂度取决于具体实现的语言。对于字符串不可变的语言，当 k &#x3D; 1 时生成每个字符串和当 k &gt; 1 时生成排序后的字符串都需要 O(n) 的空间；对于字符串可变的语言，可以省略 O(n) 的空间，只有当 k &gt; 1 时排序需要 O(logn) 的空间。</p></li></ul></div>]]></content>
      
      
      <categories>
          
          <category> 每日LeetCode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
            <tag> LeetCode </tag>
            
            <tag> 数据结构 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>(每日LeetCode)622. 设计循环队列</title>
      <link href="/2022/08/02/%E6%AF%8F%E6%97%A5LeetCode/2022-8/622%20%E8%AE%BE%E8%AE%A1%E5%BE%AA%E7%8E%AF%E9%98%9F%E5%88%97/"/>
      <url>/2022/08/02/%E6%AF%8F%E6%97%A5LeetCode/2022-8/622%20%E8%AE%BE%E8%AE%A1%E5%BE%AA%E7%8E%AF%E9%98%9F%E5%88%97/</url>
      
        <content type="html"><![CDATA[<div class="story post-story"><h2 id="题目："><a href="#题目：" class="headerlink" title="题目："></a>题目：</h2><p>设计你的循环队列实现。 循环队列是一种线性数据结构，其操作表现基于 FIFO（先进先出）原则并且队尾被连接在队首之后以形成一个循环。它也被称为“环形缓冲器”。</p><p>循环队列的一个好处是我们可以利用这个队列之前用过的空间。在一个普通队列里，一旦一个队列满了，我们就不能插入下一个元素，即使在队列前面仍有空间。但是使用循环队列，我们能使用这些空间去存储新的值。</p><p>你的实现应该支持如下操作：</p><ul><li><code>MyCircularQueue(k)</code>：构造器，设置队列长度为 k 。</li><li><code>Front()</code>：从队首获取元素。如果队列为空，返回 -1 。</li><li><code>Rear()</code>：获取队尾元素。如果队列为空，返回 -1 。</li><li><code>enQueue(value)</code>：向循环队列插入一个元素。如果成功插入则返回真。</li><li><code>deQueue()</code>：从循环队列中删除一个元素。如果成功删除则返回真。</li><li><code>isEmpty()</code>：检查循环队列是否为空。</li><li><code>isFull()</code>：检查循环队列是否已满。</li></ul></div><div class="story post-story"><h2 id="示例："><a href="#示例：" class="headerlink" title="示例："></a>示例：</h2><blockquote><p>MyCircularQueue circularQueue &#x3D; new MyCircularQueue(3); &#x2F;&#x2F; 设置长度为 3<br>circularQueue.enQueue(1);  &#x2F;&#x2F; 返回 true<br>circularQueue.enQueue(2);  &#x2F;&#x2F; 返回 true<br>circularQueue.enQueue(3);  &#x2F;&#x2F; 返回 true<br>circularQueue.enQueue(4);  &#x2F;&#x2F; 返回 false，队列已满<br>circularQueue.Rear();  &#x2F;&#x2F; 返回 3<br>circularQueue.isFull();  &#x2F;&#x2F; 返回 true<br>circularQueue.deQueue();  &#x2F;&#x2F; 返回 true<br>circularQueue.enQueue(4);  &#x2F;&#x2F; 返回 true<br>circularQueue.Rear();  &#x2F;&#x2F; 返回 4</p></blockquote></div><div class="story post-story"><h2 id="思路：数组"><a href="#思路：数组" class="headerlink" title="思路：数组"></a>思路：数组</h2><p>初始化(空栈)：</p><p>以示例为例，设置长度<code>k</code>为3，但是初始化的实际容量<code>capacity</code>应该为<code>k+1</code>即为4</p><p>初始化头节点<code>front</code>以及尾节点<code>rear</code>为0号位置</p><p>注意：<code>rear</code>指向的位置不是末尾的元素，而是末尾的元素的下一位置</p><p>是否为空判断：<code>front</code>与<code>rear</code>是否再同一个位置，即<code>front == rear</code></p><table><thead><tr><th align="center">front<br>$\Downarrow$</th><th align="center"></th><th align="center"></th><th align="center"></th></tr></thead><tbody><tr><td align="center">0</td><td align="center">1</td><td align="center">2</td><td align="center">3</td></tr><tr><td align="center">空</td><td align="center">空</td><td align="center">空</td><td align="center">空</td></tr><tr><td align="center">$\Uparrow$<br>rear</td><td align="center"></td><td align="center"></td><td align="center"></td></tr></tbody></table><p>如何循环？：</p><p>将<code>rear</code>指针所在的3号位置赋值为4后，需要将<code>rear</code>指针后移，但是<code>rear+1</code>后会导致越界</p><p>我们希望<code>rear</code>指针应该移动到0号位置，可以进行取余操作：<code>(rear + 1) % capacity</code></p><p><code>rear</code>指针当前的位置为3，容量<code>capacity</code>为4，带入公式：<code>(3 + 1) % 4 = 0</code></p><p><code>rear</code>指针移动我们所想要的到达的0号位置</p><table><thead><tr><th align="center"></th><th align="center"></th><th align="center">front<br/>$\Downarrow$</th><th align="center"></th></tr></thead><tbody><tr><td align="center">0</td><td align="center">1</td><td align="center">2</td><td align="center">3</td></tr><tr><td align="center">空</td><td align="center">空</td><td align="center">3</td><td align="center">空</td></tr><tr><td align="center"></td><td align="center"></td><td align="center"></td><td align="center">$\Uparrow$<br/>rear</td></tr></tbody></table><table><thead><tr><th align="center"></th><th align="center"></th><th align="center">front<br/>$\Downarrow$</th><th align="center"></th></tr></thead><tbody><tr><td align="center">0</td><td align="center">1</td><td align="center">2</td><td align="center">3</td></tr><tr><td align="center">空</td><td align="center">空</td><td align="center">3</td><td align="center">4</td></tr><tr><td align="center">$\Uparrow$<br/>rear</td><td align="center"></td><td align="center"></td><td align="center"></td></tr></tbody></table><p>满列的情况：</p><p>当存储的元素个数为3时，就达到满列的情况</p><p>判断是否为满列：rear指针后移，如果<code>front</code>与<code>rear</code>在同一位置，则说明满列</p><p>即<code>(rear + 1) % capacity == front</code></p><table><thead><tr><th align="center">front<br>$\Downarrow$</th><th align="center"></th><th align="center"></th><th align="center"></th></tr></thead><tbody><tr><td align="center">0</td><td align="center">1</td><td align="center">2</td><td align="center">3</td></tr><tr><td align="center">1</td><td align="center">2</td><td align="center">3</td><td align="center">空</td></tr><tr><td align="center"></td><td align="center"></td><td align="center"></td><td align="center">$\Uparrow$<br/>rear</td></tr></tbody></table><p>注意：也可以使用链表实现队列解决该问题！！用链表实现队列更简单</p></div><div class="story post-story"><h2 id="代码-cpp-："><a href="#代码-cpp-：" class="headerlink" title="代码(cpp)："></a>代码(cpp)：</h2><p>以下为数组实现：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyCircularQueue</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    vector&lt;<span class="type">int</span>&gt; queue; <span class="comment">// 队列</span></span><br><span class="line">    <span class="type">int</span> capacity;      <span class="comment">//容量</span></span><br><span class="line">    <span class="type">int</span> front;         <span class="comment">//头节点</span></span><br><span class="line">    <span class="type">int</span> rear;          <span class="comment">//尾节点</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">MyCircularQueue</span>(<span class="type">int</span> k) &#123;</span><br><span class="line">        <span class="keyword">this</span>-&gt;capacity = k + <span class="number">1</span>; </span><br><span class="line">        <span class="keyword">this</span>-&gt;queue = <span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;(<span class="keyword">this</span>-&gt;capacity); <span class="comment">//初始化容量为k+1</span></span><br><span class="line">        <span class="keyword">this</span>-&gt;front = <span class="number">0</span>;                           <span class="comment">//初始化头节点</span></span><br><span class="line">        <span class="keyword">this</span>-&gt;rear = <span class="number">0</span>;                            <span class="comment">//初始化尾节点</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//入列</span></span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">enQueue</span><span class="params">(<span class="type">int</span> value)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//判断是否为满列</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">this</span>-&gt;<span class="built_in">isFull</span>()) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"><span class="comment">//插入队列</span></span><br><span class="line">        queue[<span class="keyword">this</span>-&gt;rear] = value;</span><br><span class="line">        <span class="comment">//rear指针后移</span></span><br><span class="line">        <span class="keyword">this</span>-&gt;rear = (<span class="keyword">this</span>-&gt;rear + <span class="number">1</span>) % <span class="keyword">this</span>-&gt;capacity;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//出列</span></span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">deQueue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//判断是否为空</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">this</span>-&gt;<span class="built_in">isEmpty</span>()) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"><span class="comment">//front指针后移</span></span><br><span class="line">        <span class="keyword">this</span>-&gt;front = (<span class="keyword">this</span>-&gt;front + <span class="number">1</span>) % <span class="keyword">this</span>-&gt;capacity;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">Front</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//判断是否为空</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">this</span>-&gt;<span class="built_in">isEmpty</span>()) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        <span class="comment">//返回头节点的元素</span></span><br><span class="line">        <span class="keyword">return</span> queue[<span class="keyword">this</span>-&gt;front];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">Rear</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 判断是否为空</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">this</span>-&gt;<span class="built_in">isEmpty</span>()) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line"><span class="comment">//rear指针为末尾元素的下一位，要回到上一位置</span></span><br><span class="line">        <span class="comment">//如果rear=0，代入公式：(0 - 1 + 4) % 4 = 3；3为上一个位置</span></span><br><span class="line">        <span class="type">int</span> temp = (<span class="keyword">this</span>-&gt;rear - <span class="number">1</span> + <span class="keyword">this</span>-&gt;capacity) % <span class="keyword">this</span>-&gt;capacity;</span><br><span class="line">        <span class="comment">//返回该位置的元素</span></span><br><span class="line">        <span class="keyword">return</span> queue[temp];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">isEmpty</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//判断头节点与尾节点是否在同一位置</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>-&gt;front == <span class="keyword">this</span>-&gt;rear;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">isFull</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//判断尾节点的下一个位置是否与头节点在同一位置</span></span><br><span class="line">        <span class="keyword">return</span> (<span class="keyword">this</span>-&gt;rear + <span class="number">1</span>) % <span class="keyword">this</span>-&gt;capacity == <span class="keyword">this</span>-&gt;front;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="复杂度分析："><a href="#复杂度分析：" class="headerlink" title="复杂度分析："></a>复杂度分析：</h2><ul><li>时间复杂度：初始化和每项操作的时间复杂度均为 O(1)。</li><li>空间复杂度：O(k)，其中 k 为给定的队列元素数目。</li></ul></div>]]></content>
      
      
      <categories>
          
          <category> 每日LeetCode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
            <tag> LeetCode </tag>
            
            <tag> 数据结构 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>(每日LeetCode)1374. 生成每种字符都是奇数个的字符串</title>
      <link href="/2022/08/01/%E6%AF%8F%E6%97%A5LeetCode/2022-8/1374%20%E7%94%9F%E6%88%90%E6%AF%8F%E7%A7%8D%E5%AD%97%E7%AC%A6%E9%83%BD%E6%98%AF%E5%A5%87%E6%95%B0%E4%B8%AA%E7%9A%84%E5%AD%97%E7%AC%A6%E4%B8%B2/"/>
      <url>/2022/08/01/%E6%AF%8F%E6%97%A5LeetCode/2022-8/1374%20%E7%94%9F%E6%88%90%E6%AF%8F%E7%A7%8D%E5%AD%97%E7%AC%A6%E9%83%BD%E6%98%AF%E5%A5%87%E6%95%B0%E4%B8%AA%E7%9A%84%E5%AD%97%E7%AC%A6%E4%B8%B2/</url>
      
        <content type="html"><![CDATA[<div class="story post-story"><h2 id="题目："><a href="#题目：" class="headerlink" title="题目："></a>题目：</h2><p>给你一个整数 n，请你返回一个含 n 个字符的字符串，其中每种字符在该字符串中都恰好出现 奇数次 。</p><p>返回的字符串必须只含小写英文字母。如果存在多个满足题目要求的字符串，则返回其中任意一个即可。</p></div><div class="story post-story"><h2 id="示例："><a href="#示例：" class="headerlink" title="示例："></a>示例：</h2><blockquote><p>输入：n &#x3D; 4<br>输出：”pppz”<br>解释：”pppz” 是一个满足题目要求的字符串，因为 ‘p’ 出现 3 次，且 ‘z’ 出现 1 次。当然，还有很多其他字符串也满足题目要求，比如：”ohhh” 和 “love”。</p></blockquote><p>多说无益！</p></div><div class="story post-story"><h2 id="代码-cpp-："><a href="#代码-cpp-：" class="headerlink" title="代码(cpp)："></a>代码(cpp)：</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">string <span class="title">generateTheString</span><span class="params">(<span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(n%<span class="number">2</span> == <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">string</span>(n<span class="number">-1</span>,<span class="string">&#x27;a&#x27;</span>) + <span class="string">&#x27;b&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">string</span>(n, <span class="string">&#x27;a&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="复杂度分析："><a href="#复杂度分析：" class="headerlink" title="复杂度分析："></a>复杂度分析：</h2><ul><li>时间复杂度：O(n)。</li><li>空间复杂度：O(1)。这里不计入返回值需要的空间。</li></ul></div>]]></content>
      
      
      <categories>
          
          <category> 每日LeetCode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
            <tag> LeetCode </tag>
            
            <tag> 数据结构 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>(每日LeetCode)1161. 最大层内元素和</title>
      <link href="/2022/07/31/%E6%AF%8F%E6%97%A5LeetCode/2022-7/1161%20%E6%9C%80%E5%A4%A7%E5%B1%82%E5%86%85%E5%85%83%E7%B4%A0%E5%92%8C/"/>
      <url>/2022/07/31/%E6%AF%8F%E6%97%A5LeetCode/2022-7/1161%20%E6%9C%80%E5%A4%A7%E5%B1%82%E5%86%85%E5%85%83%E7%B4%A0%E5%92%8C/</url>
      
        <content type="html"><![CDATA[<div class="story post-story"><h2 id="题目："><a href="#题目：" class="headerlink" title="题目："></a>题目：</h2><p>给你一个二叉树的根节点 <code>root</code>。设根节点位于二叉树的第 <code>1</code> 层，而根节点的子节点位于第 <code>2</code> 层，依此类推。</p><p>请返回层内元素之和 <strong>最大</strong> 的那几层（可能只有一层）的层号，并返回其中 <strong>最小</strong> 的那个。</p></div><div class="story post-story"><h2 id="示例："><a href="#示例：" class="headerlink" title="示例："></a>示例：</h2><img src="https://assets.leetcode-cn.com/aliyun-lc-upload/uploads/2019/08/17/capture.jpeg" class="lazyload" data-srcset="https://assets.leetcode-cn.com/aliyun-lc-upload/uploads/2019/08/17/capture.jpeg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img" style="zoom:50%;" /><blockquote><p>输入：root &#x3D; [1,7,0,7,-8,null,null]<br>输出：2<br>解释：<br>第 1 层各元素之和为 1，<br>第 2 层各元素之和为 7 + 0 &#x3D; 7，<br>第 3 层各元素之和为 7 + -8 &#x3D; -1，<br>所以我们返回第 2 层的层号，它的层内元素之和最大。</p></blockquote></div><div class="story post-story"><h2 id="思路："><a href="#思路：" class="headerlink" title="思路："></a>思路：</h2><p>使用队列，层序遍历二叉树同时计算出每层的元素之和，比较每层的总和，得出最大总和所在的层数</p></div><div class="story post-story"><h2 id="代码-cpp-："><a href="#代码-cpp-：" class="headerlink" title="代码(cpp)："></a>代码(cpp)：</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">maxLevelSum</span><span class="params">(TreeNode* root)</span> </span>&#123;</span><br><span class="line">        queue&lt;TreeNode*&gt; q;</span><br><span class="line">        q.<span class="built_in">push</span>(root);</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> max_sum = <span class="number">-999999</span>; <span class="comment">//设置最大元素之和</span></span><br><span class="line">        <span class="type">int</span> max_level_sum = <span class="number">1</span>; <span class="comment">//记录最大总和的所在的层</span></span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> level_sum = <span class="number">1</span>; <span class="comment">//当前层数</span></span><br><span class="line">        <span class="keyword">while</span>(!q.<span class="built_in">empty</span>())&#123; <span class="comment">//第一个循环，遍历层</span></span><br><span class="line">            <span class="type">int</span> size = q.<span class="built_in">size</span>(); <span class="comment">//获取当前层的节点数</span></span><br><span class="line">            <span class="type">int</span> sum = <span class="number">0</span>; <span class="comment">//初始化该层的元素之和</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">while</span>(size != <span class="number">0</span>)&#123; <span class="comment">//第二个循环，遍历每层的节点</span></span><br><span class="line">                TreeNode* p = q.<span class="built_in">front</span>(); <span class="comment">//获取该节点</span></span><br><span class="line">                q.<span class="built_in">pop</span>(); <span class="comment">//移除在队列中的该节点</span></span><br><span class="line">                sum += p-&gt;val; <span class="comment">//加上该节点的值，计算该层的元素之和</span></span><br><span class="line">                <span class="keyword">if</span>(p-&gt;left != <span class="literal">nullptr</span>)&#123;</span><br><span class="line">                    q.<span class="built_in">push</span>(p-&gt;left); <span class="comment">//插入下一层的左节点</span></span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(p-&gt;right != <span class="literal">nullptr</span>)&#123;</span><br><span class="line">                    q.<span class="built_in">push</span>(p-&gt;right);<span class="comment">//插入下一层的右节点</span></span><br><span class="line">                &#125;</span><br><span class="line">                size--; <span class="comment">//已遍历完gai该层节点数减一</span></span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span>(max_sum &lt; sum)&#123; <span class="comment">//如果该层的元素之和大于之前的</span></span><br><span class="line">                max_sum = sum;</span><br><span class="line">                max_level_sum = level_sum;</span><br><span class="line">            &#125;</span><br><span class="line">            level_sum++; <span class="comment">//层数加一，进入下一层</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> max_level_sum;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></div>]]></content>
      
      
      <categories>
          
          <category> 每日LeetCode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
            <tag> LeetCode </tag>
            
            <tag> 数据结构 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>(每日LeetCode)1331. 数组序号转换</title>
      <link href="/2022/07/28/%E6%AF%8F%E6%97%A5LeetCode/2022-7/1331%20%E6%95%B0%E7%BB%84%E5%BA%8F%E5%8F%B7%E8%BD%AC%E6%8D%A2/"/>
      <url>/2022/07/28/%E6%AF%8F%E6%97%A5LeetCode/2022-7/1331%20%E6%95%B0%E7%BB%84%E5%BA%8F%E5%8F%B7%E8%BD%AC%E6%8D%A2/</url>
      
        <content type="html"><![CDATA[<div class="story post-story"><h2 id="题目："><a href="#题目：" class="headerlink" title="题目："></a>题目：</h2><p>给你一个整数数组 <code>arr</code> ，请你将数组中的每个元素替换为它们排序后的序号。</p><p>序号代表了一个元素有多大。序号编号的规则如下：</p><p>序号从 1 开始编号。<br>一个元素越大，那么序号越大。如果两个元素相等，那么它们的序号相同。<br>每个数字的序号都应该尽可能地小。</p></div><div class="story post-story"><h2 id="示例："><a href="#示例：" class="headerlink" title="示例："></a>示例：</h2><blockquote><p>输入：arr &#x3D; [37,12,28,9,100,56,80,5,12]<br>输出：[5,3,4,2,8,6,7,1,3]</p></blockquote></div><div class="story post-story"><h2 id="思路：哈希表"><a href="#思路：哈希表" class="headerlink" title="思路：哈希表"></a>思路：哈希表</h2><blockquote><p>首先用<code>temp</code>数组拷贝一份原数组<code>arr</code></p><p>将<code>temp</code>数组进行排序</p><p>用一个哈希表保存<code>temp</code>数组各元素的排列序号</p><p>最后根据原数组<code>arr</code>各个元素的位置返回排列序号</p></blockquote></div><div class="story post-story"><h2 id="代码-cpp-："><a href="#代码-cpp-：" class="headerlink" title="代码(cpp)："></a>代码(cpp)：</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">arrayRankTransform</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; arr)</span> </span>&#123;</span><br><span class="line">        <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">temp</span><span class="params">(arr)</span></span>; <span class="comment">//拷贝一份数组</span></span><br><span class="line">        <span class="built_in">sort</span>(temp.<span class="built_in">begin</span>(), temp.<span class="built_in">end</span>()); <span class="comment">//将temp排序</span></span><br><span class="line"></span><br><span class="line">        unordered_map&lt;<span class="type">int</span>, <span class="type">int</span>&gt; map;</span><br><span class="line">        </span><br><span class="line">        <span class="type">int</span> count = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; temp.<span class="built_in">size</span>(); i++)&#123;</span><br><span class="line">            <span class="comment">//如果map中已经存在，则跳过</span></span><br><span class="line">            <span class="keyword">if</span>(!map.<span class="built_in">count</span>(temp[i]))&#123;</span><br><span class="line">                map[temp[i]] = count;</span><br><span class="line">                count++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        vector&lt;<span class="type">int</span>&gt; ans;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>; j &lt; arr.<span class="built_in">size</span>(); j++)&#123;</span><br><span class="line">            ans.<span class="built_in">emplace_back</span>(map[arr[j]]); <span class="comment">//插入序号</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="复杂度分析："><a href="#复杂度分析：" class="headerlink" title="复杂度分析："></a>复杂度分析：</h2><ul><li><p>时间复杂度：O(n×logn)，其中 n 是输入数组 arr 的长度，排序消耗 O(n×logn) 时间。</p></li><li><p>空间复杂度：O(n)。有序数组和哈希表各消耗 O(n) 空间。</p></li></ul></div>]]></content>
      
      
      <categories>
          
          <category> 每日LeetCode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
            <tag> LeetCode </tag>
            
            <tag> 数据结构 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>(每日LeetCode)919. 完全二叉树插入器</title>
      <link href="/2022/07/25/%E6%AF%8F%E6%97%A5LeetCode/2022-7/919%20%E5%AE%8C%E5%85%A8%E4%BA%8C%E5%8F%89%E6%A0%91%E6%8F%92%E5%85%A5%E5%99%A8/"/>
      <url>/2022/07/25/%E6%AF%8F%E6%97%A5LeetCode/2022-7/919%20%E5%AE%8C%E5%85%A8%E4%BA%8C%E5%8F%89%E6%A0%91%E6%8F%92%E5%85%A5%E5%99%A8/</url>
      
        <content type="html"><![CDATA[<div class="story post-story"><h2 id="题目："><a href="#题目：" class="headerlink" title="题目："></a>题目：</h2><p>完全二叉树： </p><ul><li>是每一层（除最后一层外）都是完全填充（即，节点数达到最大）的，并且所有的节点都尽可能地集中在左侧。</li></ul><p>设计一种算法，将一个新节点插入到一个完整的二叉树中，并在插入后保持其完整。</p><p>实现 <code>CBTInserter</code> 类：</p><ul><li><code>CBTInserter(TreeNode root)</code> 使用头节点为 root 的给定树初始化该数据结构；</li><li><code>CBTInserter.insert(int v)</code>  向树中插入一个值为 Node.val &#x3D;&#x3D; val的新节点 TreeNode。使树保持完全二叉树的状态，并返回插入节点 TreeNode 的父节点的值；</li><li><code>CBTInserter.get_root()</code> 将返回树的头节点。</li></ul></div><div class="story post-story"><h2 id="示例："><a href="#示例：" class="headerlink" title="示例："></a>示例：</h2><img src="https://assets.leetcode.com/uploads/2021/08/03/lc-treeinsert.jpg" class="lazyload" data-srcset="https://assets.leetcode.com/uploads/2021/08/03/lc-treeinsert.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img" style="zoom: 50%;" /><blockquote><p>输入：<br>[“CBTInserter”, “insert”, “insert”, “get_root”]<br>[[[1, 2]], [3], [4], []]<br>输出：<br>[null, 1, 2, [1, 2, 3, 4]]</p><p>解释：<br>CBTInserter cBTInserter &#x3D; new CBTInserter([1, 2]);<br>cBTInserter.insert(3);  &#x2F;&#x2F; 返回父节点 1<br>cBTInserter.insert(4);  &#x2F;&#x2F; 返回父节点 2<br>cBTInserter.get_root(); &#x2F;&#x2F; 返回根节点 [1, 2, 3, 4]</p></blockquote></div><div class="story post-story"><h2 id="思路："><a href="#思路：" class="headerlink" title="思路："></a>思路：</h2><p>应用队列实现树的层序遍历：</p><blockquote><ol><li>首先将二叉树的根节点进队，判断队列不为空，就输出队头的元素</li><li>判断节点如果有孩子，就将孩子进队</li><li>遍历过的节点出队</li><li>循环，直到q.empty()</li></ol></blockquote></div><div class="story post-story"><h2 id="代码-cpp-："><a href="#代码-cpp-：" class="headerlink" title="代码(cpp)："></a>代码(cpp)：</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">CBTInserter</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">//存入最底层的节点方便以后插入</span></span><br><span class="line">    queue&lt;TreeNode*&gt; node;</span><br><span class="line">    TreeNode* root;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//获取底层节点</span></span><br><span class="line">    <span class="built_in">CBTInserter</span>(TreeNode* root) &#123;</span><br><span class="line">        <span class="keyword">this</span>-&gt;root = root;</span><br><span class="line">        queue&lt;TreeNode*&gt; q;</span><br><span class="line">        <span class="comment">//向队尾插入节点</span></span><br><span class="line">        q.<span class="built_in">push</span>(root); </span><br><span class="line">        </span><br><span class="line">        <span class="keyword">while</span> (!q.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">            <span class="comment">//返回队列中的第一个元素</span></span><br><span class="line">            TreeNode* n = q.<span class="built_in">front</span>(); </span><br><span class="line">            <span class="comment">//删除队列第一个元素</span></span><br><span class="line">            q.<span class="built_in">pop</span>(); </span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (n-&gt;left) &#123;</span><br><span class="line">                q.<span class="built_in">push</span>(n-&gt;left);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (n-&gt;right) &#123;</span><br><span class="line">                q.<span class="built_in">push</span>(n-&gt;right);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (!(n-&gt;left &amp;&amp; n-&gt;right)) &#123; <span class="comment">//获取最底层的节点</span></span><br><span class="line">                node.<span class="built_in">push</span>(n);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">insert</span><span class="params">(<span class="type">int</span> val)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//创建一个新节点</span></span><br><span class="line">        TreeNode* new_node = <span class="keyword">new</span> <span class="built_in">TreeNode</span>(val);</span><br><span class="line">        <span class="comment">// 获得队列的第一个元素</span></span><br><span class="line">        TreeNode* n = node.<span class="built_in">front</span>(); </span><br><span class="line">        <span class="comment">//获取该节点的值</span></span><br><span class="line">        <span class="type">int</span> ret = n-&gt;val;</span><br><span class="line">        <span class="comment">// 如果不存在，就插入左节点</span></span><br><span class="line">        <span class="keyword">if</span>(!(n-&gt;left))&#123;</span><br><span class="line">            n-&gt;left = new_node;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//存在，就插入到右节点</span></span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            n-&gt;right = new_node;</span><br><span class="line">            <span class="comment">//删除该节点，因为左右节点都已经存在</span></span><br><span class="line">            node.<span class="built_in">pop</span>(); </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//将新节点插入到队列</span></span><br><span class="line">        node.<span class="built_in">push</span>(new_node);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function">TreeNode* <span class="title">get_root</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> root;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="复杂度分析："><a href="#复杂度分析：" class="headerlink" title="复杂度分析："></a>复杂度分析：</h2><ul><li><p>时间复杂度：初始化 CBTInserter(root) 需要的时间为 O(n)，其中 n 是给定的初始完全二叉树的节点个数。insert(v) 和 get_root() 的时间复杂度均为 O(1)。</p></li><li><p>空间复杂度：O(n+q)，其中 q 是 insert(v) 的调用次数。在调用了 q 次 insert(v) 后，完全二叉树中有 n+q 个节点，其中有一半的节点在队列中，需要 O(n+q) 的空间。</p></li></ul></div>]]></content>
      
      
      <categories>
          
          <category> 每日LeetCode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
            <tag> LeetCode </tag>
            
            <tag> 数据结构 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>(每日LeetCode)1184. 公交站间的距离</title>
      <link href="/2022/07/24/%E6%AF%8F%E6%97%A5LeetCode/2022-7/1184%20%E5%85%AC%E4%BA%A4%E7%AB%99%E9%97%B4%E7%9A%84%E8%B7%9D%E7%A6%BB/"/>
      <url>/2022/07/24/%E6%AF%8F%E6%97%A5LeetCode/2022-7/1184%20%E5%85%AC%E4%BA%A4%E7%AB%99%E9%97%B4%E7%9A%84%E8%B7%9D%E7%A6%BB/</url>
      
        <content type="html"><![CDATA[<div class="story post-story"><h2 id="题目："><a href="#题目：" class="headerlink" title="题目："></a>题目：</h2><p>环形公交路线上有 <code>n</code> 个站，按次序从 <code>0</code> 到 <code>n - 1</code> 进行编号。我们已知每一对相邻公交站之间的距离，<code>distance[i]</code> 表示编号为 <code>i</code> 的车站和编号为 <code>(i + 1) % n</code> 的车站之间的距离。</p><p>环线上的公交车都可以按顺时针和逆时针的方向行驶。</p><p>返回乘客从出发点 <code>start</code> 到目的地 <code>destination</code> 之间的最短距离。</p></div><div class="story post-story"><h2 id="示例："><a href="#示例：" class="headerlink" title="示例："></a>示例：</h2><img src="https://assets.leetcode-cn.com/aliyun-lc-upload/uploads/2019/09/08/untitled-diagram-1.jpg" class="lazyload" data-srcset="https://assets.leetcode-cn.com/aliyun-lc-upload/uploads/2019/09/08/untitled-diagram-1.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img" style="zoom:67%;" /><blockquote><p>输入：distance &#x3D; [1,2,3,4], start &#x3D; 0, destination &#x3D; 1<br>输出：1<br>解释：公交站 0 和 1 之间的距离顺时针是 1 ，逆时针是 9，所以最小值是 1。</p></blockquote></div><div class="story post-story"><h2 id="思路："><a href="#思路：" class="headerlink" title="思路："></a>思路：</h2><p>先计算总的距离<code>all_sum</code>，再计算<code>start</code>到<code>destination</code>的距离为<code>positive_sum</code></p><p>返回顺时针的距离<code>positive_sum</code>以及逆时针的距离<code>all_sum-positive_sum</code>它们中的最小距离</p></div><div class="story post-story"><h2 id="代码-cpp-："><a href="#代码-cpp-：" class="headerlink" title="代码(cpp)："></a>代码(cpp)：</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">distanceBetweenBusStops</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; distance, <span class="type">int</span> start, <span class="type">int</span> destination)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> all_sum = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i =<span class="number">0</span>; i &lt; distance.<span class="built_in">size</span>(); i++)&#123;</span><br><span class="line">            all_sum += distance[i];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(start &gt; destination) <span class="built_in">swap</span>(start, destination);</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> positive_sum = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(start; start &lt; destination; start++)&#123;</span><br><span class="line">            positive_sum += distance[start];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">min</span>(positive_sum, all_sum - positive_sum);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>优化后：将两个循环合并在一起</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">distanceBetweenBusStops</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; distance, <span class="type">int</span> start, <span class="type">int</span> destination)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> all_sum = <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> positive_sum = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(start &gt; destination) <span class="built_in">swap</span>(start, destination);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i =<span class="number">0</span>; i &lt; distance.<span class="built_in">size</span>(); i++)&#123;</span><br><span class="line">            all_sum += distance[i];</span><br><span class="line">            <span class="keyword">if</span>(i &gt;= start &amp;&amp; i &lt; destination)&#123;</span><br><span class="line">                positive_sum += distance[i];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">min</span>(positive_sum, all_sum - positive_sum);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></div>]]></content>
      
      
      <categories>
          
          <category> 每日LeetCode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
            <tag> LeetCode </tag>
            
            <tag> 数据结构 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>(每日LeetCode)814. 二叉树剪枝</title>
      <link href="/2022/07/21/%E6%AF%8F%E6%97%A5LeetCode/2022-7/814%20%E4%BA%8C%E5%8F%89%E6%A0%91%E5%89%AA%E6%9E%9D/"/>
      <url>/2022/07/21/%E6%AF%8F%E6%97%A5LeetCode/2022-7/814%20%E4%BA%8C%E5%8F%89%E6%A0%91%E5%89%AA%E6%9E%9D/</url>
      
        <content type="html"><![CDATA[<div class="story post-story"><h2 id="题目："><a href="#题目：" class="headerlink" title="题目："></a>题目：</h2><p>给你二叉树的根结点 <code>root</code> ，此外树的每个结点的值要么是 <code>0</code> ，要么是 <code>1</code> 。</p><p>返回移除了所有不包含 1 的子树的原二叉树。</p><p>节点 <code>node</code> 的子树为 <code>node</code> 本身加上所有 <code>node</code> 的后代。</p></div><div class="story post-story"><h2 id="示例："><a href="#示例：" class="headerlink" title="示例："></a>示例：</h2><img src="https://s3-lc-upload.s3.amazonaws.com/uploads/2018/04/06/1028_2.png" class="lazyload" data-srcset="https://s3-lc-upload.s3.amazonaws.com/uploads/2018/04/06/1028_2.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img" style="zoom: 33%;" /><blockquote><p>输入：root &#x3D; [1,null,0,0,1]<br>输出：[1,null,0,null,1]<br>解释：<br>只有红色节点满足条件“所有不包含 1 的子树”。 右图为返回的答案。</p></blockquote><p><code>自底向上</code>进行剪枝，如果某个节点不存在左右节点，并且该节点值为0的话就需要<code>剪枝</code></p></div><div class="story post-story"><h2 id="代码-cpp-："><a href="#代码-cpp-：" class="headerlink" title="代码(cpp)："></a>代码(cpp)：</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">TreeNode* <span class="title">pruneTree</span><span class="params">(TreeNode* root)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(root == <span class="literal">nullptr</span>) <span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">        </span><br><span class="line">        root-&gt;left = <span class="built_in">pruneTree</span>(root-&gt;left);</span><br><span class="line">        root-&gt;right = <span class="built_in">pruneTree</span>(root-&gt;right);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(root-&gt;left == <span class="literal">nullptr</span> &amp;&amp; root-&gt;right ==<span class="literal">nullptr</span> &amp;&amp; root-&gt;val == <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> root;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="复杂度分析："><a href="#复杂度分析：" class="headerlink" title="复杂度分析："></a>复杂度分析：</h2><ul><li><p>时间复杂度：O(n)，其中 n 是二叉树节点的个数。每个节点都需要遍历一次。</p></li><li><p>空间复杂度：O(n)，其中 n 是二叉树节点的个数。递归的深度最多为 O(n)。</p></li></ul></div>]]></content>
      
      
      <categories>
          
          <category> 每日LeetCode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
            <tag> LeetCode </tag>
            
            <tag> 数据结构 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>(每日LeetCode)1252. 奇数值单元格的数目</title>
      <link href="/2022/07/12/%E6%AF%8F%E6%97%A5LeetCode/2022-7/1252%20%E5%A5%87%E6%95%B0%E5%80%BC%E5%8D%95%E5%85%83%E6%A0%BC%E7%9A%84%E6%95%B0%E7%9B%AE/"/>
      <url>/2022/07/12/%E6%AF%8F%E6%97%A5LeetCode/2022-7/1252%20%E5%A5%87%E6%95%B0%E5%80%BC%E5%8D%95%E5%85%83%E6%A0%BC%E7%9A%84%E6%95%B0%E7%9B%AE/</url>
      
        <content type="html"><![CDATA[<div class="story post-story"><h2 id="题目："><a href="#题目：" class="headerlink" title="题目："></a>题目：</h2><p>给你一个 <code>m</code> x <code>n</code> 的矩阵，最开始的时候，每个单元格中的值都是 0。</p><p>另有一个二维索引数组 <code>indices</code>，<code>indices[i] = [ri, ci]</code> 指向矩阵中的某个位置，其中 <code>ri</code> 和 <code>ci</code> 分别表示指定的行和列（从 0 开始编号）。</p><p>对 <code>indices[i]</code> 所指向的每个位置，应同时执行下述增量操作：</p><p><code>ri</code> 行上的所有单元格，加 1 。<br><code>ci</code> 列上的所有单元格，加 1 。<br>给你 <code>m</code>、<code>n</code> 和 <code>indices</code> 。请你在执行完所有 <code>indices</code> 指定的增量操作后，返回矩阵中 奇数值单元格 的数目。</p></div><div class="story post-story"><h2 id="示例："><a href="#示例：" class="headerlink" title="示例："></a>示例：</h2><blockquote><p>输入：m &#x3D; 2, n &#x3D; 3, indices &#x3D; [[0,1],[1,1]]<br>输出：6<br>解释：</p><p>[[0,0,0],     &#x3D;&#x3D;&gt;     [[1,2,1],    &#x3D;&#x3D;&gt;    [[1,3,1],  </p><p> [0,0,0]]                 [0,1,0]]              [1,3,1]]    返回奇数的个数</p></blockquote></div><div class="story post-story"><h2 id="代码-cpp-："><a href="#代码-cpp-：" class="headerlink" title="代码(cpp)："></a>代码(cpp)：</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">oddCells</span><span class="params">(<span class="type">int</span> m, <span class="type">int</span> n, vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&amp; indices)</span> </span>&#123;</span><br><span class="line">        <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">dp</span><span class="params">(n)</span></span>;</span><br><span class="line">        vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; <span class="built_in">dps</span>(m, dp);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; indices.<span class="built_in">size</span>(); i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; n; j++) &#123;</span><br><span class="line">                dps[indices[i][<span class="number">0</span>]][j] += <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> k = <span class="number">0</span>; k &lt; m; k++) &#123;</span><br><span class="line">                dps[k][indices[i][<span class="number">1</span>]] += <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> count = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; m; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; n; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (dps[i][j] % <span class="number">2</span> != <span class="number">0</span>) &#123;</span><br><span class="line">                    count++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="复杂度分析："><a href="#复杂度分析：" class="headerlink" title="复杂度分析："></a>复杂度分析：</h2><ul><li><p>时间复杂度：O(q×(m+n)+m×n), 其中 q 表示数组 indices 的长度，m,n 为矩阵的行数与列数。遍历数组时，每次都需要更新矩阵中一行加一列，需要的时间为 O(q×(m+n))，最后还需要遍历矩阵，需要的时间为 O(m×n)，总的时间复杂度为 O(q×(m+n)+m×n)。</p></li><li><p>空间复杂度：O(m×n)，其中 m,n 为矩阵的行数与列数。需要存储矩阵的所有元素。</p></li></ul></div>]]></content>
      
      
      <categories>
          
          <category> 每日LeetCode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
            <tag> LeetCode </tag>
            
            <tag> 数据结构 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>(每日LeetCode)676. 实现一个魔法字典</title>
      <link href="/2022/07/11/%E6%AF%8F%E6%97%A5LeetCode/2022-7/676%20%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E9%AD%94%E6%B3%95%E5%AD%97%E5%85%B8/"/>
      <url>/2022/07/11/%E6%AF%8F%E6%97%A5LeetCode/2022-7/676%20%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E9%AD%94%E6%B3%95%E5%AD%97%E5%85%B8/</url>
      
        <content type="html"><![CDATA[<div class="story post-story"><h2 id="题目："><a href="#题目：" class="headerlink" title="题目："></a>题目：</h2><p>设计一个使用单词列表进行初始化的数据结构，单词列表中的单词 互不相同 。 如果给出一个单词，请判定能否只将这个单词中一个字母换成另一个字母，使得所形成的新单词存在于你构建的字典中。</p><p>实现 <code>MagicDictionary</code> 类：</p><p><code>MagicDictionary()</code> 初始化对象<br><code>void buildDict(String[] dictionary)</code> 使用字符串数组 <code>dictionary</code> 设定该数据结构，<code>dictionary</code> 中的字符串互不相同<br><code>bool search(String searchWord)</code> 给定一个字符串 <code>searchWord</code> ，判定能否只将字符串中 一个 字母换成另一个字母，使得所形成的新字符串能够与字典中的任一字符串匹配。如果可以，返回 <code>true</code>；否则，返回 <code>false</code>。 </p></div><div class="story post-story"><h2 id="示例："><a href="#示例：" class="headerlink" title="示例："></a>示例：</h2><blockquote><p>输入<br>[“MagicDictionary”, “buildDict”, “search”, “search”, “search”, “search”]<br>[[], [[“hello”, “leetcode”]], [“hello”], [“hhllo”], [“hell”], [“leetcoded”]]<br>输出<br>[null, null, false, true, false, false]</p><p>解释<br>MagicDictionary magicDictionary &#x3D; new MagicDictionary();<br>magicDictionary.buildDict([“hello”, “leetcode”]);<br>magicDictionary.search(“hello”); &#x2F;&#x2F; 返回 False<br>magicDictionary.search(“hhllo”); &#x2F;&#x2F; 将第二个 ‘h’ 替换为 ‘e’ 可以匹配 “hello” ，所以返回 True<br>magicDictionary.search(“hell”); &#x2F;&#x2F; 返回 False<br>magicDictionary.search(“leetcoded”); &#x2F;&#x2F; 返回 False</p></blockquote></div><div class="story post-story"><h2 id="思路："><a href="#思路：" class="headerlink" title="思路："></a>思路：</h2><p>遍历词典，找到与<code>searchWord</code>单词长度一样的单词，再与之对比相同的位置的字母是否相同，记录不相同字母的次数，只有不相同的字母的次数为1时，才可以返回<code>true</code></p></div><div class="story post-story"><h2 id="代码-cpp-："><a href="#代码-cpp-：" class="headerlink" title="代码(cpp)："></a>代码(cpp)：</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MagicDictionary</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    vector&lt;string&gt; dic;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">MagicDictionary</span>() &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">buildDict</span><span class="params">(vector&lt;string&gt; dictionary)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>-&gt;dic= dictionary;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">search</span><span class="params">(string searchWord)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> n = searchWord.<span class="built_in">size</span>();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; dic.<span class="built_in">size</span>(); i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(dic[i].<span class="built_in">size</span>() == n)&#123;</span><br><span class="line">                <span class="type">int</span> count = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> j = <span class="number">0</span>; j &lt; n; j++)&#123;</span><br><span class="line">                    <span class="keyword">if</span>(dic[i][j] != searchWord[j])&#123;</span><br><span class="line">                        count++;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(count == <span class="number">1</span>) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="复杂度分析："><a href="#复杂度分析：" class="headerlink" title="复杂度分析："></a>复杂度分析：</h2><ul><li>时间复杂度：O(qnl)，其中 n 是数组 dictionary 的长度，l 是数组 dictionary 中字符串的平均长度，q 是函数 search(searchWord) 的调用次数。</li></ul><ul><li>空间复杂度：O(nl)，即为数组需要使用的空间。</li></ul></div>]]></content>
      
      
      <categories>
          
          <category> 每日LeetCode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
            <tag> LeetCode </tag>
            
            <tag> 数据结构 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>(每日LeetCode)873. 最长的斐波那契子序列的长度</title>
      <link href="/2022/07/09/%E6%AF%8F%E6%97%A5LeetCode/2022-7/873%20%E6%9C%80%E9%95%BF%E7%9A%84%E6%96%90%E6%B3%A2%E9%82%A3%E5%A5%91%E5%AD%90%E5%BA%8F%E5%88%97%E7%9A%84%E9%95%BF%E5%BA%A6/"/>
      <url>/2022/07/09/%E6%AF%8F%E6%97%A5LeetCode/2022-7/873%20%E6%9C%80%E9%95%BF%E7%9A%84%E6%96%90%E6%B3%A2%E9%82%A3%E5%A5%91%E5%AD%90%E5%BA%8F%E5%88%97%E7%9A%84%E9%95%BF%E5%BA%A6/</url>
      
        <content type="html"><![CDATA[<div class="story post-story"><h2 id="题目："><a href="#题目：" class="headerlink" title="题目："></a>题目：</h2><p>如果序列 $X_1, X_2, …, X_n$ 满足下列条件，就说它是 斐波那契式 的：</p><p>n &gt;&#x3D; 3<br>对于所有 i + 2 &lt;&#x3D; n，都有 $X_i + X_{i+1} &#x3D; X_{i+2}$<br>给定一个严格递增的正整数数组形成序列 <code>arr</code> ，找到 <code>arr</code> 中最长的斐波那契式的子序列的长度。如果一个不存在，返回  0 。</p><p>（回想一下，子序列是从原序列 <code>arr</code> 中派生出来的，它从 <code>arr</code> 中删掉任意数量的元素（也可以不删），而不改变其余元素的顺序。例如， [3, 5, 8] 是 [3, 4, 5, 6, 7, 8] 的一个子序列）</p></div><div class="story post-story"><h2 id="示例："><a href="#示例：" class="headerlink" title="示例："></a>示例：</h2><blockquote><p>输入: arr &#x3D; [1,3,7,11,12,14,18]<br>输出: 3<br>解释: 最长的斐波那契式子序列有 [1,11,12]、[3,11,14] 以及 [7,11,18] 。</p></blockquote></div><div class="story post-story"><h2 id="思路：递归"><a href="#思路：递归" class="headerlink" title="思路：递归"></a>思路：递归</h2><p>费劲尽心，最后运行超时！！</p><h3 id="代码-cpp-："><a href="#代码-cpp-：" class="headerlink" title="代码(cpp)："></a>代码(cpp)：</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">def</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; arr, vector&lt;<span class="type">int</span>&gt; dp, <span class="type">int</span> pos)</span></span>&#123;</span><br><span class="line">        <span class="type">int</span> ans = <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> n = dp.<span class="built_in">size</span>();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=pos; i &lt; arr.<span class="built_in">size</span>(); i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(n &lt; <span class="number">2</span>)&#123;</span><br><span class="line">                <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">n_dp</span><span class="params">(dp)</span></span>;</span><br><span class="line">                n_dp.<span class="built_in">emplace_back</span>(arr[i]);</span><br><span class="line">                ans = <span class="built_in">max</span>(<span class="built_in">def</span>(arr, n_dp, i+<span class="number">1</span>)+<span class="number">1</span>, ans);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(n &gt;= <span class="number">2</span> &amp;&amp; dp[n<span class="number">-1</span>] + dp[n<span class="number">-2</span>] == arr[i])&#123;</span><br><span class="line">                vector&lt;<span class="type">int</span>&gt; <span class="built_in">n_dp</span>(dp);</span><br><span class="line">                n_dp.<span class="built_in">emplace_back</span>(arr[i]);</span><br><span class="line">                ans = <span class="built_in">max</span>(<span class="built_in">def</span>(arr, n_dp, i+<span class="number">1</span>)+<span class="number">1</span>, ans);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(ans &lt;= <span class="number">2</span> &amp;&amp; pos &lt; <span class="number">2</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">lenLongestFibSubseq</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; arr)</span> </span>&#123;</span><br><span class="line">        vector&lt;<span class="type">int</span>&gt; dp;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">def</span>(arr, dp, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="思路：动态规划"><a href="#思路：动态规划" class="headerlink" title="思路：动态规划"></a>思路：动态规划</h2><p>摆烂了！</p><p><code>arr[k]+arr[j]=arr[i]</code></p><p>大小：<code>k&lt;j&lt;i</code></p><h3 id="代码-cpp-：-1"><a href="#代码-cpp-：-1" class="headerlink" title="代码(cpp)："></a>代码(cpp)：</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">lenLongestFibSubseq</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; arr)</span> </span>&#123;</span><br><span class="line">        unordered_map&lt;<span class="type">int</span>, <span class="type">int</span>&gt; indices;</span><br><span class="line">        <span class="type">int</span> n = arr.<span class="built_in">size</span>();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            indices[arr[i]] = i;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//创建全是0的n*n二维数组</span></span><br><span class="line">        vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; <span class="built_in">dp</span>(n, <span class="built_in">vector</span>&lt;<span class="type">int</span>&gt;(n));</span><br><span class="line">        <span class="type">int</span> ans = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> j = i - <span class="number">1</span>; j &gt;= <span class="number">0</span> &amp;&amp; arr[j] * <span class="number">2</span> &gt; arr[i]; j--) &#123;</span><br><span class="line">                <span class="type">int</span> k = <span class="number">-1</span>;</span><br><span class="line">                <span class="comment">//如果indices中存在arr[i]-arr[j]这个数</span></span><br><span class="line">                <span class="keyword">if</span> (indices.<span class="built_in">count</span>(arr[i] - arr[j])) &#123;</span><br><span class="line">                    <span class="comment">//获得获得此数</span></span><br><span class="line">                    k = indices[arr[i] - arr[j]];</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">//如果k不等于-1</span></span><br><span class="line">                <span class="keyword">if</span> (k &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">                    dp[j][i] = <span class="built_in">max</span>(dp[k][j] + <span class="number">1</span>, <span class="number">3</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">//获得到最大的序列长度</span></span><br><span class="line">                ans = <span class="built_in">max</span>(ans, dp[j][i]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="复杂度分析："><a href="#复杂度分析：" class="headerlink" title="复杂度分析："></a>复杂度分析：</h3><ul><li><p>时间复杂度：O(n^2)，其中 n 是数组 arr 的长度。动态规划的状态数是 O(n^2)，每个状态的计算时间都是 O(1)</p></li><li><p>空间复杂度：O(n^2)，其中 n 是数组 arr 的长度。需要创建二维数组 dp，空间是 O(n^2)</p></li></ul></div>]]></content>
      
      
      <categories>
          
          <category> 每日LeetCode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
            <tag> LeetCode </tag>
            
            <tag> 数据结构 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>(每日LeetCode)1846. 减小和重新排列数组后的最大元素</title>
      <link href="/2022/07/08/%E6%AF%8F%E6%97%A5LeetCode/2022-7/1846%20%E5%87%8F%E5%B0%8F%E5%92%8C%E9%87%8D%E6%96%B0%E6%8E%92%E5%88%97%E6%95%B0%E7%BB%84%E5%90%8E%E7%9A%84%E6%9C%80%E5%A4%A7%E5%85%83%E7%B4%A0/"/>
      <url>/2022/07/08/%E6%AF%8F%E6%97%A5LeetCode/2022-7/1846%20%E5%87%8F%E5%B0%8F%E5%92%8C%E9%87%8D%E6%96%B0%E6%8E%92%E5%88%97%E6%95%B0%E7%BB%84%E5%90%8E%E7%9A%84%E6%9C%80%E5%A4%A7%E5%85%83%E7%B4%A0/</url>
      
        <content type="html"><![CDATA[<div class="story post-story"><h2 id="题目："><a href="#题目：" class="headerlink" title="题目："></a>题目：</h2><p>给你一个正整数数组 <code>arr</code> 。请你对 <code>arr</code> 执行一些操作（也可以不进行任何操作），使得数组满足以下条件：</p><p><code>arr</code> 中 第一个 元素必须为 1 。<br>任意相邻两个元素的差的绝对值 小于等于 1 ，也就是说，对于任意的 <code>1 &lt;= i &lt; arr.length</code> （数组下标从 0 开始），都满足 <code>abs(arr[i] - arr[i - 1]) &lt;= 1</code> 。<code>abs(x)</code> 为 x 的绝对值。<br>你可以执行以下 2 种操作任意次：</p><p>减小 <code>arr</code> 中任意元素的值，使其变为一个 更小的正整数 。<br>重新排列 <code>arr</code> 中的元素，你可以以任意顺序重新排列。<br>请你返回执行以上操作后，在满足前文所述的条件下，<code>arr</code> 中可能的 最大值 。</p></div><div class="story post-story"><h2 id="示例："><a href="#示例：" class="headerlink" title="示例："></a>示例：</h2><blockquote><p>输入：arr &#x3D; [100,1,1000]<br>输出：3<br>解释：<br>一个可行的方案如下：</p><ol><li>重新排列 arr 得到 [1,100,1000] 。</li><li>将第二个元素减小为 2 。</li><li>将第三个元素减小为 3 。<br>现在 arr &#x3D; [1,2,3] ，满足所有条件。<br>arr 中最大元素为 3 。</li></ol></blockquote></div><div class="story post-story"><h2 id="代码-cpp-："><a href="#代码-cpp-：" class="headerlink" title="代码(cpp)："></a>代码(cpp)：</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">maximumElementAfterDecrementingAndRearranging</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; arr)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//将arr数组排序</span></span><br><span class="line">        <span class="built_in">sort</span>(arr.<span class="built_in">begin</span>(), arr.<span class="built_in">end</span>());</span><br><span class="line">        <span class="comment">//如果第一个元素不为1，则设置为1</span></span><br><span class="line">        <span class="keyword">if</span>(arr[<span class="number">0</span>] != <span class="number">1</span>) arr[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">将最大数设置为数组第一个元素</span><br><span class="line">        <span class="type">int</span> max = arr[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt; arr.<span class="built_in">size</span>(); i++)&#123;</span><br><span class="line">            <span class="comment">//当前的元素减去前面的元素，它们的绝对值肯定是大于0的</span></span><br><span class="line">            <span class="type">int</span> temp = arr[i] - arr[i<span class="number">-1</span>];</span><br><span class="line">            <span class="comment">//如果绝对值大于1，则设置当前的元素为前面的元素+1</span></span><br><span class="line">            <span class="keyword">if</span>(temp &gt; <span class="number">1</span>) arr[i] = arr[i<span class="number">-1</span>]+<span class="number">1</span>;</span><br><span class="line">            <span class="comment">//如果当前元素大于max的元素，将当前元素设置为最大数</span></span><br><span class="line">            <span class="keyword">if</span>(arr[i] &gt; max) max = arr[i];</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">//返回最大数</span></span><br><span class="line">        <span class="keyword">return</span> max;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="复杂度分析："><a href="#复杂度分析：" class="headerlink" title="复杂度分析："></a>复杂度分析：</h2><ul><li><p>时间复杂度：O(nlogn)，其中 n 是数组 arr 的长度。时间复杂度即排序的复杂度。</p></li><li><p>空间复杂度：O(logn)。空间复杂度不考虑输入，因此空间复杂度主要取决于排序时产生的 O(logn) 的栈空间。</p></li></ul></div>]]></content>
      
      
      <categories>
          
          <category> 每日LeetCode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
            <tag> LeetCode </tag>
            
            <tag> 数据结构 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>(每日LeetCode)593. 有效的正方形</title>
      <link href="/2022/07/08/%E6%AF%8F%E6%97%A5LeetCode/2022-7/593%20%E6%9C%89%E6%95%88%E7%9A%84%E6%AD%A3%E6%96%B9%E5%BD%A2/"/>
      <url>/2022/07/08/%E6%AF%8F%E6%97%A5LeetCode/2022-7/593%20%E6%9C%89%E6%95%88%E7%9A%84%E6%AD%A3%E6%96%B9%E5%BD%A2/</url>
      
        <content type="html"><![CDATA[<div class="story post-story"><h2 id="题目："><a href="#题目：" class="headerlink" title="题目："></a>题目：</h2><p>给定2D空间中四个点的坐标 p1, p2, p3 和 p4，如果这四个点构成一个正方形，则返回 true 。</p><p>点的坐标 pi 表示为 [xi, yi] 。输入 不是 按任何顺序给出的。</p><p>一个 有效的正方形 有四条等边和四个等角(90度角)。</p></div><div class="story post-story"><h2 id="示例："><a href="#示例：" class="headerlink" title="示例："></a>示例：</h2><blockquote><p>输入：p1 &#x3D; [1,0], p2 &#x3D; [-1,0], p3 &#x3D; [0,1], p4 &#x3D; [0,-1]<br>输出：true</p></blockquote></div><div class="story post-story"><h2 id="思路："><a href="#思路：" class="headerlink" title="思路："></a>思路：</h2><p>自己想出的一种很无脑的思路！</p><p>先做一个判断，某一行或某一列是否存在三个以上的点，存在则不可能是正方形</p><p>选取其中一个最小的点，计算与其余点之间的距离。如果是正方形的话，一定有两个相等的边长，和一个较长的对角线，并且满足勾股定理。</p></div><div class="story post-story"><h2 id="代码-cpp-："><a href="#代码-cpp-：" class="headerlink" title="代码(cpp)："></a>代码(cpp)：</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">judge</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; p1, vector&lt;<span class="type">int</span>&gt;&amp; p2, vector&lt;<span class="type">int</span>&gt;&amp; p3, vector&lt;<span class="type">int</span>&gt;&amp; p4)</span></span>&#123;</span><br><span class="line">        <span class="type">int</span> count = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span>(p1[<span class="number">0</span>] == p2[<span class="number">0</span>]) count++;</span><br><span class="line">        <span class="keyword">if</span>(p1[<span class="number">0</span>] == p3[<span class="number">0</span>]) count++;</span><br><span class="line">        <span class="keyword">if</span>(p1[<span class="number">0</span>] == p4[<span class="number">0</span>]) count++;</span><br><span class="line"><span class="comment">//判断某行，是否存在三个点</span></span><br><span class="line">        <span class="keyword">if</span>(count &gt;= <span class="number">2</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">        count = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span>(p1[<span class="number">1</span>] == p2[<span class="number">1</span>]) count++;</span><br><span class="line">        <span class="keyword">if</span>(p1[<span class="number">1</span>] == p3[<span class="number">1</span>]) count++;</span><br><span class="line">        <span class="keyword">if</span>(p1[<span class="number">1</span>] == p4[<span class="number">1</span>]) count++;</span><br><span class="line"><span class="comment">//判断某列，是否存在三个点</span></span><br><span class="line">        <span class="keyword">if</span>(count &gt;= <span class="number">2</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">validSquare</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; p1, vector&lt;<span class="type">int</span>&gt;&amp; p2, vector&lt;<span class="type">int</span>&gt;&amp; p3, vector&lt;<span class="type">int</span>&gt;&amp; p4)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//判断是否存在有三个点在一条线上</span></span><br><span class="line">        <span class="keyword">if</span>(!<span class="built_in">is_duo</span>(p1,p2,p3,p4)) <span class="keyword">return</span> <span class="literal">false</span>; </span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> n1 = p1[<span class="number">0</span>] + p1[<span class="number">1</span>];</span><br><span class="line">        <span class="type">int</span> n2 = p2[<span class="number">0</span>] + p2[<span class="number">1</span>];</span><br><span class="line">        <span class="type">int</span> n3 = p3[<span class="number">0</span>] + p3[<span class="number">1</span>];</span><br><span class="line">        <span class="type">int</span> n4 = p4[<span class="number">0</span>] + p4[<span class="number">1</span>];</span><br><span class="line">        </span><br><span class="line"><span class="comment">//选取一个最小的点作为计算与其余点之间的距离</span></span><br><span class="line">        <span class="type">int</span> min_num = <span class="built_in">min</span>(n1, n2);</span><br><span class="line">        min_num = <span class="built_in">min</span>(n3, min_num);</span><br><span class="line">        min_num = <span class="built_in">min</span>(n4, min_num);</span><br><span class="line"><span class="comment">//与p1点交换，使p1点变为最小点</span></span><br><span class="line">        <span class="keyword">if</span>(min_num == n2) p1.<span class="built_in">swap</span>(p2);</span><br><span class="line">        <span class="keyword">if</span>(min_num == n3) p1.<span class="built_in">swap</span>(p3);</span><br><span class="line">        <span class="keyword">if</span>(min_num == n4) p1.<span class="built_in">swap</span>(p4);</span><br><span class="line">        </span><br><span class="line"></span><br><span class="line">        vector&lt;<span class="type">int</span>&gt; nums;</span><br><span class="line">        <span class="comment">//计算p1点到其余三个点的距离，未取根号因为会产生小数</span></span><br><span class="line">        <span class="type">int</span> num1 = <span class="built_in">pow</span>(p1[<span class="number">0</span>]-p2[<span class="number">0</span>], <span class="number">2</span>) + <span class="built_in">pow</span>(p1[<span class="number">1</span>]-p2[<span class="number">1</span>], <span class="number">2</span>);</span><br><span class="line">        nums.<span class="built_in">push_back</span>(num1);</span><br><span class="line">        </span><br><span class="line">        <span class="type">int</span> num2 = <span class="built_in">pow</span>(p1[<span class="number">0</span>]-p3[<span class="number">0</span>], <span class="number">2</span>) + <span class="built_in">pow</span>(p1[<span class="number">1</span>]-p3[<span class="number">1</span>], <span class="number">2</span>);</span><br><span class="line">        nums.<span class="built_in">push_back</span>(num2);</span><br><span class="line">        </span><br><span class="line">        <span class="type">int</span> num3 = <span class="built_in">pow</span>(p1[<span class="number">0</span>]-p4[<span class="number">0</span>], <span class="number">2</span>) + <span class="built_in">pow</span>(p1[<span class="number">1</span>]-p4[<span class="number">1</span>], <span class="number">2</span>);</span><br><span class="line">        nums.<span class="built_in">push_back</span>(num3);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">sort</span>(nums.<span class="built_in">begin</span>(), nums.<span class="built_in">end</span>()); <span class="comment">//排序，对角线大于边长</span></span><br><span class="line"><span class="comment">//如果存在对角线为0</span></span><br><span class="line">        <span class="keyword">if</span>(nums[<span class="number">2</span>] == <span class="number">0</span>) <span class="keyword">return</span> <span class="literal">false</span>; </span><br><span class="line">        <span class="comment">//如果两条边长不相等 </span></span><br><span class="line">        <span class="keyword">if</span>(nums[<span class="number">0</span>] != nums[<span class="number">1</span>]) <span class="keyword">return</span> <span class="literal">false</span>; </span><br><span class="line">        <span class="comment">//勾股定理，判断是否为直角</span></span><br><span class="line">        <span class="keyword">if</span>(nums[<span class="number">0</span>] + nums[<span class="number">1</span>] != nums[<span class="number">2</span>]) <span class="keyword">return</span> <span class="literal">false</span>; </span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></div>]]></content>
      
      
      <categories>
          
          <category> 每日LeetCode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
            <tag> LeetCode </tag>
            
            <tag> 数据结构 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>(每日LeetCode)729. 我的日程安排表 I</title>
      <link href="/2022/07/05/%E6%AF%8F%E6%97%A5LeetCode/2022-7/729%20%E6%88%91%E7%9A%84%E6%97%A5%E7%A8%8B%E5%AE%89%E6%8E%92%E8%A1%A8%20I/"/>
      <url>/2022/07/05/%E6%AF%8F%E6%97%A5LeetCode/2022-7/729%20%E6%88%91%E7%9A%84%E6%97%A5%E7%A8%8B%E5%AE%89%E6%8E%92%E8%A1%A8%20I/</url>
      
        <content type="html"><![CDATA[<div class="story post-story"><h2 id="题目："><a href="#题目：" class="headerlink" title="题目："></a>题目：</h2><p>实现一个 <code>MyCalendar</code> 类来存放你的日程安排。如果要添加的日程安排不会造成 重复预订 ，则可以存储这个新的日程安排。</p><p>当两个日程安排有一些时间上的交叉时（例如两个日程安排都在同一时间内），就会产生 重复预订 。</p><p>日程可以用一对整数 <code>start</code> 和 <code>end</code> 表示，这里的时间是半开区间，即 <code>[start, end)</code>, 实数 x 的范围为，  <code>start &lt;= x &lt; end</code> 。</p><p>实现 <code>MyCalendar</code> 类：</p><p><code>MyCalendar()</code> 初始化日历对象。<br><code>boolean book(int start, int end)</code> 如果可以将日程安排成功添加到日历中而不会导致重复预订，返回 <code>true</code>。否则，返回 <code>false</code> 并且不要将该日程安排添加到日历中。</p></div><div class="story post-story"><h2 id="示例："><a href="#示例：" class="headerlink" title="示例："></a>示例：</h2><blockquote><p>输入：<br>[“MyCalendar”, “book”, “book”, “book”]<br>[[], [10, 20], [15, 25], [20, 30]]<br>输出：<br>[null, true, false, true]</p></blockquote></div><div class="story post-story"><h2 id="思路：二分查找"><a href="#思路：二分查找" class="headerlink" title="思路：二分查找"></a>思路：二分查找</h2><p>设已经插入了一些日程：</p><p>$[[start_1,end_1),[start_2,end_2),[start_3,end_3)]$</p><p>日程之间不交叉并且一定是有这样的排序：</p><p>$start_1 &lt; end_1 \leq start_2 &lt; end_2 \leq start_3 &lt; end_3$</p><p>如果要插入<code>[start, end)</code></p><p>一定是在$end_i \leq start&lt;end&lt; start_{i+1}$</p><p>利用二分查找，找到恰比<code>end</code>大的元素：$start_{i+1}$</p><p>再将$start_{i+1}$前面的元素$end_i$与<code>start</code>比较，看是否交叉。</p></div><div class="story post-story"><h2 id="代码-cpp-："><a href="#代码-cpp-：" class="headerlink" title="代码(cpp)："></a>代码(cpp)：</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyCalendar</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">//set默认的比较规则先按照first比较，如果first相同，再按照second比较</span></span><br><span class="line">    set&lt;pair&lt;<span class="type">int</span>, <span class="type">int</span>&gt;&gt; calendar;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">book</span><span class="params">(<span class="type">int</span> start, <span class="type">int</span> end)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//获取比end恰好大的元素的迭代器，没有则返回迭代器end()</span></span><br><span class="line">        <span class="comment">//如果calendar没有元素，则返回迭代器begin()</span></span><br><span class="line">        <span class="keyword">auto</span> temp = calendar.<span class="built_in">lower_bound</span>(&#123;end, <span class="number">0</span>&#125;);</span><br><span class="line">        <span class="comment">//如果temp为begin()说明没有元素直接插入</span></span><br><span class="line">        <span class="comment">//如果不为begin()则与temp前面的元素的右区间比较，如果小于等于start说明没有交叉，插入</span></span><br><span class="line">        <span class="keyword">if</span>(temp == calendar.<span class="built_in">begin</span>() || (--temp)-&gt;second &lt;= start)&#123;</span><br><span class="line">            calendar.<span class="built_in">insert</span>(&#123;start, end&#125;);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="复杂度分析："><a href="#复杂度分析：" class="headerlink" title="复杂度分析："></a>复杂度分析：</h2><ul><li><p>时间复杂度：O(nlogn), 其中 n 表示日程安排的数量。由于每次在进行预订时，都需要进行二分查找，需要的时间为 O(logn)。</p></li><li><p>空间复杂度：O(n)，其中 n 表示日程安排的数量。需要保存所有已经预订的行程。</p></li></ul></div>]]></content>
      
      
      <categories>
          
          <category> 每日LeetCode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
            <tag> LeetCode </tag>
            
            <tag> 数据结构 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>set容器用法</title>
      <link href="/2022/07/05/C++/set%E5%AE%B9%E5%99%A8/"/>
      <url>/2022/07/05/C++/set%E5%AE%B9%E5%99%A8/</url>
      
        <content type="html"><![CDATA[<div class="story post-story"><h2 id="set容器："><a href="#set容器：" class="headerlink" title="set容器："></a>set容器：</h2><p>所有元素都会在插入时自动排序，底层结构采用二叉树实现。</p></div><div class="story post-story"><h2 id="set和multiset区别："><a href="#set和multiset区别：" class="headerlink" title="set和multiset区别："></a>set和multiset区别：</h2><ul><li>set不可以插入重复数据，而multiset可以</li><li>set插入数据的同时会返回插入结果，表示插入是否成功</li><li>multiset不会检测数据，因此可以插入重复数据</li></ul><p>set容器的使用：</p><p>头文件：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;set&gt;</span> </span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br></pre></td></tr></table></figure><p>构造函数：</p><table><thead><tr><th align="center">构造函数</th><th>解释</th></tr></thead><tbody><tr><td align="center">set()</td><td>默认构造函数</td></tr><tr><td align="center">set(const set &amp;st)</td><td>拷贝构造函数</td></tr></tbody></table><p>成员函数：</p><table><thead><tr><th align="center">成员函数</th><th>解释</th></tr></thead><tbody><tr><td align="center">void insert(T key)</td><td>插入key</td></tr><tr><td align="center">void emplace(T key)</td><td>插入key，比insert()效率高</td></tr><tr><td align="center">erase()</td><td>删除</td></tr><tr><td align="center">void clear()</td><td>清空</td></tr><tr><td align="center">bool find(T key)</td><td>查找</td></tr><tr><td align="center">int count(T key)</td><td>统计</td></tr><tr><td align="center">int size()</td><td>获取大小</td></tr><tr><td align="center">bool empty()</td><td>是否为空</td></tr><tr><td align="center">void swap(set &amp;st)</td><td>交换</td></tr><tr><td align="center">iterator lower_bound(T key)</td><td>如果set容器中没有元素，则返回迭代器begin()；<br>如果set容器中存在元素，则返回恰好比key大的元素的迭代器，不存在则返回迭代器end()</td></tr></tbody></table><p>自定义数据类型排序</p><p>set&lt;pair&lt;int,int&gt;&gt;</p><p>set默认的比较规则先按照first比较，如果first相同，再按照second 比较。</p></div>]]></content>
      
      
      <categories>
          
          <category> C++ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C++ </tag>
            
            <tag> 容器 </tag>
            
            <tag> STL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>(每日LeetCode)1200. 最小绝对差</title>
      <link href="/2022/07/04/%E6%AF%8F%E6%97%A5LeetCode/2022-7/1200%20%E6%9C%80%E5%B0%8F%E7%BB%9D%E5%AF%B9%E5%B7%AE/"/>
      <url>/2022/07/04/%E6%AF%8F%E6%97%A5LeetCode/2022-7/1200%20%E6%9C%80%E5%B0%8F%E7%BB%9D%E5%AF%B9%E5%B7%AE/</url>
      
        <content type="html"><![CDATA[<div class="story post-story"><h2 id="题目："><a href="#题目：" class="headerlink" title="题目："></a>题目：</h2><p>给你个整数数组 <code>arr</code>，其中每个元素都 <strong>不相同</strong>。</p><p>请你找到所有具有最小绝对差的元素对，并且按升序的顺序返回。</p></div><div class="story post-story"><h2 id="示例："><a href="#示例：" class="headerlink" title="示例："></a>示例：</h2><p>示例1：</p><blockquote><p>输入：arr &#x3D; [4,2,1,3]<br>输出：[[1,2],[2,3],[3,4]]</p></blockquote><p>示例2：</p><blockquote><p>输入：arr &#x3D; [1,3,6,10,15]<br>输出：[[1,3]]</p></blockquote></div><div class="story post-story"><h2 id="思路："><a href="#思路：" class="headerlink" title="思路："></a>思路：</h2><p>先将<code>arr</code>数组排序</p><p>再遍历<code>arr</code>数组，如果找到有比<code>min</code>更小的差值，将<code>min</code>改为该差值，将<code>dp</code>数组之前记录的数据清空(因为之前记录的都是差值大的)，重新插入差值更小的数据。</p></div><div class="story post-story"><h2 id="代码-cpp-："><a href="#代码-cpp-：" class="headerlink" title="代码(cpp)："></a>代码(cpp)：</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; <span class="built_in">minimumAbsDifference</span>(vector&lt;<span class="type">int</span>&gt;&amp; arr) &#123;</span><br><span class="line">        <span class="comment">//将arr数组排序</span></span><br><span class="line">        <span class="built_in">sort</span>(arr.<span class="built_in">begin</span>(),arr.<span class="built_in">end</span>());</span><br><span class="line">        <span class="type">int</span> min = INT_MAX;</span><br><span class="line">        vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; dp;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">1</span>; i &lt; arr.<span class="built_in">size</span>(); i++)&#123;</span><br><span class="line">            <span class="comment">//当前的差值</span></span><br><span class="line">            <span class="type">int</span> temp = arr[i]-arr[i<span class="number">-1</span>];</span><br><span class="line">            <span class="keyword">if</span>(temp &lt; min)&#123;</span><br><span class="line">                min = temp;</span><br><span class="line">                <span class="comment">//将dp数组清空</span></span><br><span class="line">                dp.<span class="built_in">clear</span>();</span><br><span class="line">                <span class="comment">//重新插入新的差值小的数据</span></span><br><span class="line">                dp.<span class="built_in">push_back</span>(&#123;arr[i<span class="number">-1</span>],arr[i]&#125;);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(temp == min)&#123;</span><br><span class="line">                dp.<span class="built_in">push_back</span>(&#123;arr[i<span class="number">-1</span>],arr[i]&#125;);</span><br><span class="line">            &#125; </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dp;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="复杂度分析："><a href="#复杂度分析：" class="headerlink" title="复杂度分析："></a>复杂度分析：</h2><ul><li><p>时间复杂度：O(nlogn)，其中 n 是数组 arr 的长度。排序需要的时间为 O(nlogn)，遍历需要的是时间为 O(n)，因此总时间复杂度为 O(nlogn)。</p></li><li><p>空间复杂度：O(logn)，即为排序需要使用的栈空间。这里不计入返回值需要使用的空间。</p></li></ul></div>]]></content>
      
      
      <categories>
          
          <category> 每日LeetCode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
            <tag> LeetCode </tag>
            
            <tag> 数据结构 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>(每日LeetCode)556. 下一个更大元素 III</title>
      <link href="/2022/07/03/%E6%AF%8F%E6%97%A5LeetCode/2022-7/556%20%E4%B8%8B%E4%B8%80%E4%B8%AA%E6%9B%B4%E5%A4%A7%E5%85%83%E7%B4%A0%20III/"/>
      <url>/2022/07/03/%E6%AF%8F%E6%97%A5LeetCode/2022-7/556%20%E4%B8%8B%E4%B8%80%E4%B8%AA%E6%9B%B4%E5%A4%A7%E5%85%83%E7%B4%A0%20III/</url>
      
        <content type="html"><![CDATA[<div class="story post-story"><h2 id="题目："><a href="#题目：" class="headerlink" title="题目："></a>题目：</h2><p>给你一个正整数 <code>n</code> ，请你找出符合条件的最小整数，其由重新排列 <code>n</code> 中存在的每位数字组成，并且其值大于 <code>n</code> 。如果不存在这样的正整数，则返回 <code>-1</code> 。</p><p>注意 ，返回的整数应当是一个 <strong>32 位整数</strong> ，如果存在满足题意的答案，但不是 32 位整数 ，同样返回 <code>-1</code>。</p></div><div class="story post-story"><h2 id="示例："><a href="#示例：" class="headerlink" title="示例："></a>示例：</h2><p>示例 1：</p><blockquote><p>输入：n &#x3D; 12324321<br>输出：12331224</p></blockquote><p>示例 2：</p><blockquote><p>输入：n &#x3D; 21<br>输出：-1</p></blockquote></div><div class="story post-story"><h2 id="思路："><a href="#思路：" class="headerlink" title="思路："></a>思路：</h2><p>以<code>n = 12324321</code>为例</p><p>①.<code>pos1</code>指针从后往前遍历，找到第<code>pos1</code>位置的数比后面的数小的位置，<code>pos1</code>记录位置</p><table><thead><tr><th>1</th><th>2</th><th>3</th><th>2</th><th>4</th><th>3</th><th align="center"><span style="color:red">2</span></th><th><span style="color:red">1</span></th></tr></thead><tbody><tr><td></td><td></td><td></td><td></td><td></td><td></td><td align="center">$\leftarrow\Uparrow$<br><br>pos1</td><td></td></tr></tbody></table><p>2与1比较，2大，<code>pos1</code>向左移</p><p>循环直到：</p><table><thead><tr><th>1</th><th>2</th><th>3</th><th align="center"><span style="color:red">2</span></th><th><span style="color:red">4</span></th><th>3</th><th align="center">2</th><th>1</th></tr></thead><tbody><tr><td></td><td></td><td></td><td align="center">$\leftarrow\Uparrow$<br/><br/>pos1</td><td></td><td></td><td align="center"></td><td></td></tr></tbody></table><p>2与4比较，2小，记录<code>pos1</code>的位置</p><p>②.再定义<code>pos2</code>指针，从后往前遍历，找到比<code>pos1</code>位置后面的数中，有比<code>pos1</code>位置的数大的数，用pos2记录位置</p><table><thead><tr><th>1</th><th>2</th><th>3</th><th align="center"><span style="color:red">2</span></th><th>4</th><th>3</th><th align="center">2</th><th align="center"><span style="color:red">1</span></th></tr></thead><tbody><tr><td></td><td></td><td></td><td align="center">$\Uparrow$<br><br>pos1</td><td></td><td></td><td align="center"></td><td align="center">$\leftarrow\Uparrow$<br/><br/>pos2</td></tr></tbody></table><p><code>pos1</code>大于<code>pos2</code>，<code>pos2</code>指针左移</p><p>循环直到：</p><table><thead><tr><th>1</th><th>2</th><th>3</th><th align="center"><span style="color:red">2</span></th><th>4</th><th align="center"><span style="color:red">3</span></th><th align="center">2</th><th align="center">1</th></tr></thead><tbody><tr><td></td><td></td><td></td><td align="center">$\Uparrow$<br><br>pos1</td><td></td><td align="center">$\leftarrow\Uparrow$<br/><br/>pos2</td><td align="center"></td><td align="center"></td></tr></tbody></table><p><code>pos1</code>小于<code>pos2</code>，记录指针<code>pos2</code>位置</p><p>③.交换<code>pos1</code>和<code>pos2</code>的位置</p><table><thead><tr><th>1</th><th>2</th><th>3</th><th><span style="color:red">3</span></th><th>4</th><th><span style="color:red">2</span></th><th>2</th><th>1</th></tr></thead></table><p>④.将<code>pos1</code>位置后面的数进行反转</p><table><thead><tr><th>1</th><th>2</th><th>3</th><th>3</th><th>1</th><th>2</th><th>2</th><th>4</th></tr></thead></table><p>结果：12331224</p></div><div class="story post-story"><h2 id="代码-cpp-："><a href="#代码-cpp-：" class="headerlink" title="代码(cpp)："></a>代码(cpp)：</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="type">int</span> <span class="title function_">nextGreaterElement</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">        <span class="comment">//将n转换成字符串</span></span><br><span class="line">        <span class="type">string</span> <span class="variable">num</span> <span class="operator">=</span> to_string(n);</span><br><span class="line">        <span class="type">int</span> <span class="variable">pos1</span> <span class="operator">=</span> num.size()-<span class="number">2</span>;</span><br><span class="line">        <span class="comment">//从后往前遍历，找到前面的数小于后面的数，前面数的位置</span></span><br><span class="line">        <span class="keyword">while</span>(pos1 &gt;= <span class="number">0</span> &amp;&amp; num[pos1] &gt;= num[pos1+<span class="number">1</span>])&#123;</span><br><span class="line">            pos1--;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//遍历到字符串第0个位置，还没有小于的数，则不存在</span></span><br><span class="line">        <span class="keyword">if</span>(pos1 &lt; <span class="number">0</span>) <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">pos2</span> <span class="operator">=</span> num.size()-<span class="number">1</span>;</span><br><span class="line">        <span class="comment">//从后往前遍历，找到有比pos1位置的数小的数，返回pos2位置</span></span><br><span class="line">        <span class="keyword">while</span>(pos2 &gt; pos1 &amp;&amp; num[pos1] &gt;= num[pos2])&#123;</span><br><span class="line">            pos2--;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//交换两个位置的数</span></span><br><span class="line">        swap(num[pos1],num[pos2]);</span><br><span class="line">        <span class="comment">//将pos1后面的字符串反转</span></span><br><span class="line">        reverse(num.begin() + pos1 + <span class="number">1</span>, num.end());</span><br><span class="line">        <span class="comment">//防止溢出，先将temp转换成long型</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">temp</span> <span class="operator">=</span> stol(num);</span><br><span class="line">        <span class="comment">//如果超出int的范围，返回-1</span></span><br><span class="line">        <span class="keyword">if</span>(temp &gt; INT_MAX) <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> temp;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="复杂度分析："><a href="#复杂度分析：" class="headerlink" title="复杂度分析："></a>复杂度分析：</h2><ul><li>时间复杂度：O(logn)。</li><li>空间复杂度：O(logn)。</li></ul></div>]]></content>
      
      
      <categories>
          
          <category> 每日LeetCode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
            <tag> LeetCode </tag>
            
            <tag> 数据结构 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>(每日LeetCode)871. 最低加油次数</title>
      <link href="/2022/07/02/%E6%AF%8F%E6%97%A5LeetCode/2022-7/871%20%E6%9C%80%E4%BD%8E%E5%8A%A0%E6%B2%B9%E6%AC%A1%E6%95%B0/"/>
      <url>/2022/07/02/%E6%AF%8F%E6%97%A5LeetCode/2022-7/871%20%E6%9C%80%E4%BD%8E%E5%8A%A0%E6%B2%B9%E6%AC%A1%E6%95%B0/</url>
      
        <content type="html"><![CDATA[<div class="story post-story"><h2 id="题目："><a href="#题目：" class="headerlink" title="题目："></a>题目：</h2><p>汽车从起点出发驶向目的地，该目的地位于出发位置东面 target 英里处。</p><p>沿途有加油站，每个 <code>station[i]</code> 代表一个加油站，它位于出发位置东面 <code>station[i][0]</code> 英里处，并且有 <code>station[i][1]</code>升汽油。</p><p>假设汽车油箱的容量是无限的，其中最初有<code>startFuel</code>升燃料。它每行驶 1 英里就会用掉 1 升汽油。</p><p>当汽车到达加油站时，它可能停下来加油，将所有汽油从加油站转移到汽车中。</p><p>为了到达目的地，汽车所必要的最低加油次数是多少？如果无法到达目的地，则返回 -1 。</p><p>注意：如果汽车到达加油站时剩余燃料为 0，它仍然可以在那里加油。如果汽车到达目的地时剩余燃料为 0，仍然认为它已经到达目的地。</p></div><div class="story post-story"><h2 id="示例："><a href="#示例：" class="headerlink" title="示例："></a>示例：</h2><p>示例1：</p><blockquote><p>输入：target &#x3D; 100, startFuel &#x3D; 1, stations &#x3D; [[10,100]]<br>输出：-1<br>解释：我们无法抵达目的地，甚至无法到达第一个加油站。</p></blockquote><p>示例2：</p><blockquote><p>输入：target &#x3D; 100, startFuel &#x3D; 10, stations &#x3D; [[10,60],[20,30],[30,30],[60,40]]<br>输出：2<br>解释：<br>我们出发时有 10 升燃料。<br>我们开车来到距起点 10 英里处的加油站，消耗 10 升燃料。将汽油从 0 升加到 60 升。<br>然后，我们从 10 英里处的加油站开到 60 英里处的加油站（消耗 50 升燃料），<br>并将汽油从 10 升加到 50 升。然后我们开车抵达目的地。<br>我们沿途在1两个加油站停靠，所以返回 2 。</p></blockquote><p>思路：</p></div><div class="story post-story"><h2 id="一、回溯法"><a href="#一、回溯法" class="headerlink" title="一、回溯法"></a>一、回溯法</h2><h3 id="代码-cpp-："><a href="#代码-cpp-：" class="headerlink" title="代码(cpp)："></a>代码(cpp)：</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">def</span><span class="params">(vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&amp; stations,<span class="type">int</span> cur_station, <span class="type">int</span> begin, <span class="type">int</span>&amp; end, <span class="type">int</span> oil)</span></span>&#123;</span><br><span class="line">        <span class="comment">//到达目的地</span></span><br><span class="line">        <span class="keyword">if</span>(oil+begin &gt;= end) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="comment">//油量不够到达目的地</span></span><br><span class="line">        <span class="keyword">if</span>(cur_station+<span class="number">1</span> == stations.<span class="built_in">size</span>() &amp;&amp; oil+begin &lt; end)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        &#125; </span><br><span class="line">        <span class="comment">//油量不够到达下一个加油站</span></span><br><span class="line">        <span class="keyword">if</span>(cur_station+<span class="number">1</span> &lt; stations.<span class="built_in">size</span>() &amp;&amp; oil+begin &lt; stations[cur_station+<span class="number">1</span>][<span class="number">0</span>])&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> ans = INT_MAX;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = cur_station+<span class="number">1</span>; i &lt; stations.<span class="built_in">size</span>(); i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(stations[i][<span class="number">0</span>] &lt;= begin+oil)&#123;</span><br><span class="line">                <span class="type">int</span> temp = <span class="built_in">def</span>(stations, i, stations[i][<span class="number">0</span>] ,end ,oil+begin-stations[i][<span class="number">0</span>]+stations[i][<span class="number">1</span>]);</span><br><span class="line">                <span class="keyword">if</span>(temp != <span class="number">-1</span> &amp;&amp; ans &gt; temp+<span class="number">1</span>) ans = temp+<span class="number">1</span>; </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(ans == INT_MAX) ans = <span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">minRefuelStops</span><span class="params">(<span class="type">int</span> target, <span class="type">int</span> startFuel, vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&amp; stations)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//出发地没有加油站，第一个加油站编号为0，所以初始化为-1</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">def</span>(stations, <span class="number">-1</span>, <span class="number">0</span>, target, startFuel);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>运行超时</p></div><div class="story post-story"><h2 id="二、贪心"><a href="#二、贪心" class="headerlink" title="二、贪心"></a>二、贪心</h2><h3 id="思路："><a href="#思路：" class="headerlink" title="思路："></a>思路：</h3><p>如果不需要加油就往前走，当不够到达下一个加油站或目的地，就从之前走到过的加油站之中选择汽油量最多的加油站进行补充汽油。</p><p>以此往复，到达目的地。</p><p>如果所有加油站的汽油都被加完，并且没到达目的地，则不可能到达。</p><h3 id="代码-cpp-：-1"><a href="#代码-cpp-：-1" class="headerlink" title="代码(cpp)："></a>代码(cpp)：</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">minRefuelStops</span><span class="params">(<span class="type">int</span> target, <span class="type">int</span> startFuel, vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&amp; stations)</span> </span>&#123;</span><br><span class="line">        priority_queue&lt;<span class="type">int</span>&gt; pq;</span><br><span class="line">        <span class="type">int</span> count = <span class="number">0</span>; <span class="comment">//初始化加油次数</span></span><br><span class="line">        <span class="type">int</span> begin = <span class="number">0</span>; <span class="comment">//初始化路程</span></span><br><span class="line">        <span class="type">int</span> cur_fuel = startFuel;<span class="comment">//初始化车的汽油量</span></span><br><span class="line">        <span class="type">int</span> cur_distance; <span class="comment">//表示当前的路程</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= stations.<span class="built_in">size</span>(); i++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(i &lt; stations.<span class="built_in">size</span>()) cur_distance = stations[i][<span class="number">0</span>];</span><br><span class="line">            <span class="keyword">else</span> cur_distance = target;</span><br><span class="line">            <span class="comment">//(cur_distance - begin)：表示第i-1个加油站到第i个加油站之间的路程，cur_fuel为到第i个加油站时剩余的油量</span></span><br><span class="line">            cur_fuel -= cur_distance - begin;</span><br><span class="line">            <span class="comment">//如果油量为负数，说明需要从第i个加油站，之前的加油站之中选择加油量最多的加油站，进行补充汽油</span></span><br><span class="line">            <span class="keyword">while</span> (cur_fuel &lt; <span class="number">0</span> &amp;&amp; !pq.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">                cur_fuel += pq.<span class="built_in">top</span>();<span class="comment">//选择汽油量最多的加油站补充</span></span><br><span class="line">                pq.<span class="built_in">pop</span>();</span><br><span class="line">                count++;<span class="comment">//加油次数加1</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//都已经把之前的加油站的汽油都补充了，还是负数说明无法到达下一个加油站或目的地</span></span><br><span class="line">            <span class="keyword">if</span> (cur_fuel &lt; <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (i &lt; stations.<span class="built_in">size</span>()) &#123;</span><br><span class="line">                <span class="comment">//将第i个加油站的汽油量记录，现在不需要加油，等以后缺油再加</span></span><br><span class="line">                pq.<span class="built_in">emplace</span>(stations[i][<span class="number">1</span>]);</span><br><span class="line">                begin = cur_distance;<span class="comment">//更新路程</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="复杂度分析："><a href="#复杂度分析：" class="headerlink" title="复杂度分析："></a>复杂度分析：</h3><ul><li><p>时间复杂度：O(nlogn)，其中 n 是数组 <code>stations</code> 的长度。需要遍历数组 <code>stations</code> 一次，每个加油站的汽油量最多添加到优先队列和从优先队列中移除各一次，每次优先队列的操作需要 O(logn) 的时间，因此时间复杂度是 O(nlogn)。</p></li><li><p>空间复杂度：O(n)，其中 n 是数组 <code>stations</code> 的长度。优先队列需要 O(n) 的空间。</p></li></ul></div>]]></content>
      
      
      <categories>
          
          <category> 每日LeetCode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
            <tag> LeetCode </tag>
            
            <tag> 数据结构 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vector容器用法</title>
      <link href="/2022/06/30/C++/vecter%E5%AE%B9%E5%99%A8/"/>
      <url>/2022/06/30/C++/vecter%E5%AE%B9%E5%99%A8/</url>
      
        <content type="html"><![CDATA[<div class="story post-story"><h2 id="vector是什么？"><a href="#vector是什么？" class="headerlink" title="vector是什么？"></a>vector是什么？</h2><p>vector是一个能够存放任意类型的动态数组。</p><p>vector实现动态增长的原理：<br>vector的原理就是动态数组。<br>当插入新元素的时候，如果空间不足，那么vector会重新申请更大的一块空间，将原空间数据拷贝到新空间，释放旧空间数据，再把新元素插入新申请空间。</p><p>需要导入头文件：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="构造函数："><a href="#构造函数：" class="headerlink" title="构造函数："></a>构造函数：</h2><table><thead><tr><th align="center">构造函数</th><th>解释</th></tr></thead><tbody><tr><td align="center"><span style="color:red">vector()</span></td><td>创建一个空的vector</td></tr><tr><td align="center"><span style="color:red">vector(int size)</span></td><td>创建一个vector,元素个数为size，且值均为0(默认为0)</td></tr><tr><td align="center"><span style="color:red">vector(int size, T value)</span></td><td>创建一个vector，元素个数为size,且值均为value</td></tr><tr><td align="center"><span style="color:red">vector(const vector&amp; v)</span></td><td>另一个vector容器拷贝到这个vector中</td></tr><tr><td align="center">vector(iterator begin(), iterator end())</td><td>另一个[begin,end)区间内的数组元素的复制这个vector中</td></tr></tbody></table></div><div class="story post-story"><h2 id="成员函数："><a href="#成员函数：" class="headerlink" title="成员函数："></a>成员函数：</h2><table><thead><tr><th align="center">插入函数</th><th>解释</th></tr></thead><tbody><tr><td align="center">void push_back(const T&amp; x)</td><td>容器尾部插入一个元素X</td></tr><tr><td align="center">void <span style="color:red">emplace_back(const T&amp; x)</span></td><td>容器尾部插入一个元素X，比push_back()效率高</td></tr><tr><td align="center">iterator insert(iterator it,const T&amp; x)</td><td>容器中迭代器指向元素的前面插入一个元素x</td></tr><tr><td align="center">iterator insert(iterator it,int n,const T&amp; x)</td><td>容器中迭代器指向元素的前面插入n个相同的元素x</td></tr><tr><td align="center">iterator insert(iterator it,const_iterator first,const_iterator last)</td><td>向量中迭代器指向元素的前面插入另一个相同类型的vector容器的[first,last)间的数据</td></tr></tbody></table><table><thead><tr><th align="center">删除函数</th><th align="left">解释</th></tr></thead><tbody><tr><td align="center">iterator erase(iterator it)</td><td align="left">删除容器中迭代器指向的元素</td></tr><tr><td align="center">iterator erase(iterator first,iterator last)</td><td align="left">删除容器中[first,last)中的元素</td></tr><tr><td align="center">void <span style="color:red">pop_back()</span></td><td align="left">删除容器中最后一个元素</td></tr><tr><td align="center">void clear()</td><td align="left">清空容器中所有元素</td></tr></tbody></table><p><img src="https://s2.loli.net/2022/06/30/fSvFNGZcyYA1exu.png" class="lazyload" data-srcset="https://s2.loli.net/2022/06/30/fSvFNGZcyYA1exu.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="插入和迭代器指针"></p><table><thead><tr><th align="center">遍历函数</th><th>解释</th></tr></thead><tbody><tr><td align="center">T at(int pos)</td><td>返回pos位置的元素(第一个位置为0)</td></tr><tr><td align="center">T front()</td><td>返回首元素</td></tr><tr><td align="center">T back()</td><td>返回尾元素</td></tr><tr><td align="center">iterator <span style="color:red">begin()</span></td><td>返回vector容器中指向的第一个元素的迭代器</td></tr><tr><td align="center">iterator <span style="color:red">end()</span></td><td>返回vector容器中指向最后一个元素的下一个位置的迭代器</td></tr><tr><td align="center">reverse_iterator rbegin()</td><td>反向迭代器，指向容器中最后一个元素</td></tr><tr><td align="center">reverse_iterator rend()</td><td>反向迭代器，指向容器第一个元素前面的位置</td></tr></tbody></table><table><thead><tr><th align="center">大小函数</th><th>解释</th></tr></thead><tbody><tr><td align="center">int <span style="color:red">size()</span></td><td>返回vector容器中元素的个数</td></tr><tr><td align="center">int capacity()</td><td>返回当前vector容器所能容纳的最大容量</td></tr><tr><td align="center">int max_size()</td><td>返回vector容器的最大可允许的容量</td></tr><tr><td align="center">void resize(int size)</td><td>更改vector容器的元素的个数为size</td></tr><tr><td align="center">void reserve(int capacity)</td><td>更改vector容器的容量为capacity</td></tr></tbody></table><table><thead><tr><th align="center">赋值函数</th><th>解释</th></tr></thead><tbody><tr><td align="center">vector<T>&amp; operator&#x3D;</td><td>将右边vector容器的元素拷贝到左边vector容器中</td></tr><tr><td align="center">void assign(int n,const T&amp; x)</td><td>设置容器中前n个元素的值为x</td></tr><tr><td align="center">void assign(const_iterator first,const_iterator last)</td><td>将另一个vector容器中[first,last)中元素设置成当前vector容器的元素</td></tr></tbody></table><table><thead><tr><th align="center">其他函数</th><th>解释</th></tr></thead><tbody><tr><td align="center">bool <span style="color:red">empty()</span></td><td>判断向量是否为空，若为空，则返回真</td></tr><tr><td align="center">void swap(vector&amp; v)</td><td>将两个同类型vector容器的元素互换</td></tr></tbody></table></div><div class="story post-story"><h2 id="vector的遍历："><a href="#vector的遍历：" class="headerlink" title="vector的遍历："></a>vector的遍历：</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; v.<span class="built_in">size</span>(); i++)&#123;</span><br><span class="line">cout &lt;&lt; v[i] &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; v.<span class="built_in">size</span>(); i++)&#123;</span><br><span class="line">cout &lt;&lt; v1.<span class="built_in">at</span>(i) &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (vector&lt;<span class="type">int</span>&gt;::iterator it = v.<span class="built_in">begin</span>(); it != v.<span class="built_in">end</span>(); it++)&#123;</span><br><span class="line">cout &lt;&lt; *it &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">auto</span> it = v.<span class="built_in">begin</span>(); it != v.<span class="built_in">end</span>(); it++)&#123;</span><br><span class="line">cout &lt;&lt; *it &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>]]></content>
      
      
      <categories>
          
          <category> C++ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C++ </tag>
            
            <tag> 容器 </tag>
            
            <tag> STL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>(每日LeetCode)1175. 质数排列</title>
      <link href="/2022/06/30/%E6%AF%8F%E6%97%A5LeetCode/2022-6/1175%20%E8%B4%A8%E6%95%B0%E6%8E%92%E5%88%97/"/>
      <url>/2022/06/30/%E6%AF%8F%E6%97%A5LeetCode/2022-6/1175%20%E8%B4%A8%E6%95%B0%E6%8E%92%E5%88%97/</url>
      
        <content type="html"><![CDATA[<div class="story post-story"><h2 id="题目："><a href="#题目：" class="headerlink" title="题目："></a>题目：</h2><p>请你帮忙给从 1 到 <code>n</code> 的数设计排列方案，使得所有的「质数」都应该被放在「质数索引」（索引从 1 开始）上；你需要返回可能的方案总数。<br>由于答案可能会很大，所以请你返回答案 <strong>模 mod $10^9$ + 7</strong> 之后的结果即可。</p></div><div class="story post-story"><h2 id="示例："><a href="#示例：" class="headerlink" title="示例："></a>示例：</h2><blockquote><p>输入：n &#x3D; 5<br>输出：12</p></blockquote><p>解释：</p><p>先看质数定义：一个大于1的自然数，<strong>除了1和它自身外</strong>，不能被其他自然数整除的数叫做质数。(1不是质数)</p><p>用红色标记质数：</p><table><thead><tr><th>1</th><th><span style="color:red">2</span></th><th><span style="color:red">3</span></th><th>4</th><th><span style="color:red">5</span></th></tr></thead></table><p>题目的意思是将质数和非质数各分一组，进行排序一共有多少种可能：</p><blockquote><p>m个数排列m个位置，全排列公式：$A^m_m&#x3D;m!$</p><p>$A^3_3$为质数的所有排列次数</p><p>$A^2_2$为非质数的所有排列次数</p><p>并且每有一个质数的排列组合就有$A^2_2$次非质数的排列： </p><p>总数：$A^3_3 \times A^2_2&#x3D;3! \times 2!&#x3D;12$</p></blockquote></div><div class="story post-story"><h2 id="思路："><a href="#思路：" class="headerlink" title="思路："></a>思路：</h2><p>遍历数组判断是否为质数，记录质数的个数<code>p</code>，非质数个数为<code>n-p</code></p><p>运用公式求出总数：$A^p_p \times A^{n-p}_{n-p}&#x3D;p! \times (n-p)!$</p></div><div class="story post-story"><h2 id="代码-cpp-："><a href="#代码-cpp-：" class="headerlink" title="代码(cpp)："></a>代码(cpp)：</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="type">int</span> mod = <span class="built_in">pow</span>(<span class="number">10</span>,<span class="number">9</span>)+<span class="number">7</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//判断是否为质数</span></span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">is_prime</span><span class="params">(<span class="type">int</span> n)</span></span>&#123;</span><br><span class="line">        <span class="comment">//从2开始</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">2</span>; i*i &lt;= n;i++)&#123;</span><br><span class="line">            <span class="comment">//模运算为0，不是质数</span></span><br><span class="line">            <span class="keyword">if</span>(n%i == <span class="number">0</span>)&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//n!运算 Long类型防止溢出</span></span><br><span class="line">    <span class="function"><span class="type">long</span> <span class="title">factorial</span><span class="params">(<span class="type">int</span> n)</span></span>&#123;</span><br><span class="line">        <span class="type">long</span> sum = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">2</span>; i &lt;= n; i++)&#123;</span><br><span class="line">            sum *=i;</span><br><span class="line">            sum = sum%mod;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sum;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">numPrimeArrangements</span><span class="params">(<span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> prime_num = <span class="number">0</span>;</span><br><span class="line">        <span class="comment">//从2开始，1不是质数</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">2</span>; i &lt;= n; i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="built_in">is_prime</span>(i))&#123;</span><br><span class="line">                prime_num++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//n!*(n-p)!</span></span><br><span class="line">        <span class="type">long</span> result = (<span class="built_in">factorial</span>(prime_num)*<span class="built_in">factorial</span>(n-prime_num))%mod;</span><br><span class="line">        <span class="keyword">return</span> (<span class="type">int</span>)result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>复杂度分析：</p><ul><li><p>时间复杂度：O($n^{3&#x2F;2}$)。求 n 个数中质数个数的时间复杂度为 O($n^{3&#x2F;2}$)，阶乘的时间复杂度为 O(n)，总的时间复杂度为 O($n^{3&#x2F;2}$)。</p></li><li><p>空间复杂度：O(1)O(1)，只使用了常数空间。</p></li></ul></div>]]></content>
      
      
      <categories>
          
          <category> 每日LeetCode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
            <tag> LeetCode </tag>
            
            <tag> 数据结构 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>(每日LeetCode)535. TinyURL的加密与解密</title>
      <link href="/2022/06/29/%E6%AF%8F%E6%97%A5LeetCode/2022-6/535%20TinyURL%E7%9A%84%E5%8A%A0%E5%AF%86%E4%B8%8E%E8%A7%A3%E5%AF%86/"/>
      <url>/2022/06/29/%E6%AF%8F%E6%97%A5LeetCode/2022-6/535%20TinyURL%E7%9A%84%E5%8A%A0%E5%AF%86%E4%B8%8E%E8%A7%A3%E5%AF%86/</url>
      
        <content type="html"><![CDATA[<div class="story post-story"><h2 id="题目："><a href="#题目：" class="headerlink" title="题目："></a>题目：</h2><p>TinyURL 是一种 URL 简化服务， 比如：当你输入一个 URL <code>https://leetcode.com/problems/design-tinyurl</code> 时，它将返回一个简化的URL <code>http://tinyurl.com/4e9iAk</code> 。请你设计一个类来加密与解密 <code>TinyURL </code>。</p><p>加密和解密算法如何设计和运作是没有限制的，你只需要保证一个 <code>URL</code> 可以被加密成一个 <code>TinyURL</code> ，并且这个 <code>TinyURL</code> 可以用解密方法恢复成原本的 <code>URL</code> 。</p><p>实现 Solution 类：</p><p><code>Solution()</code> 初始化 <code>TinyURL</code> 系统对象。<br><code>String encode(String longUrl)</code> 返回 <code>longUrl</code> 对应的 <code>TinyURL</code> 。<br><code>String decode(String shortUrl)</code> 返回 <code>shortUrl</code> 原本的 URL 。题目数据保证给定的 <code>shortUrl</code> 是由同一个系统对象加密的。</p></div><div class="story post-story"><h2 id="示例："><a href="#示例：" class="headerlink" title="示例："></a>示例：</h2><blockquote><p>输入：url &#x3D; “<code>https://leetcode.com/problems/design-tinyurl</code>“<br>输出：”<code>https://leetcode.com/problems/design-tinyurl</code>“</p><p>解释：<br>Solution obj &#x3D; new Solution();<br>string tiny &#x3D; obj.encode(url); &#x2F;&#x2F; 返回加密后得到的 TinyURL 。<br>string ans &#x3D; obj.decode(tiny); &#x2F;&#x2F; 返回解密后得到的原本的 URL 。</p></blockquote></div><div class="story post-story"><h2 id="思路："><a href="#思路：" class="headerlink" title="思路："></a>思路：</h2><p>使用自增<code>id</code>作为<code>longUrl</code>的键，存入<code>unordered_map</code>容器中</p><p>根据<code>id</code>来获取对应的<code>longUrl</code></p></div><div class="story post-story"><h2 id="代码-cpp-："><a href="#代码-cpp-：" class="headerlink" title="代码(cpp)："></a>代码(cpp)：</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    unordered_map&lt;<span class="type">int</span>, string&gt; map;</span><br><span class="line">    <span class="type">int</span> id;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Solution</span>()&#123;</span><br><span class="line">        id = <span class="number">0</span>; <span class="comment">//初始化id</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">string <span class="title">encode</span><span class="params">(string longUrl)</span> </span>&#123;</span><br><span class="line">        id++;</span><br><span class="line">        map[id] = longUrl;</span><br><span class="line">        <span class="comment">//http://tinyurl.com/1</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;http://tinyurl.com/&quot;</span>+<span class="built_in">to_string</span>(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">string <span class="title">decode</span><span class="params">(string shortUrl)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//substr(int pos)：获取pos位置起的所有字符串</span></span><br><span class="line">        <span class="comment">//stoi(string str)：将string类型的字符串转换成int类型的整数</span></span><br><span class="line">        <span class="type">int</span> t_id = <span class="built_in">stoi</span>(shortUrl.<span class="built_in">substr</span>(<span class="number">19</span>));</span><br><span class="line">        <span class="keyword">return</span> map[t_id];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="复杂度分析："><a href="#复杂度分析：" class="headerlink" title="复杂度分析："></a>复杂度分析：</h2><ul><li><p>时间复杂度：</p><ul><li>Encode 函数：O(n)O(n)，其中 n 是字符串 <code>longUrl</code> 的长度。</li><li>Decode 函数：O(1)O(1)。我们把 <code>shortUrl</code> 当成有限长度的字符串看待。</li></ul></li><li><p>空间复杂度：</p><ul><li>Encode 函数：O(n)O(n)。保存字符串 <code>longUrl</code> 需要 O(n)O(n) 的空间。</li><li>Decode 函数：O(1)O(1)。</li></ul></li></ul></div>]]></content>
      
      
      <categories>
          
          <category> 每日LeetCode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
            <tag> LeetCode </tag>
            
            <tag> 数据结构 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>(每日LeetCode)324. 摆动排序 II</title>
      <link href="/2022/06/28/%E6%AF%8F%E6%97%A5LeetCode/2022-6/324%20%E6%91%86%E5%8A%A8%E6%8E%92%E5%BA%8F%20II/"/>
      <url>/2022/06/28/%E6%AF%8F%E6%97%A5LeetCode/2022-6/324%20%E6%91%86%E5%8A%A8%E6%8E%92%E5%BA%8F%20II/</url>
      
        <content type="html"><![CDATA[<div class="story post-story"><h2 id="题目："><a href="#题目：" class="headerlink" title="题目："></a>题目：</h2><p>给你一个整数数组 <code>nums</code>，将它重新排列成 <code>nums[0] &lt; nums[1] &gt; nums[2] &lt; nums[3]...</code> 的顺序。</p><p>你可以假设所有输入数组都可以得到满足题目要求的结果。</p></div><div class="story post-story"><h2 id="示例："><a href="#示例：" class="headerlink" title="示例："></a>示例：</h2><blockquote><p>输入：nums &#x3D; [1,5,2,4,3,6]<br>输出：[3,6,2,5,1,4]</p></blockquote></div><div class="story post-story"><h2 id="思路：双指针法"><a href="#思路：双指针法" class="headerlink" title="思路：双指针法"></a>思路：双指针法</h2><p>将数组<code>nums</code>按从小到大排列：</p><table><thead><tr><th>1</th><th>2</th><th align="center">3</th><th>4</th><th>5</th><th align="center">6</th></tr></thead><tbody><tr><td></td><td></td><td align="center">$\leftarrow\Uparrow$<br><br>left</td><td></td><td></td><td align="center">$\leftarrow\Uparrow$<br><br>right</td></tr></tbody></table><p>把排序好的数组分成两部分，<code>left</code>指针位于数组中间，<code>right</code>指针位于数组末尾，</p><p>将<code>left</code>和<code>right</code>当前位置的元素依次打印后，<code>left</code>和<code>right</code>指针左移，直至结束</p><p>输出：[3, 6, 2, 5, 1, 4]</p></div><div class="story post-story"><h2 id="代码-cpp-："><a href="#代码-cpp-：" class="headerlink" title="代码(cpp)："></a>代码(cpp)：</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">wiggleSort</span><span class="params">(vector&lt;<span class="type">int</span>&gt;&amp; nums)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> n = nums.<span class="built_in">size</span>(); <span class="comment">//获取数组的元素个数</span></span><br><span class="line">        <span class="type">int</span> left = n/<span class="number">2</span><span class="number">-1</span>; <span class="comment">//定义左指针</span></span><br><span class="line">        <span class="type">int</span> right = n<span class="number">-1</span>; <span class="comment">//定义右指针</span></span><br><span class="line">        <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">new_nums</span><span class="params">(nums)</span></span>;</span><br><span class="line">        <span class="built_in">sort</span>(new_nums.<span class="built_in">begin</span>(),new_nums.<span class="built_in">end</span>()); <span class="comment">//将新数组排序</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(i%<span class="number">2</span> == <span class="number">0</span>)&#123; <span class="comment">//偶数位置插入left指针的元素，奇数位置插入right指针的元素</span></span><br><span class="line">                nums[i] = a[left];</span><br><span class="line">                left--;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                nums[i] = a[right];</span><br><span class="line">                rigth--;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="复杂度分析："><a href="#复杂度分析：" class="headerlink" title="复杂度分析："></a>复杂度分析：</h2><ul><li>时间复杂度：O(nlogn)，排序所需的时间复杂度是O(nlogn)，插入O(n)，整体O(nlogn)</li><li>空间复杂度：O(n)，需要额外的空间存放排序的元素。</li></ul></div>]]></content>
      
      
      <categories>
          
          <category> 每日LeetCode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
            <tag> LeetCode </tag>
            
            <tag> 数据结构 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>(每日LeetCode)剑指 Offer II 091. 粉刷房子</title>
      <link href="/2022/06/25/%E6%AF%8F%E6%97%A5LeetCode/2022-6/%E5%89%91%E6%8C%87%20Offer%20II%20091%20%E7%B2%89%E5%88%B7%E6%88%BF%E5%AD%90/"/>
      <url>/2022/06/25/%E6%AF%8F%E6%97%A5LeetCode/2022-6/%E5%89%91%E6%8C%87%20Offer%20II%20091%20%E7%B2%89%E5%88%B7%E6%88%BF%E5%AD%90/</url>
      
        <content type="html"><![CDATA[<div class="story post-story"><h2 id="题目："><a href="#题目：" class="headerlink" title="题目："></a>题目：</h2><p>假如有一排房子，共 <code>n</code> 个，每个房子可以被粉刷成红色、蓝色或者绿色这三种颜色中的一种，你需要粉刷所有的房子并且使其相邻的两个房子颜色不能相同。</p><p>当然，因为市场上不同颜色油漆的价格不同，所以房子粉刷成不同颜色的花费成本也是不同的。每个房子粉刷成不同颜色的花费是以一个 <code>n x 3</code> 的正整数矩阵 <code>costs</code>来表示的。</p><p>例如，<code>costs[0][0]</code> 表示第 0 号房子粉刷成红色的成本花费；<code>costs[1][2]</code> 表示第 1 号房子粉刷成绿色的花费，以此类推。<br>请计算出粉刷完所有房子最少的花费成本。</p></div><div class="story post-story"><h2 id="示例："><a href="#示例：" class="headerlink" title="示例："></a>示例：</h2><blockquote><p>输入: costs &#x3D; [[17,2,17],[16,16,5],[14,3,19]]<br>输出: 10<br>解释: 将 0 号房子粉刷成蓝色，1 号房子粉刷成绿色，2 号房子粉刷成蓝色。<br>            最少花费: 2 + 5 + 3 &#x3D; 10。</p></blockquote></div><div class="story post-story"><h2 id="1-递归"><a href="#1-递归" class="headerlink" title="1.递归"></a>1.递归</h2><h3 id="代码-cpp-："><a href="#代码-cpp-：" class="headerlink" title="代码(cpp)："></a>代码(cpp)：</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">def</span><span class="params">(vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&amp; costs, <span class="type">int</span> pos, <span class="type">int</span> n, vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; flag)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//到达最后，没有房子了，退出</span></span><br><span class="line">        <span class="keyword">if</span> (pos == n) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> ans = INT_MAX;</span><br><span class="line">        <span class="comment">//依次选择三种颜色</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">            <span class="type">int</span> temp = INT_MAX;</span><br><span class="line">            vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; <span class="built_in">temp_flag</span>(flag);</span><br><span class="line">            <span class="comment">//粉刷第一个房子，无需看前面房子的颜色，因为前面没有房子。</span></span><br><span class="line">            <span class="keyword">if</span> (pos == <span class="number">0</span>) &#123;</span><br><span class="line">                temp_flag[pos][i] = <span class="number">-1</span>;</span><br><span class="line">                temp = <span class="built_in">def</span>(costs, pos + <span class="number">1</span>, n, temp_flag) + costs[pos][i];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//粉刷墙，要看前面用了什么颜色</span></span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (flag[pos - <span class="number">1</span>][i] != <span class="number">-1</span>) &#123;</span><br><span class="line">                <span class="comment">//将这个房子的颜色标记</span></span><br><span class="line">                temp_flag[pos][i] = <span class="number">-1</span>;</span><br><span class="line">                temp = <span class="built_in">def</span>(costs, pos + <span class="number">1</span>, n, temp_flag) + costs[pos][i];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//选择花费最少的金额</span></span><br><span class="line">            ans = <span class="built_in">min</span>(ans, temp);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">minCost</span><span class="params">(vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&amp; costs)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">def</span>(costs, <span class="number">0</span>, costs.<span class="built_in">size</span>(), costs);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>采用递归的方法，提交后，结果执行超时。</p></div><div class="story post-story"><h2 id="2-动态规划"><a href="#2-动态规划" class="headerlink" title="2.动态规划"></a>2.动态规划</h2><p>$$<br>Red[pos][0]&#x3D;<br>\begin{cases}<br>cost[0][0]  &amp; pos &#x3D; 0; \<br>min(Green[pos+1][1],Blue[pos+1][2]) + costs[pos][0]  &amp; pos&gt;0<br>\end{cases} \<br>$$</p><p>$$<br>Green[pos][1]&#x3D;<br>\begin{cases}<br>cost[0][1]  &amp; pos &#x3D; 0; \<br>min(Red[pos+1][0],Blue[pos+1][2]) + costs[pos][1]  &amp; pos&gt;0<br>\end{cases} \<br>$$</p><p>$$<br>Blue[pos][2]&#x3D;<br>\begin{cases}<br>cost[0][2]  &amp; pos &#x3D; 0; \<br>min(Red[pos+1][0],Green[pos+1][1]) + costs[pos][2]  &amp; pos&gt;0<br>\end{cases}<br>$$</p><p>画出动态规划图，以示例为例：</p><p><code>costs = [[17,2,17],[16,16,5],[14,3,19]]</code></p><table><thead><tr><th align="center">颜色\pos</th><th align="center">0</th><th align="center">1</th><th align="center">2</th></tr></thead><tbody><tr><td align="center">Red(0)</td><td align="center">17</td><td align="center">18</td><td align="center">21</td></tr><tr><td align="center">Green(1)</td><td align="center">2</td><td align="center">33</td><td align="center">10</td></tr><tr><td align="center">Blue(2)</td><td align="center">17</td><td align="center">7</td><td align="center">37</td></tr></tbody></table><p>$$<br>mincost &#x3D; min(dp[2][0],dp[2][1],dp[2][2])<br>$$</p><h3 id="代码-cpp-：-1"><a href="#代码-cpp-：-1" class="headerlink" title="代码(cpp)："></a>代码(cpp)：</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">minCost</span><span class="params">(vector&lt;vector&lt;<span class="type">int</span>&gt;&gt;&amp; costs)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> n = costs.<span class="built_in">size</span>();</span><br><span class="line">        <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">red</span><span class="params">(n, <span class="number">0</span>)</span></span>; </span><br><span class="line">        <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">blue</span><span class="params">(n, <span class="number">0</span>)</span></span>;</span><br><span class="line">        <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">green</span><span class="params">(n, <span class="number">0</span>)</span></span>;</span><br><span class="line">        <span class="comment">// 初始化</span></span><br><span class="line">        red[<span class="number">0</span>] = costs[<span class="number">0</span>][<span class="number">0</span>];</span><br><span class="line">        blue[<span class="number">0</span>] = costs[<span class="number">0</span>][<span class="number">1</span>];</span><br><span class="line">        green[<span class="number">0</span>] = costs[<span class="number">0</span>][<span class="number">2</span>];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; n; ++i) &#123;</span><br><span class="line">            red[i] = <span class="built_in">min</span>(blue[i - <span class="number">1</span>], green[i - <span class="number">1</span>]) + costs[i][<span class="number">0</span>];</span><br><span class="line">            blue[i] = <span class="built_in">min</span>(red[i - <span class="number">1</span>], green[i - <span class="number">1</span>]) + costs[i][<span class="number">1</span>];</span><br><span class="line">            green[i] = <span class="built_in">min</span>(red[i - <span class="number">1</span>], blue[i - <span class="number">1</span>]) + costs[i][<span class="number">2</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">min</span>(red[n - <span class="number">1</span>], <span class="built_in">min</span>(blue[n - <span class="number">1</span>], green[n - <span class="number">1</span>]));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="复杂度分析"><a href="#复杂度分析" class="headerlink" title="复杂度分析"></a>复杂度分析</h3><ul><li><p>时间复杂度：O(n)，其中 n 是房子个数。需要遍历全部房子一次，由于颜色数量固定是三种，因此对于每个房子计算粉刷房子的最小花费成本的时间是 O(1)，总时间复杂度是 O(n)。</p></li><li><p>空间复杂度：O(1)。使用空间优化的方法，只需要维护一个长度为 3 的数组，空间复杂度是 O(1)。</p></li></ul></div>]]></content>
      
      
      <categories>
          
          <category> 每日LeetCode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
            <tag> LeetCode </tag>
            
            <tag> 数据结构 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>(每日LeetCode)515. 在每个树行中找最大值(中等)</title>
      <link href="/2022/06/24/%E6%AF%8F%E6%97%A5LeetCode/2022-6/515%20%E5%9C%A8%E6%AF%8F%E4%B8%AA%E6%A0%91%E8%A1%8C%E4%B8%AD%E6%89%BE%E6%9C%80%E5%A4%A7%E5%80%BC/"/>
      <url>/2022/06/24/%E6%AF%8F%E6%97%A5LeetCode/2022-6/515%20%E5%9C%A8%E6%AF%8F%E4%B8%AA%E6%A0%91%E8%A1%8C%E4%B8%AD%E6%89%BE%E6%9C%80%E5%A4%A7%E5%80%BC/</url>
      
        <content type="html"><![CDATA[<div class="story post-story"><h2 id="题目："><a href="#题目：" class="headerlink" title="题目："></a>题目：</h2><p>给定一棵二叉树的根节点 <code>root</code> ，请找出该二叉树中每一层的最大值。</p></div><div class="story post-story"><h2 id="示例："><a href="#示例：" class="headerlink" title="示例："></a>示例：</h2><img src="https://assets.leetcode.com/uploads/2020/08/21/largest_e1.jpg" class="lazyload" data-srcset="https://assets.leetcode.com/uploads/2020/08/21/largest_e1.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img" style="zoom: 50%;"/><blockquote><p>输入: root &#x3D; [1,3,2,5,3,null,9]<br>输出: [1,3,9]</p></blockquote></div><div class="story post-story"><h2 id="思路：深度优先搜索"><a href="#思路：深度优先搜索" class="headerlink" title="思路：深度优先搜索"></a>思路：深度优先搜索</h2><p>我们采用树的<strong>先序遍历</strong>，来进行<strong>深度优先搜索</strong>，并用<code>pos</code>来记录<strong>当前树的高度</strong>，就可以通过<code>pos</code>高度来判断是否在同一层，并且是否更新此<strong>高度</strong>的最大值。</p></div><div class="story post-story"><h2 id="代码-cpp-："><a href="#代码-cpp-：" class="headerlink" title="代码(cpp)："></a>代码(cpp)：</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">(TreeNode* root, vector&lt;<span class="type">int</span>&gt;&amp; result, <span class="type">int</span> pos)</span></span>&#123;</span><br><span class="line">        <span class="comment">//如果该结点为空，则退出</span></span><br><span class="line">        <span class="keyword">if</span>(root == <span class="literal">nullptr</span>) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(result.<span class="built_in">size</span>() == pos)&#123;</span><br><span class="line">            <span class="comment">//数组的大小小于高度，大小需要加1</span></span><br><span class="line">            result.<span class="built_in">push_back</span>(root-&gt;val);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="comment">//判断该层的某个结点，与之前记录的比较大小</span></span><br><span class="line">            result[pos] = <span class="built_in">max</span>(result[pos], root-&gt;val);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//遍历左子树，高度+1</span></span><br><span class="line">        <span class="built_in">dfs</span>(root-&gt;left, result, pos+<span class="number">1</span>);</span><br><span class="line">        <span class="comment">//遍历右子树，高度+1</span></span><br><span class="line">        <span class="built_in">dfs</span>(root-&gt;right, result, pos+<span class="number">1</span>);        </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">largestValues</span><span class="params">(TreeNode* root)</span> </span>&#123;</span><br><span class="line">        vector&lt;<span class="type">int</span>&gt; result;</span><br><span class="line">    </span><br><span class="line">        <span class="built_in">dfs</span>(root, result, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="复杂度分析"><a href="#复杂度分析" class="headerlink" title="复杂度分析"></a>复杂度分析</h2><ul><li>时间复杂度：O(n)，其中 n 为二叉树节点个数。二叉树的遍历中每个节点会被访问一次且只会被访问一次。</li><li>空间复杂度：O(pos)。其中 pos 表示二叉树的高度。递归函数需要栈空间，而栈空间取决于递归的深度，因此空间复杂度等价于二叉树的高度。</li></ul></div>]]></content>
      
      
      <categories>
          
          <category> 每日LeetCode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
            <tag> LeetCode </tag>
            
            <tag> 数据结构 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>(每日LeetCode)30. 串联所有单词的子串</title>
      <link href="/2022/06/23/%E6%AF%8F%E6%97%A5LeetCode/2022-6/30%20%E4%B8%B2%E8%81%94%E6%89%80%E6%9C%89%E5%8D%95%E8%AF%8D%E7%9A%84%E5%AD%90%E4%B8%B2/"/>
      <url>/2022/06/23/%E6%AF%8F%E6%97%A5LeetCode/2022-6/30%20%E4%B8%B2%E8%81%94%E6%89%80%E6%9C%89%E5%8D%95%E8%AF%8D%E7%9A%84%E5%AD%90%E4%B8%B2/</url>
      
        <content type="html"><![CDATA[<div class="story post-story"><h2 id="题目："><a href="#题目：" class="headerlink" title="题目："></a>题目：</h2><p>给定一个字符串<code>s</code>和一些<strong>长度相同</strong>的单词<code>words</code>。找出<code>s</code>中恰好可以由<code>words</code>中所有单词串联形成的子串的起始位置。</p><p>注意子串要与<code>words</code>中的单词完全匹配，<strong>中间不能有其他字符</strong>，但不需要考虑<code>words</code>中单词串联的顺序。</p></div><div class="story post-story"><h2 id="示例："><a href="#示例：" class="headerlink" title="示例："></a>示例：</h2><blockquote><p>输入：s &#x3D; “barfoofoobarthefoobarman”, words &#x3D; [“bar”,”foo”,”the”]<br>输出：[6,9,12]</p></blockquote><p>输出返回字串的第一个字符在<code>s</code>中的位置</p><p>第一个字串：barfoo<em><strong>foobarthe</strong></em>foobarman  <code>6</code></p><p>第二个字串：barfoofoo<em><strong>barthefoo</strong></em>barman  <code>9</code></p><p>第三个字符：barfoofoobar<em><strong>thefoobar</strong></em>man  <code>12</code></p></div><div class="story post-story"><h2 id="思路：滑动窗口"><a href="#思路：滑动窗口" class="headerlink" title="思路：滑动窗口"></a>思路：滑动窗口</h2><blockquote><p><code>word_len</code>为每个单词的长度，因为每个单词的长度都相同；</p><p><code>word_num</code>为<code>words</code>数组中单词的个数；</p><p><code>total_len</code>为<code>words</code>数组中所有的单词的总长度；</p><p><code>map</code>来记录<code>words</code>数组中每个单词的个数；</p><p><code>t_map</code>遍历<code>s</code>时用来记录；</p><p>左指针<code>left</code>和右指针<code>right</code>用来当作左右边界；</p><p><code>count</code>用来统计已经匹配单词的个数，如果<code>count == word_num</code>，就证明匹配成功；</p><p>遍历<code>s</code>时无需一个一个字符的遍历，可以一个一个单词的遍历，<code>right += word_len</code>；</p><p>如果截取的单词<code>map</code>中不存在，则之前记录的全部无效，清空<code>t_map</code>和<code>count</code>；</p><p>如果某个单词在<code>t_map</code>中的个数大于<code>map</code>中的个数，就需要删除匹配的多余的单词，就需要删除窗口中第一个单词，直到某个单词出现的次数小于<code>map</code>中的个数</p></blockquote></div><div class="story post-story"><h2 id="代码-cpp-："><a href="#代码-cpp-：" class="headerlink" title="代码(cpp)："></a>代码(cpp)：</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">vector&lt;<span class="type">int</span>&gt; <span class="title">findSubstring</span><span class="params">(string s, vector&lt;string&gt;&amp; words)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//用来存放结果</span></span><br><span class="line">        vector&lt;<span class="type">int</span>&gt; result; </span><br><span class="line">        <span class="comment">//判断s和words是否为空，如果其中有一个为空，则返回空数组</span></span><br><span class="line">        <span class="keyword">if</span>(s.<span class="built_in">empty</span>()||words.<span class="built_in">empty</span>())&#123;</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125; </span><br><span class="line">        <span class="type">int</span> word_len = words[<span class="number">0</span>].<span class="built_in">size</span>(); <span class="comment">//一个单词的长度（每个单词长度都相同）</span></span><br><span class="line">        <span class="type">int</span> word_num = words.<span class="built_in">size</span>(); <span class="comment">// 单词的总个数</span></span><br><span class="line">        <span class="type">int</span> total_len = word_len*word_num; <span class="comment">// 全部单词的长度</span></span><br><span class="line">        <span class="comment">//建立单词-&gt;单词个数的映射</span></span><br><span class="line">        unordered_map&lt;string, <span class="type">int</span>&gt; map;</span><br><span class="line">        <span class="comment">//统计每个单词的个数</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> &amp;word : words)&#123;</span><br><span class="line">            <span class="comment">//map[key]:返回key值所对应的value值，如果不存在key值，则会使用该key值向当前容器中插入一个新value值为 0 </span></span><br><span class="line">            map[word]++; <span class="comment">//等价于 map[word] += 1</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i&lt; word_len; i++)&#123;</span><br><span class="line">            <span class="comment">//left和right用来表示窗口的左右边界</span></span><br><span class="line">            <span class="type">int</span> left = i;</span><br><span class="line">            <span class="type">int</span> right = i;</span><br><span class="line">            <span class="comment">//count用来统计已经匹配的单词个数</span></span><br><span class="line">            <span class="type">int</span> count = <span class="number">0</span>;</span><br><span class="line">            unordered_map&lt;string, <span class="type">int</span>&gt; t_map;</span><br><span class="line">            <span class="comment">//开始滑动窗口</span></span><br><span class="line">            <span class="comment">//right右边界依次累加单词的长度，直到超过s的长度停止循环 </span></span><br><span class="line">            <span class="keyword">while</span>(right + word_len &lt;= s.<span class="built_in">size</span>())&#123;</span><br><span class="line">                <span class="comment">//substr(pos, n):从第pos的位置开始截取n个字符获取单词</span></span><br><span class="line">                string word = s.<span class="built_in">substr</span>(right, word_len);</span><br><span class="line">                right += word_len; <span class="comment">//right跳到下一个单词</span></span><br><span class="line">                </span><br><span class="line">                <span class="comment">//count(key):在容器中查找以key键的键值对的个数。如果为0，说明此单词word在words数组中不存在。</span></span><br><span class="line">                <span class="keyword">if</span>(map.<span class="built_in">count</span>(word) == <span class="number">0</span>)&#123;</span><br><span class="line">                    count = <span class="number">0</span>; <span class="comment">//清空之前统计的个数</span></span><br><span class="line">                    left = right; <span class="comment">//将左指针left移动到右指针right位置上重新开始</span></span><br><span class="line">                    t_map.<span class="built_in">clear</span>(); <span class="comment">//之前匹配的单词没用了，清空t_map中的元素</span></span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">//如果不为0，说明此单词word在words数组中存在。</span></span><br><span class="line">                <span class="keyword">else</span>&#123;</span><br><span class="line">                    count++; <span class="comment">//统计个数加1</span></span><br><span class="line">                    t_map[word]++;<span class="comment">// word所对应的个数加1</span></span><br><span class="line">                    <span class="comment">//t_map中的word对应的个数大于map的word对应的个数，说明匹配到多余的单词了</span></span><br><span class="line">                    <span class="keyword">while</span>(t_map[word]&gt; map[word])&#123;</span><br><span class="line">                        <span class="comment">//获取窗口的第一个单词</span></span><br><span class="line">                        string t_word = s.<span class="built_in">substr</span>(left, word_len);</span><br><span class="line">                        <span class="comment">//将t_word这个单词对应的个数减1</span></span><br><span class="line">                        <span class="comment">//并非是那个大于map中个数的单词</span></span><br><span class="line">                        t_map[t_word]--;</span><br><span class="line">                        count--; <span class="comment">//统计个数减1</span></span><br><span class="line">                        left += word_len;<span class="comment">//将左指针跳到下一个</span></span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">//如果count等于单词的个数说明匹配成功，将左指针位置记录</span></span><br><span class="line">                    <span class="keyword">if</span>(count == word_num)&#123;</span><br><span class="line">                    result.<span class="built_in">push_back</span>(left);  </span><br><span class="line">                    &#125; </span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">         &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="复杂度分析"><a href="#复杂度分析" class="headerlink" title="复杂度分析"></a>复杂度分析</h2><ul><li>时间复杂度：O(ls×n)，其中 ls 是输入 s 的长度，n 是 words 中每个单词的长度。需要做 n 次滑动窗口，每次需要遍历一次 s。</li></ul></div>]]></content>
      
      
      <categories>
          
          <category> 每日LeetCode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
            <tag> LeetCode </tag>
            
            <tag> 数据结构 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>(每日LeetCode)513. 找树左下角的值</title>
      <link href="/2022/06/22/%E6%AF%8F%E6%97%A5LeetCode/2022-6/513%20%E6%89%BE%E6%A0%91%E5%B7%A6%E4%B8%8B%E8%A7%92%E7%9A%84%E5%80%BC/"/>
      <url>/2022/06/22/%E6%AF%8F%E6%97%A5LeetCode/2022-6/513%20%E6%89%BE%E6%A0%91%E5%B7%A6%E4%B8%8B%E8%A7%92%E7%9A%84%E5%80%BC/</url>
      
        <content type="html"><![CDATA[<div class="story post-story"><h2 id="题目："><a href="#题目：" class="headerlink" title="题目："></a>题目：</h2><p>给定一个二叉树的 <strong>根节点</strong> <code>root</code>，请找出该二叉树的 <strong>最底层 最左边</strong> 节点的值。</p><p>假设二叉树中至少有一个节点。</p></div><div class="story post-story"><h2 id="示例"><a href="#示例" class="headerlink" title="示例:"></a>示例:</h2><img src="https://assets.leetcode.com/uploads/2020/12/14/tree2.jpg" class="lazyload" data-srcset="https://assets.leetcode.com/uploads/2020/12/14/tree2.jpg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="img" style="zoom:50%;"/><blockquote><p>输入: [1,2,3,4,null,5,6,null,null,7]<br>输出: 7</p></blockquote></div><div class="story post-story"><h2 id="思路：深度优先搜索-DFS"><a href="#思路：深度优先搜索-DFS" class="headerlink" title="思路：深度优先搜索(DFS)"></a>思路：深度优先搜索(DFS)</h2><p>我采用了<strong>优先遍历左节点，再遍历右节点</strong>，因为只有优先遍历左节点，才会优先记录当前深度左节点的值，所以就没有必要记录当前深度右边的值了。</p><p>使用<code>depth</code>记录<strong>当前树的深度</strong>，<code>current_val</code>为<strong>记录的深度</strong><code>current_depth</code>的<strong>最左边的值</strong>。</p><p>进行判断如果<code>depth</code>的深度大于<code>current_depth</code>的深度，将<code>current_val</code>的值设置为当前结点的值，并将<code>current_depth</code>的值设置当前结点深度<code>depth</code></p></div><div class="story post-story"><h2 id="代码-cpp-："><a href="#代码-cpp-：" class="headerlink" title="代码(cpp)："></a>代码(cpp)：</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">(TreeNode* root, <span class="type">int</span> depth, <span class="type">int</span>&amp; current_depth, <span class="type">int</span>&amp; current_val)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (root == <span class="literal">nullptr</span>) <span class="comment">//如果当前结点为空，则退出</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//优先遍历左节点，深度加1</span></span><br><span class="line">        <span class="built_in">dfs</span>(root-&gt;left, depth+<span class="number">1</span>, current_depth, current_val);</span><br><span class="line">        <span class="comment">//其次遍历右节点，深度加1</span></span><br><span class="line">        <span class="built_in">dfs</span>(root-&gt;right, depth+<span class="number">1</span>, current_depth, current_val);</span><br><span class="line">        <span class="comment">//如果当前深度大于记录的深度</span></span><br><span class="line">        <span class="keyword">if</span> (depth &gt; current_depth)</span><br><span class="line">        &#123;</span><br><span class="line">            current_depth = depth; <span class="comment">//将当前深度记录到current_depth</span></span><br><span class="line">            current_val = root-&gt;val; <span class="comment">//将当前结点值记录到current_val</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">findBottomLeftValue</span><span class="params">(TreeNode* root)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> current_depth = <span class="number">0</span>; <span class="comment">//初始化current_depth</span></span><br><span class="line">        <span class="type">int</span> current_val = <span class="number">0</span>; <span class="comment">//初始化current_val</span></span><br><span class="line">        <span class="comment">//因为有根结点存在，将depth设置为1，而非0</span></span><br><span class="line">        <span class="built_in">dfs</span>(root, <span class="number">1</span>, current_depth, current_val);</span><br><span class="line">        <span class="keyword">return</span> current_val;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></div><div class="story post-story"><h2 id="复杂度分析"><a href="#复杂度分析" class="headerlink" title="复杂度分析"></a>复杂度分析</h2><ul><li><p>​时间复杂度：O(n)，其中 n 是二叉树的节点数目。需要遍历 n 个节点。</p></li><li><p>​空间复杂度：O(n)。递归栈需要占用 O(n) 的空间。</p></li></ul></div>]]></content>
      
      
      <categories>
          
          <category> 每日LeetCode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
            <tag> LeetCode </tag>
            
            <tag> 数据结构 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
